"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8710],{5593:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>a,frontMatter:()=>i,metadata:()=>s,toc:()=>t});var p=d(5893),r=d(1151);const i={sidebar_position:1},c="MPP\u4f7f\u7528\u6307\u5357",s={id:"Luban-SDK/part2/06-5_MPP-Useguide",title:"MPP\u4f7f\u7528\u6307\u5357",description:"1. \u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/Luban-SDK/part2/06-5_MPP-Useguide.md",sourceDirName:"Luban-SDK/part2",slug:"/Luban-SDK/part2/06-5_MPP-Useguide",permalink:"/docs/Luban-SDK/part2/06-5_MPP-Useguide",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/Luban-SDK/part2/06-5_MPP-Useguide.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"lunbansdkSidebar",previous:{title:"MPP\u5f00\u53d1",permalink:"/docs/category/mpp\u5f00\u53d1"},next:{title:"MPP \u64ad\u653e\u5668\u4f7f\u7528\u6307\u5357",permalink:"/docs/Luban-SDK/part2/06-6_MPPPlayer-Useguide"}},l={},t=[{value:"1. \u6a21\u5757\u4ecb\u7ecd",id:"1-\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"1.1. \u672f\u8bed\u5b9a\u4e49",id:"11-\u672f\u8bed\u5b9a\u4e49",level:2},{value:"1.2. \u6a21\u5757\u7b80\u4ecb",id:"12-\u6a21\u5757\u7b80\u4ecb",level:2},{value:"2.1. \u5185\u6838\u914d\u7f6e",id:"21-\u5185\u6838\u914d\u7f6e",level:2},{value:"2.1.1. MPP Heap",id:"211-mpp-heap",level:3},{value:"2.1.2. VE \u9a71\u52a8",id:"212-ve-\u9a71\u52a8",level:3},{value:"2.2. DTS \u53c2\u6570\u914d\u7f6e",id:"22-dts-\u53c2\u6570\u914d\u7f6e",level:2},{value:"3.1. \u8c03\u8bd5\u5f00\u5173",id:"31-\u8c03\u8bd5\u5f00\u5173",level:2},{value:"3.1.1. MPP\u8c03\u8bd5",id:"311-mpp\u8c03\u8bd5",level:3},{value:"3.1.2. \u5b50\u6a21\u5757\u8c03\u8bd5",id:"312-\u5b50\u6a21\u5757\u8c03\u8bd5",level:3},{value:"3.1.3. MPP Heap \u8c03\u8bd5",id:"313-mpp-heap-\u8c03\u8bd5",level:3},{value:"4.1. \u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b",id:"41-\u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b",level:2},{value:"4.1.1. mpp_test",id:"411-mpp_test",level:3},{value:"4.1.2. pic_test",id:"412-pic_test",level:3},{value:"5.1. \u6e90\u7801\u8bf4\u660e",id:"51-\u6e90\u7801\u8bf4\u660e",level:2},{value:"5.2. \u6a21\u5757\u67b6\u6784",id:"52-\u6a21\u5757\u67b6\u6784",level:2},{value:"5.2.1. MPP \u8f6f\u4ef6\u6846\u67b6",id:"521-mpp-\u8f6f\u4ef6\u6846\u67b6",level:3},{value:"5.3. mpp_decoder \u8bbe\u8ba1\u4ee5\u53ca\u63a5\u53e3\u8bf4\u660e",id:"53-mpp_decoder-\u8bbe\u8ba1\u4ee5\u53ca\u63a5\u53e3\u8bf4\u660e",level:2},{value:"5.3.1. packet \u7ba1\u7406\u673a\u5236",id:"531-packet-\u7ba1\u7406\u673a\u5236",level:3},{value:"5.3.2. frame \u7ba1\u7406\u673a\u5236",id:"532-frame-\u7ba1\u7406\u673a\u5236",level:3},{value:"5.3.3. \u7269\u7406\u8fde\u7eed\u5185\u5b58\u4f7f\u7528\u60c5\u51b5",id:"533-\u7269\u7406\u8fde\u7eed\u5185\u5b58\u4f7f\u7528\u60c5\u51b5",level:3},{value:"5.3.4. mpp_decoder \u8c03\u7528\u6d41\u7a0b",id:"534-mpp_decoder-\u8c03\u7528\u6d41\u7a0b",level:3},{value:"5.3.5. mpp_decoder \u6570\u636e\u7ed3\u6784",id:"535-mpp_decoder-\u6570\u636e\u7ed3\u6784",level:3},{value:"5.3.5.1. struct decode_config",id:"5351-struct-decode_config",level:4},{value:"5.3.5.2. struct mpp_packet",id:"5352-struct-mpp_packet",level:4},{value:"5.3.5.3. struct mpp_frame",id:"5353-struct-mpp_frame",level:4},{value:"5.3.5.4. enum mpp_dec_errno",id:"5354-enum-mpp_dec_errno",level:4},{value:"5.3.5.5. enum mpp_codec_type",id:"5355-enum-mpp_codec_type",level:4},{value:"5.3.5.6. enum mpp_dec_cmd",id:"5356-enum-mpp_dec_cmd",level:4},{value:"5.3.6. mpp_decoder \u63a5\u53e3\u8bbe\u8ba1",id:"536-mpp_decoder-\u63a5\u53e3\u8bbe\u8ba1",level:3},{value:"5.3.6.1. mpp_decoder_create",id:"5361-mpp_decoder_create",level:4},{value:"5.3.6.2. mpp_decoder_destory",id:"5362-mpp_decoder_destory",level:4},{value:"5.3.6.3. mpp_decoder_init",id:"5363-mpp_decoder_init",level:4},{value:"5.3.6.4. mpp_decoder_decode",id:"5364-mpp_decoder_decode",level:4},{value:"5.3. mpp_decoder_control",id:"53-mpp_decoder_control",level:4},{value:"5.3.6.6. mpp_decoder_reset",id:"5366-mpp_decoder_reset",level:4},{value:"5.3.6.7. mpp_decoder_get_packet",id:"5367-mpp_decoder_get_packet",level:4},{value:"5.3.6.8. mpp_decoder_put_packet",id:"5368-mpp_decoder_put_packet",level:4},{value:"5.3.6.9. mpp_decoder_get_frame",id:"5369-mpp_decoder_get_frame",level:4},{value:"5.3.6.10. mpp_decoder_put_frame",id:"53610-mpp_decoder_put_frame",level:4},{value:"5.3.7. mpp_decoder \u53c2\u8003demo",id:"537-mpp_decoder-\u53c2\u8003demo",level:3},{value:"5.4. mpp_encoder \u8bbe\u8ba1\u53ca\u63a5\u53e3\u8bf4\u660e",id:"54-mpp_encoder-\u8bbe\u8ba1\u53ca\u63a5\u53e3\u8bf4\u660e",level:2},{value:"5.4.1. \u63a5\u53e3\u8bbe\u8ba1",id:"541-\u63a5\u53e3\u8bbe\u8ba1",level:3},{value:"5.4.1.1. mpp_encode_jpeg",id:"5411-mpp_encode_jpeg",level:4},{value:"5.4.2. mpp_encoder \u53c2\u8003demo",id:"542-mpp_encoder-\u53c2\u8003demo",level:3},{value:"5.5. mpp_ge \u63a5\u53e3\u8bf4\u660e",id:"55-mpp_ge-\u63a5\u53e3\u8bf4\u660e",level:2},{value:"5.6. mpp heap \u8bbe\u8ba1\u53ca\u8bf4\u660e",id:"56-mpp-heap-\u8bbe\u8ba1\u53ca\u8bf4\u660e",level:2},{value:"5.6.1. mpp heap \u7279\u70b9",id:"561-mpp-heap-\u7279\u70b9",level:3},{value:"5.6.2. mpp heap init",id:"562-mpp-heap-init",level:3},{value:"5.6.3. mpp heap export\xb6",id:"563-mpp-heap-export",level:3},{value:"5.6.4. mpp heap close\xb6",id:"564-mpp-heap-close",level:3},{value:"5. mpp heap destroy",id:"5-mpp-heap-destroy",level:3},{value:"5.6.6. mpp heap \u63a5\u53e3",id:"566-mpp-heap-\u63a5\u53e3",level:3},{value:"5.6.7. mpp heap \u8bbe\u7f6e",id:"567-mpp-heap-\u8bbe\u7f6e",level:3},{value:"6.1. VE\u9a71\u52a8\u672a\u52a0\u8f7d",id:"61-ve\u9a71\u52a8\u672a\u52a0\u8f7d",level:2},{value:"6.2. \u89e3\u7801\u56fe\u50cf\u82b1\u5c4f",id:"62-\u89e3\u7801\u56fe\u50cf\u82b1\u5c4f",level:2},{value:"6.2.1. \u73b0\u8c61",id:"621-\u73b0\u8c61",level:3},{value:"6.2.2. \u539f\u56e0\u5206\u6790",id:"622-\u539f\u56e0\u5206\u6790",level:3},{value:"6.3. \u56fe\u50cf\u89e3\u7801\u51fa\u9519",id:"63-\u56fe\u50cf\u89e3\u7801\u51fa\u9519",level:2},{value:"6.4. \u7533\u8bf7 dmabuf \u5931\u8d25",id:"64-\u7533\u8bf7-dmabuf-\u5931\u8d25",level:2},{value:"6.4.1. \u73b0\u8c61",id:"641-\u73b0\u8c61",level:3},{value:"6.4.2. \u539f\u56e0\u5206\u6790",id:"642-\u539f\u56e0\u5206\u6790",level:3}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.h1,{id:"mpp\u4f7f\u7528\u6307\u5357",children:"MPP\u4f7f\u7528\u6307\u5357"}),"\n",(0,p.jsx)(n.h2,{id:"1-\u6a21\u5757\u4ecb\u7ecd",children:"1. \u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,p.jsx)(n.h2,{id:"11-\u672f\u8bed\u5b9a\u4e49",children:"1.1. \u672f\u8bed\u5b9a\u4e49"}),"\n",(0,p.jsxs)(n.table,{children:[(0,p.jsx)(n.thead,{children:(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.th,{children:"\u672f\u8bed"}),(0,p.jsx)(n.th,{children:"\u5b9a\u4e49"}),(0,p.jsx)(n.th,{children:"\u6ce8\u91ca\u8bf4\u660e"})]})}),(0,p.jsxs)(n.tbody,{children:[(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"VE"}),(0,p.jsx)(n.td,{children:"Video Engine"}),(0,p.jsx)(n.td,{children:"\u89c6\u9891\u52a0\u901f\u5f15\u64ce"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"MPP"}),(0,p.jsx)(n.td,{children:"Media Process Platform"}),(0,p.jsx)(n.td,{children:"\u901a\u7528\u591a\u5a92\u4f53\u5904\u7406\u8f6f\u4ef6\u5e73\u53f0"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"packet"}),(0,p.jsx)(n.td,{children:"video bitstream packet"}),(0,p.jsx)(n.td,{children:"\u4e00\u5e27\u89c6\u9891\u6216\u56fe\u7247\u7801\u6d41\u6570\u636e"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"frame"}),(0,p.jsx)(n.td,{children:"frame"}),(0,p.jsx)(n.td,{children:"\u4e00\u5e27\u89e3\u7801\u540e\u7684\u89c6\u9891\u6216\u56fe\u7247\u6570\u636e"})]})]})]}),"\n",(0,p.jsx)(n.h2,{id:"12-\u6a21\u5757\u7b80\u4ecb",children:"1.2. \u6a21\u5757\u7b80\u4ecb"}),"\n",(0,p.jsx)(n.p,{children:"MPP(Media Process Platform)\u662f Artinchip \u81ea\u4e3b\u7814\u53d1\u7684\u901a\u7528\u591a\u5a92\u4f53\u5904\u7406\u8f6f\u4ef6\u5e73\u53f0\uff0c\u9002\u7528\u4e8e Artinchip \u82af\u7247\u7cfb\u5217\u3002\u652f\u6301\u5728 Linux \u5e73\u53f0\u4e0a\u8fd0\u884c\uff0c \u5c4f\u853d\u4e86Artinchip\u4e0d\u540c\u82af\u7247\u5e73\u53f0\u591a\u79cd\u591a\u5a92\u4f53\u786c\u4ef6\u6a21\u5757\uff08VE\u3001GE \u7b49\uff09\u7248\u672c\u7684\u5dee\u5f02\uff0c\u4e3a\u4f7f\u7528\u8005\u63d0\u4f9b\u7b80\u5355\u6613\u7528\u7684\u591a\u5a92\u4f53\u5904\u7406 API\uff0c\u652f\u6301\u591a\u79cd\u591a\u5a92\u4f53\u89e3\u51b3\u65b9\u6848\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u76ee\u524d\u652f\u6301\u786c\u4ef6\u6a21\u5757\u5305\u62ec\uff1a"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"VE\uff1a\u89c6\u9891\u3001\u56fe\u7247\u7f16\u89e3\u7801\u529f\u80fd"}),"\n",(0,p.jsx)(n.li,{children:"GE\uff1a2D\u56fe\u5f62\u52a0\u901f"}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:"MPP\u5728\u7cfb\u7edf\u67b6\u6784\u7684\u5c42\u6b21\u56fe\u5982\u4e0b\u56fe\uff1a"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_system1-17066914716631.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_system1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.43 ",(0,p.jsx)(n.em,{children:"MPP\u7cfb\u7edf\u6846\u67b6\u5c42\u6b21\u56fe"})]}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"\u786c\u4ef6\u5c42 Hardware"}),"\n",(0,p.jsx)(n.p,{children:"\u786c\u4ef6\u5c42\u662f Artinchip \u7cfb\u5217\u82af\u7247\u5e73\u53f0\u7684\u591a\u5a92\u4f53\u786c\u4ef6\u52a0\u901f\u5f15\u64ce VE/GE\u3002VE \u6a21\u5757\u786c\u4ef6\u5c42\u63a5\u53e3\u8bf7\u53c2\u8003\u82af\u7247\u7528\u6237\u624b\u518c VE \u6a21\u5757GE \u6a21\u5757\u786c\u4ef6\u5c42\u63a5\u53e3\u8bf7\u53c2\u8003\u82af\u7247\u7528\u6237\u624b\u518c GE \u6a21\u5757"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"MPP \u5185\u6838\u7a7a\u95f4\u5c42"}),"\n",(0,p.jsxs)(n.p,{children:["\u5305\u62ec VE/GE \u6a21\u5757\u9a71\u52a8\uff0cMPP Heap \u5185\u5b58\u7ba1\u7406\u6846\u67b6\u3002VE \u6a21\u5757\u9a71\u52a8\u8bf7\u53c2\u8003 ",(0,p.jsx)(n.a,{href:"../ve/index.html#ref-luban-ve",children:"VE \u4f7f\u7528\u6307\u5357"}),"GE \u6a21\u5757\u9a71\u52a8\u8bf7\u53c2\u8003 ",(0,p.jsx)(n.a,{href:"../ge/index.html#ref-luban-ge",children:"GE \u4f7f\u7528\u6307\u5357"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"MPP \u7528\u6237\u7a7a\u95f4\u5c42"}),"\n",(0,p.jsx)(n.p,{children:"MPP \u7528\u6237\u6001\u7a0b\u5e8f\uff0c\u5305\u62ec \u89c6\u9891\u89e3\u7801 mpp_decoder\u3001\u89c6\u9891\u7f16\u7801 mpp_encoder\u30012D\u56fe\u50cf\u5904\u7406 mpp_ge \u7b49\u529f\u80fd\u6a21\u5757\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"\u5e94\u7528\u5c42"}),"\n",(0,p.jsx)(n.p,{children:"\u5206\u4e3a\u4e24\u90e8\u5206\uff1a\u63d0\u4f9b\u7b80\u6613\u64ad\u653e\u5668\u5e94\u7528 mpp_player; \u5bf9\u63a5\u7b2c\u4e09\u65b9\u5f00\u6e90\u5e93 openmax\u3001gstreamer\u3001lvgl\u7b49\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsx)(n.h1,{id:"2-\u53c2\u6570\u914d\u7f6e",children:"2. \u53c2\u6570\u914d\u7f6e"}),"\n",(0,p.jsx)(n.h2,{id:"21-\u5185\u6838\u914d\u7f6e",children:"2.1. \u5185\u6838\u914d\u7f6e"}),"\n",(0,p.jsx)(n.p,{children:"MPP \u4f9d\u8d56 VE \u9a71\u52a8\uff0cMPP Heap \u5185\u5b58\u7ba1\u7406\u6846\u67b6\uff0c\u8bf7\u5728 MPP \u7f16\u8bd1\u524d\u8fdb\u884c\u914d\u7f6e\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"211-mpp-heap",children:"2.1.1. MPP Heap"}),"\n",(0,p.jsx)(n.p,{children:"ArtInChip \u5e73\u53f0\u4f7f\u7528 DMA-BUF \u6765\u5b9e\u73b0\u591a\u5a92\u4f53\u6a21\u5757\u95f4\u7684 buffer \u5171\u4eab\u3002\u5bf9\u4e8e DMA-BUF\uff0cKernel \u63d0\u4f9b System Heap \u548c CMA Heap \u4e24\u4e2a exporter\u3002 \u524d\u8005\u76f4\u63a5\u7533\u8bf7\u533f\u540d\u9875\u9762\uff0c\u540e\u8005\u5219\u5728 CMA \u5185\u5b58\u4e2d\u7533\u8bf7\u9875\u9762\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u867d\u7136\u901a\u8fc7\u8fd9\u4e24\u4e2a exporter \u90fd\u80fd\u62ff\u5230\u8db3\u591f\u7684\u7269\u7406\u8fde\u7eed\u5185\u5b58\uff0c\u4f46\u5b83\u4eec\u5728\u7cfb\u7edf\u957f\u65f6\u95f4\u8fd0\u884c\u540e\uff0c\u90fd\u9762\u4e34\u5185\u5b58\u788e\u7247\u5316\u95ee\u9898\u3002\u7279\u522b\u662f\u5728 64 M \u5c0f\u5185\u5b58\u65b9\u6848\u4e2d\uff0c\u788e\u7247\u5316\u95ee\u9898\u5c24\u4e3a\u4e25\u91cd\u3002"}),"\n",(0,p.jsxs)(n.p,{children:["\u4e3a\u4e86 ",(0,p.jsx)(n.strong,{children:"\u89e3\u51b3\u5185\u5b58\u788e\u7247\u5316"})," \u7684\u95ee\u9898\uff0cArtInChip \u57fa\u4e8e CMA Heap \u8fdb\u884c\u5c01\u88c5\uff0c\u63d0\u4f9b\u4e00\u4e2a\u79c1\u6709\u7684 exporter \uff0c\u5373 ",(0,p.jsx)(n.strong,{children:"MPP Heap"})," \u3002"]}),"\n",(0,p.jsx)(n.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make kernel-menuconfig\uff0c\u8fdb\u5165 kernel \u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"Linux\n    Device Drivers  ---\x3e\n        DMABUF options ---\x3e\n            [*] Explicit Synchronization Framework\n            [*]   Sync File Validation Framework\n            [*] userspace dmabuf misc driver\n            [ ] Move notify between drivers (EXPERIMENTAL)\n            < > Selftests for the dma-buf interfaces\n            [*] DMA-BUF Userland Memory Heaps  ---\x3e\n                [ ]   DMA-BUF System Heap\n                [*]   DMA-BUF CMA Heap\n                [*]   DMA-BUF MPP Heap\n"})}),"\n",(0,p.jsx)(n.p,{children:"MPP Heap \u5728 CMA \u5185\u5b58\u4e2d\u7533\u8bf7\u4e00\u5927\u5757\u7269\u7406\u8fde\u7eed\u5185\u5b58\uff0c\u4f7f\u7528 genpool \u7b97\u6cd5\u8fdb\u884c\u7ba1\u7406\uff0c\u63d0\u4f9b\u7ed9 MPP \u4e2d\u95f4\u4ef6\u4e13\u7528\uff0c\u5176\u5927\u5c0f\u914d\u7f6e\uff1a"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"Linux\n    Library routines  ---\x3e\n        [*] DMA Contiguous Memory Allocator\n        [ ]   Enable separate DMA Contiguous Memory Area for each NUMA Node\n        *** Default contiguous memory area size: ***\n        (16)  Size in Mega Bytes\n        (8)   Size in Mega Bytes for MPP Heap\n"})}),"\n",(0,p.jsx)(n.p,{children:"\u5728\u4e0a\u8ff0\u4f8b\u5b50\u4e2d\uff0c\u7cfb\u7edf\u9884\u7559\u4e86 16M CMA \u5185\u5b58\uff0cMPP Heap \u518d\u4ece 16M CMA \u5185\u5b58\u4e2d\u7533\u8bf7 8M\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u56e0\u4e3a MPP Heap \u7684\u5185\u5b58\u662f\u4ece CMA \u4e2d\u7533\u8bf7\u7684\uff0c\u524d\u8005\u662f\u540e\u8005\u7684\u5b50\u96c6\uff0c\u6240\u4ee5 MPP Heap \u7684 size \u8981\u5c0f\u4e8e CMA \u7684 size\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u6ce8\u89e3"}),"\n",(0,p.jsxs)(n.p,{children:["\u4e3a\u4e86\u517c\u987e\u7cfb\u7edf\u4e2d\u5176\u4ed6\u9700\u8981\u7269\u7406\u8fde\u7eed\u5185\u5b58\u7684\u6a21\u5757\uff0c\u4e0d\u80fd\u5c06 CMA \u5185\u5b58\u5168\u90e8\u5206\u914d\u7ed9 MPP Heap\uff0c\u5206\u914d\u6570\u503c\u8bbe\u7f6e\u53ef\u53c2\u8003 ",(0,p.jsx)(n.a,{href:"5_design_guide.html#ref-mpp-heap-size",children:"mpp heap \u8bbe\u7f6e"}),"\u3002"]}),"\n",(0,p.jsx)(n.h3,{id:"212-ve-\u9a71\u52a8",children:"2.1.2. VE \u9a71\u52a8"}),"\n",(0,p.jsxs)(n.p,{children:["VE \u6a21\u5757\u9a71\u52a8\u914d\u7f6e\u8bf7\u53c2\u8003 VE \u4f7f\u7528\u6307\u5357 ",(0,p.jsx)(n.a,{href:"../ve/2_config_guide.html#ref-ve-config",children:"\u5185\u6838\u914d\u7f6e"})]}),"\n",(0,p.jsx)(n.h2,{id:"22-dts-\u53c2\u6570\u914d\u7f6e",children:"2.2. DTS \u53c2\u6570\u914d\u7f6e"}),"\n",(0,p.jsxs)(n.p,{children:["VE \u6a21\u5757 DTS \u914d\u7f6e\u8bf7\u53c2\u8003 VE \u4f7f\u7528\u6307\u5357 ",(0,p.jsx)(n.a,{href:"../ve/2_config_guide.html#ref-ve-config",children:"\u5185\u6838\u914d\u7f6e"})]}),"\n",(0,p.jsx)(n.h1,{id:"3-\u8c03\u8bd5\u6307\u5357",children:"3. \u8c03\u8bd5\u6307\u5357"}),"\n",(0,p.jsx)(n.h2,{id:"31-\u8c03\u8bd5\u5f00\u5173",children:"3.1. \u8c03\u8bd5\u5f00\u5173"}),"\n",(0,p.jsx)(n.h3,{id:"311-mpp\u8c03\u8bd5",children:"3.1.1. MPP\u8c03\u8bd5"}),"\n",(0,p.jsx)(n.p,{children:"MPP\u8c03\u8bd5log\u7b49\u7ea7\u5206\u4e3aERROR, WARNING, INFO, DEBUG, VERBOSE\u3002\u901a\u8fc7LOGL_DEFAULT\u5b9a\u4e49MPP\u5168\u5c40\u7684log\u7b49\u7ea7\u3002 \u9ed8\u8ba4log\u7b49\u7ea7\u4e3aINFO\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u6e90\u6587\u4ef6\u8def\u5f84\uff1aaic-mpp/base/log.h"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"enum log_level {\n    LOGL_ERROR = 0,\n    LOGL_WARNING,\n    LOGL_INFO,\n    LOGL_DEBUG,\n    LOGL_VERBOSE,\n\n    LOGL_COUNT,\n\n    LOGL_DEFAULT = LOGL_INFO,\n    LOGL_FORCE_DEBUG = 0x10,\n};\n"})}),"\n",(0,p.jsx)(n.h3,{id:"312-\u5b50\u6a21\u5757\u8c03\u8bd5",children:"3.1.2. \u5b50\u6a21\u5757\u8c03\u8bd5"}),"\n",(0,p.jsx)(n.p,{children:"\u6253\u5f00\u5b50\u6a21\u5757\u8c03\u8bd5log\u65b9\u5f0f\uff0c\u5728\u5b50\u6a21\u5757\u4e2d\u6dfb\u52a0\uff1a"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"#define LOG_DEBUG\n"})}),"\n",(0,p.jsx)(n.h3,{id:"313-mpp-heap-\u8c03\u8bd5",children:"3.1.3. MPP Heap \u8c03\u8bd5"}),"\n",(0,p.jsx)(n.p,{children:"\u6253\u5f00 MPP Heap \u8c03\u8bd5\u5f00\u5173\uff0c\u53ef\u67e5\u770b MPP \u4e2d\u95f4\u4ef6\u5bf9\u9884\u7559\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make kernel-menuconfig\uff0c\u8fdb\u5165 kernel \u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"Linux\n    Memory Management options  ---\x3e\n        [*]   MPP debugfs interface\n"})}),"\n",(0,p.jsx)(n.p,{children:"\u7cfb\u7edf\u542f\u52a8\u540e\u6302\u8f7d debugfs"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"mount -t debugfs none /sys/kernel/debug/\n"})}),"\n",(0,p.jsx)(n.p,{children:"\u901a\u8fc7\u67e5\u770b mpp \u76ee\u5f55\u4e0b\u7684\u8282\u70b9\uff0c\u5373\u53ef\u83b7\u53d6 mpp heap \u7684\u5185\u5b58\u4f7f\u7528\u60c5\u51b5"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"# cd /sys/kernel/dedbug/mpp/\n# ls\nbitmap    count     maxchunk  used\n# cat count\n2048\n# cat used\n600\n# cat maxchunk\n1448\n# cat bitmap\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 16777215 0 0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n"})}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"count : MPP Heap \u4e2d\u5305\u542b\u7684 page \u603b\u6570"}),"\n",(0,p.jsx)(n.li,{children:"used : MPP Heap \u4e2d\u5df2\u88ab\u7533\u8bf7\u7684 page \u603b\u6570"}),"\n",(0,p.jsx)(n.li,{children:"maxchunk : MPP Heap \u4e2d\u8fd8\u80fd\u7533\u8bf7\u5230\u6700\u5927\u7684\u8fde\u7eed page \u603b\u6570"}),"\n",(0,p.jsx)(n.li,{children:"bitmap : MPP Heap \u4e2d\u8bb0\u5f55 page \u72b6\u6001\u7684 bitmap"}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:"\u4e00\u4e2a page \u5927\u5c0f\u4e3a 4K \uff0c bitmap \u8282\u70b9\u6253\u5370\u8f93\u51fa\u5341\u8fdb\u5236\u6570\u636e\u3002"}),"\n",(0,p.jsxs)(n.p,{children:["4294967295 \u8f6c\u6362\u4e3a\u5341\u516d\u8fdb\u5236\u4e3a ",(0,p.jsx)(n.code,{children:"0xFFFFFFFF"})," \uff0c \u4e8c\u8fdb\u5236\u4e3a ",(0,p.jsx)(n.code,{children:"0b11111111111111111111111111111111"})," \u3002 \u4e00\u4e2a bit \u8868\u793a\u4e00\u4e2a page \u7684\u72b6\u6001\uff0c1 \u8868\u793a\u5df2\u88ab\u7533\u8bf7\uff0c0 \u8868\u793a\u7a7a\u95f2\u30024294967295 \u8868\u793a 32 \u4e2a page \u5168\u90e8\u88ab\u5360\u7528\uff0c\u603b\u5171 32 * 4K \u5927\u5c0f\u3002"]}),"\n",(0,p.jsx)(n.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,p.jsx)(n.p,{children:"\u5b9e\u9645\u8c03\u8bd5\u65f6\u8981\u6ce8\u610f\u5927\u5c0f\u7aef\u95ee\u9898\u3002"}),"\n",(0,p.jsx)(n.h1,{id:"4-\u6d4b\u8bd5\u6307\u5357",children:"4. \u6d4b\u8bd5\u6307\u5357"}),"\n",(0,p.jsx)(n.h2,{id:"41-\u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b",children:"4.1. \u8fd0\u884c\u6d4b\u8bd5\u7528\u4f8b"}),"\n",(0,p.jsx)(n.h3,{id:"411-mpp_test",children:"4.1.1. mpp_test"}),"\n",(0,p.jsx)(n.p,{children:"mpp_test \u7684\u4e3b\u8981\u529f\u80fd\u662f\u6d4b\u8bd5 mpp_decoder \u63a5\u53e3\uff0c\u89e3\u7801\u89c6\u9891\u6216\u56fe\u7247\u6587\u4ef6\u5e76\u901a\u8fc7 display \u63a5\u53e3\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u76ee\u524d\u652f\u6301 h264, jpg\uff0cpng \u7684\u89e3\u7801\u548c\u663e\u793a\uff0c\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\uff1a"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"[aic@] # mpp_test -h\nUsage: mpp_test [options]:\n    -i                             input stream file name\n    -t                             directory of test files\n    -d                             display the picture\n    -c                             enable compare output data\n    -f                             output pixel format\n    -l                             loop time\n    -s                             save output data\n    -h                             help\n\nExample1(test single file): mpp_test -i test.264\nExample2(test some files) : mpp_test -t /usr/data/\n"})}),"\n",(0,p.jsx)(n.h3,{id:"412-pic_test",children:"4.1.2. pic_test"}),"\n",(0,p.jsx)(n.p,{children:"pic_test \u7684\u4e3b\u8981\u529f\u80fd\u662f\u6d4b\u8bd5 JPEG/PNG \u56fe\u7247\u89e3\u7801\u548c\u663e\u793a\uff0c\u76f8\u6bd4\u4e8e mpp_test \u4ee3\u7801\u66f4\u52a0\u7cbe\u7b80\u3002"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"[aic@] # pic_test -h\nUsage: dec_test [options]\n\nOptions:\n-i                             input stream file name\n-h                             help\n"})}),"\n",(0,p.jsx)(n.h1,{id:"5-\u8bbe\u8ba1\u8bf4\u660e",children:"5. \u8bbe\u8ba1\u8bf4\u660e"}),"\n",(0,p.jsx)(n.h2,{id:"51-\u6e90\u7801\u8bf4\u660e",children:"5.1. \u6e90\u7801\u8bf4\u660e"}),"\n",(0,p.jsx)(n.p,{children:"\u5728 luban \u7684\u6839\u76ee\u5f55\u4e0b\u901a\u8fc7 make menuconfig \u6253\u5f00 aic-mpp\uff0c\u5e76\u8fdb\u884c\u7f16\u8bd1\u3002"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"Artinchip packages  ---\x3e\n    [*] aic-mpp\n"})}),"\n",(0,p.jsx)(n.p,{children:"\u6e90\u6587\u4ef6\u76ee\u5f55\uff1a"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"aic-mpp$ tree\n.\n\u251c\u2500\u2500 base             // \u516c\u5171\u6a21\u5757\uff1a\u5305\u62ec\u5185\u5b58\u5206\u914d\u548c\u94fe\u8868\u7b49\u57fa\u7840\u529f\u80fd\n\u2502   \u251c\u2500\u2500 memory\n\u251c\u2500\u2500 ge              // 2D \u56fe\u5f62\u52a0\u901f\u6a21\u5757\n\u251c\u2500\u2500 ve              // \u7f16\u89e3\u7801\u5668\u6a21\u5757\n|   \u251c\u2500\u2500 include     // ve \u6a21\u5757\u5934\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 common      // \u7f16\u89e3\u7801\u5668\u516c\u5171\u7ec4\u4ef6\n|   \u251c\u2500\u2500 decoder\n\u2502        \u251c\u2500\u2500 h264   // h.264 \u89e3\u7801\u6a21\u5757\n\u2502        \u251c\u2500\u2500 jpeg   // jpg \u89e3\u7801\u6a21\u5757\n\u2502        \u2514\u2500\u2500 png    // png \u89e3\u7801\u6a21\u5757\n\u251c\u2500\u2500 include         // mpp \u5bf9\u5916\u5934\u6587\u4ef6\n\u251c\u2500\u2500 mpp_test        // mpp \u6d4b\u8bd5\u7528\u4f8b\n"})}),"\n",(0,p.jsx)(n.h2,{id:"52-\u6a21\u5757\u67b6\u6784",children:"5.2. \u6a21\u5757\u67b6\u6784"}),"\n",(0,p.jsx)(n.h3,{id:"521-mpp-\u8f6f\u4ef6\u6846\u67b6",children:"5.2.1. MPP \u8f6f\u4ef6\u6846\u67b6"}),"\n",(0,p.jsx)(n.p,{children:"mpp \u8f6f\u4ef6\u6846\u56fe\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_framework1-17066995071203.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_framework1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.44 ",(0,p.jsx)(n.em,{children:"mpp \u8f6f\u4ef6\u6846\u67b6"}),(0,p.jsx)(n.a,{href:"#id12",children:"\xb6"})]}),"\n",(0,p.jsx)(n.p,{children:"\u5206\u4e3a\u4e09\u4e2a\u90e8\u5206\uff1a"}),"\n",(0,p.jsxs)(n.blockquote,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"mpp_decoder\uff0c\u5b9e\u73b0h264\u3001jpeg\u3001png\u7b49\u89e3\u7801\u529f\u80fd"}),"\n",(0,p.jsx)(n.li,{children:"mpp_encoder\uff0c\u5b9e\u73b0jpeg\u7f16\u7801\uff08\u529f\u80fd\u8fd8\u672a\u5b8c\u6210\uff09\u3002"}),"\n",(0,p.jsx)(n.li,{children:"mpp_ge\uff0c\u5b9e\u73b02D\u56fe\u5f62\u52a0\u901f\u529f\u80fd"}),"\n"]}),"\n"]}),"\n",(0,p.jsx)(n.h2,{id:"53-mpp_decoder-\u8bbe\u8ba1\u4ee5\u53ca\u63a5\u53e3\u8bf4\u660e",children:"5.3. mpp_decoder \u8bbe\u8ba1\u4ee5\u53ca\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,p.jsx)(n.p,{children:"mpp_decoder \u7531\u4e09\u4e2a\u4e3b\u8981\u6a21\u5757\u7ec4\u6210\uff1a"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"\u89e3\u7801\u6a21\u5757\uff08H264\u3001JPEG\u3001PNG\u7b49\uff09\uff1a\u8d1f\u8d23\u5c06\u7801\u6d41\u6570\u636e\u89e3\u7801\u6210\u89c6\u9891\u56fe\u50cf"}),"\n",(0,p.jsx)(n.li,{children:"\u8f93\u5165\u7801\u6d41\u6570\u636e\u7ba1\u7406\u6a21\u5757\uff08Packet manager\uff09\uff1a\u8d1f\u8d23\u89c6\u9891\u3001\u56fe\u7247\u7801\u6d41\u6570\u636e\u548c buffer \u7684\u7ba1\u7406"}),"\n",(0,p.jsx)(n.li,{children:"\u663e\u793a\u5e27\u7ba1\u7406\u6a21\u5757\uff08Frame manager\uff09\uff1a\u8d1f\u8d23\u89e3\u7801\u56fe\u50cf buffer \u7684\u7ba1\u7406"}),"\n"]}),"\n",(0,p.jsx)(n.h3,{id:"531-packet-\u7ba1\u7406\u673a\u5236",children:"5.3.1. packet \u7ba1\u7406\u673a\u5236"}),"\n",(0,p.jsx)(n.p,{children:"Packet manager \u8d1f\u8d23\u7ba1\u7406\u7801\u6d41\u6570\u636e\u548c buffer\u3002\u521d\u59cb\u5316\u65f6\uff0c\u8be5\u6a21\u5757\u7533\u8bf7\u4e00\u5757\u7269\u7406\u8fde\u7eed\u7684\u5185\u5b58\uff08buffer\u5927\u5c0f\u53ef\u7531\u5916\u90e8\u914d\u7f6e\uff09\uff0c\u7528\u4e8e\u5b58\u653e\u89c6\u9891/\u56fe\u7247\u7801\u6d41\u6570\u636e\u3002"}),"\n",(0,p.jsx)(n.p,{children:"Packet manager \u7ba1\u7406\u7684\u6570\u636e\u5355\u5143\u4e3a packet\uff0cpacket \u8868\u793a\u4e00\u7b14\u7801\u6d41\u6570\u636e\uff0c\u5b83\u53ef\u4ee5\u662f\u5b8c\u6574\u7684\u4e00\u5e27\u6570\u636e\uff0c\u4e5f\u652f\u6301\u4e0d\u662f\u5b8c\u6574\u7684\u4e00\u5e27\u6570\u636e\u3002 \u6bcf\u4e2a packet \u4e0e\u7269\u7406\u5185\u5b58\u4e2d\u7684\u7801\u6d41\u6570\u636e\u4e00\u4e00\u5bf9\u5e94\uff0c\u5b83\u8bb0\u5f55\u4e86\u6bcf\u4e00\u7b14\u7801\u6d41\u7684\u7269\u7406\u5185\u5b58\u57fa\u5730\u5740\u3001\u7269\u7406\u5185\u5b58\u7ed3\u675f\u5730\u5740\u3001\u7269\u7406\u5185\u5b58\u504f\u79fb\u3001\u865a\u62df\u5185\u5b58\u5730\u5740\u3001\u7801\u6d41\u6570\u636e\u957f\u5ea6\u7b49\u4fe1\u606f\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/packet_manager1-17066995321425.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/packet_manager1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.45 ",(0,p.jsx)(n.em,{children:"packet\u7ba1\u7406"})]}),"\n",(0,p.jsx)(n.p,{children:"packet \u901a\u8fc7 empty list \u548c ready list \u4e24\u4e2a\u94fe\u8868\u8fdb\u884c\u7ba1\u7406\u3002 \u5176\u4e2d\uff0cempty list \u7528\u4e8e\u5b58\u653e\u7a7a\u95f2\u7684 packet\uff0cready list \u7528\u4e8e\u5b58\u653e\u5f85\u89e3\u7801\u7684 packet\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u9001\u7801\u6d41\u6570\u636e\u65f6\uff0c\u4ece empty list \u83b7\u53d6\u4e00\u4e2a\u7a7a\u95f2 packet\uff0c\u586b\u5145\u6570\u636e\u540e\uff0c\u518d\u628a packet \u653e\u5165 ready list\uff1b"}),"\n",(0,p.jsx)(n.p,{children:"\u89e3\u7801\u524d\uff0c\u89e3\u7801\u5668\u4ece ready list \u83b7\u53d6\u4e00\u4e2a\u586b\u5145\u6570\u636e\u7684 packet\uff0c\u4f7f\u7528\u5b8c\u540e\u518d\u628a\u8be5 packet \u653e\u5165 empty list\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/pm_flow1-17066995412247.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/pm_flow1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.46 ",(0,p.jsx)(n.em,{children:"packet manager \u8c03\u7528\u6d41\u7a0b"})]}),"\n",(0,p.jsx)(n.h3,{id:"532-frame-\u7ba1\u7406\u673a\u5236",children:"5.3.2. frame \u7ba1\u7406\u673a\u5236"}),"\n",(0,p.jsx)(n.p,{children:"Frame manager \u8d1f\u8d23\u7ba1\u7406\u56fe\u50cf buffer\u3002Frame manager \u5185\u90e8\u901a\u8fc7\u4e24\u4e2a\u94fe\u8868\u6765\u7ba1\u7406\u56fe\u50cf buffer\uff1aempty list \u548c render list\u3002 \u5176\u4e2d\uff0cempty list \u5b58\u653e\u53ef\u4ee5\u7ed9\u89e3\u7801\u8f93\u51fa\u4f7f\u7528\u7684\u56fe\u50cf buffer\uff0crender list \u5b58\u653e\u89e3\u7801\u5b8c\u6210\u4f46\u8fd8\u672a\u663e\u793a\u7684\u56fe\u50cf buffer\u3002 \u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6b63\u5728\u663e\u793a\u7684\u56fe\u50cf buffer \u548c\u7528\u4e8e\u53c2\u8003\u7684\u56fe\u50cf buffer \u53ef\u80fd\u4e0d\u5728\u8fd9\u4e24\u4e2a list \u4e2d\u3002"}),"\n",(0,p.jsxs)(n.ol,{children:["\n",(0,p.jsx)(n.li,{children:"frame \u72b6\u6001\u8fc1\u79fb"}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:"\u521d\u59cb\u5316\u65f6\uff0c\u8be5\u6a21\u5757\u7533\u8bf7\u6307\u5b9a\u4e2a\u6570\u7684\u56fe\u50cf buffer\uff08\u4e2a\u6570\u53ef\u7531\u5916\u90e8\u914d\u7f6e\uff09\uff0c\u6bcf\u4e2a\u56fe\u50cf buffer \u7684\u4fe1\u606f\u5b58\u653e\u5728\u5185\u90e8\u6570\u7ec4\u4e2d\u3002 \u6bcf\u4e2a\u56fe\u50cf buffer \u67094\u79cd\u72b6\u6001\uff1a"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"Decoding: \u8be5\u5e27\u6b63\u5728\u88ab\u89e3\u7801\u5668\u4f7f\u7528\uff08\u7528\u4e8e\u89e3\u7801\u8f93\u51fa\u6216\u4f5c\u4e3a\u53c2\u8003\u5e27\uff09"}),"\n",(0,p.jsx)(n.li,{children:"wait_render: \u8be5\u5e27\u5728 render list \u4e2d\uff0c\u7b49\u5f85\u663e\u793a"}),"\n",(0,p.jsx)(n.li,{children:"Rendering: \u8be5\u5e27\u6b63\u5728\u88ab\u663e\u793a\u5360\u7528"}),"\n",(0,p.jsx)(n.li,{children:"IDLE: \u8be5\u5e27\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff08\u65e2\u6ca1\u6709\u88ab\u663e\u793a\u5360\u7528\uff0c\u4e5f\u6ca1\u6709\u88ab\u89e3\u7801\u5668\u7528\u4f5c\u53c2\u8003\u5e27\uff09"}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:"\u5176\u72b6\u6001\u8f6c\u79fb\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"\u521d\u59cb\u5316\u65f6\uff0c\u6240\u6709\u56fe\u50cf buffer \u90fd\u5728 empty list \u4e2d\uff0c\u6b64\u65f6\u5904\u4e8e IDLE \u72b6\u6001\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"\u89e3\u7801\u6a21\u5757\u4ece empty list \u94fe\u8868\u5934\u90e8\u83b7\u53d6\u4e00\u4e2a\u7a7a\u56fe\u50cf buffer\uff0c\u6b64\u65f6 buffer \u88ab\u89e3\u7801\u6a21\u5757\u5360\u7528\uff0c\u4ece IDLE \u72b6\u6001\u53d8\u4e3a Decoding \u72b6\u6001;"}),"\n",(0,p.jsxs)(n.li,{children:["\u89e3\u7801\u5b8c\u6210\u540e\uff0c\u89e3\u7801\u6a21\u5757\u8fd8\u56fe\u50cf\u6570\u636e\u3002\u6b64\u65f6\u5206\u4e24\u79cd\u60c5\u51b5\uff1a","\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"1\uff09\u5982\u679c\u5f53\u524d\u5e27\u8fd8\u672a\u88ab\u663e\u793a\uff0c\u8be5\u5e27\u52a0\u5165 render list \u94fe\u8868\u5c3e\u90e8\uff0c\u4ece Decoding \u72b6\u6001\u53d8\u4e3a wait render \u72b6\u6001\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"2\uff09\u8be5\u5e27\u4e0d\u518d\u7528\u505a\u53c2\u8003\u5e27\u4e14\u5df2\u663e\u793a\u5b8c\u6210\uff0c\u6b64\u65f6\u8be5\u5e27\u52a0\u5165 empty list \u94fe\u8868\u5c3e\u90e8\uff0c\u7531 Decoding \u72b6\u6001\u8fdb\u5165 IDLE \u72b6\u6001\uff1b"}),"\n"]}),"\n"]}),"\n",(0,p.jsx)(n.li,{children:"\u663e\u793a\u6a21\u5757\u4ece render list \u94fe\u8868\u5934\u90e8\u53d6\u4e00\u5e27\u56fe\u50cf\uff0c\u6b64\u65f6\u5f53\u524d\u5e27\u7531 wait render \u72b6\u6001\u8fdb\u5165 Rendering \u72b6\u6001\uff1b"}),"\n",(0,p.jsxs)(n.li,{children:["\u663e\u793a\u6a21\u5757\u8fd8\u56fe\u50cf buffer\uff0c\u5206\u4e24\u79cd\u60c5\u51b5\uff1a","\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"1\uff09\u5982\u679c\u5f53\u524d\u5e27\u4e0d\u7528\u4e8e\u53c2\u8003\uff0c\u6b64\u65f6\u7531 Rendering \u72b6\u6001\u56de\u5230IDLE\u72b6\u6001\uff0c\u8be5\u5e27\u52a0\u5165 empty list \u94fe\u8868\u5c3e\u90e8\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"2\uff09\u5982\u679c\u5f53\u524d\u5e27\u7528\u4e8e\u53c2\u8003\uff0c\u6b64\u65f6\u7531 Rendering \u72b6\u6001\u8fdb\u5165Decoding\u72b6\u6001\uff0c\u8be5\u56fe\u50cf buffer \u4e0d\u8fdb\u5165\u4efb\u4f55\u961f\u5217\uff0c\u7b49\u5f85\u89e3\u7801\u5668\u8fd8\u53c2\u8003\u5e27\uff1b"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/frame_status1-17066995677329.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/frame_status1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.47 ",(0,p.jsx)(n.em,{children:"frame\u72b6\u6001\u8fc1\u79fb"})]}),"\n",(0,p.jsxs)(n.ol,{children:["\n",(0,p.jsx)(n.li,{children:"frame manager \u8c03\u7528\u6d41\u7a0b"}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:"\u5bf9\u4e8e JPEG\u3001PNG \u8fd9\u7c7b\u6ca1\u6709\u53c2\u8003\u5e27\u6982\u5ff5\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u6bcf\u4e00\u5e27\u7684\u72b6\u6001\u662f\u552f\u4e00\u7684\uff0c\u89e3\u7801\u540e\u7684\u6570\u636e\u5e27\u53ef\u76f4\u63a5\u9001 render list"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_jpeg1-170669957657011.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_jpeg1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.48 ",(0,p.jsx)(n.em,{children:"frame manager \u8c03\u7528\u6d41\u7a0b\uff08JPEG/PNG\uff09"}),")"]}),"\n",(0,p.jsx)(n.p,{children:"\u4f46\u5bf9\u4e8e H264 \u8fd9\u7c7b\u6709\u53c2\u8003\u5e27\u7684\u7f16\u7801\u683c\u5f0f\uff0c\u89e3\u7801\u540e\u7684\u89c6\u9891\u5e27\u53ef\u80fd\u65e2\u88ab\u663e\u793a\u5360\u7528\u4e5f\u4f1a\u88ab\u89e3\u7801\u5668\u7528\u4f5c\u53c2\u8003\u5e27\uff0c\u5e76\u4e14\u7531\u4e8e\u53cc\u5411\u53c2\u8003\u5e27\u7684\u5b58\u5728\uff0c \u89c6\u9891\u5e27\u9700\u8981\u91cd\u6392\u5e8f\u540e\u624d\u80fd\u9001\u663e\u793a\u3002 \u4e0d\u540c\u4e8eJPG\uff0cH264 \u89e3\u7801\u5e93\u5185\u90e8\u5b58\u5728\u4e00\u4e2a delay list \u7528\u4e8e\u4e3a\u663e\u793a\u5e27\u91cd\u6392\u5e8f\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_2641-170669959339213.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_2641.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.49 ",(0,p.jsx)(n.em,{children:"frame manager \u8c03\u7528\u6d41\u7a0b\uff08H264\uff09"})]}),"\n",(0,p.jsx)(n.h3,{id:"533-\u7269\u7406\u8fde\u7eed\u5185\u5b58\u4f7f\u7528\u60c5\u51b5",children:"5.3.3. \u7269\u7406\u8fde\u7eed\u5185\u5b58\u4f7f\u7528\u60c5\u51b5"}),"\n",(0,p.jsx)(n.p,{children:"H264 \u89e3\u7801\u6240\u9700\u7684\u7269\u7406\u8fde\u7eed\u5185\u5b58\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,p.jsxs)(n.table,{children:[(0,p.jsx)(n.thead,{children:(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.th,{children:"\u5185\u5b58\u5360\u7528\u6a21\u5757"}),(0,p.jsx)(n.th,{children:"\u8ba1\u7b97\u65b9\u5f0f"}),(0,p.jsx)(n.th,{children:"\u8bf4\u660e"})]})}),(0,p.jsxs)(n.tbody,{children:[(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u8f93\u5165\u7801\u6d41"}),(0,p.jsx)(n.td,{}),(0,p.jsx)(n.td,{children:"\u5927\u5c0f\u7531\u5e94\u7528\u5c42\u914d\u7f6e"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u8f93\u51fa\u5e27"}),(0,p.jsxs)(n.td,{children:["width",(0,p.jsx)(n.em,{children:"height"}),"3/2*frame_num"]}),(0,p.jsx)(n.td,{children:"frame_num\u81f3\u5c11\u9700\u8981\uff08\u53c2\u8003\u5e27\u4e2a\u6570+1\uff09\u4e2a\u663e\u793a\u5360\u7528\u4e2a\u6570\u53ef\u7531\u5e94\u7528\u5c42\u901a\u8fc7struct decode_config\u7ed3\u6784\u4f53\u4e2d\u7684extra_frame_num \u914d\u7f6e"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u5e27\u5185\u9884\u6d4b(\u9700\u8981\u4e0a\u4e00\u884c\u6570\u636e)"}),(0,p.jsxs)(n.td,{children:["\u5e27\u683c\u5f0f\uff1awidth",(0,p.jsx)(n.em,{children:"2MBAFF\uff1awidth"}),"4"]}),(0,p.jsx)(n.td,{})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u5b8f\u5757\u4fe1\u606f"}),(0,p.jsx)(n.td,{children:"\u56fa\u5b9a12K"}),(0,p.jsx)(n.td,{})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"dblk\u6a21\u5757(\u4e0a\u4e00\u4e2a\u5b8f\u5757\u884c\u6700\u540e4\u884c\u6570\u636e)"}),(0,p.jsxs)(n.td,{children:["\u5e27\u683c\u5f0f\uff1awidth",(0,p.jsx)(n.em,{children:"8MBAFF\uff1awidth"}),"16"]}),(0,p.jsx)(n.td,{})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"co-located\u4fe1\u606f"}),(0,p.jsx)(n.td,{children:"\u56fa\u5b9a68K"}),(0,p.jsx)(n.td,{})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u6bcf\u4e00\u5e27co-located\u6570\u636e\u7f13\u5b58"}),(0,p.jsxs)(n.td,{children:["(width/16)*(height/16)",(0,p.jsx)(n.em,{children:"32"}),"frame_num"]}),(0,p.jsx)(n.td,{})]})]})]}),"\n",(0,p.jsx)(n.p,{children:"\u6ce8\u89e3"}),"\n",(0,p.jsx)(n.p,{children:"co-located \u4e24\u4e2abuffer\uff0cI\u3001P\u5e27\u89e3\u7801\u65f6\u4f1a\u5f80buffer\u91cc\u5199\u6570\u636e\uff0cB \u5e27\u89e3\u7801\u65f6\u4ecebuffer\u8bfb\u6570\u636e\u3002 \u5982\u679c\u5f53\u524d\u7801\u6d41\u4e2d\u6ca1\u6709 B \u5e27\uff0c\u8fd9\u4e24\u5757\u5185\u5b58\u4e5f\u9700\u8981\u7533\u8bf7\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"534-mpp_decoder-\u8c03\u7528\u6d41\u7a0b",children:"5.3.4. mpp_decoder \u8c03\u7528\u6d41\u7a0b"}),"\n",(0,p.jsx)(n.p,{children:"\u5728\u8c03\u7528 mpp_decoder \u7684\u89e3\u7801\u51fd\u6570\u65f6\uff0c\u89e3\u7801\u6a21\u5757\u4ece Packet manager \u53d6\u4e00\u7b14\u7801\u6d41\uff0c\u540c\u65f6\u4ece Frame maneger \u53d6\u4e00\u4e2a\u7a7a\u95f2\u56fe\u50cf buffer\uff0c\u5bf9\u7801\u6d41\u8fdb\u884c\u89e3\u7801 \u5e76\u8f93\u51fa\u56fe\u50cf\u5230\u56fe\u50cf buffer\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u89e3\u7801\u540e\uff0c\u89e3\u7801\u6a21\u5757\u5c06\u7801\u6d41 buffer \u5f52\u8fd8 Packet manager\uff0c\u5c06\u89e3\u7801\u56fe\u50cf buffer \u5f52\u8fd8 Frame maneger\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u4e3a\u4fdd\u8bc1\u89e3\u7801\u6548\u7387\uff0c\u5efa\u8bae\u8c03\u7528\u8005\u521b\u5efa3\u4e2a\u7ebf\u7a0b\u5b9e\u73b0\u89e3\u7801\u529f\u80fd\uff1a"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"send data thread"}),"\n",(0,p.jsx)(n.p,{children:"\u901a\u8fc7 mpp_decoder_get_packet \u548c mpp_decoder_put_packet \u8fd9\u4e24\u4e2a\u63a5\u53e3\u628a\u7801\u6d41\u6570\u636e\u9001\u5230 packet \u7ba1\u7406\u6a21\u5757"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"decode thread"}),"\n",(0,p.jsx)(n.p,{children:"\u901a\u8fc7\u8c03\u7528 mpp_decoder_decode \u63a7\u5236\u89e3\u7801\uff0c\u89e3\u7801\u5e93\u4ece packet \u7ba1\u7406\u6a21\u5757\u53d6\u4e00\u7b14\u7801\u6d41\u6570\u636e\uff0c\u89e3\u7801\u5b8c\u6210\u540e\uff0c\u5c06\u89c6\u9891\u5e27\u9001\u5165 frame \u7ba1\u7406\u6a21\u5757"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"render thread"}),"\n",(0,p.jsx)(n.p,{children:"\u901a\u8fc7 mpp_decoder_get_frame \u548c mpp_decoder_put_frame \u4e24\u4e2a\u63a5\u53e3\u4ece frame \u7ba1\u7406\u6a21\u5757\u83b7\u53d6\u89c6\u9891\u5e27\uff0c\u5e76\u63a7\u5236\u8be5\u5e27\u663e\u793a\u65f6\u673a"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_decoder_flow1-170669962555915.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_decoder_flow1.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.50 ",(0,p.jsx)(n.em,{children:"mpp_decoder \u8c03\u7528\u6d41\u7a0b"})]}),"\n",(0,p.jsx)(n.h3,{id:"535-mpp_decoder-\u6570\u636e\u7ed3\u6784",children:"5.3.5. mpp_decoder \u6570\u636e\u7ed3\u6784"}),"\n",(0,p.jsx)(n.h4,{id:"5351-struct-decode_config",children:"5.3.5.1. struct decode_config"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"struct decode_config {\n    enum mpp_pixel_format pix_fmt;  // output pixel format\n    int bitstream_buffer_size;      // bitstream buffer size in pm\n    int packet_count;               // packet number in pm\n    int extra_frame_num;            // extra frame number in fm\n};\n"})}),"\n",(0,p.jsx)(n.p,{children:"decode_config \u7ed3\u6784\u4f53\u7528\u4e8e\u914d\u7f6e\u89e3\u7801\u5668\u521d\u59cb\u5316\u4f7f\u7528\u7684\u53c2\u6570\u3002"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"pix_fmt \u8868\u793a\u89e3\u7801\u8f93\u51fa\u7684\u989c\u8272\u683c\u5f0f"}),"\n",(0,p.jsx)(n.li,{children:"bitstream_buffer_size \u8868\u793a\u5b58\u653e\u8f93\u5165\u7801\u6d41\u7f13\u5b58\u7684\u603b\u957f\u5ea6"}),"\n",(0,p.jsx)(n.li,{children:"packet_count \u8868\u793a packet manager \u4e2d packet \u7684\u6700\u5927\u4e2a\u6570"}),"\n",(0,p.jsx)(n.li,{children:"extra_frame_num \u8868\u793a\u89e3\u7801\u5668\u989d\u5916\u5206\u914d\u7684\u5e27\u4e2a\u6570\uff0c\u4e3b\u8981\u7528\u4e8e\u7f13\u5b58\u663e\u793a\u5e27\u4ee5\u4fdd\u8bc1\u663e\u793a\u5e73\u6ed1\u3002"}),"\n"]}),"\n",(0,p.jsx)(n.h4,{id:"5352-struct-mpp_packet",children:"5.3.5.2. struct mpp_packet"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"struct mpp_packet {\n    void *data;\n    int size;\n    long long pts;\n    unsigned int flag;\n};\n"})}),"\n",(0,p.jsx)(n.p,{children:"mpp_packet \u7ed3\u6784\u4f53\u7528\u4e8e\u8868\u793a\u8f93\u5165\u7801\u6d41\u4fe1\u606f\u3002"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"data \u8868\u793a\u7801\u6d41\u6570\u636e\u5b58\u653e\u7684\u8d77\u59cb\u5730\u5740"}),"\n",(0,p.jsx)(n.li,{children:"size \u8868\u793a\u8be5\u7b14\u7801\u6d41\u6570\u636e\u957f\u5ea6"}),"\n",(0,p.jsx)(n.li,{children:"pts \u8868\u793a\u8be5\u7b14\u7801\u6d41\u7684\u65f6\u95f4\u6233"}),"\n",(0,p.jsx)(n.li,{children:"flag \u8868\u793a\u8be5\u7b14\u7801\u6d41\u7684\u6807\u8bb0\u4f4d\uff0c\u76ee\u524d\u4ec5\u7528\u4e8e\u786e\u5b9a\u8be5\u7801\u6d41\u662f\u5426\u4e3a\u6700\u540e\u4e00\u7b14\u7801\u6d41\uff08PACKET_FLAG_EOS\uff09"}),"\n"]}),"\n",(0,p.jsx)(n.h4,{id:"5353-struct-mpp_frame",children:"5.3.5.3. struct mpp_frame"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"struct mpp_size {\n    int width;\n    int height;\n};\nstruct mpp_rect {\n    int x;\n    int y;\n    int width;\n    int height;\n};\nenum mpp_buf_type {\n    MPP_DMA_BUF_FD,\n    MPP_PHY_ADDR,\n};\n\nstruct mpp_buf {\n    enum mpp_buf_type       buf_type;\n    union {\n            int             fd[3];\n            unsigned int    phy_addr[3];\n    };\n    unsigned int            stride[3];\n    struct mpp_size         size;\n    unsigned int            crop_en;\n    struct mpp_rect         crop;\n    enum mpp_pixel_format   format;\n    unsigned int            flags;\n};\n"})}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"buf_type\uff1a\u8868\u793a mpp_buf \u7c7b\u578b\uff0c\u4ee5 fd \u65b9\u5f0f MPP_DMA_BUF_FD \u6216 \u4ee5\u7269\u7406\u5730\u5740\u65b9\u5f0f MPP_PHY_ADDR\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"fd[3]\uff1a\u8868\u793a buffer \u4e09\u4e2a\u5206\u91cf\u7684 fd"}),"\n",(0,p.jsx)(n.li,{children:"phy_addr[3]\uff1a\u8868\u793a buffer \u4e09\u4e2a\u5206\u91cf\u7684\u7269\u7406\u5730\u5740"}),"\n",(0,p.jsx)(n.li,{children:"stride[3]\uff1a\u8868\u793a buffer \u4e09\u4e2a\u5206\u91cf\u7684 stride"}),"\n",(0,p.jsx)(n.li,{children:"size\uff1a\u8868\u793a buffer \u7684\u5bbd\u3001\u9ad8"}),"\n",(0,p.jsx)(n.li,{children:"crop_en\uff1a \u8868\u793a\u8be5 buffer \u662f\u5426\u9700\u8981 crop"}),"\n",(0,p.jsx)(n.li,{children:"crop\uff1a\u8868\u793a\u8be5 buffer \u7684 crop \u4fe1\u606f"}),"\n",(0,p.jsx)(n.li,{children:"format\uff1a \u8868\u793a\u8be5 buffer \u7684\u989c\u8272\u683c\u5f0f\u7c7b\u578b"}),"\n"]}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"struct mpp_frame {\n    struct mpp_buf          buf;\n    long long               pts;\n    unsigned int            id;\n    unsigned int            flags;\n};\n"})}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"buf\uff1a\u8868\u793a mpp_frame \u7684 buffer \u4fe1\u606f"}),"\n",(0,p.jsx)(n.li,{children:"pts\uff1a\u8868\u793a mpp_frame \u7684\u65f6\u95f4\u6233"}),"\n",(0,p.jsx)(n.li,{children:"id\uff1a\u8868\u793a mpp_frame \u7684\u552f\u4e00\u6807\u8bc6"}),"\n",(0,p.jsx)(n.li,{children:"flags\uff1a\u8868\u793a mpp_frame \u7684\u6807\u5fd7\u4f4d"}),"\n"]}),"\n",(0,p.jsx)(n.h4,{id:"5354-enum-mpp_dec_errno",children:"5.3.5.4. enum mpp_dec_errno"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"enum mpp_dec_errno {\n    DEC_ERR_NOT_SUPPORT         = 0x90000001,\n    DEC_ERR_NO_EMPTY_PACKET     = 0x90000002, // no packet in empty list\n    DEC_ERR_NO_READY_PACKET     = 0x90000003, //\n    DEC_ERR_NO_EMPTY_FRAME      = 0x90000004, //\n    DEC_ERR_NO_RENDER_FRAME     = 0x90000005, //\n    DEC_ERR_NULL_PTR            = 0x90000006,\n    DEC_ERR_FM_NOT_CREATE       = 0x90000006,\n};\n"})}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"DEC_ERR_NOT_SUPPORT\uff1a\u8be5\u7801\u6d41\u4e0d\u652f\u6301"}),"\n",(0,p.jsx)(n.li,{children:"DEC_ERR_NO_EMPTY_PACKET\uff1apacket manager \u4e2d\u7f3a\u5c11\u7a7a\u95f2\u7684 packet\uff0c\u53ef\u80fd\u662f\u89e3\u7801\u901f\u5ea6\u5c0f\u4e8e\u9001 packet \u901f\u5ea6\uff0c\u6b64\u65f6\u9700\u8981\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"DEC_ERR_NO_READY_PACKET\uff1apacket manager \u4e2d\u7f3a\u5c11\u586b\u597d\u7801\u6d41\u6570\u636e\u7684 packet\uff0c\u53ef\u80fd\u662f\u9001 packet \u901f\u5ea6\u5c0f\u4e8e\u89e3\u7801\u901f\u5ea6\uff0c\u6b64\u65f6\u9700\u8981\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"DEC_ERR_NO_EMPTY_FRAME\uff1aframe manager \u4e2d\u7f3a\u5c11\u7a7a\u95f2\u7684 frame\uff0c\u8868\u793a\u6240\u6709\u5e27\u90fd\u5904\u4e8e\u4f7f\u7528\u72b6\u6001\uff0c\u901a\u5e38\u662f\u89e3\u7801\u901f\u5ea6\u5927\u4e8e\u663e\u793a\u901f\u5ea6\u5bfc\u81f4\uff0c\u6b64\u65f6\u9700\u8981\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"DEC_ERR_NO_RENDER_FRAME\uff1aframe manager \u4e2d\u7f3a\u5c11\u5f85\u663e\u793a\u7684 frame\uff0c\u8868\u793a\u6240\u6709\u5e27\u90fd\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\uff0c\u901a\u5e38\u662f\u89e3\u7801\u901f\u5ea6\u5c0f\u4e8e\u663e\u793a\u901f\u5ea6\u5bfc\u81f4\uff0c\u6b64\u65f6\u9700\u8981\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff1b"}),"\n",(0,p.jsx)(n.li,{children:"DEC_ERR_NULL_PTR\uff1a\u8868\u793a\u63a5\u53e3\u51fd\u6570\u8f93\u5165\u53c2\u6570\u5b58\u5728\u7a7a\u6307\u9488"}),"\n",(0,p.jsx)(n.li,{children:"DEC_ERR_FM_NOT_CREATE\uff1a\u8868\u793a\u5728\u83b7\u53d6\u5f85\u663e\u793a frame \u65f6 frame manager \u8fd8\u672a\u521b\u5efa"}),"\n"]}),"\n",(0,p.jsx)(n.h4,{id:"5355-enum-mpp_codec_type",children:"5.3.5.5. enum mpp_codec_type"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"enum mpp_codec_type {\n    MPP_CODEC_VIDEO_DECODER_H264 = 0x1000,         // decoder\n    MPP_CODEC_VIDEO_DECODER_MJPEG,\n    MPP_CODEC_VIDEO_DECODER_PNG,\n\n    MPP_CODEC_VIDEO_ENCODER_H264 = 0x2000,         // encoder\n};\n"})}),"\n",(0,p.jsx)(n.p,{children:"mpp_codec_type \u679a\u4e3e\u7c7b\u578b\u8868\u793a\u652f\u6301\u7684\u7f16\u89e3\u7801\u683c\u5f0f\u3002"}),"\n",(0,p.jsx)(n.h4,{id:"5356-enum-mpp_dec_cmd",children:"5.3.5.6. enum mpp_dec_cmd"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"enum mpp_dec_cmd {\n    MPP_DEC_INIT_CMD_SET_EXT_FRAME_ALLOCATOR,            // frame buffer allocator\n    MPP_DEC_INIT_CMD_SET_ROT_FLIP_FLAG,\n    MPP_DEC_INIT_CMD_SET_SCALE,\n    MPP_DEC_INIT_CMD_SET_CROP_INFO,\n    MPP_DEC_INIT_CMD_SET_OUTPUT_POS,\n};\n"})}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsx)(n.li,{children:"MPP_DEC_INIT_CMD_SET_EXT_FRAME_ALLOCATOR\uff1a\u8868\u793a\u7531\u5916\u90e8\u8bbe\u7f6e\u5e27 buffer \u5206\u914d\u5668"}),"\n",(0,p.jsx)(n.li,{children:"MPP_DEC_INIT_CMD_SET_ROT_FLIP_FLAG: \u8868\u793a\u8bbe\u7f6e\u65cb\u8f6c\u3001\u955c\u50cf\u540e\u5904\u7406\uff0c\u53ea\u7528\u4e8eJPEG"}),"\n",(0,p.jsx)(n.li,{children:"MPP_DEC_INIT_CMD_SET_SCALE\uff1a \u8868\u793a\u8bbe\u7f6e\u7f29\u653e\u7cfb\u6570\uff0c\u53ea\u7528\u4e8eJPEG"}),"\n",(0,p.jsx)(n.li,{children:"MPP_DEC_INIT_CMD_SET_CROP_INFO\uff1a\u8868\u793a\u8bbe\u7f6e\u8f93\u51fa crop \u4fe1\u606f"}),"\n",(0,p.jsx)(n.li,{children:"MPP_DEC_INIT_CMD_SET_OUTPUT_POS\uff1a\u8868\u793a\u8bbe\u7f6e\u89e3\u7801\u56fe\u50cf\u5728\u8f93\u51fa\u7f13\u5b58\u7684\u4f4d\u7f6e"}),"\n"]}),"\n",(0,p.jsx)(n.h3,{id:"536-mpp_decoder-\u63a5\u53e3\u8bbe\u8ba1",children:"5.3.6. mpp_decoder \u63a5\u53e3\u8bbe\u8ba1"}),"\n",(0,p.jsx)(n.p,{children:"\u63a5\u53e3\u5982\u4e0b :"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"struct decode_config {\n    enum mpp_pixel_format pix_fmt;  // output pixel format\n    int bitstream_buffer_size;      // bitstream buffer size in pm\n    int packet_count;               // packet number in pm\n    int extra_frame_num;            // extra frame number in fm\n};\n\nstruct mpp_decoder* create_mpp_decoder(enum mpp_codec_type type);\nvoid destory_mpp_decoder(struct mpp_decoder* decoder);\nint mpp_decoder_init(struct mpp_decoder *decoder, struct decode_config *config);\nint mpp_decoder_decode(struct mpp_decoder* decoder);\nint mpp_decoder_control(struct mpp_decoder* decoder, int cmd, void *param);\nint mpp_decoder_reset(struct mpp_decoder* decoder);\nint mpp_decoder_get_packet(struct mpp_decoder* decoder, struct mpp_packet* packet, int size);\nint mpp_decoder_put_packet(struct mpp_decoder* decoder, struct mpp_packet* packet);\nint mpp_decoder_get_frame(struct mpp_decoder* decoder, struct mpp_frame* frame);\nint mpp_decoder_put_frame(struct mpp_decoder* decoder, struct mpp_frame* frame);\n"})}),"\n",(0,p.jsx)(n.h4,{id:"5361-mpp_decoder_create",children:"5.3.6.1. mpp_decoder_create"}),"\n",(0,p.jsxs)(n.table,{children:[(0,p.jsx)(n.thead,{children:(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,p.jsx)(n.th,{children:"struct mpp_decoder* mpp_decoder_create(enum mpp_codec_type type)"})]})}),(0,p.jsxs)(n.tbody,{children:[(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,p.jsx)(n.td,{children:"\u521b\u5efampp_decoder\u5bf9\u8c61"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,p.jsx)(n.td,{children:"type: \u89e3\u7801\u5668\u7c7b\u578b"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,p.jsx)(n.td,{children:"mpp_decoder\u5bf9\u8c61"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,p.jsx)(n.td,{})]})]})]}),"\n",(0,p.jsx)(n.h4,{id:"5362-mpp_decoder_destory",children:"5.3.6.2. mpp_decoder_destory"}),"\n",(0,p.jsxs)(n.table,{children:[(0,p.jsx)(n.thead,{children:(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,p.jsx)(n.th,{children:"void mpp_decoder_destory(struct mpp_decoder* decoder)"})]})}),(0,p.jsxs)(n.tbody,{children:[(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,p.jsx)(n.td,{children:"\u9500\u6bc1mpp_decoder\u5bf9\u8c61"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,p.jsx)(n.td,{children:"decoder: mpp_decoder\u5bf9\u8c61"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,p.jsx)(n.td,{children:"\u65e0"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,p.jsx)(n.td,{})]})]})]}),"\n",(0,p.jsx)(n.h4,{id:"5363-mpp_decoder_init",children:"5.3.6.3. mpp_decoder_init"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_init(struct mpp_decoder *decoder, struct decode_config *config) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u521d\u59cb\u5316\u89e3\u7801\u5668                                                 |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61config\uff1a\u89e3\u7801\u5668\u7684\u914d\u7f6e\u53c2\u6570             |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                                |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"5364-mpp_decoder_decode",children:"5.3.6.4. mpp_decoder_decode"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_decode(struct mpp_decoder* decoder) |\n| -------- | --------------------------------------------------- |\n| \u529f\u80fd\u8bf4\u660e | \u89e3\u7801\u4e00\u7b14\u6570\u636e                                        |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61                            |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                       |\n| \u6ce8\u610f\u4e8b\u9879 |                                                     |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"53-mpp_decoder_control",children:"5.3. mpp_decoder_control"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_control(struct mpp_decoder* decoder, int cmd, void* param) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u5411mpp_decoder\u5bf9\u8c61\u53d1\u9001\u63a7\u5236\u547d\u4ee4                                |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61cmd: \u63a7\u5236\u547d\u4ee4\u7c7b\u578bparam: \u63a7\u5236\u53c2\u6570     |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                                |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"5366-mpp_decoder_reset",children:"5.3.6.6. mpp_decoder_reset"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_reset(struct mpp_decoder* decoder) |\n| -------- | -------------------------------------------------- |\n| \u529f\u80fd\u8bf4\u660e | \u91cd\u7f6empp_decoder\u5bf9\u8c61                                |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61                           |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                      |\n| \u6ce8\u610f\u4e8b\u9879 |                                                    |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"5367-mpp_decoder_get_packet",children:"5.3.6.7. mpp_decoder_get_packet"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_get_packet(struct mpp_decoder* decoder, struct mpp_packet* packet, int size) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u83b7\u53d6\u4e00\u4e2a\u5199\u7801\u6d41\u6570\u636e\u7684packet                                   |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61packet:\u7801\u6d41\u6570\u636e\u7ed3\u6784\u6307\u9488size:\u4e0a\u5c42\u5e94\u7528\u7533\u8bf7packet\u7684buffer\u5927\u5c0f |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                                |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"5368-mpp_decoder_put_packet",children:"5.3.6.8. mpp_decoder_put_packet"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_put_packet(struct mpp_decoder* decoder, struct mpp_packet* packet) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u5f52\u8fd8\u7801\u6d41\u6570\u636e\u7684packet\u5bf9\u8c61                                     |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61packet:\u7801\u6d41\u6570\u636e\u7ed3\u6784\u6307\u9488              |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                                |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"5369-mpp_decoder_get_frame",children:"5.3.6.9. mpp_decoder_get_frame"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_get_frame(struct mpp_decoder* decoder, struct mpp_frame* frame) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u83b7\u53d6\u4e00\u4e2a\u89c6\u9891\u5e27\u5bf9\u8c61                                           |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61frame:\u89c6\u9891\u5e27\u6570\u636e\u7ed3\u6784\u6307\u9488             |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                                |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.h4,{id:"53610-mpp_decoder_put_frame",children:"5.3.6.10. mpp_decoder_put_frame"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_decoder_put_frame(struct mpp_decoder* decoder, struct mpp_frame* frame) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u5f52\u8fd8\u89c6\u9891\u5e27\u5bf9\u8c61                                               |\n| \u53c2\u6570\u5b9a\u4e49 | decoder: mpp_decoder\u5bf9\u8c61frame:\u89c6\u9891\u5e27\u6570\u636e\u7ed3\u6784\u6307\u9488             |\n| \u8fd4\u56de\u503c   | 0:\u6210\u529f<0:\u5931\u8d25                                                |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.h3,{id:"537-mpp_decoder-\u53c2\u8003demo",children:"5.3.7. mpp_decoder \u53c2\u8003demo"}),"\n",(0,p.jsx)(n.p,{children:"\u4ee5\u4e0b demo \u4e3a\u57fa\u672c\u6d41\u7a0b\u8c03\u7528\uff0c\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801 mpp/mpp_test/picture_decoder_test.c"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"//* 1.\u521b\u5efa mpp_decoder \u5bf9\u8c61\nstruct mpp_decoder* dec = mpp_decoder_create(type);\n\nstruct decode_config config;\nconfig.bitstream_buffer_size = (file_len + 1023) & (~1023);\nconfig.extra_frame_num = 0;\nconfig.packet_count = 1;\nconfig.pix_fmt = MPP_FMT_ARGB_8888;\n\n//* 2. \u521d\u59cb\u5316 mpp_decoder\nmpp_decoder_init(dec, &config);\n\n//* 3. \u83b7\u53d6\u4e00\u4e2a\u7a7a\u7684packet\nstruct mpp_packet packet;\nmemset(&packet, 0, sizeof(struct mpp_packet));\nmpp_decoder_get_packet(dec, &packet, file_len);\n\n//* 4. \u628a\u89c6\u9891\u7801\u6d41\u6570\u636e\u62f7\u8d1d\u5230 packet\nfread(packet.data, 1, file_len, fp);\npacket.size = file_len;\npacket.flag = PACKET_FLAG_EOS;\n\n//* 5. \u5f52\u8fd8 packet\nmpp_decoder_put_packet(dec, &packet);\n\n//* 6. \u89e3\u7801\u8be5\u7b14\u7801\u6d41\u6570\u636e\nmpp_decoder_decode(dec);\n\n//* 7. \u83b7\u53d6\u89e3\u7801\u540e\u89c6\u9891\u5e27\u6570\u636e\nstruct mpp_frame frame;\nmemset(&frame, 0, sizeof(struct mpp_frame));\nmpp_decoder_get_frame(dec, &frame);\n\n//* 8. \u663e\u793a\u8be5\u89c6\u9891\u5e27\n// render_frame...\n\n//* 9. \u5f52\u8fd8\u8be5\u89c6\u9891\u5e27\nmpp_decoder_put_frame(dec, &frame);\n\n//* 10. \u9500\u6bc1 mpp_decoder\nmpp_decoder_destory(dec);\n"})}),"\n",(0,p.jsx)(n.h2,{id:"54-mpp_encoder-\u8bbe\u8ba1\u53ca\u63a5\u53e3\u8bf4\u660e",children:"5.4. mpp_encoder \u8bbe\u8ba1\u53ca\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,p.jsx)(n.p,{children:"mpp_encoder \u76ee\u524d\u53ea\u652f\u6301 JPEG \u56fe\u7247\u7f16\u7801\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"541-\u63a5\u53e3\u8bbe\u8ba1",children:"5.4.1. \u63a5\u53e3\u8bbe\u8ba1"}),"\n",(0,p.jsx)(n.h4,{id:"5411-mpp_encode_jpeg",children:"5.4.1.1. mpp_encode_jpeg"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int mpp_encode_jpeg(struct mpp_frame* frame, int quality, int dma_buf_fd, int buf_len, int* len) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u7f16\u7801\u4e00\u5e27 JPEG \u56fe\u7247                                           |\n| \u53c2\u6570\u5b9a\u4e49 | frame: \u5f85\u7f16\u7801\u7684\u539f\u59cb YUV \u6570\u636equality: \u7f16\u7801\u8d28\u91cf\uff0c\u53d6\u503c\u8303\u56f41~100\uff0c1\u8868\u793a\u7f16\u7801\u56fe\u7247\u8d28\u91cf\u6700\u5dee\uff0c100\u8868\u793a\u6700\u597ddma_buf_fd\uff1a\u8f93\u51fa JPEG \u56fe\u7247\u5b58\u653e\u7684 dma-buf fdbuf_len\uff1a\u8f93\u51fa JPEG \u56fe\u7247 dma-buf \u7684\u957f\u5ea6len: \u8f93\u51fa JPEG \u56fe\u7247\u7684\u771f\u5b9e\u5927\u5c0f |\n| \u8fd4\u56de\u503c   | 0: \u6210\u529f<0:\u5931\u8d25                                               |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,p.jsx)(n.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,p.jsx)(n.p,{children:"\u8f93\u51fa JPEG \u56fe\u7247\u7684\u7f13\u5b58 buffer \u7531\u8c03\u7528\u8005\u7533\u8bf7\uff0c\u4f46\u8c03\u7528\u8005\u5e76\u4e0d\u77e5\u9053\u7f16\u7801\u540e\u56fe\u7247\u7684\u5b9e\u9645\u5927\u5c0f\uff0c \u4e3a\u907f\u514d VE \u5199\u8f93\u51fa\u6570\u636e\u65f6\u8d8a\u754c\uff0c\u8be5 buffer \u9700\u8981\u9884\u5148\u7533\u8bf7\u8f83\u5927\u7684\u5185\u5b58\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"542-mpp_encoder-\u53c2\u8003demo",children:"5.4.2. mpp_encoder \u53c2\u8003demo"}),"\n",(0,p.jsx)(n.p,{children:"\u4ee5\u4e0b demo \u4e3a\u57fa\u672c\u6d41\u7a0b\u8c03\u7528\uff0c\u5177\u4f53\u5b9e\u73b0\u53ef\u4ee5\u53c2\u8003\u4ee3\u7801 mpp/mpp_test/jpeg_encoder_test.c"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:'//* 1. \u83b7\u53d6 dma-buf device \u53e5\u67c4\nint dma_fd = dmabuf_device_open();\n\n//* 2. \u8bbe\u7f6e\u8f93\u5165 YUV \u6570\u636e\u7ed3\u6784\u4f53\nstruct mpp_frame frame;\n// ....\n\n//* 3. \u7533\u8bf7\u7f16\u7801\u8f93\u51fa buffer\nint len = 0;\nint buf_len = width * height * 4/5 * quality / 100;\nint jpeg_data_fd = dmabuf_alloc(dma_fd, buf_len);\n\n//* 4. \u7f16\u7801 JPEG \u56fe\u7247\nmpp_encode_jpeg(&frame, quality, jpeg_data_fd, buf_len, &len)\uff1b\n\n//* 5. \u4fdd\u5b58\u7f16\u7801\u540e JPEG \u56fe\u7247\nunsigned char* jpeg_vir_addr = dmabuf_mmap(jpeg_data_fd, buf_len);\nFILE* fp_save = fopen("/save.jpg", "wb");\nfwrite(jpeg_vir_addr, 1, len, fp_save);\nfclose(fp_save);\n\n//* 6. \u91ca\u653e\u8d44\u6e90\ndmabuf_munmap(jpeg_vir_addr, buf_len);\ndmabuf_free(jpeg_data_fd);\ndmabuf_device_close(dma_fd);\n'})}),"\n",(0,p.jsx)(n.h2,{id:"55-mpp_ge-\u63a5\u53e3\u8bf4\u660e",children:"5.5. mpp_ge \u63a5\u53e3\u8bf4\u660e"}),"\n",(0,p.jsxs)(n.p,{children:["mpp_ge \u63a5\u53e3\u8bf4\u660e\u8bf7\u53c2\u8003 ",(0,p.jsx)(n.a,{href:"../ge/5_design_guide.html#ref-luban-mpp-ge",children:"MPP\u5bf9GE\u63a5\u53e3\u7684\u5c01\u88c5"})]}),"\n",(0,p.jsx)(n.h2,{id:"56-mpp-heap-\u8bbe\u8ba1\u53ca\u8bf4\u660e",children:"5.6. mpp heap \u8bbe\u8ba1\u53ca\u8bf4\u660e"}),"\n",(0,p.jsx)(n.p,{children:"Mpp Heap \u8d1f\u8d23\u7ba1\u7406 mpp \u4e2d\u95f4\u4ef6\u72ec\u5360\u7684 CMA \u5185\u5b58\uff0c\u5e76\u5728 mpp \u4e2d\u95f4\u4ef6\u9700\u8981\u7269\u7406\u5185\u5b58\u65f6\uff0c\u5c06\u5185\u5b58\u9875\u9762\u5bfc\u51fa\u4e3a DMA-BUF\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"561-mpp-heap-\u7279\u70b9",children:"5.6.1. mpp heap \u7279\u70b9"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.strong,{children:"\u89e3\u51b3\u5185\u5b58\u788e\u7247\u5316"})}),"\n",(0,p.jsx)(n.p,{children:"CMA \u5185\u5b58\u5141\u8bb8\u591a\u5a92\u4f53\u6a21\u5757\u548c\u7cfb\u7edf\u590d\u7528\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5185\u5b58\u788e\u7247\u5316\u7684\u60c5\u51b5\u4e0d\u53ef\u907f\u514d\uff08\u90e8\u5206\u5185\u5b58\u9875\u9762\u53ef\u80fd\u4f1a\u88ab\u7cfb\u7edf pin \u4f4f\uff0c\u65e0\u6cd5\u8fc1\u79fb\uff09\u3002\u800c mpp heap \u7ba1\u7406\u7684\u5185\u5b58\u80fd\u786e\u4fdd\u53ea\u88ab mpp \u4e2d\u95f4\u4ef6\u4f7f\u7528\uff0c\u907f\u514d\u4e86\u5185\u5b58\u9875\u9762\u88ab pin \u4f4f\u800c\u5bfc\u81f4\u788e\u7247\u5316\u7684\u95ee\u9898\u3002"}),"\n",(0,p.jsxs)(n.ul,{children:["\n",(0,p.jsxs)(n.li,{children:["mpp heap \u7684\u5185\u5b58\u9700\u8981\u5728\u7528\u6237\u6001\u901a\u8fc7 ",(0,p.jsx)(n.code,{children:"/dev/dmabuf/mpp"})," \u8282\u70b9\u6765\u7533\u8bf7\uff0c\u8fd9\u4e2a\u8282\u70b9\u662f ArtInChip \u5e73\u53f0\u6269\u5c55\u7684\u79c1\u6709\u8282\u70b9\uff0c\u53ea\u6709 mpp \u4e2d\u95f4\u4ef6\u4f1a\u8bbf\u95ee\u3002"]}),"\n",(0,p.jsx)(n.li,{children:"\u5bf9\u4e8e\u7cfb\u7edf\u6765\u8bf4\uff0c\u8be5\u5757\u5185\u5b58\u5df2\u88ab alloc\uff0c\u7cfb\u7edf\u4e0d\u4f1a\u518d\u53bb\u8bbf\u95ee\uff0c\u56e0\u6b64\u80fd\u8fbe\u5230 mpp \u4e2d\u95f4\u4ef6\u72ec\u5360\u7684\u6548\u679c\u3002"}),"\n"]}),"\n",(0,p.jsx)(n.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,p.jsx)(n.p,{children:"\u53ea\u8981\u5728\u8c03\u7528 mpp \u4e2d\u95f4\u4ef6\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8981\u505a\u5230\u8d44\u6e90\u7684\u7533\u8bf7\u4e0e\u91ca\u653e\u4e00\u4e00\u5bf9\u5e94\uff0c\u5c31\u80fd\u89e3\u51b3\u5185\u5b58\u788e\u7247\u5316\u95ee\u9898\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.strong,{children:"\u5141\u8bb8\u7cfb\u7edf\u56de\u6536 mpp heap \u5185\u5b58"})}),"\n",(0,p.jsxs)(n.p,{children:["mpp heap \u7ba1\u7406\u7684\u5185\u5b58\u901a\u8fc7 ",(0,p.jsx)(n.code,{children:"cma_alloc"})," \u7533\u8bf7\uff0c\u5728\u7cfb\u7edf\u5185\u5b58\u8d44\u6e90\u7d27\u5f20\uff0c\u800c\u53c8\u4e0d\u9700\u8981 mpp \u4e2d\u95f4\u4ef6\u7684\u60c5\u51b5\u4e0b \uff08\u4f8b\u5982 OTA \u5347\u7ea7\uff09\uff0c\u5141\u8bb8\u901a\u8fc7\u9500\u6bc1 mpp heap \u91ca\u653e CMA \u5185\u5b58\u7ed9\u7cfb\u7edf\u4f7f\u7528\u3002"]}),"\n",(0,p.jsx)(n.p,{children:"\u6ce8\u89e3"}),"\n",(0,p.jsx)(n.p,{children:"mpp heap \u4e00\u65e6\u9500\u6bc1\uff0c\u65e0\u6cd5\u518d\u6b21\u521d\u59cb\u5316\uff0c\u53ea\u80fd reboot \u7cfb\u7edf\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"562-mpp-heap-init",children:"5.6.2. mpp heap init"}),"\n",(0,p.jsx)(n.p,{children:"\u521d\u59cb\u5316\u65f6\uff0cMPP Heap \u4ece CMA \u5185\u5b58\u4e2d\u7533\u8bf7\u4e00\u5927\u5757\u7269\u7406\u8fde\u7eed\u5185\u5b58\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a genpool \u5185\u5b58\u6c60\u8fdb\u884c\u7ba1\u7406\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_init-170669984075717.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_init.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.51 ",(0,p.jsx)(n.em,{children:"mpp_heap \u521d\u59cb\u5316"})]}),"\n",(0,p.jsxs)(n.h3,{id:"563-mpp-heap-export",children:["5.6.3. mpp heap export",(0,p.jsx)(n.a,{href:"#mpp-heap-export",children:"\xb6"})]}),"\n",(0,p.jsxs)(n.p,{children:["mpp heap \u901a\u8fc7 ",(0,p.jsx)(n.code,{children:"/dev/dmabuf/mpp"})," \u8282\u70b9\uff0c\u4ee5 ",(0,p.jsx)(n.code,{children:"ioctl"})," \u7684\u65b9\u5f0f\u5c06\u7ba1\u7406\u7684 CMA \u5185\u5b58\u5bfc\u51fa\u4e3a\u6807\u51c6\u7684 DMA-BUF \u6587\u4ef6\u53e5\u67c4\u3002"]}),"\n",(0,p.jsxs)(n.p,{children:["genpool \u5185\u5b58\u6c60\u662f\u4e00\u4e2a\u57fa\u4e8e bitmap \u7684\u7ba1\u7406\u7b97\u6cd5\uff0c\u5176\u6700\u5c0f\u5206\u914d\u5355\u4f4d\u4e3a 4K\uff0c\u5206\u914d\u7684\u5185\u5b58\u65e0\u8bba ",(0,p.jsx)(n.strong,{children:"\u9996\u5730\u5740"})," \u8fd8\u662f ",(0,p.jsx)(n.strong,{children:"\u5927\u5c0f"})," \uff0c\u90fd\u9075\u5faa ",(0,p.jsx)(n.code,{children:"4K"})," \u5bf9\u9f50\u3002"]}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_export-170669984741119.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_export.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.52 ",(0,p.jsx)(n.em,{children:"mpp_heap \u5bfc\u51fa DMA-BUF"})]}),"\n",(0,p.jsxs)(n.h3,{id:"564-mpp-heap-close",children:["5.6.4. mpp heap close",(0,p.jsx)(n.a,{href:"#mpp-heap-close",children:"\xb6"})]}),"\n",(0,p.jsxs)(n.p,{children:["\u53ea\u9700\u8981 ",(0,p.jsx)(n.code,{children:"close"})," DMA-BUF \u7684\u6587\u4ef6\u53e5\u67c4\uff0c\u5373\u89e6\u53d1 mpp heap \u7684\u56de\u6536 DMA-BUF\u3002"]}),"\n",(0,p.jsx)(n.p,{children:"\u6ce8\u89e3"}),"\n",(0,p.jsx)(n.p,{children:"\u5f53\u4e00\u5757 DMA-BUF \u8fd8\u88ab\u591a\u5a92\u4f53\u6a21\u5757\u5360\u7528\u65f6\uff0cclose \u64cd\u4f5c\u65e0\u6cd5\u89e6\u53d1 mpp heap \u56de\u6536"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_close-170669986798021.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_close.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.53 ",(0,p.jsx)(n.em,{children:"mpp_heap \u56de\u6536 DMA-BUF"})]}),"\n",(0,p.jsx)(n.h3,{id:"5-mpp-heap-destroy",children:"5. mpp heap destroy"}),"\n",(0,p.jsxs)(n.p,{children:["\u901a\u8fc7 ",(0,p.jsx)(n.code,{children:"/dev/dmabuf/mpp"})," \u8282\u70b9\uff0c\u4e0b\u53d1\u6269\u5c55\u7684 ",(0,p.jsx)(n.code,{children:"ioctl"})," \u63a5\u53e3\u5373\u53ef\u9500\u6bc1 MPP Heap, \u5c06\u5176\u4e2d\u7684 CMA \u5185\u5b58\u5f52\u8fd8\u6539\u7cfb\u7edf\u3002"]}),"\n",(0,p.jsx)(n.p,{children:"mpp heap \u4e00\u65e6\u88ab\u9500\u6bc1\uff0c\u65e0\u6cd5\u518d\u6b21\u521d\u59cb\u5316\uff0c\u53ea\u80fd reboot\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_destroy-170669988289623.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_destroy.png"})}),"\n",(0,p.jsxs)(n.p,{children:["\u56fe 6.54 ",(0,p.jsx)(n.em,{children:"mpp heap \u9500\u6bc1"})]}),"\n",(0,p.jsx)(n.h3,{id:"566-mpp-heap-\u63a5\u53e3",children:"5.6.6. mpp heap \u63a5\u53e3"}),"\n",(0,p.jsx)(n.p,{children:"\u63a5\u53e3\u5982\u4e0b :"}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"int dmabuf_device_open();\nvoid dmabuf_device_close(int dma_fd);\nvoid dmabuf_device_destroy(int dma_fd);\nint dmabuf_alloc(int dma_fd, int size);\n"})}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int dmabuf_device_open() |\n| -------- | ------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u83b7\u53d6 mpp heap \u7684\u6587\u4ef6\u53e5\u67c4 |\n| \u53c2\u6570\u5b9a\u4e49 | void                     |\n| \u8fd4\u56de\u503c   | dma_fd:\u6210\u529f<0:\u5931\u8d25       |\n| \u6ce8\u610f\u4e8b\u9879 |                          |\n"})}),"\n",(0,p.jsxs)(n.table,{children:[(0,p.jsx)(n.thead,{children:(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,p.jsx)(n.th,{children:"void dmabuf_device_close(int dma_fd)"})]})}),(0,p.jsxs)(n.tbody,{children:[(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,p.jsx)(n.td,{children:"\u91ca\u653e mpp heap \u7684\u6587\u4ef6\u53e5\u67c4"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,p.jsx)(n.td,{children:"dma_fd: mpp heap \u7684\u6587\u4ef6\u53e5\u67c4"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,p.jsx)(n.td,{children:"void"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,p.jsx)(n.td,{})]})]})]}),"\n",(0,p.jsxs)(n.table,{children:[(0,p.jsx)(n.thead,{children:(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,p.jsx)(n.th,{children:"void dmabuf_device_destroy(int dma_fd)"})]})}),(0,p.jsxs)(n.tbody,{children:[(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,p.jsx)(n.td,{children:"\u9500\u6bc1 mpp heap"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,p.jsx)(n.td,{children:"dma_fd: mpp heap \u7684\u6587\u4ef6\u53e5\u67c4"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,p.jsx)(n.td,{children:"void"})]}),(0,p.jsxs)(n.tr,{children:[(0,p.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,p.jsx)(n.td,{children:"mpp heap \u4e00\u65e6\u88ab\u9500\u6bc1\uff0c\u65e0\u6cd5\u518d\u6b21\u521d\u59cb\u5316\uff0c\u53ea\u80fd reboot"})]})]})]}),"\n",(0,p.jsx)(n.pre,{children:(0,p.jsx)(n.code,{children:"| \u51fd\u6570\u539f\u578b | int dmabuf_alloc(int dma_fd, int size)        |\n| -------- | --------------------------------------------- |\n| \u529f\u80fd\u8bf4\u660e | \u901a\u8fc7 mpp heap \u7533\u8bf7\u4e00\u5757 DMA-BUF                |\n| \u53c2\u6570\u5b9a\u4e49 | dma_fd: mpp heap \u7684\u6587\u4ef6\u53e5\u67c4size: DMA-BUF size |\n| \u8fd4\u56de\u503c   | DMA-BUF fd:\u6210\u529f<0:\u5931\u8d25                        |\n| \u6ce8\u610f\u4e8b\u9879 |                                               |\n"})}),"\n",(0,p.jsx)(n.h3,{id:"567-mpp-heap-\u8bbe\u7f6e",children:"5.6.7. mpp heap \u8bbe\u7f6e"}),"\n",(0,p.jsx)(n.p,{children:"mpp heap \u7ba1\u7406\u7684\u5185\u5b58\u5fc5\u987b\u6ee1\u8db3\u89c6\u9891\u64ad\u653e\u7684\u6700\u5927\u9700\u6c42\u3002"}),"\n",(0,p.jsxs)(n.p,{children:["\u89c6\u9891\u64ad\u653e\u5185\u5b58\u53ef\u7531 ",(0,p.jsx)(n.a,{href:"../../../_downloads/8db0ff5ddffd480ed46bdfb4ca60868d/video_memory.xlsx",children:(0,p.jsx)(n.code,{children:"\u89c6\u9891\u64ad\u653e\u5185\u5b58\u7edf\u8ba1\u8868\u683c"})})," \u5f97\u5230\u7ed3\u679c\u3002"]}),"\n",(0,p.jsx)(n.p,{children:"mpp heap \u4e2d\u7684\u5185\u5b58\u4ece CMA \u9884\u7559\u5185\u5b58\u4e2d\u7533\u8bf7\uff0c\u4f46 CMA \u5185\u5b58\u4e0d\u80fd\u53ea\u4e3a mpp heap \u9884\u7559\uff0c\u8fd8\u9700\u8981\u4e3a \u5176\u4ed6\u9700\u8981\u7269\u7406\u8fde\u7eed\u5185\u5b58\u7684\u6a21\u5757\u9884\u7559\uff0c\u4e3b\u8981\u662f\u663e\u793a\uff0c\u97f3\u9891\u548c\u901a\u8baf\u6a21\u5757\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u6ce8\u89e3"}),"\n",(0,p.jsx)(n.p,{children:"\u5982\u679c mpp heap \u7684 size \u6216 CMA \u9884\u7559\u5185\u5b58\u7684 size \u8bbe\u7f6e\u4e0d\u5408\u7406\uff0c\u4e0d\u4ec5\u5f71\u54cd mpp heap \u521d\u59cb\u5316\uff0c\u8fd8\u53ef\u80fd\u5f71\u54cd\u5176\u4ed6\u6a21\u5757\u8fd0\u884c\u3002"}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.strong,{children:"\u663e\u793a\u6a21\u5757"})}),"\n",(0,p.jsx)(n.p,{children:"\u4ee5 fb0 \u4e3a 32 \u4f4d argb8888 \u683c\u5f0f\uff0c\u5916\u63a5\u5206\u8fa8\u7387\u4e3a 1024x600 \u7684 LCD \u4e3a\u4f8b\uff1a"}),"\n",(0,p.jsxs)(n.p,{children:["\u5355 buffer \u573a\u666f\u4e0b\u9700\u8981 1024 * 600 * (32 / 8) = 2457600 byte, \u7ea6 ",(0,p.jsx)(n.code,{children:"2.4M"})," CMA \u5185\u5b58"]}),"\n",(0,p.jsxs)(n.p,{children:["\u53cc buffer \u573a\u666f\u4e0b\u5219\u9700\u8981 ",(0,p.jsx)(n.code,{children:"4.8M"})]}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.strong,{children:"\u97f3\u9891\u6a21\u5757"})}),"\n",(0,p.jsxs)(n.p,{children:["\u542f\u7528 ALSL \u7684\u573a\u666f\u4e0b\u9700\u8981\u4e3a\u97f3\u9891\u6a21\u5757\u9884\u7559 ",(0,p.jsx)(n.code,{children:"1.5M"})," CMA \u5185\u5b58"]}),"\n",(0,p.jsxs)(n.p,{children:["\u5728 ALSL \u52a0 I2S \u7684\u573a\u666f\u4e0b\u5219\u9700\u8981 ",(0,p.jsx)(n.code,{children:"2.5M"})," CMA \u5185\u5b58"]}),"\n",(0,p.jsx)(n.p,{children:(0,p.jsx)(n.strong,{children:"\u901a\u8baf\u6a21\u5757"})}),"\n",(0,p.jsx)(n.p,{children:"WIFI, Bluetooth, USB \u7b49\u901a\u8baf\u6a21\u5757\u4e5f\u4f1a\u5360\u7528\u90e8\u5206 CMA \u5185\u5b58\uff0c\u8fd9\u4e2a\u8981\u6839\u636e\u5b9e\u9645\u573a\u666f\u8fdb\u884c\u63a8\u7b97\u3002"}),"\n",(0,p.jsx)(n.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,p.jsxs)(n.p,{children:["CMA \u9884\u7559\u5185\u5b58\u7684\u5927\u5c0f >= mpp heap + \u5176\u4ed6\u6a21\u5757\uff0c\u540c\u65f6 CMA \u9884\u7559\u5185\u5b58\u5927\u5c0f\u9075\u5faa ",(0,p.jsx)(n.code,{children:"4M"})," \u5bf9\u9f50\u3002 \u4e3a\u786e\u4fdd\u7cfb\u7edf\u6b63\u5e38\u8fd0\u884c\uff0c\u5728\u8bbe\u7f6e CMA \u9884\u7559\u5185\u5b58\u65f6\u8981\u4fdd\u6709\u4e00\u5b9a\u7684\u4f59\u91cf\u3002"]}),"\n",(0,p.jsx)(n.h1,{id:"6-\u5e38\u89c1\u95ee\u9898",children:"6. \u5e38\u89c1\u95ee\u9898"}),"\n",(0,p.jsx)(n.h2,{id:"61-ve\u9a71\u52a8\u672a\u52a0\u8f7d",children:"6.1. VE\u9a71\u52a8\u672a\u52a0\u8f7d"}),"\n",(0,p.jsxs)(n.p,{children:["\u8bf7\u67e5\u770bVE\u4f7f\u7528\u6307\u5357 ",(0,p.jsx)(n.a,{href:"../ve/6_faq.html#ref-ve-insmod",children:"VE\u9a71\u52a8\u672a\u52a0\u8f7d"})]}),"\n",(0,p.jsx)(n.h2,{id:"62-\u89e3\u7801\u56fe\u50cf\u82b1\u5c4f",children:"6.2. \u89e3\u7801\u56fe\u50cf\u82b1\u5c4f"}),"\n",(0,p.jsx)(n.h3,{id:"621-\u73b0\u8c61",children:"6.2.1. \u73b0\u8c61"}),"\n",(0,p.jsx)(n.p,{children:"\u89e3\u7801\u540e\u7684\u56fe\u50cf\u51fa\u73b0\u82b1\u5c4f\u73b0\u8c61\u3002"}),"\n",(0,p.jsx)(n.h3,{id:"622-\u539f\u56e0\u5206\u6790",children:"6.2.2. \u539f\u56e0\u5206\u6790"}),"\n",(0,p.jsx)(n.p,{children:"\u9010\u6b65\u6392\u9664\u4ee5\u4e0b\u539f\u56e0\uff1a"}),"\n",(0,p.jsxs)(n.ol,{children:["\n",(0,p.jsx)(n.li,{children:"\u662f\u5426\u6e90\u6587\u4ef6\u672c\u8eab\u6709\u6570\u636e\u9519\u8bef\uff0c\u53ef\u4f7f\u7528 PC \u7aef\u89c6\u9891\u64ad\u653e\u8f6f\u4ef6\u6216\u56fe\u50cf\u6d4f\u89c8\u5668\u67e5\u770b\uff0c\u662f\u5426\u6709\u82b1\u5c4f\u73b0\u8c61;"}),"\n",(0,p.jsx)(n.li,{children:"\u901a\u8fc7\u4fdd\u5b58\u89e3\u7801\u5e27\u6570\u636e\uff0c\u5728 PC \u7aef\u67e5\u770b\u56fe\u50cf\u662f\u5426\u6709\u82b1\u5c4f\u73b0\u8c61\uff0c\u5982\u679c PC \u7aef\u67e5\u770b\u56fe\u50cf\u6b63\u5e38\uff0c\u5219\u9700\u8981\u6392\u67e5\u662f\u5426\u8bbe\u7f6e\u56fe\u50cf\u683c\u5f0f\u9519\u8bef\uff0c\u6216\u6392\u67e5 Display \u6a21\u5757\u76f8\u5173\u539f\u56e0\u3002"}),"\n",(0,p.jsx)(n.li,{children:"\u7801\u6d41\u89e3\u6790\u662f\u5426\u6b63\u786e\uff0c\u76f8\u5173 VE \u5bc4\u5b58\u5668\u4fe1\u606f\u662f\u5426\u914d\u7f6e\u6b63\u786e\uff0c\u5177\u4f53\u8bf7\u67e5\u770b VE Spec \u8bf4\u660e\u3002"}),"\n"]}),"\n",(0,p.jsx)(n.h2,{id:"63-\u56fe\u50cf\u89e3\u7801\u51fa\u9519",children:"6.3. \u56fe\u50cf\u89e3\u7801\u51fa\u9519"}),"\n",(0,p.jsxs)(n.p,{children:["\u8bf7\u67e5\u770bVE\u4f7f\u7528\u6307\u5357 ",(0,p.jsx)(n.a,{href:"../ve/6_faq.html#ref-ve-error",children:"\u89e3\u7801\u62a5\u9519"})]}),"\n",(0,p.jsx)(n.h2,{id:"64-\u7533\u8bf7-dmabuf-\u5931\u8d25",children:"6.4. \u7533\u8bf7 dmabuf \u5931\u8d25"}),"\n",(0,p.jsx)(n.h3,{id:"641-\u73b0\u8c61",children:"6.4.1. \u73b0\u8c61"}),"\n",(0,p.jsx)(n.p,{children:"log \u663e\u793a dmabuf \u7533\u8bf7\u5931\u8d25\uff0c\u6216\u8005\u89e3\u7801\u7a0b\u5e8f\u8dd1\u98de"}),"\n",(0,p.jsx)(n.h3,{id:"642-\u539f\u56e0\u5206\u6790",children:"6.4.2. \u539f\u56e0\u5206\u6790"}),"\n",(0,p.jsxs)(n.ol,{children:["\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsxs)(n.p,{children:["mpp heap \u7684\u662f\u5426\u6210\u529f\u521d\u59cb\u5316\uff0c\u751f\u6210 ",(0,p.jsx)(n.code,{children:"/dev/dmabuf/mpp"})," \u6587\u4ef6\u8282\u70b9"]}),"\n",(0,p.jsxs)(n.p,{children:["\u5982\u679c\u6ca1\u6709\u751f\u6210 ",(0,p.jsx)(n.code,{children:"/dev/dmabuf/mpp"})," \u6587\u4ef6\u8282\u70b9\uff0c\u5219\u9700\u8981\u589e\u52a0 CMA \u9884\u7559\u5185\u5b58\u7684\u5927\u5c0f\uff0c\u6216\u8005\u51cf\u5c0f mpp heap \u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f\u3002\u8bf7\u67e5\u770b\u914d\u7f6e\u6307\u5357 ",(0,p.jsx)(n.a,{href:"2_config_guide.html#ref-mpp-heap-cfg",children:"MPP Heap"})]}),"\n"]}),"\n",(0,p.jsxs)(n.li,{children:["\n",(0,p.jsx)(n.p,{children:"mpp heap \u662f\u5426\u8bbe\u7f6e\u5f97\u592a\u5c0f\uff0c\u65e0\u6cd5\u6ee1\u8db3\u6ee1\u8db3\u89e3\u7801\u7684\u9700\u6c42"}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,p.jsx)(n,{...e,children:(0,p.jsx)(h,{...e})}):h(e)}},1151:(e,n,d)=>{d.d(n,{Z:()=>s,a:()=>c});var p=d(7294);const r={},i=p.createContext(r);function c(e){const n=p.useContext(i);return p.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),p.createElement(i.Provider,{value:n},e.children)}}}]);