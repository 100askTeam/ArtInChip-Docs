<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-D213-DevKit/part3/08-2_CE-Useguide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">CE 使用指南 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://artinchip.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://artinchip.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/08-2_CE-Useguide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CE 使用指南 | 东山Π"><meta data-rh="true" name="description" content="1. 模块介绍"><meta data-rh="true" property="og:description" content="1. 模块介绍"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/08-2_CE-Useguide"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/08-2_CE-Useguide" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/08-2_CE-Useguide" hreflang="en"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/08-2_CE-Useguide" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.d875fe7e.css">
<script src="/en/assets/js/runtime~main.b47c3da8.js" defer="defer"></script>
<script src="/en/assets/js/main.880773af.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">东山Π</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/D213-DevKit/BoardIntroduction">D213-DevKit</a><a class="navbar__item navbar__link" href="/en/docs/category/luban-sdk使用指南">Luban-SDK</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/D213-DevKit/part3/08-2_CE-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/D213-DevKit/part3/08-2_CE-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/ArtInChip-Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/D213-DevKit/BoardIntroduction">匠心创D213-DevKit开发板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/D213-DevKit/SupportingResources">源码工具文档手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/快速启动">快速启动</a><button aria-label="Expand sidebar category &#x27;快速启动&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/D213-DevKit/ConfigHostEnv">安装并配置开发环境</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/luban-sdk开发">Luban-SDK开发</a><button aria-label="Expand sidebar category &#x27;Luban-SDK开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/luban-linux系统开发">Luban-Linux系统开发</a><button aria-label="Collapse sidebar category &#x27;Luban-Linux系统开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-1_BWMUserGuide">BWM 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-2_CMUUserGuide">CMU 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-3_DMABook">DMA 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-4_RTCUserGuide">RTC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-5_TSensorUserGuide">TSensor 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-6_WatchdogUserGuide">Watchdog 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-7_WRIUserGuide">WRI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-1_SDMCUserGuide">SDMC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-2_SPI_NANDUserGuide">SPI NAND 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-3_SPI_NORUserGuide">SPI NOR 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-4_FileSystemUserGuide">文件系统使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-1_GE-Useguide">GE 开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-2_VE-Useguide">VE 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-3_Display-Useguide">Display 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-4_DVP-Useguide">DVP开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-8_I2S-Useguide">I2S 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-9_AudioCodec-Useguide">AudioCodec 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-1_CAN-Useguide">CAN 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-2_ CIR-Useguide">CIR 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-3_ GPAI-Useguide">GPAI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-4_I2C-Useguide">I2C 开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-5_MAC-Useguide">MAC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-6_PBus-Useguide">PBus 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-7_PINCTRL-Useguide">PINCTRL 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-8_PWM-Useguide">PWM 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-9_RTP-Useguide">RTP 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-10_SPI-Useguide">SPI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-11_UART-Useguide">UART 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-12_USB-Useguide">USB 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-13_PSADC-Useguide">PSADC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-1_SPI-ENC">SPI ENC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/D213-DevKit/part3/08-2_CE-Useguide">CE 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-3_eFuse-Useguide">eFuse 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-4_HardwareAuthorizationCertification">硬件授权认证</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide">触摸屏调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-2_DisplayDebuggingGuide">显示屏调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-3_WiFiDebuggingGuide">WiFi调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-4_GuideToUsingTheKeyMatrix">按键矩阵使用指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux-bringup参考">Linux-Bringup参考</a><button aria-label="Expand sidebar category &#x27;Linux-Bringup参考&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux-uboot开发">Linux-Uboot开发</a><button aria-label="Expand sidebar category &#x27;Linux-Uboot开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/luban-linux系统开发"><span itemprop="name">Luban-Linux系统开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CE 使用指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>CE 使用指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-模块介绍">1. 模块介绍<a href="#1-模块介绍" class="hash-link" aria-label="Direct link to 1. 模块介绍" title="Direct link to 1. 模块介绍">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-术语定义">1.1. 术语定义<a href="#11-术语定义" class="hash-link" aria-label="Direct link to 1.1. 术语定义" title="Direct link to 1.1. 术语定义">​</a></h3>
<table><thead><tr><th>术语</th><th>定义</th><th>注释说明</th></tr></thead><tbody><tr><td>CE</td><td>Crypto Engine</td><td>硬件加解密算法引擎</td></tr><tr><td>DES</td><td>Data Encryption Standard</td><td>一种对称分组密码算法</td></tr><tr><td>AES</td><td>Advanced Encryption Standard</td><td>一种对称分组密钥算法</td></tr><tr><td>ECB</td><td>Electronic Code Book</td><td>电子密码本模式</td></tr><tr><td>CBC</td><td>Cipher Block Chaining</td><td>密码分组链模式</td></tr><tr><td>CTR</td><td>Counter</td><td>计数器模式</td></tr><tr><td>XTS</td><td>XEX Tweakable Block Cipher with Ciphertext Stealing</td><td>一种对称分组密码算法模式</td></tr><tr><td>CTS</td><td>Ciphertext Stealing</td><td>一种对称分组密码算法模式</td></tr><tr><td>RSA</td><td>Rivest-Shamir-Adleman</td><td>一种非对称密钥算法</td></tr><tr><td>MD5</td><td>Message Digest Algorithm</td><td>消息摘要算法</td></tr><tr><td>SHA</td><td>Secure Hash Algorithm</td><td>安全散列算法</td></tr><tr><td>TRNG</td><td>True Random Number Generator</td><td>真随机数生成器</td></tr><tr><td>SSK</td><td>Symmetric Secret Key</td><td>对称密钥</td></tr><tr><td>HUK</td><td>Hardware Unique Key</td><td>硬件唯一密钥</td></tr><tr><td>PNK</td><td>Part Number Key</td><td>芯片型号密钥</td></tr><tr><td>PSK</td><td>Partner Secret Key</td><td>合作伙伴密钥</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-模块简介">1.2. 模块简介<a href="#12-模块简介" class="hash-link" aria-label="Direct link to 1.2. 模块简介" title="Direct link to 1.2. 模块简介">​</a></h3>
<p>CE 是一个独立的硬件加解密算法引擎，支持下列算法模式：</p>
<table><thead><tr><th>算法类型</th><th>算法列表</th><th>密钥位宽</th></tr></thead><tbody><tr><td>对称密钥算法</td><td>AES ECB</td><td>128/256</td></tr><tr><td>AES CBC</td><td>128/256</td><td></td></tr><tr><td>AES CTR</td><td>128/256</td><td></td></tr><tr><td>AES CTS</td><td>128/256</td><td></td></tr><tr><td>AES XTS</td><td>256/512</td><td></td></tr><tr><td>DES ECB</td><td>64</td><td></td></tr><tr><td>DES CBC</td><td>64</td><td></td></tr><tr><td>TDES ECB</td><td>192</td><td></td></tr><tr><td>TDES CBC</td><td>192</td><td></td></tr><tr><td>非对称密钥算法</td><td>RSA</td><td>512/1024/2048</td></tr><tr><td>消息摘要算法</td><td>MD5</td><td></td></tr><tr><td>SHA-1</td><td></td><td></td></tr><tr><td>SHA-224</td><td></td><td></td></tr><tr><td>SHA-256</td><td></td><td></td></tr><tr><td>SHA-384</td><td></td><td></td></tr><tr><td>SHA-512</td><td></td><td></td></tr></tbody></table>
<p>同时具备下列功能：</p>
<blockquote>
<ul>
<li>真随机数产生器(TRNG)</li>
<li>安全访问 eFuse 密钥: eFuse 密钥仅 CE 可访问</li>
<li>安全 SRAM: 保护密钥安全</li>
<li>本地数据安全：加密的数据仅当前设备可解密，其他设备无法解密</li>
<li>硬件设备身份认证：软件可识别当前设备是否合法</li>
<li>可支持实现加密启动</li>
<li>可支持实现安全启动</li>
<li>可支持实现文件系统加密</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-原理框图">1.3. 原理框图<a href="#13-原理框图" class="hash-link" aria-label="Direct link to 1.3. 原理框图" title="Direct link to 1.3. 原理框图">​</a></h3>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_block_diagram2-17067682235501.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_block_diagram2.png" class="img_ev3q"></p>
<p>图 8.10 <em>CE 原理框图</em></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-参数配置">2. 参数配置<a href="#2-参数配置" class="hash-link" aria-label="Direct link to 2. 参数配置" title="Direct link to 2. 参数配置">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-内核配置">2.1. 内核配置<a href="#21-内核配置" class="hash-link" aria-label="Direct link to 2.1. 内核配置" title="Direct link to 2.1. 内核配置">​</a></h3>
<p>使能 CE 相关的内核驱动，可在通过下列命令进行配置（在 SDK 顶层目录执行）:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make linux-menuconfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或者使用快捷命令:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make km</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在内核的配置界面中，进行下列的选择:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Cryptographic API  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;*&gt;   User-space interface for asymmetric key cipher algorithms</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*]   Hardware crypto devices  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   Support for artinchip cryptographic accelerator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;*&gt;     Artinchip&#x27;s crypto engine driver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此处特别选择了 <code>User-space interface for asymmetric key cipher algorithms</code> 是因为默认的 Linux 内核仅对用户空间开放了下列四种类型的算法。</p>
<table><thead><tr><th>算法类型</th><th>内核开放接口</th><th>说明</th></tr></thead><tbody><tr><td>SKCIPHER</td><td>是</td><td>对称密钥类算法，如 AES、DES 等</td></tr><tr><td>AEAD</td><td>是</td><td>关联数据的认证加密类算法，如 GCM-AES，CCM-AES 等</td></tr><tr><td>HASH</td><td>是</td><td>消息摘要类算法，如 MD5，SHA-256 等</td></tr><tr><td>RNG</td><td>是</td><td>随机数类算法</td></tr><tr><td>AKCIPHER</td><td>否</td><td>非对称密钥类算法，如 RSA</td></tr></tbody></table>
<p>内核中 <code>非对称密钥类算法</code> 默认并没有对用户空间开放。Artinchip 对内核打了补丁，使得内核支持用户空间程序 使用内核所提供的非对称密钥算法，在配置内核时使能上述配置即可。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-dts-配置">2.2. DTS 配置<a href="#22-dts-配置" class="hash-link" aria-label="Direct link to 2.2. DTS 配置" title="Direct link to 2.2. DTS 配置">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crypto: crypto-engine@10020000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        compatible = &quot;artinchip,aic-crypto-v1.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0x0 0x10020000 0x0 0x1000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        interrupts-extended = &lt;&amp;plic0 33 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        clocks = &lt;&amp;cmu CLK_CE&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        resets = &lt;&amp;rst RESET_CE&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-调试指南">3. 调试指南<a href="#3-调试指南" class="hash-link" aria-label="Direct link to 3. 调试指南" title="Direct link to 3. 调试指南">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-调试开关">3.1. 调试开关<a href="#31-调试开关" class="hash-link" aria-label="Direct link to 3.1. 调试开关" title="Direct link to 3.1. 调试开关">​</a></h3>
<p>可通过内核配置使能 CE 模块的 DEBUG 选项。在 SDK 根目录下执行:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make linux-menuconfig (or make km)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>进入内核的配置界面:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Kernel hacking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Artinchip Debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] CE driver debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>勾选使能该 DEBUG 选项后：</p>
<blockquote>
<ol>
<li>CE 的驱动源码将以 <code>-O0</code> 编译</li>
<li>CE 驱动中的 pr_dbg() 和 dev_dbg() 调试信息会被编译</li>
</ol>
</blockquote>
<p>如果需要看到 pr_dbg() 和 dev_dbg() 的打印信息，还需要设置 <code>loglevel=8</code> 。</p>
<p>若需要在启动过程中即可看到打印，需要在 <code>env.txt</code> 中修改 bootargs，增加 <code>loglevel=8</code> 。 若仅需要在板子启动到 Linux shell 后使能相关打印，可以通过下列命令调整 loglevel：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo 8 &gt; /proc/sys/kernel/printk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-测试指南">4. 测试指南<a href="#4-测试指南" class="hash-link" aria-label="Direct link to 4. 测试指南" title="Direct link to 4. 测试指南">​</a></h2>
<p>CE 的测试主要覆盖以下几个要点：</p>
<blockquote>
<ul>
<li>驱动所实现的所有算法</li>
<li>不同数据长度的处理</li>
<li>输入输出 buffer 是否 4KB 对齐（需要支持不对齐的情况）</li>
<li>多进程/线程并发访问</li>
</ul>
</blockquote>
<p>测试的方式主要是通过对算法处理后的数据进行“比数”的方式进行，结果与参考结果一致，则表明测试通过。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-测试工具">4.1. 测试工具<a href="#41-测试工具" class="hash-link" aria-label="Direct link to 4.1. 测试工具" title="Direct link to 4.1. 测试工具">​</a></h3>
<p>主机端工具：</p>
<blockquote>
<ul>
<li>OpenSSL (主机需要安装)</li>
</ul>
</blockquote>
<p>平台端工具：</p>
<blockquote>
<ul>
<li>crypto_kcapi (编译 source/artinchip/test-ce)</li>
</ul>
</blockquote>
<p>编译 crypto_kcapi 需要在 SDK 顶层目录执行:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make menuconfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>选择配置:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Artinchip packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sample code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*] test-ce</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-测试对象">4.2. 测试对象<a href="#42-测试对象" class="hash-link" aria-label="Direct link to 4.2. 测试对象" title="Direct link to 4.2. 测试对象">​</a></h3>
<p>需要测试的算法有：</p>
<table><thead><tr><th>对称密钥算法</th><th>非对称密钥算法</th><th>消息摘要算法</th></tr></thead><tbody><tr><td>cbc(des3_ede)ecb(des3_ede)cbc(des)ecb(des)xts(aes)cts(aes)ctr(aes)cbc(aes)ecb(aes)huk-protected(xts(aes))huk-protected(cts(aes))huk-protected(cbc(aes))huk-protected(ecb(aes))ssk-protected(cbc(aes))ssk-protected(ecb(aes))</td><td>rsapsk3-protected(rsa)psk2-protected(rsa)psk1-protected(rsa)psk0-protected(rsa)pnk-protected(rsa)</td><td>sha512sha384sha256sha224sha1md5hmac(sha256)hmac(sha1)</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-测试方法">4.3. 测试方法<a href="#43-测试方法" class="hash-link" aria-label="Direct link to 4.3. 测试方法" title="Direct link to 4.3. 测试方法">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="431-创建测试用例的脚本">4.3.1. 创建测试用例的脚本<a href="#431-创建测试用例的脚本" class="hash-link" aria-label="Direct link to 4.3.1. 创建测试用例的脚本" title="Direct link to 4.3.1. 创建测试用例的脚本">​</a></h4>
<p>HOST 端，通过 <code>gen_xxx_test_data.sh</code> 脚本，生成对应算法的测试脚本。 <code>gen_xxx_test_data.sh</code> 脚本所做的事情包括：</p>
<blockquote>
<ul>
<li>生成测试数据：指定长度的 <code>0x00 ~ 0xFF</code> 循环数据</li>
<li>  使用 OpenSSL 工具，根据指定的密钥，生成对应算法加解密后的数据</li>
<li>使用 OpenSSL 工具，对生成的结果计算 MD5 值</li>
<li>将对应的 MD5 值写入生成的 <code>test_xxx_script_kcapi.sh</code> 中，作为比较依据</li>
<li>生成的 <code>test_xxx_script_kcapi.sh</code> 使用 DEVICE 端的 <code>crypto_kcapi</code> 工具进行测试</li>
</ul>
</blockquote>
<p>相关的脚本和数据在 <code>source/artinchip/test-ce/test</code> 目录下。目前有下列用于生成测试用例的脚本：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gen_hash_test_data.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gen_rsa_test_data.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gen_skcipher_ssram_test_data.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gen_skcipher_test_data.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_test_host-17067683239363.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_test_host.png" class="img_ev3q"></p>
<p>图 8.11 <em>生成测试脚本</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="432-测试用例脚本">4.3.2. 测试用例脚本<a href="#432-测试用例脚本" class="hash-link" aria-label="Direct link to 4.3.2. 测试用例脚本" title="Direct link to 4.3.2. 测试用例脚本">​</a></h4>
<p>DEVICE 端在系统运行起来之后，可以在 <code>/usr/local/bin/test</code> 目录下，运行测试用例脚本。</p>
<p>测试脚本所做的事情包括：</p>
<blockquote>
<ul>
<li>生成测试数据：与 HOST 端一样，指定长度的 <code>0x00 ~ 0xFF</code> 循环数据</li>
<li>使用 crypto_kcapi 工具，根据指定的密钥，生成对应算法加解密后的数据</li>
<li>使用 crypto_kcapi 工具，对生成的结果计算 MD5 值</li>
<li>对比测试脚本中的 MD5 值，如果一样，则测试通过，否则失败</li>
</ul>
</blockquote>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_test_device-17067683451825.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_test_device.png" class="img_ev3q"></p>
<p>图 8.12 <em>运行测试脚本</em></p>
<p>目前有下列用于测试的脚本：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_cbc_huk_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_cbc_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_cbc_ssk_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_ctr_huk_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_ctr_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_ctr_ssk_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_ecb_huk_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_ecb_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_aes_ecb_ssk_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_des_cbc_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_des_ecb_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_hash_all_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_md5_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_rsa_1024_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_rsa_2048_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_rsa_512_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_sha1_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_sha224_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_sha256_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_sha384_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_sha512_script_kcapi.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test_skciper_all_script_kcapi.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-设计说明">5. 设计说明<a href="#5-设计说明" class="hash-link" aria-label="Direct link to 5. 设计说明" title="Direct link to 5. 设计说明">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-源码说明">5.1. 源码说明<a href="#51-源码说明" class="hash-link" aria-label="Direct link to 5.1. 源码说明" title="Direct link to 5.1. 源码说明">​</a></h3>
<table><thead><tr><th>相关模块</th><th>源码路径</th></tr></thead><tbody><tr><td>1. Crypto subsystem2. AF_ALG</td><td>source/linux-5.10/crypto/</td></tr><tr><td>Driver</td><td>source/linux-5.10/drivers/crypto/artinchip/ce/</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-模块架构">5.2. 模块架构<a href="#52-模块架构" class="hash-link" aria-label="Direct link to 5.2. 模块架构" title="Direct link to 5.2. 模块架构">​</a></h3>
<p>CE 模块对接内核加密子系统。 <code>CE &lt;—&gt; Crypto subsystem &lt;—&gt; User space</code> 之间的层次关系如下图所示。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_kernel-17067684750627.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_kernel.png" class="img_ev3q"></p>
<p>图 8.13 <em>CE 与内核加密子系统</em></p>
<p>Linux 内核加密子系统由几个部分组成</p>
<ul>
<li>
<p>核心部分:</p>
<p>该部分实现了加密子系统的主要核心功能，包括主要的数据结构和管理所支持的算法类型以及不同算法之间进行组合的模板等对下对接各种算法的具体软硬件实现，对上提供对应的 API，为内核其他模块提供服务。</p>
</li>
<li>
<p>算法实现部分:</p>
<p>分为软件的基本算法实现硬件算法加速器的驱动。</p>
</li>
<li>
<p>用户空间接口部分:</p>
<p>内核加密子系统通过 Socket 接口向用户空间程序提供服务AF_NETLINK 接口，提供关于加密学子系统的信息，用户态程序可以通过该接口查询当前加密子系统向用户态提供了哪些服务，以及相关算法的详细信息；AF_ALG 接口，提供与具体算法进行交互的接口，用户态程序可以使用该接口对数据进行加解密等处理。</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-设计要点">5.3. 设计要点<a href="#53-设计要点" class="hash-link" aria-label="Direct link to 5.3. 设计要点" title="Direct link to 5.3. 设计要点">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="531-ce-算法的分类注册">5.3.1. CE 算法的分类注册<a href="#531-ce-算法的分类注册" class="hash-link" aria-label="Direct link to 5.3.1. CE 算法的分类注册" title="Direct link to 5.3.1. CE 算法的分类注册">​</a></h4>
<p>CE 硬件实现了多组不同类型的加密算法加速单元，分别对应内核加密子系统中的几种类型加密算法。在驱动实现时，根据不同的算法类型，将 CE 硬件抽象出三个不同的算法加速器：</p>
<blockquote>
<ol>
<li>对称密钥算法加速器</li>
<li>非对称密钥算法加速器</li>
<li>消息摘要算法加速器</li>
</ol>
</blockquote>
<p>驱动按照不同的算法加速器进行资源分配和实现，每个算法加速器支持多种不同的具体算法，并且将具体算法注册到加密子系统。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_alg_and_accel-17067684951479.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_alg_and_accel.png" class="img_ev3q"></p>
<p>图 8.14 <em>CE 算法分类</em></p>
<p>驱动为 每一个 CE 算法实现一个实例，然后注册到内核加密子系统。 内核加密子系统使用链表的方式管理所有注册的算法，后续的使用者通过两个名字（ <code>cra_name</code>, <code>cra_driver_name</code> ）可以查找到对应的算法。 例如：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct skcipher_alg alg = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_name = &quot;ecb(aes)&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_driver_name = &quot;ecb-aes-aic&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_priority = 400,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_flags = CRYPTO_ALG_ASYNC | CRYPTO_ALG_ALLOCATES_MEMORY,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_blocksize = AES_BLOCK_SIZE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_ctxsize = sizeof(struct aic_skcipher_tfm_ctx),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_alignmask = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .base.cra_module = THIS_MODULE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .init = aic_skcipher_alg_init,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .exit = aic_skcipher_alg_exit,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .setkey = aic_skcipher_alg_setkey,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .decrypt = aic_skcipher_aes_ecb_decrypt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .encrypt = aic_skcipher_aes_ecb_encrypt,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .min_keysize = AES_MIN_KEY_SIZE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .max_keysize = AES_MAX_KEY_SIZE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .ivsize = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>各驱动和算法实现模块，通过下列接口向加密子系统注册算法。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_register_skcipher(struct skcipher_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void crypto_unregister_skcipher(struct skcipher_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_register_akcipher(struct akcipher_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void crypto_unregister_akcipher(struct akcipher_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_register_ahash(struct ahash_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void crypto_unregister_ahash(struct ahash_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_register_aead(struct aead_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void crypto_unregister_aead(struct aead_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_register_kpp(struct kpp_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void crypto_unregister_kpp(struct kpp_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_register_rng(struct rng_alg *alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void crypto_unregister_rng(struct rng_alg *alg);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_subsystem_alg_list-170676851354211.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_subsystem_alg_list.png" class="img_ev3q"></p>
<p>图 8.15 <em>加密子系统的算法列表</em></p>
<p>使用时，使用者需要使用对应的 API，创建对应算法的数据处理实例，然后使用对应类型算法的接口，进行数据的处理。如对称密钥算法使用下列的接口。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct crypto_skcipher *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crypto_alloc_skcipher(const char *alg_name, u32 type, u32 mask);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct skcipher_request *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">skcipher_request_alloc(struct crypto_skcipher *tfm, gfp_t gfp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_skcipher_encrypt(struct skcipher_request *req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int crypto_skcipher_decrypt(struct skcipher_request *req);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注解</p>
<p>可以留意，以对对称密钥算法为例，向加密子系统注册算法实例时，使用的结构体为 <code>struct skciper_alg</code>， 用户 API 使用时，使用的结构体为 <code>struct crypto_skcipher</code> 。这里的区别是，前者是对内， 是具体算法的实现；后者是对外，代表一个对称密钥算法。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="532-异步调用和处理">5.3.2. 异步调用和处理<a href="#532-异步调用和处理" class="hash-link" aria-label="Direct link to 5.3.2. 异步调用和处理" title="Direct link to 5.3.2. 异步调用和处理">​</a></h4>
<p>为了支持更广泛的应用场景，CE 的算法驱动需要实现异步调用，即每一个请求调用，都会立刻返回， 然后通过注册的回调函数来获取请求处理完成的通知。</p>
<p>要实现异步调用需要为每一个加速器实现对应的任务队列，以及相应的执行线程。内核加密子系统提供的公共模块 <code>crypto_engine</code> 已经实现了对应的功能，只需为每个加速器创建 <code>crypto_engine</code> 即可。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_async_call-170676852870913.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_async_call.png" class="img_ev3q"></p>
<p>图 8.16 <em>Crypto Engine 的异步工作流程</em></p>
<p>如上图所示，当算法驱动接收到一个数据处理请求时，只需做一些基本的标记工作，然后将该请求转发给对应的 <code>crypto_engine</code> 进行管理。<code>crypto_engine</code> 包含一个任务队列，以及一个工作线程。</p>
<p>工作线程总是检查当前队列是否有待处理的任务，如果有任务需要处理，则对当前任务按顺序调用对应的回调函数：</p>
<table><thead><tr><th>回调函数</th><th>说明</th></tr></thead><tbody><tr><td>prepare(…)</td><td>准备硬件以及对将要送给硬件的数据进行预处理</td></tr><tr><td>do_one_request(…)</td><td>启动硬件，处理数据</td></tr></tbody></table>
<p>硬件完成处理之后，在对一个的 IRQ 处理线程中处理输出数据，并且调用该请求的回调函数，以及释放本次数据处理请求所申请的资源。</p>
<p>注解</p>
<p>CE 的每一个算法处理单元对应一个 <code>crypto_engine</code>, 即有：skcipher engine，akcipher engine，hash engine</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="533-efuse-密钥和安全-sram">5.3.3. eFuse 密钥和安全 SRAM<a href="#533-efuse-密钥和安全-sram" class="hash-link" aria-label="Direct link to 5.3.3. eFuse 密钥和安全 SRAM" title="Direct link to 5.3.3. eFuse 密钥和安全 SRAM">​</a></h4>
<p>安全 SRAM 是 CE 中的一块专用 SRAM，该 SRAM 与其他模块安全隔离，仅 CE 可以访问， 因此用其保存的密钥和数据可以保证不被其他模块窃取。</p>
<p>安全 SRAM 的设计目的是要解决密钥的本地存储的安全问题。在一些数据加密的应用场景中，用户生成了一个密钥， 并且使用该密钥对数据进行加密。本地存储了加密后的数据，但是密钥要如何保存才安全又成了新的问题。 如果明文保存在本地，则很容易被窃取。</p>
<p>使用安全 SRAM 如何解决密钥的本地存储的安全问题？具体做法是：</p>
<blockquote>
<ol>
<li>本地不保存明文密钥，只保存经过 eFuse 密钥加密后的密钥数据（eFuse 密钥 CPU 不可读，仅 CE 可读）</li>
<li>需要使用密钥时，首先将加密后的密钥数据，解密到安全 SRAM，CE 再从安全 SRAM 读取密钥明文</li>
</ol>
</blockquote>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/secure_sram_1-170676854874115.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/secure_sram_1.png" class="img_ev3q"></p>
<p>图 8.17 <em>安全密钥的生成</em></p>
<p>在需要使用安全 SRAM 进行加解密处理时，需要完成下列操作：</p>
<blockquote>
<ol>
<li>用户指定一种对称密钥算法，指定 eFuse 密钥，对加密后的密钥数据进行解密</li>
<li>用户指定解密后的明文密钥输出的安全 SRAM 位置</li>
<li>配置 CE 使用特定安全 SRAM 中的明文密钥，对数据进行加解密处理</li>
</ol>
</blockquote>
<p>问题：</p>
<blockquote>
<p>该流程是 AIC CE 特有，用户提供了更多  的输入信息，中间多了密钥的解密、安全 SRAM 的管理等。 该处理流程如何融入到内核加密子系统的算法处理流程成为了问题。</p>
</blockquote>
<p>为了很好的对接内核加密子系统，并且方便用户使用，CE 驱动采取的方案是：</p>
<blockquote>
<ol>
<li>将安全 SRAM 的使用场景具体化，限制到具体的应用需求</li>
<li>将使用安全 SRAM 的算法抽象为一种特殊的算法，注册到内核加密子系统中</li>
<li>算法的处理过程中首先进行一个密钥的解密，然后再进行数据的处理</li>
</ol>
</blockquote>
<p>具体实现是为每一个场景实现一个对应的特殊算法，如为需要使用 eFuse HUK 进行密钥解密的 AES ECB 算法，实现一个名为 <code>huk-protected(ecb(aes))</code> 的算法，并且注册到内核加密子系统中。</p>
<p>当用户指定使用该算法时：</p>
<blockquote>
<ol>
<li>对应的驱动总是先申请一块安全 SRAM 空间</li>
<li>使用 eFuse HUK 对用户所提供的密钥数据进行解密，并输出到安全 SRAM 空间</li>
<li>然后指定 CE 使用安全 SRAM 中生成的明文密钥，对数据进行处理</li>
</ol>
</blockquote>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/secure_sram_2-170676856394417.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/secure_sram_2.png" class="img_ev3q"></p>
<p>图 8.18 <em>算法使用安全 SRAM 的示意图</em></p>
<p>通过这种方式，既可以让用户选择符合条件的处理算法，又避免了用户参与处理 eFuse 密钥等额外流程， 还与当前内核加密子系统中其他算法的使用流程保持一致，用户只要指定正确的名字即可使用这些特殊算法。</p>
<p>当前 CE 驱动为下列几个应用场景定义了特殊算法。</p>
<blockquote>
<ol>
<li>
<p>数据安全保护：将数据与设备型号加密绑定</p>
<p>eFuse SSK 密钥，一型一密（厂商定义，一个型号共用相同密码）， 通过 <code>ssk-protected(ecb(aes))</code> 和 <code>ssk-protected(cbc(aes))</code> 算法加密的数据，结合本地密钥可在相同型号的机器上进行解密。</p>
</li>
<li>
<p>数据安全保护：将数据与具体设备加密绑定</p>
<p>eFuse HUK 密钥，一机一密（芯片出厂时随机生成，每台唯一），通过 <code>huk-proteced(ecb(aes))</code> 和 <code>huk-proteced(cbc(aes))</code> 算法加密的数据，只能在当前设备可以解密。</p>
<p><code>huk-proteced(cts(aes))</code> 和 <code>huk-proteced(xts(aes))</code> 可用于当前设备的文件系统加密， 保证加密后的文件系统只有当前设备可以解密使用。</p>
</li>
<li>
<p>设备身份安全认证</p>
<p>RSA 算法可以用于设备身份认证，前提是设备可以安全的保存其特有的私钥。</p>
<p>AIC 的方案中可以使用 eFuse 密钥 PNK、PSK 对私钥进行加密保存在设备本地，然后使用 <code>pnk-proteced(rsa)</code> 算法，或者 <code>pskx-proteced(rsa)</code> 算法，将对应的私钥解密到安全 SRAM 中使用。</p>
<p>PNK、PSK 是仅 CE 可访问的安全 eFuse 空间，可根据实际情况，分配给不同的厂商/用户使用。 当用户需要对设备进行身份认证时，可使用这些算法。</p>
</li>
</ol>
</blockquote>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/secure_sram_3-170676857741219.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/secure_sram_3.png" class="img_ev3q"></p>
<p>图 8.19 <em>使用安全 SRAM 的特殊算法</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="534-fallback-机制">5.3.4. Fallback 机制<a href="#534-fallback-机制" class="hash-link" aria-label="Direct link to 5.3.4. Fallback 机制" title="Direct link to 5.3.4. Fallback 机制">​</a></h4>
<p>当用户使用指定的 CE 算法时，遇到一些 CE 无法支持的边角情况，此时需要通过 Fallback 机制， 使用软件实现的算法完成用户指定的数据处理任  务。</p>
<p>目前可能需要使用 Fallback 机制的是 RSA 算法。</p>
<p>RSA 算法共有5 种密钥长度，但是目前 CE 仅支持三种（512、1024、2048），当用户需要使用 3072， 4096 比特的密钥时，需要使用 Fallback 机制，使用软件计算。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="535-内核补丁">5.3.5. 内核补丁<a href="#535-内核补丁" class="hash-link" aria-label="Direct link to 5.3.5. 内核补丁" title="Direct link to 5.3.5. 内核补丁">​</a></h4>
<p>如前面所述，内核加密子系统通过 AF_ALG Socket 接口向用户空间程序提供了部分算法服务，包括下面四中类型的算法：</p>
<blockquote>
<ol>
<li>SKCIPHER 对称密钥类算法，如 AES、DES 等算法</li>
<li>AEAD 关联数据的认证加密类算法，如 GCM-AES, CCM-AES 等算法</li>
<li>HASH 消息摘要类算法，如 MD5，SHA-256 等算法</li>
<li>RNG 随机数类算法</li>
</ol>
</blockquote>
<p>默认情况下，非对称密钥算法，如 RSA、ECC 等算法内核并没有提供接口给用户空间程序使用。这里有部分原因是这类算法运算量大，在应用中不会用来直接对数据进行处理，仅用于对小量的关键数据进行加解密，因此直接使用用户空间的算法库效率更高，避免了系统调用等的额外开销。</p>
<p>但是提供非对称密钥算法的接口在一些情况下是有意义的，比如平台支持非对称密钥算法的硬件加速，并且运算速度明显比 CPU 计算更快；或者硬件提供基于非对称密钥算法的额外安全功能，比如 AIC 的 CE 可以提供基于 RSA 算法的硬件设备身份安全认证功能，用户空间程序需要有接口可以使用 CE 的 RSA 算法加速器。</p>
<p>虽然主线的内核并没有提供非对称密钥算法的 AF_ALG 接口，但是社区中有相关接口的补丁。Libkcapi 是一个对内核加密子系统 AF_ALG 接口进行封装的开源库，该库将 AF_ALG 接口封装成用户空间更容易使用的 API 接口，并且为若干内核版本提供了非对称密钥的 AF_ALG 接口补丁，通过使用这些补丁，用户空间程序可以使用内核中的非对称密钥算法。</p>
<p>相关的信息链接：</p>
<blockquote>
<ol>
<li><a href="https://www.chronox.de/libkcapi.html" target="_blank" rel="noopener noreferrer">https://www.chronox.de/libkcapi.html</a></li>
<li><a href="https://github.com/smuellerDD/libkcapi" target="_blank" rel="noopener noreferrer">https://github.com/smuellerDD/libkcapi</a></li>
</ol>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-关键流程">5.4. 关键流程<a href="#54-关键流程" class="hash-link" aria-label="Direct link to 5.4. 关键流程" title="Direct link to 5.4. 关键流程">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="541-初始化流程">5.4.1. 初始化流程<a href="#541-初始化流程" class="hash-link" aria-label="Direct link to 5.4.1. 初始化流程" title="Direct link to 5.4.1. 初始化流程">​</a></h4>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_keyflow-170676860953421.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_keyflow.png" class="img_ev3q"></p>
<p>图 8.20 <em>初始化流程</em></p>
<p>相关的代码流程如下。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aic_crypto_probe(pdev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; ce_dev-&gt;base = devm_platform_ioremap_resource(pdev, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; ret = devm_request_threaded_irq(dev, irq, aic_crypto_irq_handler,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                   aic_crypto_irq_thread, IRQF_ONESHOT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|                                   dev_name(dev), ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; ce_dev-&gt;clk = devm_clk_get(dev, NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; clk_prepare_enable(ce_dev-&gt;clk);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; ce_dev-&gt;reset = devm_reset_control_get(dev, NULL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; reset_control_assert(ce_dev-&gt;reset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; reset_control_deassert(ce_dev-&gt;reset);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_crypto_skcipher_accelerator_init(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-&gt; eng = crypto_engine_alloc_init_and_set(ce-&gt;dev, true, NULL, true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |                                          ACCEL_QUEUE_MAX_SIZE);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-&gt; kfifo_alloc(&amp;ce-&gt;sk_accel.req_fifo, ACCEL_QUEUE_MAX_SIZE, GFP_KERNEL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-&gt; crypto_engine_start(ce-&gt;sk_accel.engine);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   |-&gt; crypto_register_skcipher(&amp;sk_algs[i].alg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_crypto_akcipher_accelerator_init(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_crypto_hash_accelerator_init(ce_dev);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="542-数据处理流程">5.4.2. 数据处理流程<a href="#542-数据处理流程" class="hash-link" aria-label="Direct link to 5.4.2. 数据处理流程" title="Direct link to 5.4.2. 数据处理流程">​</a></h4>
<p>由于 CE 中几种类型算法的数据处理流程相似，这里仅以对称密钥算法的数据处理流程为例进行说明。</p>
<p>在处理步骤上，各种算法都遵循标准化的几个步骤：</p>
<blockquote>
<ol>
<li>从 Crypto Core 层将处理请求传递给 CE 算法</li>
<li>CE 算法处理函数将请求转交给(transfer)给对应加速器的 crypto_engine 队列</li>
<li>crypto_engine 中的处理线程从队列中取出请求，调用对应的 prepare/do_one_req 进行处理</li>
<li>do_one_req 回调函数中，将对应的请求交给硬件处理</li>
<li>在中断处理函数中，取出结果，返回给调用者</li>
</ol>
</blockquote>
<p>对称密钥算法的具体处理调用流程如下所示。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aic_skcipher_aes_ecb_encrypt(req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_skcipher_crypt(req, FLG_AES | FLG_ECB);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-&gt; crypto_transfer_skcipher_request_to_engine(eng, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crypto_engine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_skcipher_prepare_req(engine, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_skcipher_do_one_req(engine, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-&gt; aic_crypto_enqueue_task(ce, algo, rctx-&gt;phy_task);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aic_crypto_irq_thread(int irq, void *arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; aic_skcipher_handle_irq(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-&gt; crypto_finalize_skcipher_request(ce-&gt;sk_accel.engine, req, err);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |-&gt; aic_skcipher_unprepare_req(engine, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        |-&gt; req.complete(req, err);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>除了上述的大处理流程，还有一个关键点需要注意，就是 <strong>数据的对齐处理</strong> 。用户发起数据处理请求时， 提供了输入和输出的数据缓冲区，然而这些数据缓冲区对 CE 而言有两个问题：</p>
<blockquote>
<ol>
<li>这些缓冲区是虚拟地址空间的内存，并不一定是物理连续的内存空间</li>
<li>缓冲区的开始地址并不一定是对齐的，不一定满足 CE 的地址对齐要求</li>
</ol>
</blockquote>
<p>因此需要对输入和输出的数据做一些处理。</p>
<p>一个简单的处理方式是对输入和输出的数据，一律复制到驱动新申请的物理连续的缓冲区中， 使用该空间作为 CE 的硬件工作缓冲区，处理完成之后再复制到用户提供的输出缓冲区。 但是对每一笔数据都会有额外的两次数据拷贝操作，对于处理大量数据的应用场景，效率较低。</p>
<p>为了兼顾数据处理效率，CE 驱动针对可能出现的情况，做了几个分类， <strong>原则上尽量避免数据拷贝</strong> 。</p>
<blockquote>
<ol>
<li>
<p>输入缓冲区和输出缓冲区 CE 都无法使用</p>
<p>此种情况CE 驱动为输入和输出缓冲区分配物理连续的工作缓冲区，并且需要对输入和输出数据进行复制。</p>
</li>
<li>
<p>输入缓冲区 CE 可用，输出 缓冲区 CE 不可用</p>
<p>此种情况 CE 驱动为输出缓冲区分配物理连续的工作缓冲区，CE 将数据处理完成之后，再复制到用户提供的输出缓冲区。</p>
</li>
<li>
<p>输入缓冲区 CE 不可用，输出缓冲区 CE 可用</p>
<p>此种情况 CE 驱动为输入缓冲区分配物理连续的工作缓冲区，CE 驱动先将输入数据复制到工作缓冲区， 再启动 CE 处理，直接输出到输出缓冲区。</p>
</li>
<li>
<p>输入缓冲区和输出缓冲区都是 CE 可用</p>
<p>此种情况效率最高，CE 直接使用用户提供的输入输出缓冲区。</p>
</li>
</ol>
</blockquote>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_data_buffer_for_ce-170676862505723.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_data_buffer_for_ce.png" class="img_ev3q"></p>
<p>当用户处理大量数据时，为了提高系统的处理效率，应为输入和输出数据申请按页对齐的缓冲区，这样 CE 驱动可以直接使用，避免额外的复制操作。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="543-中断处理流程">5.4.3. 中断处理流程<a href="#543-中断处理流程" class="hash-link" aria-label="Direct link to 5.4.3. 中断处理流程" title="Direct link to 5.4.3. 中断处理流程">​</a></h4>
<p>CE 驱动的中断处理比较简单，采用线程化的 IRQ 处理方式实现。</p>
<p>当中断发生时，首先在 irq handler 函数中保存当前的 IRQ 状态寄存器和错误状态寄存器的值。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static irqreturn_t aic_crypto_irq_handler(int irq, void *arg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct aic_crypto_dev *ce_dev = arg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ce_dev-&gt;irq_status = readl(ce_dev-&gt;base + CE_REG_ISR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ce_dev-&gt;err_status = readl(ce_dev-&gt;base + CE_REG_ERR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        writel(ce_dev-&gt;irq_status, ce_dev-&gt;base + CE_REG_ISR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return IRQ_WAKE_THREAD;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后唤醒对应的处理线程，根据中断状态值，调用对应算法加速器的 IRQ 处理函数。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static irqreturn_t aic_crypto_irq_thread(int irq, void *arg)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct aic_crypto_dev *ce_dev = arg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ce_dev-&gt;irq_status &amp; (0x1 &lt;&lt; DMA_CHAN_SK_ACCELERATOR))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                aic_skcipher_handle_irq(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ce_dev-&gt;irq_status &amp; (0x1 &lt;&lt; DMA_CHAN_AK_ACCELERATOR))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                aic_akcipher_handle_irq(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ce_dev-&gt;irq_status &amp; (0x1 &lt;&lt; DMA_CHAN_HASH_ACCELERATOR))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                aic_hash_handle_irq(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return IRQ_HANDLED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如前面所述，各算法加速器的 IRQ 处理函数只做相关资源的释放，以及请求处理完成的通知。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aic_skcipher_handle_irq(ce_dev);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|-&gt; crypto_finalize_skcipher_request(ce-&gt;sk_accel.engine, req, err);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-&gt; aic_skcipher_unprepare_req(engine, req);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |-&gt; req.complete(req, err);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-数据结构">5.5. 数据结构<a href="#55-数据结构" class="hash-link" aria-label="Direct link to 5.5. 数据结构" title="Direct link to 5.5. 数据结构">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="551-设备结构体">5.5.1. 设备结构体<a href="#551-设备结构体" class="hash-link" aria-label="Direct link to 5.5.1. 设备结构体" title="Direct link to 5.5.1. 设备结构体">​</a></h4>
<p>CE 设备结构体用来保存 CE 基地址等相关信息，除此之外，还包含了三个不同类型的算法加速器结构体， 以及安全 SRAM 的分配管理信息等。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_alg_accelerator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct crypto_engine *engine;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct mutex alock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DECLARE_KFIFO_PTR(req_fifo, void *);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_crypto_dev {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct device *dev;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void __iomem *base;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct clk *clk;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct reset_control *reset;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct mutex mlock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_alg_accelerator sk_accel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_alg_accelerator ak_accel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_alg_accelerator hash_accel;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u64 ssram_bitmap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u32 irq_status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    u32 err_status;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>sk_accel</p>
<p>对称密钥算法加速器结构体，用于管理对称密钥算法所使用的 crypto_engine 实例，以及正在处理的请求 FIFO。</p>
</li>
<li>
<p>ak_accel</p>
<p>非对称密钥算法加速器结构体，用于管理非对称密钥算法所使用的 crypto_engine 实例，以及正在处理的请求 FIFO。</p>
</li>
<li>
<p>hash_accel</p>
<p>消息摘要算法加速器结构体，用于管理消息摘要算法所使用的 crypto_engine 实例，以及正在处理的请求 FIFO。</p>
</li>
<li>
<p>ssram_bitmap</p>
<p>安全 SRAM 空间的分配位图。安全 SRAM 按照32字节为单位进行分配管理，这里每一个比特对应一个32字节的安全 SRAM 空间。</p>
</li>
<li>
<p>irq_status</p>
<p>记录最新的 IRQ 状态寄存器的值。</p>
</li>
<li>
<p>err_status</p>
<p>记录最新的错误状态寄存器的值。</p>
</li>
</ul>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="552-对称密钥算法">5.5.2. 对称密钥算法<a href="#552-对称密钥算法" class="hash-link" aria-label="Direct link to 5.5.2. 对称密钥算法" title="Direct link to 5.5.2. 对称密钥算法">​</a></h4>
<p>aic_skcipher_tfm_ctx 是一个对称密钥算法实例对应的上下文结构体，当用户使用 API 接口</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct crypto_skcipher *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">crypto_alloc_skcipher(const char *alg_name, u32 type, u32 mask);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建一个实例时，自  动创建对应的上下文。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_skcipher_tfm_ctx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct crypto_engine_ctx enginectx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *inkey;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int inkeylen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_crypto_dev *ce;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>enginectx</p>
<p>crypto_engine 的上下文，用于配置该算法的回调处理函数。</p>
</li>
<li>
<p>inkey</p>
<p>用于保存用户配置的密钥信息。此处保存的密钥不直接交给 CE 硬件。</p>
</li>
</ul>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_skcipher_reqctx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct task_desc *task;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_task;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_key;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *iv;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *backup_ivs; /* Back up iv for CBC decrypt */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_iv;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t ssram_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t backup_phy_ivs;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t next_iv; /* Next IV address for CBC encrypt */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int tasklen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int keylen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ivsize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int blocksize;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int backup_iv_cnt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned long mode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *src_cpy_buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *dst_cpy_buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t src_phy_buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t dst_phy_buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool src_map_sg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool dst_map_sg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>aic_skcipher_reqctx 是每一个数据请求所对应的上下文，在每一个 struct skcipher_request 实例化时自动创建。</p>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>task</p>
<p>CE 任务描述符指针。任务描述符所使用的空间是动态分配的空间，需要相关指针信息保存，以便完成时释放。</p>
</li>
<li>
<p>phy_task</p>
<p>任务描述符的物理地址。</p>
</li>
<li>
<p>key</p>
<p>密钥缓冲区的指针。该缓冲区为动态分配， 地址空间 DMA 可用。</p>
</li>
<li>
<p>phy_key</p>
<p>密钥缓冲区的物理地址。</p>
</li>
<li>
<p>iv</p>
<p>初始化向量缓冲区指针。该缓冲区动态分配，地址空间 DMA 可用。</p>
<p>该成员变量在不同的算法模式中，含义有所不同。CBC 模式中为初始化向量；CTR 模式中为初始计数值，同时也用于保存 CE 输出的下一个数据块的计数值；XTS 中为 TWEAK 值。</p>
</li>
<li>
<p>phy_iv</p>
<p>初始化向量缓冲区的物理地址。</p>
</li>
<li>
<p>backup_ivs</p>
<p>用于 CBC 算法模式的解密情景。解密时，需要保存不同数据段的最后一个密文块，作为下一个数据段的初始化向量。</p>
</li>
<li>
<p>backup_phy_ivs</p>
<p>对应的物理地址。</p>
</li>
<li>
<p>next_iv</p>
<p>用于 CBC 算法模式加密的场景。在 CBC 算法模式的加密处理时，如果一个请求中有多个数据块串行处理，使用 next_iv 指向当前数据块的最后一个密文块的地址，以作为下一个数据块的初始化向量输入。</p>
</li>
<li>
<p>ssram_addr</p>
<p>当需要使用安全 SRAM 时，用于保存申请到的安全 SRAM 地址。</p>
</li>
<li>
<p>mode</p>
<p>算法和模式标记变量，用于标记当前请求所使用的算法和模式等信息。</p>
</li>
<li>
<p>src_cpy_buf</p>
<p>输入数据的工作缓冲区。当前请求的输入数据缓冲区不满足 CE 硬件的使用要求时，需要分配物理连续的工作缓冲区。</p>
</li>
<li>
<p>src_phy_buf</p>
<p>输入数据的工作缓冲区物理地址。</p>
</li>
<li>
<p>dst_cpy_buf</p>
<p>输出数据的工作缓冲区。当前输出数据缓冲区不满足 CE 硬件的使用要求时，需要分配物理连续的工作缓冲区。</p>
</li>
<li>
<p>dst_phy_buf</p>
<p>输出数据缓冲区的物理地址。</p>
</li>
<li>
<p>src_map_sg</p>
<p>输入 sg list 是否执行了 map 的标记。</p>
</li>
<li>
<p>dst_map_sg</p>
<p>输出 sg list 是否执行了map 的标记。</p>
</li>
</ul>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="553-非对称密钥算法">5.5.3. 非对称密钥算法<a href="#553-非对称密钥算法" class="hash-link" aria-label="Direct link to 5.5.3. 非对称密钥算法" title="Direct link to 5.5.3. 非对称密钥算法">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_akcipher_tfm_ctx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct crypto_engine_ctx enginectx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_crypto_dev *ce;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *n;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *e;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *d;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int n_sz;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int e_sz;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int d_sz;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>aic_akcipher_tfm_ctx 是非对称密钥算法实例所对应的上下文。</p>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>enginectx</p>
<p>crypto_engine 的上下文，用于配置该算法的回调处理函数。</p>
</li>
<li>
<p>n</p>
<p>RSA 密钥中的 modulus。</p>
</li>
<li>
<p>e</p>
<p>RSA 密钥中的公钥指数。</p>
</li>
<li>
<p>d</p>
<p>RSA 密钥中的私钥指数。</p>
</li>
</ul>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_akcipher_reqctx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct task_desc *task;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_task;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *wbuf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_wbuf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t ssram_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int tasklen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int wbuf_size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned long flags;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>aic_akcipher_reqctx 是每一个数据请求所对应的上下文，在每一个 struct akcipher_request 实例化时自动创建。</p>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>task</p>
<p>CE 任务描述符指针。任务描述符所使用的空间是动态分配的空间，需要相关指针信息保存，以便完成时释放。</p>
</li>
<li>
<p>phy_task</p>
<p>任务描述符的物理地址。</p>
</li>
<li>
<p>wbuf</p>
<p>工作缓冲区。</p>
</li>
<li>
<p>phy_wbuf</p>
<p>工作缓冲区的物理地址。</p>
</li>
<li>
<p>ssram_addr</p>
<p>当需要使用安全 SRAM 时，用于保存申请到的安全 SRAM 地址。</p>
</li>
<li>
<p>flags</p>
<p>算法和模式标记变量，用于标记当前请求所使用的算法和模式等信息。</p>
</li>
</ul>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="554-消息摘要算法">5.5.4. 消息摘要算法<a href="#554-消息摘要算法" class="hash-link" aria-label="Direct link to 5.5.4. 消息摘要算法" title="Direct link to 5.5.4. 消息摘要算法">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_hash_tfm_ctx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct crypto_engine_ctx enginectx;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_crypto_dev *ce;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool hmac;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>aic_hash_tfm_ctx 是消息摘要算法实例所对应的上下文。</p>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>enginectx</p>
<p>crypto_engine 的上下文，用于配置该算法的回调处理函数。</p>
</li>
<li>
<p>hmac</p>
<p>用于标记当前算法是否为 HMAC 类算法。</p>
</li>
</ul>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_hash_reqctx {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct task_desc *task;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_task;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *ivbuf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_ivbuf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char *total_bitlen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t phy_total_bitlen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *src_cpy_buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dma_addr_t src_phy_buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int tasklen;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int digest_size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned long flags;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned char digest[CE_MAX_DIGEST_SIZE];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bool src_map_sg;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>aic_hash_reqctx 是每一个数据请求所对应的上下文，在每一个 struct ahash_request 实例化时自动创建。</p>
<p>其中：</p>
<blockquote>
<ul>
<li>
<p>task</p>
<p>CE 任务描述符指针。任务描述符所使用的空间是动态分配的空间，需要相关指针信息保存，以便完成时释放。</p>
</li>
<li>
<p>phy_task</p>
<p>任务描述符的物理地址。</p>
</li>
<li>
<p>total_bitlen</p>
<p>当前请求处理的数据总长度，单位 bit。</p>
</li>
<li>
<p>phy_total_bitlen</p>
<p>保存数据总长度的变量的物理地址。</p>
</li>
<li>
<p>src_cpy_buf</p>
<p>输入数据的工作缓冲区。当前请求的输入数据缓冲区不满足 CE 硬件的使用要求时，需要分配物理连续的工作缓冲区。</p>
</li>
<li>
<p>src_phy_buf</p>
<p>输入数据的工作缓冲区物理地址。</p>
</li>
<li>
<p>flags</p>
<p>算法和模式标记变量，用于标记当前请求所使用的算法和模式等信息。</p>
</li>
<li>
<p>digest</p>
<p>用于保存当前一笔请求数据的摘要结果。当有连续多个请求的数据需要处理时，同时作为下一个请求的初始化向量输入。</p>
</li>
<li>
<p>src_map_sg</p>
<p>输入 sg list 是否执行了 map 的标记。</p>
</li>
</ul>
</blockquote>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="56-接口设计">5.6. 接口设计<a href="#56-接口设计" class="hash-link" aria-label="Direct link to 5.6. 接口设计" title="Direct link to 5.6. 接口设计">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="561-aic_skcipher_alg_init">5.6.1. aic_skcipher_alg_init)<a href="#561-aic_skcipher_alg_init" class="hash-link" aria-label="Direct link to 5.6.1. aic_skcipher_alg_init)" title="Direct link to 5.6.1. aic_skcipher_alg_init)">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_skcipher_alg_init(struct crypto_skcipher *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>对称密钥算法的初始化函数</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_skcipher *tfm算法实例指针</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="562-aic_skcipher_alg_exit">5.6.2. aic_skcipher_alg_exit<a href="#562-aic_skcipher_alg_exit" class="hash-link" aria-label="Direct link to 5.6.2. aic_skcipher_alg_exit" title="Direct link to 5.6.2. aic_skcipher_alg_exit">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>void aic_skcipher_alg_exit(struct crypto_skcipher *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>对称密钥算法使用完毕，释放相关资源</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_skcipher *tfm算法实例指针</td></tr><tr><td><strong>返回值</strong></td><td>无</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="563-aic_skcipher_alg_setkey">5.6.3. aic_skcipher_alg_setkey<a href="#563-aic_skcipher_alg_setkey" class="hash-link" aria-label="Direct link to 5.6.3. aic_skcipher_alg_setkey" title="Direct link to 5.6.3. aic_skcipher_alg_setkey">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_skcipher_alg_setkey(struct crypto_skcipher *tfm, const u8 *key, unsigned int keylen)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>设置对称密钥算法的密钥</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_skcipher *tfm算法实例指针const u8 *key密钥的指针unsigned int keylen密钥的长度</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="564-aic_skcipher_crypt">5.6.4. aic_skcipher_crypt<a href="#564-aic_skcipher_crypt" class="hash-link" aria-label="Direct link to 5.6.4. aic_skcipher_crypt" title="Direct link to 5.6.4. aic_skcipher_crypt">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_skcipher_crypt(struct skcipher_request *req, unsigned long flg)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>发起一个对称密钥算法的加解密处理的请求</td></tr><tr><td><strong>参数定义</strong></td><td>struct skcipher_request *req加解密请求的指针unsigned logn flg算法标记，用来标识算法类型和算法模式</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="565-aic_akcipher_rsa_alg_init">5.6.5. aic_akcipher_rsa_alg_init<a href="#565-aic_akcipher_rsa_alg_init" class="hash-link" aria-label="Direct link to 5.6.5. aic_akcipher_rsa_alg_init" title="Direct link to 5.6.5. aic_akcipher_rsa_alg_init">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_akcipher_rsa_alg_init(struct crypto_akcipher *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>RSA 算法初始化</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_akcipher *tfm算法实例的指针</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="566-aic_akcipher_rsa_alg_exit">5.6.6. aic_akcipher_rsa_alg_exit<a href="#566-aic_akcipher_rsa_alg_exit" class="hash-link" aria-label="Direct link to 5.6.6. aic_akcipher_rsa_alg_exit" title="Direct link to 5.6.6. aic_akcipher_rsa_alg_exit">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>void aic_akcipher_rsa_alg_exit(struct crypto_akcipher *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>RSA 算法使用完毕，释放相关资源</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_akcipher *tfm算法实例的指针</td></tr><tr><td><strong>返回值</strong></td><td>无</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="567-aic_akcipher_rsa_set_pub_key">5.6.7. aic_akcipher_rsa_set_pub_key<a href="#567-aic_akcipher_rsa_set_pub_key" class="hash-link" aria-label="Direct link to 5.6.7. aic_akcipher_rsa_set_pub_key" title="Direct link to 5.6.7. aic_akcipher_rsa_set_pub_key">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_akcipher_rsa_set_pub_key(struct crypto_akcipher *tfm, const void *key,unsigned int keylen)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>设置 RSA 算法的公钥</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_akcipher *tfm算法实例指针const void *key密钥数据的指针unsigned int keylen密钥的长度</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="568-aic_akcipher_rsa_set_priv_key">5.6.8. aic_akcipher_rsa_set_priv_key<a href="#568-aic_akcipher_rsa_set_priv_key" class="hash-link" aria-label="Direct link to 5.6.8. aic_akcipher_rsa_set_priv_key" title="Direct link to 5.6.8. aic_akcipher_rsa_set_priv_key">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_akcipher_rsa_set_priv_key(struct crypto_akcipher *tfm, const void *key,unsigned int keylen)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>设置 RSA 算法的私钥</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_akcipher *tfm算法实例指针const void *key密钥数据的指针unsigned int keylen密钥的长度</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="569-aic_akcipher_rsa_max_size">5.6.9. aic_akcipher_rsa_max_size<a href="#569-aic_akcipher_rsa_max_size" class="hash-link" aria-label="Direct link to 5.6.9. aic_akcipher_rsa_max_size" title="Direct link to 5.6.9. aic_akcipher_rsa_max_size">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_akcipher_rsa_max_size(struct crypto_akcipher *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>获取当前 RSA 算法的密钥长度</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_akcipher *tfm算法实例指针</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5610-aic_akcipher_rsa_crypt">5.6.10. aic_akcipher_rsa_crypt<a href="#5610-aic_akcipher_rsa_crypt" class="hash-link" aria-label="Direct link to 5.6.10. aic_akcipher_rsa_crypt" title="Direct link to 5.6.10. aic_akcipher_rsa_crypt">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_akcipher_rsa_crypt(struct akcipher_request *req, unsigned long flag)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>发起一个 RSA 算法的加解密请求</td></tr><tr><td><strong>参数定义</strong></td><td>struct akcipher_request *req请求的指针unsigned long flag算法标记</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5611-aic_hash_alg_init">5.6.11. aic_hash_alg_init<a href="#5611-aic_hash_alg_init" class="hash-link" aria-label="Direct link to 5.6.11. aic_hash_alg_init" title="Direct link to 5.6.11. aic_hash_alg_init">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_hash_alg_init(struct crypto_tfm *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>HASH 算法的初始化</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_tfm *tfm算法实例的指针</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5612-aic_hash_alg_exit">5.6.12. aic_hash_alg_exit<a href="#5612-aic_hash_alg_exit" class="hash-link" aria-label="Direct link to 5.6.12. aic_hash_alg_exit" title="Direct link to 5.6.12. aic_hash_alg_exit">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>void aic_hash_alg_exit(struct crypto_tfm *tfm)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>HASH 算法使用完毕，释放相关资源</td></tr><tr><td><strong>参数定义</strong></td><td>struct crypto_tfm *tfm算法实例的指针</td></tr><tr><td><strong>返回值</strong></td><td>无</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5613-aic_hash_init">5.6.13. aic_hash_init<a href="#5613-aic_hash_init" class="hash-link" aria-label="Direct link to 5.6.13. aic_hash_init" title="Direct link to 5.6.13. aic_hash_init">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_hash_init(struct ahash_request *req)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>初始化一个 HASH 运算的操作</td></tr><tr><td><strong>参数定义</strong></td><td>struct ahash_request *reqHASH 运算的请求，具体所使用的算法，根据消息摘要的大小决定</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5614-aic_hash_update">5.6.14. aic_hash_update<a href="#5614-aic_hash_update" class="hash-link" aria-label="Direct link to 5.6.14. aic_hash_update" title="Direct link to 5.6.14. aic_hash_update">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_hash_update(struct ahash_request *req)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>更新一笔 HASH 运算的数据，用于数据分多次输入的场景</td></tr><tr><td><strong>参数定义</strong></td><td>struct ahash_request *reqHASH 运算的请求，数据信息保存在该结构体中</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5615-aic_hash_final">5.6.15. aic_hash_final<a href="#5615-aic_hash_final" class="hash-link" aria-label="Direct link to 5.6.15. aic_hash_final" title="Direct link to 5.6.15. aic_hash_final">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_hash_final(struct ahash_request *req)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>HASH 运算的数据输入结束，获取结果</td></tr><tr><td><strong>参数定义</strong></td><td>struct ahash_request *reqHASH 运算的请求，本请求不带数据，只获取结果</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5616-aic_hash_finup">5.6.16. aic_hash_finup<a href="#5616-aic_hash_finup" class="hash-link" aria-label="Direct link to 5.6.16. aic_hash_finup" title="Direct link to 5.6.16. aic_hash_finup">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_hash_finup(struct ahash_request *req)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>HASH 运算的最后一笔数据，并且获取结果</td></tr><tr><td><strong>参数定义</strong></td><td>struct ahash_request *reqHASH 运算的请求，本请求带最后一笔数据，并获取结果</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5617-aic_hash_digest">5.6.17. aic_hash_digest<a href="#5617-aic_hash_digest" class="hash-link" aria-label="Direct link to 5.6.17. aic_hash_digest" title="Direct link to 5.6.17. aic_hash_digest">​</a></h4>
<table><thead><tr><th><strong>函数原型</strong></th><th>int aic_hash_digest(struct ahash_request *req)</th></tr></thead><tbody><tr><td><strong>功能说明</strong></td><td>针对一笔数据，完成 init 和 finup 的 HASH 运算操作，并获取结果</td></tr><tr><td><strong>参数定义</strong></td><td>struct ahash_request *reqHASH 运算的请求，本请求带最后一笔数据，并获取结果</td></tr><tr><td><strong>返回值</strong></td><td>0: 成功其他: 失败</td></tr><tr><td><strong>注意事项</strong></td><td></td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="57-应用编程">5.7. 应用编程<a href="#57-应用编程" class="hash-link" aria-label="Direct link to 5.7. 应用编程" title="Direct link to 5.7. 应用编程">​</a></h3>
<p>用户空间编程使用 CE 时，根据使用场景和需求的不同，有几层 API 可以选择：</p>
<blockquote>
<ul>
<li>AF_ALG Socket API</li>
<li>Libkcapi API</li>
<li>OpenSSL API</li>
</ul>
</blockquote>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/ce_userpace_api-170676875520325.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ce_userpace_api.png" class="img_ev3q"></p>
<p>图 8.21 <em>用户空间 API 对接</em></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="571-af_alg-api">5.7.1. AF_ALG API<a href="#571-af_alg-api" class="hash-link" aria-label="Direct link to 5.7.1. AF_ALG API" title="Direct link to 5.7.1. AF_ALG API">​</a></h4>
<p>相关 API 可参考头文件</p>
<blockquote>
<ul>
<li>linux/if_alg.h</li>
</ul>
</blockquote>
<p>要使用内核 提供的算法和驱动，需要知道对应的算法名字。可通过下列命令获取:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /proc/crypto</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>例如:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">name         : ctr(aes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">driver       : ctr-aes-aic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module       : kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority     : 400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refcnt       : 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selftest     : passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal     : no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type         : skcipher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async        : yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blocksize    : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min keysize  : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max keysize  : 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ivsize       : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunksize    : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">walksize     : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name         : cbc(aes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">driver       : cbc-aes-aic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module       : kernel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">priority     : 400</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">refcnt       : 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">selftest     : passed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">internal     : no</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">type         : skcipher</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async        : yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">blocksize    : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">min keysize  : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max keysize  : 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ivsize       : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunksize    : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">walksize     : 16</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">......</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注解</p>
<p>这里的 /proc/crypto 是目标平台上的文件</p>
<p>AF_ALG API 的特点：</p>
<blockquote>
<ul>
<li>效率高</li>
<li>接口灵活</li>
<li>较为复杂</li>
</ul>
</blockquote>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="572-libkcapi-api">5.7.2. Libkcapi API<a href="#572-libkcapi-api" class="hash-link" aria-label="Direct link to 5.7.2. Libkcapi API" title="Direct link to 5.7.2. Libkcapi API">​</a></h4>
<p>SDK 已经提供对应的 libkcapi 库，默认配置已经支持</p>
<blockquote>
<ul>
<li>对称密钥算法</li>
<li>非对称密钥算法</li>
<li>消息摘要算法</li>
<li>随机数读取</li>
</ul>
</blockquote>
<p>如果需要修改对应包的编译配置，可在 Luban SDK 顶层目录执行:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make menuconfig (or make m)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置界面的索引如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Third-party packages  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -*- libkcapi  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   use prebuilt binary instead of building from source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   enable asym algorithm support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   build enc application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   build hasher application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   build rng read application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   build speed-test program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   build test program</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Libkcapi 的特点：</p>
<blockquote>
<ul>
<li>接口简单</li>
<li>效率高</li>
</ul>
</blockquote>
<ul>
<li>
<p>基于 Libkcapi API 的参考示例:</p>
<p>source/artinchip/test-ce/kcapi/</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="573-openssl-api">5.7.3. OpenSSL API<a href="#573-openssl-api" class="hash-link" aria-label="Direct link to 5.7.3. OpenSSL API" title="Direct link to 5.7.3. OpenSSL API">​</a></h4>
<p>Luban SDK 通过 OpenSSL 的 Engine 机制，以实现 Engine 库的方式，已经完成了对 OpenSSL 的对接。 无论是通过 OpenSSL 的命令行，还是通 过使用库编程，都可以使用到 CE。</p>
<p>Engine 库有两个，根据不同的目的进行使用。</p>
<table><thead><tr><th>Engine</th><th>库和路径</th><th>说明</th></tr></thead><tbody><tr><td>aic engine</td><td>usr/lib/libengine_aic.so</td><td>实现 CE 所提供的对称密钥算法、RSA 算法和消息摘要算法该 Engine 实现的都是标准算法。</td></tr><tr><td>huk engine</td><td>usr/lib/libengine_huk.so</td><td>实现了 HUK 保护的 AES 算法，可用于本地数据保护。使用该 Engine 时，输入的密钥会被 HUK 进行一次解密，然后才用于 AES 加解密。HUK 每一颗芯片不同，因此使用该 Engine 加密后的数据，仅当前平台可解密。</td></tr></tbody></table>
<p>命令行中使用指定 Engine 的示例:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl enc -engine aic -p -nosalt -nopad -aes-128-ecb -e -K 0123 -in data.bin -out enc.bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上述示例中，通过 <code>-engine aic</code> 指定了使用 <code>aic</code> engine。</p>
<p>当在 <code>openssl.cnf</code> 文件中配置了默 认的 Engine 之后，命令行中可以忽略 <code>-engine</code> 参数。 具体配置可参考 <code>/etc/ssl/openssl_aic.cnf</code> 文件。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">openssl_conf = openssl_def</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[openssl_def]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engines = engine_section</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[engine_section]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aic = aic_section</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[aic_section]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">engine_id = aic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dynamic_path = /usr/lib/libengine_aic.so</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default_algorithms = CIPHERS,DIGESTS,RSA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Libopenssl API 的特点：</p>
<blockquote>
<ul>
<li>功能强大</li>
<li>调用效率稍差</li>
</ul>
</blockquote>
<ul>
<li>
<p>基于 Libopenssl API 的参考示例:</p>
<p>source/artinchip/test-ce/openssl/</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-常见问题">6. 常见问题<a href="#6-常见问题" class="hash-link" aria-label="Direct link to 6. 常见问题" title="Direct link to 6. 常见问题">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/08-2_CE-Useguide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/D213-DevKit/part3/08-1_SPI-ENC"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SPI ENC</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/D213-DevKit/part3/08-3_eFuse-Useguide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">eFuse 使用指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-模块介绍" class="table-of-contents__link toc-highlight">1. 模块介绍</a><ul><li><a href="#11-术语定义" class="table-of-contents__link toc-highlight">1.1. 术语定义</a></li><li><a href="#12-模块简介" class="table-of-contents__link toc-highlight">1.2. 模块简介</a></li><li><a href="#13-原理框图" class="table-of-contents__link toc-highlight">1.3. 原理框图</a></li></ul></li><li><a href="#2-参数配置" class="table-of-contents__link toc-highlight">2. 参数配置</a><ul><li><a href="#21-内核配置" class="table-of-contents__link toc-highlight">2.1. 内核配置</a></li><li><a href="#22-dts-配置" class="table-of-contents__link toc-highlight">2.2. DTS 配置</a></li></ul></li><li><a href="#3-调试指南" class="table-of-contents__link toc-highlight">3. 调试指南</a><ul><li><a href="#31-调试开关" class="table-of-contents__link toc-highlight">3.1. 调试开关</a></li></ul></li><li><a href="#4-测试指南" class="table-of-contents__link toc-highlight">4. 测试指南</a><ul><li><a href="#41-测试工具" class="table-of-contents__link toc-highlight">4.1. 测试工具</a></li><li><a href="#42-测试对象" class="table-of-contents__link toc-highlight">4.2. 测试对象</a></li><li><a href="#43-测试方法" class="table-of-contents__link toc-highlight">4.3. 测试方法</a></li></ul></li><li><a href="#5-设计说明" class="table-of-contents__link toc-highlight">5. 设计说明</a><ul><li><a href="#51-源码说明" class="table-of-contents__link toc-highlight">5.1. 源码说明</a></li><li><a href="#52-模块架构" class="table-of-contents__link toc-highlight">5.2. 模块架构</a></li><li><a href="#53-设计要点" class="table-of-contents__link toc-highlight">5.3. 设计要点</a></li><li><a href="#54-关键流程" class="table-of-contents__link toc-highlight">5.4. 关键流程</a></li><li><a href="#55-数据结构" class="table-of-contents__link toc-highlight">5.5. 数据结构</a></li><li><a href="#56-接口设计" class="table-of-contents__link toc-highlight">5.6. 接口设计</a></li><li><a href="#57-应用编程" class="table-of-contents__link toc-highlight">5.7. 应用编程</a></li></ul></li><li><a href="#6-常见问题" class="table-of-contents__link toc-highlight">6. 常见问题</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>