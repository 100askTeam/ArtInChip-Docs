<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-D213-DevKit/part3/07-11_UART-Useguide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">UART 使用指南 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://artinchip.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://artinchip.100ask.net/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/07-11_UART-Useguide"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_Hans"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="UART 使用指南 | 东山Π"><meta data-rh="true" name="description" content="1. 模块介绍"><meta data-rh="true" property="og:description" content="1. 模块介绍"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/07-11_UART-Useguide"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/07-11_UART-Useguide" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/07-11_UART-Useguide" hreflang="en"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/07-11_UART-Useguide" hreflang="x-default"><link rel="stylesheet" href="/en/assets/css/styles.d875fe7e.css">
<script src="/en/assets/js/runtime~main.492f0d3e.js" defer="defer"></script>
<script src="/en/assets/js/main.d02687fe.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/en/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">东山Π</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/D213-DevKit/BoardIntroduction">D213-DevKit</a><a class="navbar__item navbar__link" href="/en/docs/category/luban-sdk使用指南">Luban-SDK</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/D213-DevKit/part3/07-11_UART-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/D213-DevKit/part3/07-11_UART-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/ArtInChip-Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/D213-DevKit/BoardIntroduction">匠心创D213-DevKit开发板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/D213-DevKit/SupportingResources">源码工具文档手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/快速启动">快速启动</a><button aria-label="Expand sidebar category &#x27;快速启动&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/docs/D213-DevKit/ConfigHostEnv">安装并配置开发环境</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/luban-sdk开发">Luban-SDK开发</a><button aria-label="Expand sidebar category &#x27;Luban-SDK开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/en/docs/category/luban-linux系统开发">Luban-Linux系统开发</a><button aria-label="Collapse sidebar category &#x27;Luban-Linux系统开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-1_BWMUserGuide">BWM 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-2_CMUUserGuide">CMU 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-3_DMABook">DMA 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-4_RTCUserGuide">RTC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-5_TSensorUserGuide">TSensor 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-6_WatchdogUserGuide">Watchdog 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/04-7_WRIUserGuide">WRI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-1_SDMCUserGuide">SDMC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-2_SPI_NANDUserGuide">SPI NAND 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-3_SPI_NORUserGuide">SPI NOR 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/05-4_FileSystemUserGuide">文件系统使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-1_GE-Useguide">GE 开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-2_VE-Useguide">VE 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-3_Display-Useguide">Display 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-4_DVP-Useguide">DVP开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-8_I2S-Useguide">I2S 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/06-9_AudioCodec-Useguide">AudioCodec 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-1_CAN-Useguide">CAN 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-2_ CIR-Useguide">CIR 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-3_ GPAI-Useguide">GPAI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-4_I2C-Useguide">I2C 开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-5_MAC-Useguide">MAC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-6_PBus-Useguide">PBus 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-7_PINCTRL-Useguide">PINCTRL 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-8_PWM-Useguide">PWM 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-9_RTP-Useguide">RTP 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-10_SPI-Useguide">SPI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/D213-DevKit/part3/07-11_UART-Useguide">UART 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-12_USB-Useguide">USB 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/07-13_PSADC-Useguide">PSADC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-1_SPI-ENC">SPI ENC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-2_CE-Useguide">CE 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-3_eFuse-Useguide">eFuse 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/08-4_HardwareAuthorizationCertification">硬件授权认证</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide">触摸屏调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-2_DisplayDebuggingGuide">显示屏调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-3_WiFiDebuggingGuide">WiFi调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/D213-DevKit/part3/10-4_GuideToUsingTheKeyMatrix">按键矩阵使用指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux-bringup参考">Linux-Bringup参考</a><button aria-label="Expand sidebar category &#x27;Linux-Bringup参考&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/en/docs/category/linux-uboot开发">Linux-Uboot开发</a><button aria-label="Expand sidebar category &#x27;Linux-Uboot开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/en/docs/category/luban-linux系统开发"><span itemprop="name">Luban-Linux系统开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">UART 使用指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>UART 使用指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-模块介绍">1. 模块介绍<a href="#1-模块介绍" class="hash-link" aria-label="Direct link to 1. 模块介绍" title="Direct link to 1. 模块介绍">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-术语定义">1.1. 术语定义<a href="#11-术语定义" class="hash-link" aria-label="Direct link to 1.1. 术语定义" title="Direct link to 1.1. 术语定义">​</a></h3>
<table><thead><tr><th>术语</th><th>定义</th><th>注释说明</th></tr></thead><tbody><tr><td>UART</td><td>Universal Asynchronous Receiver/Transmitter</td><td>通用异步收发传输器</td></tr><tr><td>TTL</td><td>Transistor-Transistor Logic</td><td>逻辑门电路</td></tr><tr><td>DCD</td><td>Data Carrier Detect</td><td>载波侦听</td></tr><tr><td>DTR</td><td>Data Terminal Ready</td><td>  数据终端准备好</td></tr><tr><td>DSR</td><td>Data Set Ready</td><td>数据准备好</td></tr><tr><td>RTS</td><td>Request To Send</td><td>请求发送</td></tr><tr><td>CTS</td><td>Clear To Send</td><td>清除发送</td></tr><tr><td>RI</td><td>Ring Indicator</td><td>响铃指示</td></tr><tr><td>THR</td><td>Transmit Holding Register</td><td>发送保持寄存器</td></tr><tr><td>RBR</td><td>Receive Buffer Register</td><td>接收缓冲寄存器</td></tr><tr><td>ACPI</td><td>Advanced Configuration and Power Interface</td><td>高阶配置和电源接口</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-模块简介">1.2. 模块简介<a href="#12-模块简介" class="hash-link" aria-label="Direct link to 1.2. 模块简介" title="Direct link to 1.2. 模块简介">​</a></h3>
<p>通用异步收发传输器（Universal Asynchronous Receiver/Transmitter)，通常称作 UART，是一种通用串行数据总线。</p>
<p>串行通信是指利用一条传输线将数据一位位地顺序传送，通信线路非常简单。</p>
<p>UART 为双向通信，可以实现全双工传输和接收。在嵌入式设计中，UART 用于主机与辅助设备通信，如汽车音响与外接AP之间的通信，也用于 PC 机通信包括与监控调试器和其它器件，如 EEPROM 通信。</p>
<p>在 UART 上追加同步方式的序列信号变换电路的产品，被称为 USART(Universal Synchronous Asynchronous Receiver Transmitter)</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-通信协议">1.3. 通信协议<a href="#13-通信协议" class="hash-link" aria-label="Direct link to 1.3. 通信协议" title="Direct link to 1.3. 通信协议">​</a></h3>
<p>UART 作为异步串行通信协议的一种，工作原理是将传输数据的每个字符一位接一位地传输。其协议中添加了一些特殊的表示位：</p>
<ul>
<li>
<ul>
<li>
<p>起始位 Start bit</p>
<p>先发出一个逻辑“0”的信号，表示传输字符的开始</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>数  据位 Data bits</p>
<p>紧接着起始位之后。数据位的个数可以是4、5、6、7、8等，构成一个字符。通常采用 ASCII 码。从最低位开始传送，靠时钟定位。</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>奇偶校验位 Parity</p>
<p>数据位加上这一位后，使得“1”的位数应为偶数(偶校验)或奇数(奇校验)，以此来校验数据传送的正确性。</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>停止位 Stop bits</p>
<p>它是一个字符数据的结束标志。可以是1位、1.5位、2位的高电平。 由于数据是在传输线上定时的，并且每一个设备有其自己的时钟，很可能在通信中两台设备间出现了小小的不同步。因此停止位不仅仅是表示传输的结束，并且提供计算机校正时钟同步的机会。停止位的位数越多，时钟同步的容忍程度越大，但是数据传输率会越慢</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>流控 Flow contorl</p>
<p>管理两个节点之间数据传输速率的过程，以防止出现接收端的数据缓冲区已满，而发送端依然继续发送数据，所导致数据丢失，我们会在一些上位机上看到 RTS /CTS、DTR /DSR和 XON /XOFF的选项，这是对流控制的选项</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>空闲位</p>
<p>处于逻辑“1”状态，表示当前线路上没有数据传送，该位为协议位，自动产生</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>波特率 BaudRate</p>
<p>是衡量数据传送速率的指标。表示每秒钟传送的bit数。比如波特率 115200，表示传输速率是 115200 bps</p>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-参数信息">1.4. 参数信息<a href="#14-参数信息" class="hash-link" aria-label="Direct link to 1.4. 参数信息" title="Direct link to 1.4. 参数信息">​</a></h3>
<p>在 UART 进行通信的时候，双方需要协商相关参数，否则无法进行信息解析，因此在通信之初，需要对所使用的工具设置上述的所有参数</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/uart-param1-17067626921621.jpg" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/uart-param1.jpg" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="15-常用接口">1.5. 常用接口<a href="#15-常用接口" class="hash-link" aria-label="Direct link to 1.5. 常用接口" title="Direct link to 1.5. 常用接口">​</a></h3>
<ul>
<li>串口、COM 口是指的物理接口形式(硬件)。</li>
<li>TTL、RS-232、RS-485 是指的电平标准(电信号)。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="151-ttl">1.5.1. TTL<a href="#151-ttl" class="hash-link" aria-label="Direct link to 1.5.1. TTL" title="Direct link to 1.5.1. TTL">​</a></h4>
<ul>
<li>TTL标准是低电平（0V）为0，高电平（+5V）为1。</li>
<li>TTL 接口需要对端接口也为 TTL，但诸如 PC 等设备无 TTL 接口的UART口，一般转 TTL 为 USB 等 PC 更通用的接口。</li>
<li>TTL 接口为全双工，连接设备的时候一般只接 GND/RX/TX。不会接Vcc或者 +3.3v 的电源线，避免与目标设备上的供电冲突，但 GND 可以保证源设备和目标设备供地，有助于信号稳定。</li>
<li>信号线采用交叉的方式，即源端的 RX 连接目标设备的 TX，源端的 TX 连接目标设备的 RX。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="152-rs232">1.5.2. RS232<a href="#152-rs232" class="hash-link" aria-label="Direct link to 1.5.2. RS232" title="Direct link to 1.5.2. RS232">​</a></h4>
<ul>
<li>RS232 标准是正电平（+3V~+15V）为0，负电平（-13V~-15V）为1。</li>
<li>RS232 接口在总线上只允许连接1个收发器，单站能力。</li>
<li>RS232 传输线采用屏蔽双绞线，最高传输距离一般为 15M，最大速率为 20Kbps。</li>
<li>RS232 接口为全双工，连接设备的时候一般只接 GND/RX/TX。</li>
<li>信号线也采用交叉的方式，即源端的RX连接目标设备的 TX，源端的 TX   连接目标设备的 RX。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="153-rs422">1.5.3. RS422<a href="#153-rs422" class="hash-link" aria-label="Direct link to 1.5.3. RS422" title="Direct link to 1.5.3. RS422">​</a></h4>
<ul>
<li>RS422 标准采用差分信号负逻辑，逻辑“1”以两线间的电压差为+（2—6）V表示；逻辑“0”以两线间的电压差为-（2—6）V表示。接口信号电平比 RS232 降低了，就不易损坏接口电路的芯片，且该电平与 TTL 电平兼容，可方便与TTL电路连接。</li>
<li>RS422 接口在总线上是允许连接多达128个收发器，多站能力。</li>
<li>RS422 的数据最高传输速率为 10Mbps，100米长双绞线的最大速度为 1Mb/s。</li>
<li>RS422 采用平衡发送和差分接收，因此具有抑制共模干扰的能力。RS422 接口的最大传输距离标准值为4000英尺（约1219米），实际上可达3000米。</li>
<li>RS422 是全双工，连接设备的时候一般接 RX+/RX-/TX+/TX-/GND。</li>
<li>信号线也采用交叉的方式，即源端的 RX-/RX+ 连接目标设备的 TX-/TX+，源端的 TX-/TX+ 连接目标设备的 RX-/RX+。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="154-rs485">1.5.4. RS485<a href="#154-rs485" class="hash-link" aria-label="Direct link to 1.5.4. RS485" title="Direct link to 1.5.4. RS485">​</a></h4>
<ul>
<li>RS485 的电气性能和 RS422 完全一样，主要区别是 RS485 是半双工。连接设备的时候一般接 A-/A+/GND，DB9 接口定义了两组，同时必须使用同一组的+/-。</li>
<li>信号线也采用交叉的方式，即源端的 A- 连接目标设备的A-，源端的 A+ 连接目标设备的 A+。</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="16-插头">1.6. 插头<a href="#16-插头" class="hash-link" aria-label="Direct link to 1.6. 插头" title="Direct link to 1.6. 插头">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="161-公母之分">1.6.1. 公母之分<a href="#161-公母之分" class="hash-link" aria-label="Direct link to 1.6.1. 公母之分" title="Direct link to 1.6.1. 公母之分">​</a></h4>
<ul>
<li>针形的为公头，孔形的为母头</li>
<li>PC 串口一般为公头，设备的一般为母头</li>
</ul>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/port-male1-17067627271843.jpg" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/port-male1.jpg" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="162-db-9接口">1.6.2. DB-9接口<a href="#162-db-9接口" class="hash-link" aria-label="Direct link to 1.6.2. DB-9接口" title="Direct link to 1.6.2. DB-9接口">​</a></h4>
<p>RS232DB9 的信号分分四组：</p>
<ul>
<li>DCD/RI：电气 Ready 参数</li>
<li>DTR/DSR：模块 Ready 参数</li>
<li>RTS/CTS：流控参数</li>
<li>RXD/TXD：数据收发</li>
</ul>
<table><thead><tr><th>针序</th><th>RS232</th><th>说明</th><th>RS422</th><th>说明</th><th>RS485</th><th>说明</th></tr></thead><tbody><tr><td>1</td><td>DCD</td><td>数据载波检测</td><td>RXD-</td><td>接收</td><td>A-</td><td>组1</td></tr><tr><td>2</td><td>RXD</td><td>接收数据</td><td></td><td></td><td></td><td></td></tr><tr><td>3</td><td>TXD</td><td>发送数据</td><td></td><td></td><td></td><td></td></tr><tr><td>4</td><td>DTR</td><td>数据终端准备好</td><td>TXD+</td><td>发送</td><td>A+</td><td>组2</td></tr><tr><td>5</td><td>GND</td><td>信号地</td><td>GND</td><td>信号地</td><td>GND</td><td>信号地</td></tr><tr><td>6</td><td>DSR</td><td>数据准备好</td><td>RXD+</td><td>接收</td><td>A+</td><td>组1</td></tr><tr><td>7</td><td>RTS</td><td>请求发送</td><td>RTS</td><td>请求发送</td><td>RTS</td><td>请求发送</td></tr><tr><td>8</td><td>CTS</td><td>清除发送</td><td>CTS</td><td>清除发送</td><td>CTS</td><td>清除发送</td></tr><tr><td>9</td><td>RI</td><td>响铃指示</td><td>TXD-</td><td>发送</td><td>A-</td><td>组2</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="17-  流控">1.7. 流控<a href="#17-流控" class="hash-link" aria-label="Direct link to 1.7. 流控" title="Direct link to 1.7. 流控">​</a></h3>
<p>这里讲到的 “流”，指的是数据流；在数据通信中，流控制是管理两个节点之间数据传输速率的过程，以防止出现接收端的数据缓冲区已满，而发送端依然继续发送数据，所导致数据丢失。</p>
<p>当接收端的数据缓冲区已满，无法处理数据来时，就发出 “不再接收” 的信号，发送端则停止发送，直到发送端收到 “可以继续发送” 的信号再发送数据。</p>
<p>计算机中常用的两种流控制分别是硬件流控制（RTS /CTS、DTR /DSR等）和软件流控制（XON /XOFF）。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="171-硬件流控">1.7.1. 硬件流控<a href="#171-硬件流控" class="hash-link" aria-label="Direct link to 1.7.1. 硬件流控" title="Direct link to 1.7.1. 硬件流控">​</a></h4>
<p>RTS/CTS 属于硬件握手的一种，最初是设计为电传打字机和调制解调器半双工协作通信的，每次它只能一方调制解调器发送数据。终端必须发送请求发送信号然后等到调制解调器回应清除发送信号。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/flowctrol1-17067627451835.jpg" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/flowctrol1.jpg" class="img_ev3q"></p>
<p>A 端的 DTR（数据设备就绪）发出信号， 当 B 端准备好后，B 端的 DTR（数据设备就绪）向 A端的 DSR（通讯设备就绪）发出信号。 接下来就可以通过 RTS（请求发送）和 DTR（允许发送）来控制通信。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="172-软件流控">1.7.2. 软件流控<a href="#172-软件流控" class="hash-link" aria-label="Direct link to 1.7.2. 软件流控" title="Direct link to 1.7.2. 软件流控">​</a></h4>
<p>软件流控制（Software flow control）是在计算机数据链路中的一种流控制方法，特别适用于 RS232 串口通信；它是采用特殊字符来传输带内信令，特殊编码字符称作 XOFF 与 XON（分别表示 “transmit off” 与 “transmit on”）。因此，也被称作 “XON /XOFF流控制”。</p>
<table><thead><tr><th>码的名字</th><th>含义</th><th>ASCII</th><th>十进制</th><th>十六进制</th></tr></thead><tbody><tr><td>XOFF</td><td>暂停传输</td><td>DC3</td><td>19</td><td>13</td></tr><tr><td>XON</td><td>恢复传输</td><td>DC1</td><td>17</td><td>11</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="18-raw模式">1.8. RAW模式<a href="#18-raw模式" class="hash-link" aria-label="Direct link to 1.8. RAW模式" title="Direct link to 1.8. RAW模式">​</a></h3>
<p>UART 作为tty设备工作的时候，有两种工作方式：</p>
<ul>
<li>
<ul>
<li>
<p>Canonical Input</p>
<p>RX端接收到数据之后不会直接反馈给用户态的read函数，而是要一直等到一个回车，意即对一些特殊字符进行语意解析</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>Raw Input</p>
<p>RX端接收到什么直接返回到用户空间的read函数里面</p>
</li>
</ul>
</li>
</ul>
<p>两种工作模式均为kernel层逻辑，和驱动/硬件无关，对于普通的uart应用，建议Canonical方式，对于RS485应用，建议使用Raw方式，二者通过termios的lflag参数的ICANON 位进行区分。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="19-模块特性">1.9. 模块特性<a href="#19-模块特性" class="hash-link" aria-label="Direct link to 1.9. 模块特性" title="Direct link to 1.9. 模块特性">​</a></h3>
<ul>
<li>兼容工业标准16550 UART</li>
<li>256x8bit发送与接收FIFO</li>
<li>传输速度可达3Mbps</li>
<li>支持5-8数据位以及1/1 ½/2停止位</li>
<li>支持奇校验，偶校验或者无奇偶校验</li>
<li>支持DMA控制器接口</li>
<li>支持软件/硬件流控</li>
<li>支持IrDA 1.0 SIR</li>
<li>支持RS-485/9bit 模式</li>
<li>RS-485支持硬件使能</li>
<li>Compact-IO 精简2线模式</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-使用指南">2. 使用指南<a href="#2-使用指南" class="hash-link" aria-label="Direct link to 2. 使用指南" title="Direct link to 2. 使用指南">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-内核配置">2.1. 内核配置<a href="#21-内核配置" class="hash-link" aria-label="Direct link to 2.1. 内核配置" title="Direct link to 2.1. 内核配置">​</a></h3>
<p>内核配置主要是通过 make km (make kernel_menuconfig) 命令进行 kernel 的功能选择：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Character devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Serial driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;*&gt; 8250/16550 and compatible serial support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;*&gt;   8250/16550 support for ArtInChip serial ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*]   Support 8250_core.* kernel options (DEPRECATED)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*]   Support for variants of the 16550A serial port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [ ]   Support for Fintek F81216A LPC to 4 UART RS485 API</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*]   Console on 8250/16550 and compatible serial port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (8)   Maximum number of 8250/16550 serial ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (8)   Number of 8250/16550 serial ports to register at runtime</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [ ]   Extended 8250/16550 serial driver options</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-系统参数配置">2.2. 系统参数配置<a href="#22-系统参数配置" class="hash-link" aria-label="Direct link to 2.2. 系统参数配置" title="Direct link to 2.2. 系统参数配置">​</a></h3>
<p>D211 提供最多8个 UART 端口</p>
<p>这些参数主要在文件 target/d211/common/d211.dtsi 中，模块系统参数随 SoC 的设定而定，一般不能进行更改，除非更换了新的 SoC，则需要在专业人士的指导下进行更改。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">uart1: serial@18711000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     compatible = &quot;artinchip,aic-uart-v1.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     reg = &lt;0x0 0x18711000 0x0 0x400&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     interrupts-extended = &lt;&amp;plic0 77 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     reg-shift = &lt;2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     reg-io-width = &lt;4&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     clocks = &lt;&amp;cmu CLK_UART1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     clock-frequency = &lt;48000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     resets = &lt;&amp;rst RESET_UART1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     dmas = &lt;&amp;dma DMA_UART1&gt;, &lt;&amp;dma DMA_UART1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     dma-names = &quot;rx&quot;, &quot;tx&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> };</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<ul>
<li>
<p>reg-shift</p>
<p>UART控制器兼容8250标准, 寄存器寻址使用索引而不是偏移描述，reg-shift 用来进行索引和地址的转换计算，该值不能修改</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>reg-io-width</p>
<p>为寄存器的位宽，<code>4</code> 表示采用32位标准位宽，该值不能修改</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>clock-frequency</p>
<p>D211 UART 模块的父时钟为 48M， UART 模块时钟的频率通过对其父时钟的进行除频来设置，clock-frequency 即用于设置 UART 的模块时钟， 不同的模块时钟时波特率的误差可能不同，因此可以根据目标波特率进行模块时钟的设置，详情参看 <a href="/en/ic/clocks_power/cmu/function.html#ref-baudrate-errorrate-table">UART 波特率与误差率</a></p>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-功能参数配置">2.3. 功能参数配置<a href="#23-功能参数配置" class="hash-link" aria-label="Direct link to 2.3. 功能参数配置" title="Direct link to 2.3. 功能参数配置">​</a></h3>
<p>功能参数主要针对某一个使用方案而定，因此随着方案的不同，参数很可能不同，</p>
<p>这些参数主要在文件 target/d211/xxx/board.dts 中，功能参数的设置必须和硬件原理图相匹配</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;uart1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;uart1_pins_a&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    linux,rs485-enabled-at-boot-time;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aic,rs485-compact-io-mode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<ul>
<li>
<p>pinctrl-names</p>
<p>SDK 一般会把要使用的某一功能的端口组预先定义，后期直接使用即可，定义一般放在 target/d211/common/aicxxx-pinctrl.dtsi 文件中，目前 “pinctrl-names” 均设置为 “default” 即可</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>pinctrl-0</p>
<p>即指示 UART 预先定义的端口组，其中包括用于进行发送/接收选择的 GPIO 端口</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>linux,rs485-enabled-at-boot-time</p>
<p>该端口配置为 RS485</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>aic,rs485-compact-io-mode</p>
<p>使用 AIC 独有的精简 IO 模式， 只使用2个端口，一个用作发送接收，一个用作发送和接收控制</p>
</li>
</ul>
</li>
</ul>
<p>其中 rs485 功能还有其他一些可选配置项，如 time delay 等，目前 SoC 内部对此类参数做了很好的兼容，除非特殊的 rs485 模组，否则均不需要额外配置参数</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="24-调试端口">2.4. 调试端口<a href="#24-调试端口" class="hash-link" aria-label="Direct link to 2.4. 调试端口" title="Direct link to 2.4. 调试端口">​</a></h3>
<p>调试端口的配置除了要使能相应的 UART 端口，还要在 target/aicxxx/common/env.txt 文件中配置波特率等相关参数</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">earlycon=smh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console=ttyS0,115200n8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-调试指南">3. 调试指南<a href="#3-调试指南" class="hash-link" aria-label="Direct link to 3. 调试指南" title="Direct link to 3. 调试指南">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-调试开关">3.1. 调试开关<a href="#31-调试开关" class="hash-link" aria-label="Direct link to 3.1. 调试开关" title="Direct link to 3.1. 调  试开关">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-log等级">3.1.1. Log等级<a href="#311-log等级" class="hash-link" aria-label="Direct link to 3.1.1. Log等级" title="Direct link to 3.1.1. Log等级">​</a></h4>
<p>调试的时候需要设置 log 等级为最高8，有两种设置方法：</p>
<ul>
<li>
<ul>
<li>
<p>bootarg</p>
<p>target/aicxxx/common/env.txt 中设置 loglevel=8</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>kernel menuconfig</p>
<p>make kernel_menuconfig 或者 make km 命令打开 kernel 的 menuconfig</p>
</li>
</ul>
</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Kernel hacking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printk and dmesg options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (8) Default console loglevel (1-15)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (7) Default message log level (1-7)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-调试开关">3.1.2. 调试开关<a href="#312-调试开关" class="hash-link" aria-label="Direct link to 3.1.2. 调试开关" title="Direct link to 3.1.2. 调试开关">​</a></h4>
<p>通过 make kernel_menuconfig 或者 make km 命令打开 kernel 的 menuconfig， 如下路径选中 UART 的调试开关</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Kernel hacking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*] Kernel debuging</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ArtInChip Debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*] UART Driver Debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-调试端口">3.2. 调试端口<a href="#32-调试端口" class="hash-link" aria-label="Direct link to 3.2. 调试端口" title="Direct link to 3.2. 调试端口">​</a></h3>
<p>如果 UART 作为调试端口，其主要工作即为进行调试日志的输入输出，模块工作正常则可以正常进行日志的输入输出，调试端口是所有其他模块的调试的基础，以 uart0 作为调试端口为例</p>
<p>调试端口在驱动中强制不使用 DMA</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="321-端口配置">3.2.1. 端口配置<a href="#321-端口配置" class="hash-link" aria-label="Direct link to 3.2.1. 端口配置" title="Direct link to 3.2.1. 端口配置">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">target/d211/方案x/board.dts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;uart0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;uart0_pins_a&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="322-调试端口指定">3.2.2. 调试端口指定<a href="#322-调试端口指定" class="hash-link" aria-label="Direct link to 3.2.2. 调试端口指定" title="Direct link to 3.2.2. 调试端口指定">​</a></h4>
<p>调试端口的配置只在 env.txt 中指定即可，board.dts 中 bootargs 中的 console 只是在 JTAG 调试时使用</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">target/d211/common/env.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">earlycon=smh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">console=ttyS0,115200n8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">loglevel=8</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-功能验证">3.3. 功能验证<a href="#33-功能验证" class="hash-link" aria-label="Direct link to 3.3. 功能验证" title="Direct link to 3.3. 功能验证">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="331-驱动加载">3.3.1. 驱动加载<a href="#331-驱动加载" class="hash-link" aria-label="Direct link to 3.3.1. 驱动加载" title="Direct link to 3.3.1. 驱动加载">​</a></h4>
<p>uboot 和 kernel 不共享驱动，因此驱动加载是否成功也要分两个阶段验证。</p>
<p>UART 作为调试串口和非调试串口使用的驱动一致，因此系统有任何日志输出则说明驱动加载正常。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Serial: 8250/16550 driver, 8 ports, IRQ sharing disabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18713000.serial: ttyS3 at MMIO 0x18713000 (irq = 22, base_baud = 75000000) is a 16550A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aic8250_apply_quirks port:0 rs485:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aic8250_probe port:0 clk:48000000 regshift:2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aic8250_probe success.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="332-设备信息">3.3.2. 设备信息<a href="#332-设备信息" class="hash-link" aria-label="Direct link to 3.3.2. 设备信息" title="Direct link to 3.3.2. 设备信息">​</a></h4>
<p>系统默认会给每一个 UART 端口创建一个设备节点，即 ttyS#，而不管设备是否被打开。</p>
<p>从 /sys/class/tty/ttyS# 中查看该设备信息可以确认其是否被正常初始化</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@ttyS1] cd /sys/class/tty/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[aic@ttyS1] # cat type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0： 没有初始；4： 初始化为16550A设备</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[aic@ttyS2] # cat console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">N：非调试串口；Y：调试串口</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="333-设备通信">3.3.3. 设备通信<a href="#333-设备通信" class="hash-link" aria-label="Direct link to 3.3.3. 设备通信" title="Direct link to 3.3.3. 设备通信">​</a></h4>
<p>验证模块是否可以正常通信，最简单的办法是环路端口的 RX/TX，使用 AIC 提供的 UART 测试工具进行测试</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="3331-编译测试工具">3.3.3.1. 编译测试工具<a href="#3331-编译测试工具" class="hash-link" aria-label="Direct link to 3.3.3.1. 编译测试工具" title="Direct link to 3.3.3.1. 编译测试工具">​</a></h5>
<p>在根目录下通过 make menuconfig 可以选择编译 AIC 提供的UART测试工具到系统</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Artinchip packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sample code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*] test-uart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="3332-端口环路测试">3.3.3.2. 端口环路测试<a href="#3332-端口环路测试" class="hash-link" aria-label="Direct link to 3.3.3.2. 端口环路测试" title="Direct link to 3.3.3.2. 端口环路测试">​</a></h5>
<p>运行命令：test_uart -C /dev/ttyS1 9600 进行环路测试，但不要使用其测试调试端口</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test_uart -C /dev/ttyS1  9600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Mode: 3:Circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Send Device     : /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receive Device  : /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m_Baudrate      : 9600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send data is:    1234567890artinchip0987654321</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receive data is: 1234567890artinchip0987654321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-问题排查流程">3.4. 问题排查流程<a href="#34-问题排查流程" class="hash-link" aria-label="Direct link to 3.4. 问题排查流程" title="Direct link to 3.4. 问题排查流程">​</a></h3>
<ul>
<li>
<p>在 board.dts 中确认使用的 UART 端口 status = “okay”</p>
</li>
<li>
<p>确认该 UART 端口的 GPIO 端口配置正确， 具体查看相关 GPIO 端口的寄存器</p>
</li>
<li>
<p>确认该 UART 端口的 clk 设置正确</p>
<blockquote>
<ul>
<li>确认 /dev/ttyS#/uartclk 值: 48000000</li>
<li>在 CMU 的寄存器中查看相关寄存器，如：0x0844 CLK_UART1</li>
<li>reg-dump -a 0x18020844： 0x18020844: 00003118</li>
<li>clk = 1200M / (0x18 + 1) = 48M</li>
</ul>
</blockquote>
</li>
<li>
<p>UART 寄存器是时分复用寄存器，直接读取的值无法明确意义，要跟踪寄存器设置，只能在代码中打印寄存器值</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-测试指南">4. 测试指南<a href="#4-测试指南" class="hash-link" aria-label="Direct link to 4. 测试指南" title="Direct link to 4. 测试指南">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-准备工作">4.1. 准备工作<a href="#41-准备工作" class="hash-link" aria-label="Direct link to 4.1. 准备工作" title="Direct link to 4.1. 准备工作">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="411-硬件">4.1.1. 硬件<a href="#411-硬件" class="hash-link" aria-label="Direct link to 4.1.1. 硬件" title="Direct link to 4.1.1. 硬件">​</a></h4>
<ul>
<li>
<ul>
<li>
<p>PC</p>
<p>用于和开发板进行交互</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>测试板</p>
<p>3个以上 UART 端口的测试板</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>连接线</p>
<p>用于连接 UART 的 RX/TX 端口</p>
</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="412-软件">4.1.2. 软件<a href="#412-软件" class="hash-link" aria-label="Direct link to 4.1.2. 软件" title="Direct link to 4.1.2. 软件">  ​</a></h4>
<ul>
<li>
<ul>
<li>
<p>PC串口软件：</p>
<p>用于PC和开发板进行串口通信</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>test_uart：</p>
<p>AIC 的 UART 测试工具，内嵌在 SDK 中，在根目录下通过 make menuconfig 可以选择编译到系统</p>
</li>
</ul>
</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Artinchip packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Sample code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*] test-uart</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-测试组网">4.2. 测试组网<a href="#42-测试组网" class="hash-link" aria-label="Direct link to 4.2. 测试组网" title="Direct link to 4.2. 测试组网">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="421-单端口的环路测试">4.2.1. 单端口的环路测试<a href="#421-单端口的环路测试" class="hash-link" aria-label="Direct link to 4.2.1. 单端口的环路测试" title="Direct link to 4.2.1. 单端口的环路  测试">​</a></h4>
<p>UARTn TX to UARTn RX</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/test-cycle1-17067629111947.jpg" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/test-cycle1.jpg" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="422-双端口的环路测试">4.2.2. 双端口的环路测试<a href="#422-双端口的环路测试" class="hash-link" aria-label="Direct link to 4.2.2. 双端口的环路测试" title="Direct link to 4.2.2. 双端口的环路测试">​</a></h4>
<p>UARTn to UARTm</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/test-topo-17067629176269.jpg" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/test-topo.jpg" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-rs232功能测试">4.3. RS232功能测试<a href="#43-rs232功能测试" class="hash-link" aria-label="Direct link to 4.3. RS232功能测试" title="Direct link to 4.3. RS232功能测试">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="431-单端口收发">4.3.1. 单端口收发<a href="#431-单端口收发" class="hash-link" aria-label="Direct link to 4.3.1. 单端口收发" title="Direct link to 4.3.1. 单端口收发">​</a></h4>
<ul>
<li>按单端口的环路测试组网，环路 UART4 的 RX/TX</li>
<li>使用 test_uart 工具进行测试</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test_uart -C /dev/ttyS1  9600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Mode: 3:Circle</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Send Device     : /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receive Device  : /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m_Baudrate      : 9600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">send data is:    1234567890artinchip0987654321</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">receive data is: 1234567890artinchip0987654321</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="432-双端口收发">4.3.2. 双端口收发<a href="#432-双端口收发" class="hash-link" aria-label="Direct link to 4.3.2. 双端口收发" title="Direct link to 4.3.2. 双端口收发">​</a></h4>
<ul>
<li>按双端口的环路测试组网，环路 UART4 和 UART5 的 RX/TX</li>
<li>使用 test_uart 工具进行测试</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test_uart -N /dev/ttyS4 /dev/ttyS5 115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Mode: 0:Normal Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Device     : /dev/ttyS4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receive Device  : /dev/ttyS5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m_Baudrate      : 115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 08:24:46   =============================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 08:24:46   Please input messages you want to send</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">thisisatest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 08:24:49   send data:thisisatest.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 08:24:49   receive data: len = 11: thisisatest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-rs485-功能测试">4.4. RS485 功能测试<a href="#44-rs485-功能测试" class="hash-link" aria-label="Direct link to 4.4. RS485 功能测试" title="Direct link to 4.4. RS485 功能测试">​</a></h3>
<p>RS485 的测试方式和 RS232 类似，有几点不同：</p>
<ul>
<li>端口需要配置为 RS485</li>
<li>RS485 需要有外接驱动芯片</li>
<li>RS485 为差分信号，因此需要 B+ 对 B+ 环路，B- 对 B- 环路</li>
<li>RS485 不能 B+ 环路 B-</li>
</ul>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/test-rs4851-170676294039611.jpg" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/test-rs4851.jpg" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="45-兼容性测试">4.5. 兼容性测试<a href="#45-兼容性测试" class="hash-link" aria-label="Direct link to 4.5. 兼容性测试" title="Direct link to 4.5. 兼容性测试">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="451-串口工具兼容性测试">4.5.1. 串口工具兼容性测试<a href="#451-串口工具兼容性测试" class="hash-link" aria-label="Direct link to 4.5.1. 串口工具兼容性测试" title="Direct link to 4.5.1. 串口工具兼容性测试">​</a></h4>
<p>应该测试在 RS232 模式下，调试口和如下工具的兼容性</p>
<ul>
<li>MobaXterm</li>
<li>SecureCRT</li>
<li>XShell</li>
<li>sscom</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="452-rs485-兼容性测试">4.5.2. RS485 兼容性测试<a href="#452-rs485-兼容性测试" class="hash-link" aria-label="Direct link to 4.5.2. RS485 兼容性测试" title="Direct link to 4.5.2. RS485 兼容性测试">​</a></h4>
<p>应测试在 RS485 模式下，SoC 和通用 RS485 模组的兼容性</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="46-压力测试">4.6. 压力测试<a href="#46-压力测试" class="hash-link" aria-label="Direct link to 4.6. 压力测试" title="Direct link to 4.6. 压力测试">​</a></h3>
<p>可借助于 test_uart 工具， 采用环路 UART4 和 UART5 的组网，进行压力测试。</p>
<p>测试方法是短时间内进行大量数据的收发，因为 CPU 的读写速度远远高于 UART 的收发，因此可能会有丢包，但模块不应该出现卡死现象。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # test_uart -P  /dev/ttyS4 /dev/ttyS5 115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Mode: 1:Pressure Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Send Device     : /dev/ttyS4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receive Device  : /dev/ttyS5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m_Baudrate      : 115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 08:55:22   type any key to send 100kB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="47-稳定性测试">4.7. 稳定性测试<a href="#47-稳定性测试" class="hash-link" aria-label="Direct link to 4.7. 稳定性测试" title="Direct link to 4.7. 稳定性测试">​</a></h3>
<p>可借助于 test_uart 工具，采用环路 UART4 和 UART5 的组网，进行长时间的稳定性验证。</p>
<p>测试方法是循环进行长时间的 数据收发，确认模块是否正常工作和是否有丢包。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # test_uart -S  /dev/ttyS4 /dev/ttyS5  115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Mode: 2:Stability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Send Device     : /dev/ttyS4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Receive Device  : /dev/ttyS5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">m_Baudrate      : 115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 09:08:13   =============== sending =====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 09:08:13   =============== receiving =====================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 09:08:21   send 64K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 09:08:21   receive 64K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 09:08:29   send 128K</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1970-01-01 09:08:29   receive 128K</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-源码说明">5. 源码说明<a href="#5-源码说明" class="hash-link" aria-label="Direct link to 5. 源码说明" title="Direct link to 5. 源码说明">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-串口芯片">5.1. 串口芯片<a href="#51-串口芯片" class="hash-link" aria-label="Direct link to 5.1. 串口芯片" title="Direct link to 5.1. 串口芯片">​</a></h3>
<p>在驱动代码说明开始前先介绍几种通用的串口芯片。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="511-8250">5.1.1. 8250<a href="#511-8250" class="hash-link" aria-label="Direct link to 5.1.1. 8250" title="Direct link to 5.1.1. 8250">​</a></h4>
<p>8250是 IBM PC 及兼容机使用的第一种串口芯片。这是一种相对来说很慢的芯片，有时候装载到它的寄存器速度太快，它来不及处理，就会出现数据丢失现象。8250有7个寄存器，支持的最大波特率为56kb。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="512-16450">5.1.2. 16450<a href="#512-16450" class="hash-link" aria-label="Direct link to 5.1.2. 16450" title="Direct link to 5.1.2. 16450">​</a></h4>
<p>16450 是 8250A 的快速版。加快了处理器存取它的速度，但最大速度还是 56kb。有些人实际用得比这高也可以。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="513-16550">5.1.3. 16550<a href="#513-16550" class="hash-link" aria-label="Direct link to 5.1.3. 16550" title="Direct link to 5.1.3. 16550">​</a></h4>
<p>16550/16550A 是第一种带先进先出（FIFO）功能的8250系列串口芯片。</p>
<p>AIC UART 模块是一 16550A UART，属于标准的8250系，而 Linux 对8250系串口有通用的驱动，我们采取在该驱动上添加 AIC 私有的代码的方式实现我们的驱动。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-驱动配置宏">5.2. 驱动配置宏<a href="#52-驱动配置宏" class="hash-link" aria-label="Direct link to 5.2. 驱动配置宏" title="Direct link to 5.2. 驱动配置宏">​</a></h3>
<p>因为8250驱动兼容很多后续开发的串口芯片，因此有非常多的编译功能配置项。</p>
<p>menuconfig 中位置：device drivers/Character devices/8250 16550 and compatible serial support</p>
<p>关键配置项说明：</p>
<ul>
<li>
<ul>
<li>
<p>SERIAL_8250_DEPRECATED_OPTIONS: Support 8250_core.* kernel options (DEPRECATED)</p>
<p>3.7 版本的错误，不应该打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_PNP: 8250/16550 PNP device support</p>
<p>不打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_16550A_VARIANTS: 16550A serial port</p>
<p>打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_FINTEK: Fintek F81216A LPC to 4 UART RS485 API</p>
<p>不打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_CONSOLE: 8250/16550 and compatible serial port</p>
<p>打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_DMA: DMA support for 16550 compatible UART controllers</p>
<p>打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_NR_UARTS: Maximum number of 8250/16550 serial ports</p>
<p>设置为8</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_RUNTIME_UARTS: Number of 8250/16550 serial ports to register at runtime</p>
<p>设置为8</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_EXTENDED: Extended 8250/16550 serial driver options</p>
<p>没有使用，无关系</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_MANY_PORTS</p>
<p>没有使用，无关系</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_SHARE_IRQ: Support for sharing serial interrupts</p>
<p>不打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_DETECT_IRQ: Autodetect IRQ on standard ports (unsafe)</p>
<p>不打开</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_RSA: Support RSA serial ports</p>
<p>不打开，没有使用</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_8250_DW: Support for Synopsys DesignWare 8250 quirks</p>
<p>不打开，不需要兼容</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>SERIAL_OF_PLATFORM: Device tree based probing for 8250 ports</p>
<p>不打开，使用AIC定义的OF</p>
</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-寄存器">5.3. 寄存器<a href="#53-寄存器" class="hash-link" aria-label="Direct link to 5.3. 寄存器" title="Direct link to 5.3. 寄存器">​</a></h3>
<p>8250驱动使用索引来定义寄存器，地址的计算方式为索引 * 位宽。 AIC UART 的寄存器大致可分为两种：</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="531-标准寄存器">5.3.1. 标准寄存器<a href="#531-标准寄存器" class="hash-link" aria-label="Direct link to 5.3.1. 标准寄存器" title="Direct link to 5.3.1. 标准寄存器">​</a></h4>
<p>0x7C 之前，为8250标准寄存器，在include/uapi/linux/serial_reg.h 中定义，AIC 对如下3个寄存器值有修改</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define UART_IER   1    /*Interrupt Enable: Shifter_Reg_Empty_EN*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define UART_IIR   2    /*Interrupt Identity：Shifter_Reg_Empty_INT*/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define UART_MCR   4    /*Modem Control：UART_FUNCTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="532-扩展寄存器">5.3.2. 扩展寄存器<a href="#532-扩展寄存器" class="hash-link" aria-label="Direct link to 5.3.2. 扩展寄存器" title="Direct link to 5.3.2. 扩展寄存器">​</a></h4>
<p>0x7C 之后，为 AIC 新扩展，需要额外的逻辑代码，譬如 RS485，在 8250_artinchip.h 中定义</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_USR   0x1f        /* UART Status Register */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_TFL   0x20        /* transmit FIFO level */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_RFL   0x21        /* Receive FIFO Level */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_HSK   0x22        /* DMA Handshake Configuration */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_HALT  0x29        /* Halt tx register */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_DLL   0x2C        /* DBG DLL */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_DLH   0x2D        /* DBG DLH */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_REG_UART_RS485 0x30        /* RS485 control status register */</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-程序入口">5.4. 程序入口<a href="#54-程序入口" class="hash-link" aria-label="Direct link to 5.4. 程序入口" title="Direct link to 5.4. 程序入口">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="541-8250_core">5.4.1. 8250_core<a href="#541-8250_core" class="hash-link" aria-label="Direct link to 5.4.1. 8250_core" title="Direct link to 5.4.1. 8250_core">​</a></h4>
<p>8250标准寄存器/逻辑的初始化入口，三方驱动大都借助 8250_core 完成其工作，文件：8250_core.c。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module_init(serial8250_init);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module_exit(serial8250_exit);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="542-aic-uart">5.4.2. aic-uart<a href="#542-aic-uart" class="hash-link" aria-label="Direct link to 5.4.2. aic-uart" title="Direct link to 5.4.2. aic-uart">​</a></h4>
<p>aic8250 是 artinchip 的 uart 驱动的入口，声明驱动和初始化私有寄存器/逻辑，文件：8250_artinchip.c</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static const struct of_device_id aic8250_of_match[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   { .compatible = &quot;artinchip,aic-uart-v1.0&quot; },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   { /* Sentinel */ }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MODULE_DEVICE_TABLE(of, aic8250_of_match);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct platform_driver aic8250_platform_driver = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .driver = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .name          = AICUART_DRIVER_NAME,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .pm            = &amp;aic8250_pm_ops,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .of_match_table        = aic8250_of_match,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .probe                    = aic8250_probe,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .remove           = aic8250_remove,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">module_platform_driver(aic8250_platform_driver);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-数据结构">5.5. 数据结构<a href="#55-数据结构" class="hash-link" aria-label="Direct link to 5.5. 数据结构" title="Direct link to 5.5. 数据结构">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="551-uart_8250_port">5.5.1. uart_8250_port<a href="#551-uart_8250_port" class="hash-link" aria-label="Direct link to 5.5.1. uart_8250_port" title="Direct link to 5.5.1. uart_8250_port">​</a></h4>
<p>声明在 include/linux/serial_8250.h 中，驱动中以变量名：up 变量存在，artinchip 驱动中未进行任何设置，只 overlay 了 AIC 平台的 rs485 设置函数， 其他完全使用 8250_core.c 中参数。uart_8250_port的初始化在 8250_core.c：serial8250_register_8250_port中完成。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct uart_8250_port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   struct uart_port          port;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   …</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   struct uart_8250_dma      *dma;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   const struct uart_8250_ops        *ops;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /* 8250 specific callbacks */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   int                       (*dl_read)(struct uart_8250_port *);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   void                      (*dl_write)(struct uart_8250_port *, int);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   struct uart_8250_em485 *em485;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   void                      (*rs485_start_tx)(struct uart_8250_port *);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   void                      (*rs485_stop_tx)(struct uart_8250_port *);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .dl_read          = default_serial_dl_read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .dl_write         = default_serial_dl_write</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .rs485_config = aic8250_rs485_config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .rs485            = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .rs485_start_tx = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   .rs485_stop_tx = NULL;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="552-uart_port">5.5.2. uart_port<a href="#552-uart_port" class="hash-link" aria-label="Direct link to 5.5.2. uart_port" title="Direct link to 5.5.2. uart_port">​</a></h4>
<p>uart_port 是UART驱动的关键数据结构，驱动中以 变量名：p存在，声明include/linux/serial_core.h，包含变量和关键操作函数的overlay入口。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct uart_port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   spinlock_t     lock;                      /* port lock */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   unsigned long  iobase;            /* in/out */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   unsigned char __iomem     *membase;               /* read/write */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   unsigned int   (*serial_in)(struct uart_port *, int);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   void           (*serial_out)(struct uart_port *, int, int);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ... ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="553-aic8250_data">5.5.3. aic8250_data<a href="#553-aic8250_data" class="hash-link" aria-label="Direct link to 5.5.3. aic8250_data" title="Direct link to 5.5.3. aic8250_data">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic8250_data {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct aic8250_port_data     data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int                  msr_mask_on;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int                  msr_mask_off;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct clk           *clk;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct reset_control *rst;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        unsigned int         uart_16550_compatible:1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        unsigned int         tx_empty;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        unsigned int         rs485simple;      //compact-io mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="554-operations">5.5.4. Operations<a href="#554-operations" class="hash-link" aria-label="Direct link to 5.5.4. Operations" title="Direct link to 5.5.4. Operations">​</a></h4>
<p>uart_port各操作接口设置和操作的寄存器。</p>
<p>蓝色接口为可以在客户的驱动中定制，否则使用uart8250_core中标准接口。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">handle_irq  = aic8250_handle_irq;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.pm          = aic8250_do_pm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.serial_in   = aic8250_serial_in32;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.serial_out  = aic8250_serial_out32;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.set_ldisc   = aic8250_set_ldisc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.set_termios = aic8250_set_termios;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.set_mctrl   = serial8250_set_mctrl, //set modem control, 包括termios 和 modem的转换，Modem Control Reg： MCR</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.get_mctrl   = serial8250_get_mctrl, //get modem control</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.startup     = serial8250_startup,   //寄存器初始化</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.shutdown    = serial8250_shutdown,  //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.get_divisor   = serial8250_do_get_divisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.set_divisor    = serial8250_do_set_divisor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.handle_break =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.tx_empty       = serial8250_tx_empty    //Line Status: Transmitter Empty &amp; TX Holding Register Empty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.stop_tx     = serial8250_stop_tx,   //serial8250_clear_THRI，Interrupt Enable Reg，Enable Transmitter：10，Enable Receive：01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.start_tx    = serial8250_start_tx,  //serial8250_set_THRI，Interrupt Enable Reg，Enable Transmitter：10，Enable Receive：01</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.throttle    = serial8250_throttle,  //synclink_gt.c，</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.unthrottle  = serial8250_unthrottle,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.stop_rx     = serial8250_stop_rx,   //Interrupt Enable Reg，Enable Receive：01，Enable receiver line status interrupt： 04</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.enable_ms   = serial8250_enable_ms, //Interrupt Enable Reg，Enable Modem status interrupt：08</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.break_ctl   = serial8250_break_ctl, //Line Control Reg，Break Control Bit：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.type                = serial8250_type,              //8250 or 16550 or TI16750</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.release_port        = serial8250_release_port,      //release_mem_region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.request_port= serial8250_request_port,//request_mem_region</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.config_port = serial8250_config_port,       //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.verify_port = serial8250_verify_port,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="56-关键流程">5.6. 关键流程<a href="#56-关键流程" class="hash-link" aria-label="Direct link to 5.6. 关键流程" title="Direct link to 5.6. 关键流程">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="561-serial8250_init">5.6.1. serial8250_init<a href="#561-serial8250_init" class="hash-link" aria-label="Direct link to 5.6.1. serial8250_init" title="Direct link to 5.6.1. serial8250_init">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">serial8250_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;serial8250_isa_init_ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |--&gt;UART_NR                        //8个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |--&gt;serial8250_init_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         |--&gt;port-&gt;ops = &amp;serial8250_pops;    //标准ops</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |--&gt;serial8250_set_defaults     //io，dma，fifosize，标准DMA接口</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |--&gt;serial8250_isa_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;uart_register_driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;serial8250_pnp_init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;platform_device_add</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;serial8250_register_ports</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;platform_driver_register</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="562-aic8250_probe">5.6.2. aic8250_probe<a href="#562-aic8250_probe" class="hash-link" aria-label="Direct link to 5.6.2. aic8250_probe" title="Direct link to 5.6.2. aic8250_probe">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aic8250_probe</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;regs = platform_get_resource</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;platform_get_irq</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;handle_irq = aic8250_handle_irq;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;pm         = aic8250_do_pm;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;type               = PORT_16550</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;serial_in  = aic8250_serial_in32;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;serial_out         = aic8250_serial_out32;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;set_ldisc            = aic8250_set_ldisc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;set_termios        = aic8250_set_termios;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;p-&gt;regshift            = dts:reg-shift, reg 32bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;Prepare clk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;prepare reset</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;aic8250_apply_quirks  : 处理aic 私有逻辑，dcd-override，dsr-override，cts-override，ri-override</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      |--&gt;aic8250_init_special_reg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;data-&gt;data.line = serial8250_register_8250_port： return port number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;platform_set_drvdata</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="563-serial8250_register_8250_port">5.6.3. serial8250_register_8250_port<a href="#563-serial8250_register_8250_port" class="hash-link" aria-label="Direct link to 5.6.3. serial8250_register_8250_port" title="Direct link to 5.6.3. serial8250_register_8250_port">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">serial8250_register_8250_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;return port number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;serial8250_find_match_or_unused</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;copy aic uart_8250_port to local uart_8250_port</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;uart_get_rs485_mode：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |--&gt;rs485-rts-delay，rs485-rx-during-tx，linux,rs485-enabled-at-boot-time，rs485-rts-active-low，rs485-term</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;mctrl_gpio_init:    //null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;serial8250_set_defaults //io,dma,fifosize setting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   |--&gt;serial8250_apply_quirks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     |--&gt;uart_add_one_port</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="57-rs485">5.7. RS485<a href="#57-rs485" class="hash-link" aria-label="Direct link to 5.7. RS485" title="Direct link to 5.7. RS485">​</a></h3>
<p>ArtInChip 的 RS485 有两种工作模式：</p>
<ul>
<li>标准模式：标准 RS485 接口，有B+/B-两根数据线和发送使能，共三线</li>
<li>精简模式：为 ArtInChip 定制版，使用单数据线进行数据传输，加发送使能共二线</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="571-标准模式">5.7.1. 标准模式<a href="#571-标准模式" class="hash-link" aria-label="Direct link to 5.7.1. 标准模式" title="Direct link to 5.7.1. 标准模式">​</a></h4>
<p>通过在dts中添加linux,rs485-enabled-at-boot-time配置为RS485模式，代码流为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">static void aic8250_apply_quirks(struct device *dev, struct uart_port *p,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      struct aic8250_data *data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct device_node *np = p-&gt;dev-&gt;of_node;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uart_get_rs485_mode(p);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/serial_core.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int uart_get_rs485_mode(struct uart_port *port)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if (device_property_read_bool(dev, &quot;linux,rs485-enabled-at-boot-time&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      rs485conf-&gt;flags |= SER_RS485_ENABLED;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="572-精简模式">5.7.2. 精简模式<a href="#572-精简模式" class="hash-link" aria-label="Direct link to 5.7.2. 精简模式" title="Direct link to 5.7.2. 精简模式">​</a></h4>
<p>精简模式 RS485 首先是 RS485，因此需要在开启 RS485 的基础上进行额外的配置，通过在 board.dts 中添加 aic,rs485-compact-io-mode 完成配置，代码流为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">drivers/tty/serial/serial_artinchip.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aic8250_apply_quirks:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (device_property_read_bool(dev, &quot;aic,rs485-compact-io-mode&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   data-&gt;rs485simple = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int aic8250_rs485_config(struct uart_port *p,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      struct serial_rs485 *prs485)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   struct aic8250_data *d = to_aic8250_data(p-&gt;private_data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     unsigned int mcr = p-&gt;serial_in(p, UART_MCR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     unsigned int rs485 = p-&gt;serial_in(p, AIC_REG_UART_RS485);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     mcr &amp;= AIC_UART_MCR_FUNC_MASK;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     if (prs485-&gt;flags &amp; SER_RS485_ENABLED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             if (d-&gt;rs485simple)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     mcr |= AIC_UART_MCR_RS485S;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     mcr |= AIC_UART_MCR_RS485;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             rs485 |= AIC_UART_RS485_RXBFA;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             rs485 &amp;= ~AIC_UART_RS485_CTL_MODE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             mcr = AIC_UART_MCR_UART;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             rs485 &amp;= ~AIC_UART_RS485_RXBFA;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     p-&gt;serial_out(p, UART_MCR, mcr);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     p-&gt;serial_out(p, AIC_REG_UART_RS485, rs485);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="58-dma">5.8. DMA<a href="#58-dma" class="hash-link" aria-label="Direct link to 5.8. DMA" title="Direct link to 5.8. DMA">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="581-特殊性">5.8.1. 特殊性<a href="#581-特殊性" class="hash-link" aria-label="Direct link to 5.8.1. 特殊性" title="Direct link to 5.8.1. 特殊性">​</a></h4>
<p>AIC 的 DMA 和标准的 DMA有 一点使用不同，限制了我们只能使用自己私有的 DMA 接口，主要差别点在于我们必须设置 UART FIFO中 的数据长度进行 DMA 搬运才不会出错，测试的逻辑为：</p>
<ul>
<li>如果设置了 FIFO 的中断触发为1/2，则在 FIFO 中数据达到 128byte 后会收到 data ready 中断</li>
<li>如果这个时候 UAR T在继续接收，则FIFO中的数据会按 4bytes/次 的速度增加</li>
<li>如果设置了 DMA 接收长度为64，则128-64 = 64会丢失</li>
<li>如果设置了 DM A接收长度为1024，则因为fifo中的数据最多为256，则永远收不满</li>
</ul>
<p>因此AIC的DMA处理逻辑为：</p>
<ul>
<li>收到 data ready 中断后，先停掉 UART 的接收，防止 FIFO 中数据增加</li>
<li>读取当时 FIFO 中数据的长度，作为 DMA 的参数进行数据搬移</li>
<li>DMA 搬移成功后重启 UART 数据接收</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int aic8250_dma_rx(struct uart_8250_port *p)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   struct uart_8250_dma              *dma = p-&gt;dma;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   struct dma_async_tx_descriptor    *desc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if (dma-&gt;rx_running)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   aic8250_set_ier(p, false);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   dma-&gt;rx_size = p-&gt;port.serial_in(&amp;p-&gt;port, AIC_REG_UART_RFL);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   desc = dmaengine_prep_slave_single(dma-&gt;rxchan, dma-&gt;rx_addr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  dma-&gt;rx_size, DMA_DEV_TO_MEM,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  DMA_PREP_INTERRUPT | DMA_CTRL_ACK);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   if (!desc)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return -EBUSY;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   dma-&gt;rx_running = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   desc-&gt;callback = aic8250_dma_rx_complete;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   desc-&gt;callback_param = p;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   dma-&gt;rx_cookie = dmaengine_submit(desc);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   dma_async_issue_pending(dma-&gt;rxchan);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="582-dma寄存器">5.8.2. DMA寄存器<a href="#582-dma寄存器" class="hash-link" aria-label="Direct link to 5.8.2. DMA寄存器" title="Direct link to 5.8.2. DMA寄存器">​</a></h4>
<p>DMA 的所有寄存器不建议进行参数调整，使用默认值即可，但 DMA 需要工作在 HSK 模式。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">p-&gt;serial_out(p, AIC_REG_UART_HSK, AIC_HSK_HAND_SHAKE);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="59-修改总结">5.9. 修改总结<a href="#59-修改总结" class="hash-link" aria-label="Direct link to 5.9. 修改总结" title="Direct link to 5.9. 修改总结">​</a></h3>
<p>AIC 的 UART 驱动附着于8250标准驱动，但又有不一样的地方，总结一下修改列表</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="591-驱动接口">5.9.1. 驱动接口<a href="#591-驱动接口" class="hash-link" aria-label="Direct link to 5.9.1. 驱动接口" title="Direct link to 5.9.1. 驱动接口">​</a></h4>
<ul>
<li>添加 AIC 私有接口，8250_artinchip.c,8250_artinchip.h</li>
<li>从 board.dst 中读取并配置 uartclk</li>
<li>配合 SOC 功能简化代码</li>
<li>移除 autoconfig 功能，因为有些 try 会导致输出乱码</li>
<li>DMA 策略添加和私有逻辑接口</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="592-rs485支持">5.9.2. RS485支持<a href="#592-rs485支持" class="hash-link" aria-label="Direct link to 5.9.2. RS485支持" title="Direct link to 5.9.2. RS485支持">​</a></h4>
<p>RS485 的支持需要设置 Modem_Control 和 RS485 Control and Status 两个寄存器，添加了 aic8250_rs485_config 处理接口</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="6-常见问题">6. 常见问题<a href="#6-常见问题" class="hash-link" aria-label="Direct link to 6. 常见问题" title="Direct link to 6. 常见问题">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-端口非tty设备">6.1. 端口非tty设备<a href="#61-端口非tty设备" class="hash-link" aria-label="Direct link to 6.1. 端口非tty设备" title="Direct link to 6.1. 端口非tty设备">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="611-现象">6.1.1. 现象<a href="#611-现象" class="hash-link" aria-label="Direct link to 6.1.1. 现象" title="Direct link to 6.1.1. 现象">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # test_uart -N /dev/ttyS1 /detv/ttySw2 1145200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  Test Mode: 0:Normal Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  Send Device     : /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  Receive Device  : /dev/ttyS2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  m_Baudrate      : 115200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  standard input is not a terminal device for /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  tcgetattr: Bad file descriptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  standard input is not a terminal device for /dev/ttyS2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-01-26 16:23:43]  tcgetattr: Bad file descriptor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # echo 111 &gt; /dev/ttyS1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">write error: Input/output error</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="612-原因">6.1.2. 原因<a href="#612-原因" class="hash-link" aria-label="Direct link to 6.1.2. 原因" title="Direct link to 6.1.2. 原因">​</a></h4>
<p>新版IC系统修改了 UART Clk 的地址，dts 中未同步修改，导致设备虽然进行了初始化，但模块无数据读写</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # devmem 0x18711000 32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[2022-02-07 09:23:06]  0x00000000            //uart的所有寄存器读不到数据，clk未工作</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-长包卡死">6.2. 长包卡死<a href="#62-长包卡死" class="hash-link" aria-label="Direct link to 6.2. 长包卡死" title="Direct link to 6.2. 长包卡死">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="621-现象">6.2.1. 现象<a href="#621-现象" class="hash-link" aria-label="Direct link to 6.2.1. 现象" title="Direct link to 6.2.1. 现象">​</a></h4>
<p>发送128字节以内的短包，模块可正常收发，发送超过128字节的长包，会卡死</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="622-原因">6.2.2. 原因<a href="#622-原因" class="hash-link" aria-label="Direct link to 6.2.2. 原因" title="Direct link to 6.2.2. 原因">​</a></h4>
<p>D211 RX DMA 要求严格设置 DMA RX size，如果该 size 设置不对，则会有如下问题：</p>
<ul>
<li>如果 fifo 中有数据150，而设置 rx size 为120，则丢失30数据</li>
<li>如果 fifo 中有数据150，而设置 rx size 为160， 则永远无法填充满，则永远收不回数据，卡死</li>
</ul>
<p>目前默认的8250驱动中，设置的 rx size 为1000，但 fifo 的大小只有256，因此永远无法填充完成，故导致系统卡死。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-初始化乱码">6.3. 初始化乱码<a href="#63-初始化乱码" class="hash-link" aria-label="Direct link to 6.3. 初始化乱码" title="Direct link to 6.3. 初始化乱码">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="631-现象">6.3.1. 现象<a href="#631-现象" class="hash-link" aria-label="Direct link to 6.3.1. 现象" title="Direct link to 6.3.1. 现象">​</a></h4>
<p>reboot 测试中发现 Linux 初始化 UART 时输出乱码 0xFF，导致接收端 Python脚本 断开</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="632-原因">6.3.2. 原因<a href="#632-原因" class="hash-link" aria-label="Direct link to 6.3.2. 原因" title="Direct link to 6.3.2. 原因">​</a></h4>
<p>8250驱动因为要兼容很多 IC，因此初始化时有一个自动 try 的机制：autoconfig，通过对硬件模块的测试来确认 IP 类型和特殊功能，此自动 try 工作会频繁操作寄存器，既可能造成不确定的影响（输出上述乱码），也会增加系统开销，而我们 UART 模块特性固定，可以预先进行配置，不进行 try。</p>
<p>autoconfig 的核心是设置了 port-&gt;type 为 PORT_16550A，我们直接设置 type 后即可不使用 autoconfig 流程。</p>
<p>关闭 autoconfig 的流程为：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aic8250_probe:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p-&gt;type = PORT_16550A;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    p-&gt;flags = UPF_FIXED_TYPE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uart_configure_port:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!(port-&gt;flags &amp; UPF_FIXED_TYPE)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port-&gt;type = PORT_UNKNOWN;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        flags |= UART_CONFIG_TYPE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">serial8250_config_port:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (flags &amp; UART_CONFIG_TYPE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        autoconfig(up);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/07-11_UART-Useguide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/docs/D213-DevKit/part3/07-10_SPI-Useguide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">SPI 使用指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/docs/D213-DevKit/part3/07-12_USB-Useguide"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">USB 使用指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-模块介绍" class="table-of-contents__link toc-highlight">1. 模块介绍</a><ul><li><a href="#11-术语定义" class="table-of-contents__link toc-highlight">1.1. 术语定义</a></li><li><a href="#12-模块简介" class="table-of-contents__link toc-highlight">1.2. 模块简介</a></li><li><a href="#13-通信协议" class="table-of-contents__link toc-highlight">1.3. 通信协议</a></li><li><a href="#14-参数信息" class="table-of-contents__link toc-highlight">1.4. 参数信息</a></li><li><a href="#15-常用接口" class="table-of-contents__link toc-highlight">1.5. 常用接口</a></li><li><a href="#16-插头" class="table-of-contents__link toc-highlight">1.6. 插头</a></li><li><a href="#17-流控" class="table-of-contents__link toc-highlight">1.7. 流控</a></li><li><a href="#18-raw模式" class="table-of-contents__link toc-highlight">1.8. RAW模式</a></li><li><a href="#19-模块特性" class="table-of-contents__link toc-highlight">1.9. 模块特性</a></li></ul></li><li><a href="#2-使用指南" class="table-of-contents__link toc-highlight">2. 使用指南</a><ul><li><a href="#21-内核配置" class="table-of-contents__link toc-highlight">2.1. 内核配置</a></li><li><a href="#22-系统参数配置" class="table-of-contents__link toc-highlight">2.2. 系统参数配置</a></li><li><a href="#23-功能参数配置" class="table-of-contents__link toc-highlight">2.3. 功能参数配置</a></li><li><a href="#24-调试端口" class="table-of-contents__link toc-highlight">2.4. 调试端口</a></li></ul></li><li><a href="#3-调试指南" class="table-of-contents__link toc-highlight">3. 调试指南</a><ul><li><a href="#31-调试开关" class="table-of-contents__link toc-highlight">3.1. 调试开关</a></li><li><a href="#32-调试端口" class="table-of-contents__link toc-highlight">3.2. 调试端口</a></li><li><a href="#33-功能验证" class="table-of-contents__link toc-highlight">3.3. 功能验证</a></li><li><a href="#34-问题排查流程" class="table-of-contents__link toc-highlight">3.4. 问题排查流程</a></li></ul></li><li><a href="#4-测试指南" class="table-of-contents__link toc-highlight">4. 测试指南</a><ul><li><a href="#41-准备工作" class="table-of-contents__link toc-highlight">4.1. 准备工作</a></li><li><a href="#42-测试组网" class="table-of-contents__link toc-highlight">4.2. 测试组网</a></li><li><a href="#43-rs232功能测试" class="table-of-contents__link toc-highlight">4.3. RS232功能测试</a></li><li><a href="#44-rs485-功能测试" class="table-of-contents__link toc-highlight">4.4. RS485 功能测试</a></li><li><a href="#45-兼容性测试" class="table-of-contents__link toc-highlight">4.5. 兼容性测试</a></li><li><a href="#46-压力测试" class="table-of-contents__link toc-highlight">4.6. 压力测试</a></li><li><a href="#47-稳定性测试" class="table-of-contents__link toc-highlight">4.7. 稳定性测试</a></li></ul></li><li><a href="#5-源码说明" class="table-of-contents__link toc-highlight">5. 源码说明</a><ul><li><a href="#51-串口芯片" class="table-of-contents__link toc-highlight">5.1. 串口芯片</a></li><li><a href="#52-驱动配置宏" class="table-of-contents__link toc-highlight">5.2. 驱动配置宏</a></li><li><a href="#53-寄存器" class="table-of-contents__link toc-highlight">5.3. 寄存器</a></li><li><a href="#54-程序入口" class="table-of-contents__link toc-highlight">5.4. 程序入口</a></li><li><a href="#55-数据结构" class="table-of-contents__link toc-highlight">5.5.   数据结构</a></li><li><a href="#56-关键流程" class="table-of-contents__link toc-highlight">5.6. 关键流程</a></li><li><a href="#57-rs485" class="table-of-contents__link toc-highlight">5.7. RS485</a></li><li><a href="#58-dma" class="table-of-contents__link toc-highlight">5.8. DMA</a></li><li><a href="#59-修改总结" class="table-of-contents__link toc-highlight">5.9. 修改总结</a></li></ul></li><li><a href="#6-常见问题" class="table-of-contents__link toc-highlight">6. 常见问题</a><ul><li><a href="#61-端口非tty设备" class="table-of-contents__link toc-highlight">6.1. 端口非tty设备</a></li><li><a href="#62-长包卡死" class="table-of-contents__link toc-highlight">6.2. 长包卡死</a></li><li><a href="#63-初始化乱码" class="table-of-contents__link toc-highlight">6.3. 初始化乱码</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>