"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5128],{5519:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>x,frontMatter:()=>l,metadata:()=>t,toc:()=>a});var r=i(5893),d=i(1151);const l={sidebar_position:13},s="Display \u4f7f\u7528\u6307\u5357",t={id:"D213-DevKit/part3/06-3_Display-Useguide",title:"Display \u4f7f\u7528\u6307\u5357",description:"1. \u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/D213-DevKit/part3/06-3_Display-Useguide.md",sourceDirName:"D213-DevKit/part3",slug:"/D213-DevKit/part3/06-3_Display-Useguide",permalink:"/en/docs/D213-DevKit/part3/06-3_Display-Useguide",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/06-3_Display-Useguide.md",tags:[],version:"current",sidebarPosition:13,frontMatter:{sidebar_position:13},sidebar:"d213dkSidebar",previous:{title:"VE \u4f7f\u7528\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/06-2_VE-Useguide"},next:{title:"DVP\u5f00\u53d1\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/06-4_DVP-Useguide"}},c={},a=[{value:"1. \u6a21\u5757\u4ecb\u7ecd",id:"1-\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"1.1. \u672f\u8bed\u5b9a\u4e49",id:"11-\u672f\u8bed\u5b9a\u4e49",level:3},{value:"1.2. \u7cfb\u7edf\u7b80\u4ecb",id:"12-\u7cfb\u7edf\u7b80\u4ecb",level:3},{value:"1.3. \u7279\u6027\u8bf4\u660e",id:"13-\u7279\u6027\u8bf4\u660e",level:3},{value:"1.3.1. \u663e\u793a\u5f15\u64ce",id:"131-\u663e\u793a\u5f15\u64ce",level:4},{value:"1.3.2. \u663e\u793a\u63a5\u53e3",id:"132-\u663e\u793a\u63a5\u53e3",level:4},{value:"2. \u53c2\u6570\u914d\u7f6e",id:"2-\u53c2\u6570\u914d\u7f6e",level:2},{value:"2.1. menuconfig\u914d\u7f6e",id:"21-menuconfig\u914d\u7f6e",level:3},{value:"2.1.1. \u4f7f\u80fd\u663e\u793a\u6a21\u5757\u9a71\u52a8",id:"211-\u4f7f\u80fd\u663e\u793a\u6a21\u5757\u9a71\u52a8",level:4},{value:"2.1.2. \u7f16\u8bd1\u663e\u793a\u63a5\u53e3",id:"212-\u7f16\u8bd1\u663e\u793a\u63a5\u53e3",level:4},{value:"2.1.3. \u9009\u62e9panel",id:"213-\u9009\u62e9panel",level:4},{value:"2.1.4. \u4f7f\u80fd\u80cc\u5149",id:"214-\u4f7f\u80fd\u80cc\u5149",level:4},{value:"2.1.5. \u9a71\u52a8\u4f9d\u8d56\u9879",id:"215-\u9a71\u52a8\u4f9d\u8d56\u9879",level:4},{value:"2.1.5.1. \u914d\u7f6eCMA",id:"2151-\u914d\u7f6ecma",level:5},{value:"2.1.5.2. \u4f7f\u80fd DMA-BUF",id:"2152-\u4f7f\u80fd-dma-buf",level:5},{value:"2.2. DTS\u53c2\u6570\u914d\u7f6e",id:"22-dts\u53c2\u6570\u914d\u7f6e",level:3},{value:"2.2.1. \u7cfb\u7edf\u53c2\u6570\u914d\u7f6e",id:"221-\u7cfb\u7edf\u53c2\u6570\u914d\u7f6e",level:4},{value:"2.2.1.1. fb0",id:"2211-fb0",level:5},{value:"2.2.1.2. display engine",id:"2212-display-engine",level:5},{value:"2.2.1.3. rgb display interface",id:"2213-rgb-display-interface",level:5},{value:"2.2.1.4. lvds display interface",id:"2214-lvds-display-interface",level:5},{value:"2.2.1.5. mipi-dsi display interface",id:"2215-mipi-dsi-display-interface",level:5},{value:"2.2.2. \u529f\u80fd\u53c2\u6570\u914d\u7f6e",id:"222-\u529f\u80fd\u53c2\u6570\u914d\u7f6e",level:4},{value:"2.2.2.1. Panel",id:"2221-panel",level:5},{value:"2.2.2.1.1. panel rgb",id:"22211-panel-rgb",level:6},{value:"2.2.2.1.2. panel lvds",id:"22212-panel-lvds",level:6},{value:"2.2.2.1.3. panel dsi",id:"22213-panel-dsi",level:6},{value:"2.2.2.2. backlight",id:"2222-backlight",level:5},{value:"2.2.2.2.1. pwm-backlight",id:"22221-pwm-backlight",level:6},{value:"2.2.2.3. Display Interface",id:"2223-display-interface",level:5},{value:"2.2.2.3.1. RGB Display Interface",id:"22231-rgb-display-interface",level:6},{value:"2.2.2.3.2. LVDS Display Interface",id:"22232-lvds-display-interface",level:6},{value:"2.2.2.3.3. MIPI-DSI Display Interface",id:"22233-mipi-dsi-display-interface",level:6},{value:"2.2.2.4. Display Engine",id:"2224-display-engine",level:5},{value:"2.2.2.4.1. Display Engine",id:"22241-display-engine",level:6},{value:"2.2.2.5. Display FB0",id:"2225-display-fb0",level:5},{value:"2.2.2.5.1. Display FB0",id:"22251-display-fb0",level:6},{value:"3. \u8c03\u8bd5\u6307\u5357",id:"3-\u8c03\u8bd5\u6307\u5357",level:2},{value:"3.1. \u8c03\u8bd5\u5f00\u5173",id:"31-\u8c03\u8bd5\u5f00\u5173",level:3},{value:"3.1.1. DE \u8c03\u8bd5\u5f00\u5173",id:"311-de-\u8c03\u8bd5\u5f00\u5173",level:4},{value:"3.1.2. CMA \u8c03\u8bd5\u5f00\u5173",id:"312-cma-\u8c03\u8bd5\u5f00\u5173",level:4},{value:"3.2. Component",id:"32-component",level:3},{value:"3.3. CMA",id:"33-cma",level:3},{value:"3.4. DMA-BUF",id:"34-dma-buf",level:3},{value:"3.5. /dev/fb",id:"35-devfb",level:3},{value:"3.6. Display Engine",id:"36-display-engine",level:3},{value:"3.7. Color bar",id:"37-color-bar",level:3},{value:"3.8. Framebuffer \u622a\u56fe",id:"38-framebuffer-\u622a\u56fe",level:3},{value:"4. \u6d4b\u8bd5\u6307\u5357",id:"4-\u6d4b\u8bd5\u6307\u5357",level:2},{value:"4.1. \u6d4b\u8bd5\u73af\u5883",id:"41-\u6d4b\u8bd5\u73af\u5883",level:3},{value:"4.1.1. \u786c\u4ef6",id:"411-\u786c\u4ef6",level:4},{value:"4.1.2. \u8f6f\u4ef6",id:"412-\u8f6f\u4ef6",level:4},{value:"4.1.3. \u8f6f\u4ef6\u914d\u7f6e",id:"413-\u8f6f\u4ef6\u914d\u7f6e",level:4},{value:"4.1.3.1. \u914d\u7f6e LVDS\u5c4f\u5e55",id:"4131-\u914d\u7f6e-lvds\u5c4f\u5e55",level:5},{value:"4.1.3.2. display engine",id:"4132-display-engine",level:5},{value:"4.1.3.3. lvds display interface",id:"4133-lvds-display-interface",level:5},{value:"4.1.3.4. test_dmabuf \u914d\u7f6e",id:"4134-test_dmabuf-\u914d\u7f6e",level:5},{value:"4.2. test_dmabuf \u6d4b\u8bd5",id:"42-test_dmabuf-\u6d4b\u8bd5",level:3},{value:"5. \u8bbe\u8ba1\u8bf4\u660e",id:"5-\u8bbe\u8ba1\u8bf4\u660e",level:2},{value:"5.1. \u6e90\u7801\u548c\u6587\u6863\u8bf4\u660e",id:"51-\u6e90\u7801\u548c\u6587\u6863\u8bf4\u660e",level:3},{value:"5.1.1. \u6e90\u7801\u8bf4\u660e",id:"511-\u6e90\u7801\u8bf4\u660e",level:4},{value:"5.1.2. \u6587\u6863\u8bf4\u660e",id:"512-\u6587\u6863\u8bf4\u660e",level:4},{value:"5.2. \u6a21\u5757\u67b6\u6784",id:"52-\u6a21\u5757\u67b6\u6784",level:3},{value:"5.2.1. fbdev\u6846\u67b6",id:"521-fbdev\u6846\u67b6",level:4},{value:"5.2.2. Componet\u6846\u67b6",id:"522-componet\u6846\u67b6",level:4},{value:"5.3. \u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",id:"53-\u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",level:3},{value:"5.3.1. \u521d\u59cb\u5316\u6d41\u7a0b",id:"531-\u521d\u59cb\u5316\u6d41\u7a0b",level:4},{value:"5.3.1.1. probe\u548cbind\u8fc7\u7a0b",id:"5311-probe\u548cbind\u8fc7\u7a0b",level:5},{value:"5.3.1.2. \u786c\u4ef6\u65f6\u5e8f\u8981\u6c42\xb6",id:"5312-\u786c\u4ef6\u65f6\u5e8f\u8981\u6c42",level:5},{value:"5.3.2. \u9884\u7559\u5185\u5b58\u7ba1\u7406\u6d41\u7a0b",id:"532-\u9884\u7559\u5185\u5b58\u7ba1\u7406\u6d41\u7a0b",level:4},{value:"5.3.2.1. CMA",id:"5321-cma",level:5},{value:"5.3.2.2. DMA-BUF",id:"5322-dma-buf",level:5},{value:"5.3.3. Backlight",id:"533-backlight",level:5},{value:"5.4. \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",id:"54-\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",level:3},{value:"5.4.1. uapi/video/artinchip_video.h",id:"541-uapivideoartinchip_videoh",level:4},{value:"5.4.1.1. struct aic_rect",id:"5411-struct-aic_rect",level:5},{value:"5.4.1.2. struct aic_point",id:"5412-struct-aic_point",level:5},{value:"5.4.1.3. struct aic_size",id:"5413-struct-aic_size",level:5},{value:"5.4.1.4. enum aic_pixel_format",id:"5414-enum-aic_pixel_format",level:5},{value:"5.4.2. uapi/video/artinchip_fb.h",id:"542-uapivideoartinchip_fbh",level:4},{value:"5.4.2.1. struct aicfb_layer_num",id:"5421-struct-aicfb_layer_num",level:5},{value:"5.4.2.2. struct aicfb_layer_capability",id:"5422-struct-aicfb_layer_capability",level:5},{value:"5.4.2.3. struct aicfb_buffer",id:"5423-struct-aicfb_buffer",level:5},{value:"5.4.2.4. struct aicfb_layer_data",id:"5424-struct-aicfb_layer_data",level:5},{value:"5.4.2.5. struct aicfb_config_lists",id:"5425-struct-aicfb_config_lists",level:5},{value:"5.4.2.6. struct aicfb_alpha_config",id:"5426-struct-aicfb_alpha_config",level:5},{value:"5.4.2.7. struct aicfb_ck_config",id:"5427-struct-aicfb_ck_config",level:5},{value:"5.4.2.8. struct aicfb_dmabuf_fd",id:"5428-struct-aicfb_dmabuf_fd",level:5},{value:"5.4.2.9. ioctl\u547d\u4ee4",id:"5429-ioctl\u547d\u4ee4",level:5},{value:"5.5. \u63a5\u53e3\u8bbe\u8ba1",id:"55-\u63a5\u53e3\u8bbe\u8ba1",level:3},{value:"5.5.1. \u6982\u8ff0",id:"551-\u6982\u8ff0",level:4},{value:"5.5.2. Framebuffer\u6807\u51c6\u63a5\u53e3",id:"552-framebuffer\u6807\u51c6\u63a5\u53e3",level:4},{value:"5.5.3. \u6269\u5c55\u63a5\u53e3",id:"553-\u6269\u5c55\u63a5\u53e3",level:4},{value:"5.5.3.1. AICFB_WAIT_FOR_VSYNC",id:"5531-aicfb_wait_for_vsync",level:5},{value:"5.5.3.2. AICFB_GET_LAYER_NUM",id:"5532-aicfb_get_layer_num",level:5},{value:"5.5.3.3. AICFB_GET_LAYER_CAPABILITY",id:"5533-aicfb_get_layer_capability",level:5},{value:"5.5.3.4. AICFB_GET_LAYER_CONFIG",id:"5534-aicfb_get_layer_config",level:5},{value:"5.5.3.5. AICFB_UPDATE_LAYER_CONFIG",id:"5535-aicfb_update_layer_config",level:5},{value:"5.5.3.6. AICFB_UPDATE_LAYER_CONFIG_LISTS",id:"5536-aicfb_update_layer_config_lists",level:5},{value:"5.5.3.7. AICFB_GET_ALPHA_CONFIG",id:"5537-aicfb_get_alpha_config",level:5},{value:"5.5.3.8. AICFB_UPDATE_ALPHA_CONFIG",id:"5538-aicfb_update_alpha_config",level:5},{value:"5.5.3.9. AICFB_GET_CK_CONFIG",id:"5539-aicfb_get_ck_config",level:5},{value:"5.5.3.10. AICFB_UPDATE_CK_CONFIG",id:"55310-aicfb_update_ck_config",level:5},{value:"5.5.3.11. AICFB_GET_SCREEN_SIZE",id:"55311-aicfb_get_screen_size",level:5},{value:"5.5.3.12. AICFB_GET_FB_LAYER_CONFIG",id:"55312-aicfb_get_fb_layer_config",level:5},{value:"5.5.3.13. AICFB_GET_DMABUF",id:"55313-aicfb_get_dmabuf",level:5},{value:"5.5.3.14. AICFB_PUT_DMABUF",id:"55314-aicfb_put_dmabuf",level:5},{value:"5.5.3.15. AICFB_TO_DMABUF_FD",id:"55315-aicfb_to_dmabuf_fd",level:5},{value:"5.6. APP Demo",id:"56-app-demo",level:3},{value:"5.6.1. Framebuffer\u6807\u51c6\u63a5\u53e3\u7684\u4f7f\u7528",id:"561-framebuffer\u6807\u51c6\u63a5\u53e3\u7684\u4f7f\u7528",level:4},{value:"5.6.2. AICFB\u6269\u5c55\u63a5\u53e3\u7684\u4f7f\u7528",id:"562-aicfb\u6269\u5c55\u63a5\u53e3\u7684\u4f7f\u7528",level:4},{value:"5.6.3. DMA-BUF\u7684\u4f7f\u7528",id:"563-dma-buf\u7684\u4f7f\u7528",level:4}];function h(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"display-\u4f7f\u7528\u6307\u5357",children:"Display \u4f7f\u7528\u6307\u5357"}),"\n",(0,r.jsx)(e.h2,{id:"1-\u6a21\u5757\u4ecb\u7ecd",children:"1. \u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,r.jsx)(e.h3,{id:"11-\u672f\u8bed\u5b9a\u4e49",children:"1.1. \u672f\u8bed\u5b9a\u4e49"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u672f\u8bed"}),(0,r.jsx)(e.th,{children:"\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"\u6ce8\u91ca\u8bf4\u660e"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"DE"}),(0,r.jsx)(e.td,{children:"Display Engine"}),(0,r.jsx)(e.td,{children:"\u663e\u793a\u5f15\u64ce"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"DI"}),(0,r.jsx)(e.td,{children:"Display Interface"}),(0,r.jsx)(e.td,{children:"\u663e\u793a\u63a5\u53e3\uff0c\u5305\u62ecRGB/LVDS/DSI\u7b49"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"PANEL"}),(0,r.jsx)(e.td,{children:"panel"}),(0,r.jsx)(e.td,{children:"\u5916\u63a5\u5c4f\u5e55\u9a71\u52a8"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB"}),(0,r.jsx)(e.td,{children:"Red Green Blue"}),(0,r.jsx)(e.td,{children:"\u6309\u7ea2\u7eff\u84dd\u4e09\u539f\u8272\u7f16\u7801\u7684\u663e\u793a\u63a5\u53e3\u6807\u51c6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"LVDS"}),(0,r.jsx)(e.td,{children:"Low Voltage Differential Signaling"}),(0,r.jsx)(e.td,{children:"\u4f4e\u538b\u5dee\u5206\u4fe1\u53f7\u7684\u663e\u793a\u63a5\u53e3\u6807\u51c6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"MIPI-DSI"}),(0,r.jsx)(e.td,{children:"Mipi Display Serial Interface"}),(0,r.jsx)(e.td,{children:"Mipi\u7ec4\u7ec7\u5b9a\u4e49\u7684\u4e00\u4e2a\u663e\u793a\u63a5\u53e3\u6807\u51c6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"I8080"}),(0,r.jsx)(e.td,{children:"/"}),(0,r.jsx)(e.td,{children:"Inter\u63d0\u51fa\u76848080\u603b\u7ebf\u6807\u51c6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SPI"}),(0,r.jsx)(e.td,{children:"Serial Peripheral Interface"}),(0,r.jsx)(e.td,{children:"\u4e32\u884c\u5916\u8bbe\u63a5\u53e3\uff0c\u7531spi\u534f\u8bae\u4f20\u8f93\u6570\u636e"})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"12-\u7cfb\u7edf\u7b80\u4ecb",children:"1.2. \u7cfb\u7edf\u7b80\u4ecb"}),"\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u6a21\u5757\u5305\u542b\u4e86\u663e\u793a\u5f15\u64ce (DE)\uff0c\u663e\u793a\u63a5\u53e3 (DI)\u3002\u5176\u4e2d\u663e\u793a\u63a5\u53e3\u652f\u6301 RGB/LVDS/DSI/I8080/SPI \u7b49\u63a5\u53e3\u6807\u51c6\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u6a21\u5757\u7684\u4e3b\u8981\u529f\u80fd\u662f\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u8f6c\u6362\u6210\u663e\u793a\u63a5\u53e3\u9700\u8981\u7684\u4fe1\u53f7\uff0c\u5e76\u4e14\u652f\u6301\u591a\u56fe\u5c42\u7684\u53e0\u52a0\u8f93\u51fa\u3002\u4ece\u786c\u4ef6\u89d2\u5ea6\u770b\uff0c\u663e\u793a\u6a21\u5757\u7684\u6846\u67b6\u5982\u4e0b\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/display_system1-17066864576981.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/display_system1.png"})}),"\n",(0,r.jsxs)(e.p,{children:["\u56fe 6.21 ",(0,r.jsx)(e.em,{children:"\u663e\u793a\u6a21\u5757"})]}),"\n",(0,r.jsx)(e.h3,{id:"13-\u7279\u6027\u8bf4\u660e",children:"1.3. \u7279\u6027\u8bf4\u660e"}),"\n",(0,r.jsx)(e.h4,{id:"131-\u663e\u793a\u5f15\u64ce",children:"1.3.1. \u663e\u793a\u5f15\u64ce"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Display Engine"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6700\u5927\u8f93\u5165/\u8f93\u51fa\u56fe\u50cf\u5927\u5c0f 2048x2048"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6700\u9ad8\u6027\u80fd 1920*1080@60fps"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u652f\u6301\u4e24\u4e2a\u663e\u793a\u56fe\u5c42\uff0c\u4e00\u4e2a Video \u56fe\u5c42\uff0c\u4e00\u4e2a UI \u56fe\u5c42\uff0cUI \u56fe\u5c42\u5185\u652f\u63014\u4e2a\u77e9\u5f62\u7a97\u53e3"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"UI \u56fe\u5c42\u652f\u6301\u56fe\u50cf\u683c\u5f0f\uff1aARGB8888/XRGB8888/RGB888/ARGB4444/ARGB1555/RGB565"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Video \u56fe\u5c42\u652f\u6301\u56fe\u50cf\u683c\u5f0f\uff1a"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ARGB8888/XRGB8888/RGB888/ARGB4444/ARGB1555/RGB565"}),"\n",(0,r.jsx)(e.li,{children:"YUV420P/NV12/NV21/YUV420_TILE_64x32/YUV420_TILE_128x16"}),"\n",(0,r.jsx)(e.li,{children:"YUV422P/NV16/NV61/YUYV/YVYU/UYVY/VYUY/YUV422_TILE_64x32/YUV422_TILE_128x16"}),"\n",(0,r.jsx)(e.li,{children:"YUV400"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Video\u56fe\u5c42\u7684 YUV \u683c\u5f0f\u652f\u6301 1/31.999x ~ 32x \u7f29\u653e\uff08RGB\u683c\u5f0f\u4e0d\u652f\u6301\uff09"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u652f\u6301\u8bef\u5dee\u6269\u6563 Dither"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"132-\u663e\u793a\u63a5\u53e3",children:"1.3.2. \u663e\u793a\u63a5\u53e3"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"RGB\u63a5\u53e3"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u652f\u6301 PRGB/SRGB/I8080/SPI \u56db\u79cd\u63a5\u53e3","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["PRGB \u5e76\u884c RGB \u63a5\u53e3","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 PRGB 24/18/16 bit \u6a21\u5f0f\uff0c\u6700\u9ad8\u6027\u80fd 1080P60"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["SRGB \u4e32\u884c RGB \u63a5\u53e3","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 SRGB 8/6 bit \u6a21\u5f0f\uff0c\u6700\u9ad8\u6027\u80fd 480x320@60fps"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["I8080 \u63a5\u53e3","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 I8080 24/18/16/9/8 bit \u6a21\u5f0f\uff0c\u6700\u9ad8\u6027\u80fd 960x540@60fps"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["SPI \u63a5\u53e3","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 SPI 3wire/4wire/4-sda \u6a21\u5f0f\uff0c\u6700\u9ad8\u6027\u80fd 480x320@60fps"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 SPI 8/24/32 read\u6a21\u5f0f"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 8 \u4f4d\u8272\u6df1\uff0cR/G/B \u4e09\u7ec4\u4fe1\u53f7\u53ef\u4efb\u610f\u4ea4\u53c9\uff0c\u7a7a\u767d\u533a\u57df\u6570\u636e\u53ef\u914d\u7f6e"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 R/G/B \u7ec4\u5185\u6570\u636e\u8f93\u51fa\u987a\u5e8f\u5207\u6362"}),"\n",(0,r.jsx)(e.li,{children:"PRGB/SRGB \u65f6\u949f\u63d0\u4f9b 4 \u4e2a\u76f8\u4f4d\u9009\u62e9"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"LVDS\u63a5\u53e3"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 Single Link \u548c Dual Link\uff0c\u6700\u9ad8\u901f\u7387 700M bps"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 VESA \u548c JEIDA \u6a21\u5f0f"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 18bit \u548c 24bit \u6570\u636e\u4f20\u8f93"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 LVDS \u4fe1\u53f7\u6781\u6027\u9009\u62e9\u6a21\u5f0f"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 LVDS Link0 \u548c Link1 \u6574\u7ec4\u4e92\u6362"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 LVDS \u4e94\u7ec4\u5dee\u5206\u5bf9\u4fe1\u53f7\u4efb\u610f\u4e92\u6362"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"MIPI-DSI\u63a5\u53e3"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6700\u5927\u652f\u6301 1080P60 \u53ca\u884d\u751f\u5206\u8fa8\u7387\uff0c\u652f\u6301 Video \u548c Command \u6a21\u5f0f"}),"\n",(0,r.jsx)(e.li,{children:"Video \u6a21\u5f0f\u652f\u6301 Non-burst \u548c Burst \u4e24\u79cd\u65b9\u5f0f"}),"\n",(0,r.jsx)(e.li,{children:"\u53ef\u914d\u7f6e\u4e3a 1/2/3/4 \u5bf9\u6570\u636e\u901a\u9053\uff0c\u6bcf\u901a\u9053\u6700\u5927\u652f\u6301 1Gbps \u901f\u7387"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 RGB888\uff0cRGB666\uff0cRGB666 packed\uff0cRGB565"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"2-\u53c2\u6570\u914d\u7f6e",children:"2. \u53c2\u6570\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u7ae0\u8282\u4ecb\u7ecd\u663e\u793a\u6a21\u5757\u7684\u53c2\u6570\u914d\u7f6e\uff0c\u5305\u62ec menuconfig \u914d\u7f6e \u548c dts \u914d\u7f6e\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"21-menuconfig\u914d\u7f6e",children:"2.1. menuconfig\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h4,{id:"211-\u4f7f\u80fd\u663e\u793a\u6a21\u5757\u9a71\u52a8",children:"2.1.1. \u4f7f\u80fd\u663e\u793a\u6a21\u5757\u9a71\u52a8"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make linux-menuconfig\uff0c\u8fdb\u5165 kernel \u7684\u529f\u80fd\u914d\u7f6e\uff0c\u4f7f\u80fd\u663e\u793a\u6a21\u5757\u9a71\u52a8\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Device Drivers\n        Graphics support\n            ArtInChip Graphics  ---\x3e\n                <*> ArtInChip Framebuffer support\n"})}),"\n",(0,r.jsx)(e.h4,{id:"212-\u7f16\u8bd1\u663e\u793a\u63a5\u53e3",children:"2.1.2. \u7f16\u8bd1\u663e\u793a\u63a5\u53e3"}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u80fd\u663e\u793a\u6a21\u5757\u7684\u9a71\u52a8\u540e\uff0c\u9700\u8981\u5c06\u663e\u793a\u63a5\u53e3\u7f16\u8bd1\u8fdb\u5185\u6838\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"<*> ArtInChip Framebuffer support\n    [*]   ArtInChip display rgb support\n    [*]   ArtInChip display lvds support\n    [*]   ArtInChip display mipi-dsi support\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53ef\u4ee5\u5c06\u4e09\u4e2a\u663e\u793a\u63a5\u53e3\u90fd\u7f16\u8bd1\u8fdb\u5185\u6838\uff0c\u4f46\u7cfb\u7edf\u8fd0\u884c\u65f6\uff0c\u53ea\u6709 panel \u9a71\u52a8\u6240\u5bf9\u5e94\u7684\u663e\u793a\u63a5\u53e3\u80fd\u751f\u6548\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"213-\u9009\u62e9panel",children:"2.1.3. \u9009\u62e9panel"}),"\n",(0,r.jsx)(e.p,{children:"Luban sdk \u4e0d\u4ec5\u4e3a RGB/LVDS \u7b49\u663e\u793a\u63a5\u53e3\u63d0\u4f9b\u4e86\u901a\u7528\u7684 panel \u9a71\u52a8\uff0c\u4e5f\u4e3a\u90e8\u5206\u5c4f\u9a71 IC \u63d0\u4f9b\u4e13\u7528 panel \u9a71\u52a8\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u9009\u62e9\u7279\u5b9a\u7684 panel \u9a71\u52a8\uff0c\u8981\u5148\u4f7f\u80fd panel \u5bf9\u5e94\u7684\u663e\u793a\u63a5\u53e3\u548c pwm-backlight\uff0c\u5426\u5219 panel \u5728 menuconfig \u4e2d\u4e0d\u53ef\u89c1\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"<*> ArtInChip Framebuffer support\n    <*>   ArtInChip Panel Drivers (ArtInChip general RGB panel)  ---\x3e\n"})}),"\n",(0,r.jsx)(e.h4,{id:"214-\u4f7f\u80fd\u80cc\u5149",children:"2.1.4. \u4f7f\u80fd\u80cc\u5149"}),"\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u6a21\u5757\u9a71\u52a8\u4f7f\u7528 pwm-backlight \u6846\u67b6\u8fdb\u884c\u80cc\u5149\u63a7\u5236"}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u80fd PWM"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Device Drivers\n    [*] Pulse-Width Modulation (PWM) Support  ---\x3e\n         <*>   ArtInChip PWM support\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u80fd pwm-backlight"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Device Drivers\n    Graphics support\n        Backlight & LCD device support\n            <*> Lowlevel Backlight controls\n                <*> Generic PWM based Backlight Driver\n"})}),"\n",(0,r.jsx)(e.h4,{id:"215-\u9a71\u52a8\u4f9d\u8d56\u9879",children:"2.1.5. \u9a71\u52a8\u4f9d\u8d56\u9879"}),"\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u6a21\u5757\u9a71\u52a8\u4f9d\u8d56 CMA \u548c DMA-BUF \u529f\u80fd\u3002"}),"\n",(0,r.jsx)(e.h5,{id:"2151-\u914d\u7f6ecma",children:"2.1.5.1. \u914d\u7f6eCMA"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make kernel-menuconfig\uff0c\u4f7f\u80fd CMA\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Memory Management options\n        [*] Contiguous Memory Allocator\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e CMA \u5185\u5b58\u533a\u57df\u7684\u5927\u5c0f\uff0c\u5728\u5185\u6838\u914d\u7f6e\u7684\u53e6\u4e00\u4e2a\u5730\u65b9\uff0c\u4ee5\u4e0b\u914d\u7f6e\u4e3a 12MB\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Library routines\n    [*] DMA Contiguous Memory Allocator\n    (12)  Size in Mega Bytes\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"CMA \u5185\u5b58\u533a\u57df\u65e0\u6cd5\u968f\u610f\u8bbe\u7f6e\u5927\u5c0f, Size \u9700\u8981 4M \u5bf9\u9f50\u3002"}),"\n",(0,r.jsx)(e.p,{children:"Linux \u542f\u52a8\u65f6\u4f1a\u5bf9 CMA size \u8fdb\u884c 4M \u5bf9\u9f50\uff0c\u5bf9\u9f50\u64cd\u4f5c\u4e0e CONFIG_FORCE_MAX_ZONEORDER \u8bbe\u7f6e\u76f8\u5173\u3002 ArtInChip \u5e73\u53f0\u4e0a\uff0c\u8be5\u914d\u7f6e\u4e3a 11\uff0c\u610f\u601d\u4e3a\u4e00\u6b21\u6700\u5927\u5206\u914d\u5185\u5b58\u4e3a 2^10 pages\uff0c\u5373 4M\u3002"}),"\n",(0,r.jsx)(e.h5,{id:"2152-\u4f7f\u80fd-dma-buf",children:"2.1.5.2. \u4f7f\u80fd DMA-BUF"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make kernel-menuconfig\uff0c\u8fdb\u5165 kernel \u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Device Drivers\n        DMABUF options\n            [*] Explicit Synchronization Framework\n            [*]   Sync File Validation Framework\n            [*] userspace dmabuf misc driver\n            [*] DMA-BUF Userland Memory Heaps\n                [*]   DMA-BUF CMA Heap\n"})}),"\n",(0,r.jsx)(e.h3,{id:"22-dts\u53c2\u6570\u914d\u7f6e",children:"2.2. DTS\u53c2\u6570\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h4,{id:"221-\u7cfb\u7edf\u53c2\u6570\u914d\u7f6e",children:"2.2.1. \u7cfb\u7edf\u53c2\u6570\u914d\u7f6e"}),"\n",(0,r.jsxs)(e.p,{children:["\u7cfb\u7edf\u53c2\u6570\u4e3b\u8981\u5728\u6587\u4ef6 ",(0,r.jsx)(e.code,{children:"target/d211/common/d211.dtsi"})," \u4e2d\u3002\u6a21\u5757\u7684\u7cfb\u7edf\u53c2\u6570\u968f IC \u7684\u8bbe\u5b9a\u800c\u5b9a\uff0c\u4e0d\u5efa\u8bae\u7528\u6237\u4fee\u6539\u6a21\u5757\u7cfb\u7edf\u53c2\u6570\u3002"]}),"\n",(0,r.jsx)(e.h5,{id:"2211-fb0",children:"2.2.1.1. fb0"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'display-fb {\n    compatible = "artinchip,aic-framebuffer";\n    #address-cells = <1>;\n    #size-cells = <0>;\n    fb0: fb@0 {\n        reg = <0x0 0x0>;\n    };\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"2212-display-engine",children:"2.2.1.2. display engine"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'de0: de@18a00000 {\n    #address-cells = <1>;\n    #size-cells = <0>;\n    compatible = "artinchip,aic-de-v1.0";\n    reg = <0x0 0x18a00000 0x0 0x1000>;\n    interrupts-extended = <&plic0 59 IRQ_TYPE_LEVEL_HIGH>;\n    clocks = <&cmu CLK_DE>, <&cmu CLK_PIX>;\n    clock-names = "de0", "pix";\n    resets = <&rst RESET_DE>;\n    reset-names = "de0";\n    mclk-rate = <200000000>;\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"2213-rgb-display-interface",children:"2.2.1.3. rgb display interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'rgb0: rgb@18800000 {\n    #address-cells = <1>;\n    #size-cells = <0>;\n    compatible = "artinchip,aic-rgb-v1.0";\n    reg = <0x0 0x18800000 0x0 0x1000>;\n    clocks = <&cmu CLK_RGB>, <&cmu CLK_SCLK>;\n    clock-names = "rgb0", "sclk";\n    resets = <&rst RESET_RGB>;\n    reset-names = "rgb0";\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"2214-lvds-display-interface",children:"2.2.1.4. lvds display interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'lvds0: lvds@18810000 {\n    #address-cells = <1>;\n    #size-cells = <0>;\n    compatible = "artinchip,aic-lvds-v1.0";\n    reg = <0x0 0x18810000 0x0 0x1000>;\n    clocks = <&cmu CLK_LVDS>, <&cmu CLK_SCLK>;\n    clock-names = "lvds0", "sclk";\n    resets = <&rst RESET_LVDS>;\n    reset-names = "lvds0";\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"2215-mipi-dsi-display-interface",children:"2.2.1.5. mipi-dsi display interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'dsi0: dsi@18820000 {\n    #address-cells = <1>;\n    #size-cells = <0>;\n    compatible = "artinchip,aic-mipi-dsi-v1.0";\n    reg = <0x0 0x18820000 0x0 0x1000>;\n    clocks = <&cmu CLK_MIPIDSI>, <&cmu CLK_SCLK>;\n    clock-names = "dsi0", "sclk";\n    resets = <&rst RESET_MIPIDSI>;\n    reset-names = "dsi0";\n    interrupts-extended = <&plic0 56 IRQ_TYPE_LEVEL_HIGH>;\n    data-lanes = <0 1 2 3>;\n    lane-polarities = <0 0 0 0>;\n};\n'})}),"\n",(0,r.jsx)(e.h4,{id:"222-\u529f\u80fd\u53c2\u6570\u914d\u7f6e",children:"2.2.2. \u529f\u80fd\u53c2\u6570\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u529f\u80fd\u53c2\u6570\u4e3b\u8981\u9488\u5bf9\u67d0\u4e00\u4e2a\u4f7f\u7528\u65b9\u6848\uff0c\u968f\u7740\u65b9\u6848\u7684\u6539\u53d8\uff0c\u53c2\u6570\u5f88\u53ef\u80fd\u4e0d\u540c\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e9b\u53c2\u6570\u4e3b\u8981\u5728\u6587\u4ef6 target/d211/\u65b9\u6848x/board.dts \u4e2d\uff0c\u529f\u80fd\u53c2\u6570\u7684\u8bbe\u7f6e\u5fc5\u987b\u548c\u786c\u4ef6\u539f\u7406\u56fe\u76f8\u5339\u914d\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u529f\u80fd\u53c2\u6570\u7684\u8bbe\u7f6e\u4ea6\u53ef\u53c2\u770b\u4ee5\u4e0b\u8def\u5f84\u7684\u5185\u6838\u6587\u6863\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"linux-5.10/Documentation/devicetree/bindings/display/artinchip/\n    artinchip-de.txt  artinchip-dsi.txt  artinchip-fb.txt  artinchip-lvds.txt  artinchip-panel.txt  artinchip-rgb.txt\n\nlinux-5.10/Documentation/devicetree/bindings/display/panel/artinchip/\n    panel-dsi.txt  panel-lvds.txt  panel-rgb.txt\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u529f\u80fd\u53c2\u6570\u4e4b\u95f4\u4f1a\u6784\u6210\u4e00\u6761\u5b8c\u6574\u7684\u6570\u636e\u94fe\u8def\uff0c\u5982\u4f55\u8bbe\u7f6e\u53ef\u67e5\u770b ",(0,r.jsx)(e.a,{href:"../../06_panel_port/index.html#ref-to-panel-port",children:"\u5c4f\u914d\u7f6e\u6307\u5357"})," \u76f8\u5173\u7ae0\u8282\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/* The data flow:\n* fb ---\x3e de ----\x3e di ----\x3e panel\n*              {-> lvds ->}\n*              |-> rgb  ->|\n*              '-> dsi  ->'\n*/\n"})}),"\n",(0,r.jsx)(e.h5,{id:"2221-panel",children:"2.2.2.1. Panel"}),"\n",(0,r.jsx)(e.h6,{id:"22211-panel-rgb",children:"2.2.2.1.1. panel rgb"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'panel_rgb {\n    compatible = "artinchip,aic-general-rgb-panel";\n    status = "okay";\n\n    rgb-mode = <PRGB>;\n    interface-format = <PRGB_24BIT>;\n    clock-phase = <DEGREE_0>;\n    data-order = <RGB>;\n    backlight = <&backlight>;\n    // enable-gpios = <&gpio_a 4 GPIO_ACTIVE_HIGH>;\n\n    port {\n        panel_rgb_in: endpoint {\n            remote-endpoint = <&rgb0_out>;\n        };\n    };\n\n    display-timings {\n        native-mode = <&timing0>;\n        timing0: 1024x600 {\n            clock-frequency = <45000000>;\n            hactive = <1024>;\n            vactive = <600>;\n            hback-porch = <140>;\n            hfront-porch = <160>;\n            hsync-len = <20>;\n            vback-porch = <12>;\n            vfront-porch = <20>;\n            vsync-len = <3>;\n            de-active = <1>;\n            pixelclk-active = <1>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6ce8\u89e3"}),"\n",(0,r.jsx)(e.p,{children:"\u76f8\u5173\u5b8f\u5b9a\u4e49\u53d6\u503c\u5728\u6587\u4ef6 include/dt-bindings/display/artinchip,aic-disp.h \u4e2d"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Required properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u8fde\u63a5\u5230 RGB \u663e\u793a\u63a5\u53e3\u7684\u8f93\u5165\u7aef\u53e3\uff0c\u5c06 panel_rgb \u7ed3\u70b9\u4e0e rgb \u7ed3\u70b9\u5173\u8054\u8d77\u6765\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Optional properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"rgb-mode"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u8bbe\u7f6e RGB \u663e\u793a\u63a5\u53e3\u7684\u8f93\u51fa\u6a21\u5f0f\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u5e76\u884c RGB\u3001\u4e32\u884c RGB\u3001I8080\u3001SPI\u3002\u9ed8\u8ba4\u4e3a\u5e76\u884c RGB \u6a21\u5f0f"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"rgb-mode"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u5e76\u884cRGB"}),(0,r.jsx)(e.td,{children:"PRGB"}),(0,r.jsx)(e.td,{children:"0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u4e32\u884cRGB"}),(0,r.jsx)(e.td,{children:"SRGB"}),(0,r.jsx)(e.td,{children:"1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"I8080"}),(0,r.jsx)(e.td,{children:"I8080"}),(0,r.jsx)(e.td,{children:"2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SPI"}),(0,r.jsx)(e.td,{children:"SPI"}),(0,r.jsx)(e.td,{children:"3"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"interface-format"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u8bbe\u7f6e RGB \u663e\u793a\u63a5\u53e3\u7684\u8f93\u51fa\u683c\u5f0f\uff0c\u9ed8\u8ba4\u8f93\u51fa\u5e76\u884c RGB 24-bit\u3002"}),"\n",(0,r.jsx)(e.p,{children:"PRGB \u7684 18bit/16bit \u517c\u5bb9 2 \u79cd\u8f93\u51fa\u6a21\u5f0f\uff0c\u53ef\u6839\u636e\u4e0d\u540c\u7684\u5c01\u88c5\u6216\u8d70\u7ebf\u9700\u6c42\u8fdb\u884c\u9009\u62e9\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"PRGB_18BIT_LD \u8868\u793a\u5c06 24 \u4e2a pin \u4e2d\u6700\u4f4e\u4f4d\u7684 6 \u4e2a pin \u4e22\u5f03"}),"\n",(0,r.jsx)(e.li,{children:"PRGB_18BIT_HD \u8868\u793a\u5c06 24 \u4e2a pin \u4e2d\u6700\u9ad8\u4f4d\u7684 6 \u4e2a pin \u4e22\u5f03"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"16 bit \u6a21\u5f0f\u540c\u7406\uff0c\u4e22\u5f03 24 \u4e2a pin \u4e2d\u7684 8 \u4e2a\uff0c\u8be6\u60c5\u53ef\u53c2\u8003\u82af\u7247\u6570\u636e\u624b\u518c\u4e2d LCD \u7ae0\u8282\u4e2d\u7684\u529f\u80fd\u63cf\u8ff0\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"mode"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"PRGB"}),(0,r.jsx)(e.td,{children:"PRGB_24BIT"}),(0,r.jsx)(e.td,{children:"0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"PRGB_18BIT_LD"}),(0,r.jsx)(e.td,{children:"1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"PRGB_18BIT_HD"}),(0,r.jsx)(e.td,{children:"2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"PRGB_16BIT_LD"}),(0,r.jsx)(e.td,{children:"3"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"PRGB_16BIT_HD"}),(0,r.jsx)(e.td,{children:"4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SRGB"}),(0,r.jsx)(e.td,{children:"SRGB_8BIT"}),(0,r.jsx)(e.td,{children:"0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SRGB_6BIT"}),(0,r.jsx)(e.td,{children:"1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"I8080"}),(0,r.jsx)(e.td,{children:"I8080_RGB565_8BIT"}),(0,r.jsx)(e.td,{children:"0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB666_8BIT"}),(0,r.jsx)(e.td,{children:"1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB666_9BIT"}),(0,r.jsx)(e.td,{children:"2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB666_16BIT_3CYCLE"}),(0,r.jsx)(e.td,{children:"3"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB666_16BIT_2CYCLE"}),(0,r.jsx)(e.td,{children:"4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB565_16BIT"}),(0,r.jsx)(e.td,{children:"5"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB666_18BIT"}),(0,r.jsx)(e.td,{children:"6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"I8080_RGB888_24BIT"}),(0,r.jsx)(e.td,{children:"7"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"SPI"}),(0,r.jsx)(e.td,{children:"SPI_3LINE_RGB565"}),(0,r.jsx)(e.td,{children:"0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_3LINE_RGB666"}),(0,r.jsx)(e.td,{children:"1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_3LINE_RGB888"}),(0,r.jsx)(e.td,{children:"2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_4LINE_RGB565"}),(0,r.jsx)(e.td,{children:"3"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_4LINE_RGB666"}),(0,r.jsx)(e.td,{children:"4"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_4LINE_RGB888"}),(0,r.jsx)(e.td,{children:"5"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_4SDA_RGB565"}),(0,r.jsx)(e.td,{children:"6"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_4SDA_RGB666"}),(0,r.jsx)(e.td,{children:"7"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{}),(0,r.jsx)(e.td,{children:"SPI_4SDA_RGB888"}),(0,r.jsx)(e.td,{children:"8"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"clock-phase"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"pixel\u65f6\u949f\u8f93\u51fa\u76f8\u4f4d\u9009\u62e9, \u5141\u8bb8\u8bbe\u7f6e\u65f6\u949f\u4e0a\u5347\u6cbf\u5ef6\u540e\u6570\u636e 0\xb0/90\xb0/180\xb0/270\xb0 \u76f8\u4f4d\u3002 \u9ed8\u8ba4\u4e3a 0\xb0"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"degress"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"0\xb0"}),(0,r.jsx)(e.td,{children:"DEGREE_0"}),(0,r.jsx)(e.td,{children:"0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"90\xb0"}),(0,r.jsx)(e.td,{children:"DEGREE_90"}),(0,r.jsx)(e.td,{children:"1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"180\xb0"}),(0,r.jsx)(e.td,{children:"DEGREE_180"}),(0,r.jsx)(e.td,{children:"2"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"270\xb0"}),(0,r.jsx)(e.td,{children:"DEGREE_270"}),(0,r.jsx)(e.td,{children:"3"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"data-order"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"RGB \u6570\u636e\u7684\u8f93\u51fa\u987a\u5e8f\uff0cR/G/B \u4e09\u7ec4\u4fe1\u53f7\u53ef\u6309\u4efb\u610f\u987a\u5e8f\u8f93\u51fa\u3002\u9ed8\u8ba4\u4e3a RGB \u987a\u5e8f\u8f93\u51fa\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u6570\u636e\u8f93\u51fa\u987a\u5e8f"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB"}),(0,r.jsx)(e.td,{children:"RGB"}),(0,r.jsx)(e.td,{children:"0x02100210"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RBG"}),(0,r.jsx)(e.td,{children:"RBG"}),(0,r.jsx)(e.td,{children:"0x02010201"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"BGR"}),(0,r.jsx)(e.td,{children:"BGR"}),(0,r.jsx)(e.td,{children:"0x00120012"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"BRG"}),(0,r.jsx)(e.td,{children:"BRG"}),(0,r.jsx)(e.td,{children:"0x00210021"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"GRB"}),(0,r.jsx)(e.td,{children:"GRB"}),(0,r.jsx)(e.td,{children:"0x01200120"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"GBR"}),(0,r.jsx)(e.td,{children:"GBR"}),(0,r.jsx)(e.td,{children:"0x01020102"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"data-mirror"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5e03\u5c14\u578b\u53c2\u6570\uff0c\u63a7\u5236 RGB \u6570\u636e\u7ec4\u5185\u5927\u5c0f\u7aef\u8f93\u51fa\u3002\u9ed8\u8ba4\u8f93\u51fa\u4f4e\u4f4d\u5230\u9ad8\u4f4d 0 - 7\u3002\u5982\u679c\u8bbe\u7f6e\u5219\u8f93\u51fa\u53d8\u4e3a 7 - 0"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-dither"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u989c\u8272\u8f93\u51fa\u6df1\u5ea6\u63a7\u5236\uff0c\u4f7f\u56fe\u50cf\u8fc7\u5ea6\u66f4\u5e73\u6ed1\u3002\u5f53\u5185\u5b58\u6570\u636e\u4e3a 8bit \uff0c\u4f46\u8f93\u51fa\u4e3a 6bit \u6216\u8005 5bit \u65f6\uff0c\u4f7f\u80fd dither \u80fd\u8ba9\u56fe\u50cf\u8fc7\u5ea6\u66f4\u5e73\u6ed1\uff0c\u5426\u5219\u76f4\u63a5\u4e22\u5f03\u4f4e\u4f4d bit\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e dither \u65f6\u9ed8\u8ba4\u4f7f\u80fd\u968f\u673a dither \uff0c\u83b7\u53d6\u66f4\u597d\u7684\u663e\u793a\u6548\u679c\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u989c\u8272\u8f93\u51fa\u6df1\u5ea6"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"R \u5206\u91cf\u8f93\u51fa 5bitG \u5206\u91cf\u8f93\u51fa 6bitB \u5206\u91cf\u8f93\u51fa 5bit"}),(0,r.jsx)(e.td,{children:"DITHER_RGB565"}),(0,r.jsx)(e.td,{children:"0x1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"R \u5206\u91cf\u8f93\u51fa 6bitG \u5206\u91cf\u8f93\u51fa 6bitB \u5206\u91cf\u8f93\u51fa 6bit"}),(0,r.jsx)(e.td,{children:"DITHER_RGB666"}),(0,r.jsx)(e.td,{children:"0x2"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"tearing-effect"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u4fe1\u53f7\u54cd\u5e94\u6a21\u5f0f\uff0c\u914d\u5408\u5c4f\u5e55 TE \u4fe1\u53f7\u4f7f\u7528\uff0c\u63a7\u5236 DE \u6a21\u5757\u7684\u8f93\u51fa\uff0c\u907f\u514d LCD \u5c4f\u5e55\u51fa\u73b0\u6495\u88c2\u73b0\u8c61\u3002"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u8fde\u7eed\u5237\u65b0 (default) \uff1a\u5ffd\u7565 TE \u4fe1\u53f7, \u8fde\u7eed\u5237\u65b0"}),"\n",(0,r.jsx)(e.li,{children:"\u624b\u52a8\u5237\u65b0\uff1aDE timging enable \u540e\u5728\u4e0b\u4e00\u4e2a TE \u4fe1\u53f7\u66f4\u65b0\u753b\u9762"}),"\n",(0,r.jsx)(e.li,{children:"\u81ea\u52a8\u5237\u65b0\uff1a \u6bcf\u6536\u5230\u4e00\u4e2a TE \u4fe1\u53f7\uff0c\u81ea\u52a8\u66f4\u65b0\u753b\u9762\uff0c\u66f4\u65b0\u671f\u95f4\u5ffd\u7565 TE \u4fe1\u53f7"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u5237\u65b0\u548c\u81ea\u52a8\u5237\u65b0\u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u8bbe\u5b9a TE \u8109\u51b2\u5bbd\u5ea6\uff0c\u7528\u4e8e\u68c0\u6d4b\u5c4f\u5e55 TE \u4fe1\u53f7\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"TE mode"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fde\u7eed\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_BYPASS"}),(0,r.jsx)(e.td,{children:"0x0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u624b\u52a8\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_HOLD"}),(0,r.jsx)(e.td,{children:"0x1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u81ea\u52a8\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_AUTO"}),(0,r.jsx)(e.td,{children:"0x2"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"te-pulse-width"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u8109\u51b2\u5bbd\u5ea6\uff0c\u7528\u4e8e\u68c0\u6d4b TE \u540c\u6b65\u4fe1\u53f7\u7684\u6709\u6548\u72b6\u6001\uff0c\u5efa\u8bae\u8bbe\u4e3a5\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"enable-gpios"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u9884\u7559\u7684\u5c4f\u5e55\u4f7f\u80fd\u5f15\u811a\uff0c\u53ef\u7528\u4e8e\u63a7\u5236\u5c4f\u5e55\u4f9b\u7535\uff0c\u4e0d\u4f7f\u7528 pwm-backlight \u7684\u60c5\u51b5\u4e0b\u4ea6\u53ef\u63a7\u5236\u5c4f\u5e55\u80cc\u5149\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"backlight"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c4f\u5e55\u7684 pwm-backlight \u914d\u7f6e\u8282\u70b9\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"display-timings"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c4f\u7684\u65f6\u5e8f\u4fe1\u53f7\u3002\u7531\u5c4f\u5382\u63d0\u4f9b\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h6,{id:"22212-panel-lvds",children:"2.2.2.1.2. panel lvds"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'panel_lvds {\n    compatible = "artinchip,aic-general-lvds-panel";\n    data-mapping = "vesa-24";\n    data-channel = "single-link1";\n    backlight = <&backlight>;\n    // enable-gpios = <&gpio_a 4 GPIO_ACTIVE_HIGH>;\n    status = "okay";\n\n    port {\n        panel_lvds_in: endpoint {\n            remote-endpoint = <&lvds0_out>;\n        };\n    };\n\n    display-timings {\n        native-mode = <&timing1>;\n        timing1: 1024x600 {\n            clock-frequency = <60000000>;\n            hactive = <1024>;\n            vactive = <600>;\n            hback-porch = <140>;\n            hfront-porch = <160>;\n            hsync-len = <20>;\n            vback-porch = <20>;\n            vfront-porch = <12>;\n            vsync-len = <3>;\n            de-active = <1>;\n            pixelclk-active = <1>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Required properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u8fde\u63a5\u5230LVDS\u663e\u793a\u63a5\u53e3\u7684\u8f93\u5165\u7aef\u53e3\uff0c\u5c06panel_lvds\u7ed3\u70b9\u4e0elvds\u7ed3\u70b9\u5173\u8054\u8d77\u6765\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"data-mapping"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"lvds \u6a21\u5f0f\u8bbe\u7f6e\uff0c\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u9ed8\u8ba4\u8f93\u51fa\u4e3a\u201dvesa-24\u201d"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"lvds mode"}),(0,r.jsx)(e.th,{children:"strings"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"NS"}),(0,r.jsx)(e.td,{children:"\u201cvesa-24\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"JEIDA 8 bit"}),(0,r.jsx)(e.td,{children:"\u201cjeida-24\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"JEIDA 6 bit"}),(0,r.jsx)(e.td,{children:"\u201cjeida-18\u201d"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"data-channel"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"lvds link \u8bbe\u7f6e\uff0c\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u9ed8\u8ba4\u8f93\u51fa\u201dlvds-link0\u201d\uff0c\u5355link\u8f93\u51fa\uff0clink0\u901a\u9053\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"lvds link mode"}),(0,r.jsx)(e.th,{children:"strings"}),(0,r.jsx)(e.th,{children:"\u5907\u6ce8"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u5355Link\u6a21\u5f0f0"}),(0,r.jsx)(e.td,{children:"\u201csingle-link0\u201d"}),(0,r.jsx)(e.td,{children:"\u5355link\u8f93\u51fa\uff0c\u8f93\u51fa\u9009\u62e9link0\u901a\u9053"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u5355Link\u6a21\u5f0f1"}),(0,r.jsx)(e.td,{children:"\u201csingle-link1\u201d"}),(0,r.jsx)(e.td,{children:"\u5355link\u8f93\u51fa\uff0c\u8f93\u51fa\u9009\u62e9link1\u901a\u9053"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u5355Link\u6a21\u5f0f2"}),(0,r.jsx)(e.td,{children:"\u201cdouble-screen\u201d"}),(0,r.jsx)(e.td,{children:"\u5355link\u8f93\u51fa\uff0clink0 \u548c link1 \u540c\u65f6\u8f93\u51fa\uff0c\u53ef\u9a71\u52a8\u53cc\u5c4f\u540c\u663e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53ccLink\u6a21\u5f0f"}),(0,r.jsx)(e.td,{children:"\u201cdual-link\u201d"}),(0,r.jsx)(e.td,{children:"dual link\u8f93\u51fa\uff0c\u5947\u5076\u50cf\u7d20\u540c\u65f6\u8f93\u51fa"})]})]})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Optional properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-dither"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u989c\u8272\u8f93\u51fa\u6df1\u5ea6\u63a7\u5236\uff0c\u4f7f\u56fe\u50cf\u8fc7\u5ea6\u66f4\u5e73\u6ed1\u3002\u5f53\u5185\u5b58\u6570\u636e\u4e3a 8bit \uff0c\u4f46\u8f93\u51fa\u4e3a 6bit \u6216\u8005 5bit \u65f6\uff0c\u4f7f\u80fd dither \u80fd\u8ba9\u56fe\u50cf\u8fc7\u5ea6\u66f4\u5e73\u6ed1\uff0c\u5426\u5219\u76f4\u63a5\u4e22\u5f03\u4f4e\u4f4d bit\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e dither \u65f6\u9ed8\u8ba4\u4f7f\u80fd\u968f\u673a dither \uff0c\u83b7\u53d6\u66f4\u597d\u7684\u663e\u793a\u6548\u679c\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u989c\u8272\u8f93\u51fa\u6df1\u5ea6"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"R \u5206\u91cf\u8f93\u51fa 5bitG \u5206\u91cf\u8f93\u51fa 6bitB \u5206\u91cf\u8f93\u51fa 5bit"}),(0,r.jsx)(e.td,{children:"DITHER_RGB565"}),(0,r.jsx)(e.td,{children:"0x1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"R \u5206\u91cf\u8f93\u51fa 6bitG \u5206\u91cf\u8f93\u51fa 6bitB \u5206\u91cf\u8f93\u51fa 6bit"}),(0,r.jsx)(e.td,{children:"DITHER_RGB666"}),(0,r.jsx)(e.td,{children:"0x2"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"tearing-effect"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u4fe1\u53f7\u54cd\u5e94\u6a21\u5f0f\uff0c\u914d\u5408\u5c4f\u5e55 TE \u4fe1\u53f7\u4f7f\u7528\uff0c\u63a7\u5236 DE \u6a21\u5757\u7684\u8f93\u51fa\uff0c\u907f\u514d LCD \u5c4f\u5e55\u51fa\u73b0\u6495\u88c2\u73b0\u8c61\u3002"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u8fde\u7eed\u5237\u65b0 (default) \uff1a\u5ffd\u7565 TE \u4fe1\u53f7, \u8fde\u7eed\u5237\u65b0"}),"\n",(0,r.jsx)(e.li,{children:"\u624b\u52a8\u5237\u65b0\uff1aDE timging enable \u540e\u5728\u4e0b\u4e00\u4e2a TE \u4fe1\u53f7\u66f4\u65b0\u753b\u9762"}),"\n",(0,r.jsx)(e.li,{children:"\u81ea\u52a8\u5237\u65b0\uff1a \u6bcf\u6536\u5230\u4e00\u4e2a TE \u4fe1\u53f7\uff0c\u81ea\u52a8\u66f4\u65b0\u753b\u9762\uff0c\u66f4\u65b0\u671f\u95f4\u5ffd\u7565 TE \u4fe1\u53f7"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u5237\u65b0\u548c\u81ea\u52a8\u5237\u65b0\u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u8bbe\u5b9a TE \u8109\u51b2\u5bbd\u5ea6\uff0c\u7528\u4e8e\u68c0\u6d4b\u5c4f\u5e55 TE \u4fe1\u53f7\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"TE mode"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fde\u7eed\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_BYPASS"}),(0,r.jsx)(e.td,{children:"0x0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u624b\u52a8\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_HOLD"}),(0,r.jsx)(e.td,{children:"0x1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u81ea\u52a8\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_AUTO"}),(0,r.jsx)(e.td,{children:"0x2"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"te-pulse-width"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u8109\u51b2\u5bbd\u5ea6\uff0c\u7528\u4e8e\u68c0\u6d4b TE \u540c\u6b65\u4fe1\u53f7\u7684\u6709\u6548\u72b6\u6001\uff0c\u5efa\u8bae\u8bbe\u4e3a5\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"enable-gpios"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u9884\u7559\u7684\u5c4f\u5e55\u4f7f\u80fd\u5f15\u811a\uff0c\u53ef\u7528\u4e8e\u63a7\u5236\u5c4f\u5e55\u4f9b\u7535\uff0c\u4e0d\u4f7f\u7528 pwm-backlight \u7684\u60c5\u51b5\u4e0b\u4ea6\u53ef\u63a7\u5236\u5c4f\u5e55\u80cc\u5149\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"backlight"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c4f\u5e55\u7684 pwm-backlight \u914d\u7f6e\u8282\u70b9\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"display-timings"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c4f\u7684\u65f6\u5e8f\u4fe1\u53f7\u3002\u7531\u5c4f\u5382\u63d0\u4f9b\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h6,{id:"22213-panel-dsi",children:"2.2.2.1.3. panel dsi"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'panel_dsi {\n    compatible = "artinchip,aic-dsi-panel-simple";\n    backlight = <&backlight>;\n    // enable-gpios = <&gpio_a 4 GPIO_ACTIVE_HIGH>;\n    status = "okay";\n\n    port {\n        panel_dsi_in: endpoint {\n            remote-endpoint = <&dsi0_out>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Required properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u8fde\u63a5\u5230MIPI-DSI\u663e\u793a\u63a5\u53e3\u7684\u8f93\u5165\u7aef\u53e3\uff0c\u5c06panel_dsi\u7ed3\u70b9\u4e0edsi\u7ed3\u70b9\u5173\u8054\u8d77\u6765\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Optional properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"dsi,mode"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"dsi\u6a21\u5f0f\u8bbe\u7f6e\uff0c\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u652f\u6301video \u4e0e command \u4e24\u79cd\u6a21\u5f0f\u3002Video\u6a21\u5f0f\u652f\u6301Non-burst\u548cBurst\u4e24\u79cd\u65b9\u5f0f\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"dsi mode"}),(0,r.jsx)(e.th,{children:"strings"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"video pulse mode"}),(0,r.jsx)(e.td,{children:"\u201cvideo-pulse\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"video event mode"}),(0,r.jsx)(e.td,{children:"\u201cvideo-event\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"video burst mode"}),(0,r.jsx)(e.td,{children:"\u201cvideo-burst\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"command mode"}),(0,r.jsx)(e.td,{children:"\u201ccommand-mode\u201d"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"dsi,format"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"dsi \u663e\u793a\u63a5\u53e3\u8f93\u51fa\u683c\u5f0f\u3002\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u652f\u6301RGB888\uff0cRGB666\uff0cRGB666 packed\uff0cRGB565"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"dsi outout format"}),(0,r.jsx)(e.th,{children:"strings"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB888"}),(0,r.jsx)(e.td,{children:"\u201crgb888\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB666"}),(0,r.jsx)(e.td,{children:"\u201crgb666\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB666 packed"}),(0,r.jsx)(e.td,{children:"\u201crgb666l\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB565"}),(0,r.jsx)(e.td,{children:"\u201crgb565\u201d"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"dsi,lane_num"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u901a\u8def\u6570\u91cf\uff0c\u6574\u578b\uff0c\u53d6\u503c 1 ~ 4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-dither"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u989c\u8272\u8f93\u51fa\u6df1\u5ea6\u63a7\u5236\uff0c\u4f7f\u56fe\u50cf\u8fc7\u5ea6\u66f4\u5e73\u6ed1\u3002\u5f53\u5185\u5b58\u6570\u636e\u4e3a 8bit \uff0c\u4f46\u8f93\u51fa\u4e3a 6bit \u6216\u8005 5bit \u65f6\uff0c\u4f7f\u80fd dither \u80fd\u8ba9\u56fe\u50cf\u8fc7\u5ea6\u66f4\u5e73\u6ed1\uff0c\u5426\u5219\u76f4\u63a5\u4e22\u5f03\u4f4e\u4f4d bit\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e dither \u65f6\u9ed8\u8ba4\u4f7f\u80fd\u968f\u673a dither \uff0c\u83b7\u53d6\u66f4\u597d\u7684\u663e\u793a\u6548\u679c\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u989c\u8272\u8f93\u51fa\u6df1\u5ea6"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"R \u5206\u91cf\u8f93\u51fa 5bitG \u5206\u91cf\u8f93\u51fa 6bitB \u5206\u91cf\u8f93\u51fa 5bit"}),(0,r.jsx)(e.td,{children:"DITHER_RGB565"}),(0,r.jsx)(e.td,{children:"0x1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"R \u5206\u91cf\u8f93\u51fa 6bitG \u5206\u91cf\u8f93\u51fa 6bitB \u5206\u91cf\u8f93\u51fa 6bit"}),(0,r.jsx)(e.td,{children:"DITHER_RGB666"}),(0,r.jsx)(e.td,{children:"0x2"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"tearing-effect"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u4fe1\u53f7\u54cd\u5e94\u6a21\u5f0f\uff0c\u914d\u5408\u5c4f\u5e55 TE \u4fe1\u53f7\u4f7f\u7528\uff0c\u63a7\u5236 DE \u6a21\u5757\u7684\u8f93\u51fa\uff0c\u907f\u514d LCD \u5c4f\u5e55\u51fa\u73b0\u6495\u88c2\u73b0\u8c61\u3002"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u8fde\u7eed\u5237\u65b0 (default) \uff1a\u5ffd\u7565 TE \u4fe1\u53f7, \u8fde\u7eed\u5237\u65b0"}),"\n",(0,r.jsx)(e.li,{children:"\u624b\u52a8\u5237\u65b0\uff1aDE timging enable \u540e\u5728\u4e0b\u4e00\u4e2a TE \u4fe1\u53f7\u66f4\u65b0\u753b\u9762"}),"\n",(0,r.jsx)(e.li,{children:"\u81ea\u52a8\u5237\u65b0\uff1a\u6bcf\u6536\u5230\u4e00\u4e2a TE \u4fe1\u53f7\uff0c\u81ea\u52a8\u66f4\u65b0\u753b\u9762\uff0c\u66f4\u65b0\u671f\u95f4\u5ffd\u7565 TE \u4fe1\u53f7"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u5237\u65b0\u548c\u81ea\u52a8\u5237\u65b0\u6a21\u5f0f\u4e0b\uff0c\u9700\u8981\u8bbe\u5b9a TE \u8109\u51b2\u5bbd\u5ea6\uff0c\u7528\u4e8e\u68c0\u6d4b\u5c4f\u5e55 TE \u4fe1\u53f7\u3002"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"TE mode"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fde\u7eed\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_BYPASS"}),(0,r.jsx)(e.td,{children:"0x0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u624b\u52a8\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_HOLD"}),(0,r.jsx)(e.td,{children:"0x1"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u81ea\u52a8\u5237\u65b0"}),(0,r.jsx)(e.td,{children:"TE_AUTO"}),(0,r.jsx)(e.td,{children:"0x2"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"te-pulse-width"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u8109\u51b2\u5bbd\u5ea6\uff0c\u7528\u4e8e\u68c0\u6d4b TE \u540c\u6b65\u4fe1\u53f7\u7684\u6709\u6548\u72b6\u6001\uff0c\u5efa\u8bae\u8bbe\u4e3a5\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"enable-gpios"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u9884\u7559\u7684\u5c4f\u5e55\u4f7f\u80fd\u5f15\u811a\uff0c\u53ef\u7528\u4e8e\u63a7\u5236\u5c4f\u5e55\u4f9b\u7535\uff0c\u4e0d\u4f7f\u7528 pwm-backlight \u7684\u60c5\u51b5\u4e0b\u4ea6\u53ef\u63a7\u5236\u5c4f\u5e55\u80cc\u5149\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"backlight"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c4f\u5e55\u7684 pwm-backlight \u914d\u7f6e\u8282\u70b9\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"display-timings"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c4f\u7684\u65f6\u5e8f\u4fe1\u53f7\u3002\u7531\u5c4f\u5382\u63d0\u4f9b\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h5,{id:"2222-backlight",children:"2.2.2.2. backlight"}),"\n",(0,r.jsx)(e.h6,{id:"22221-pwm-backlight",children:"2.2.2.2.1. pwm-backlight"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'panel_rgb {\n    ...\n    backlight = <&backlight>;\n\n}\n\nbacklight: backlight {\n    compatible = "pwm-backlight";\n    /* pwm node name; pwm device No.; period_ns; pwm_polarity */\n    pwms = <&pwm 2 1000000 0>;\n    brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;\n    default-brightness-level = <8>;\n    status = "okay";\n};\n\n&pwm {\n    status = "okay";\n    pinctrl-names = "default";\n    pinctrl-0 = <&pwm2_pins_b>;\n    /* mode: up-count, down-count, up-down-count\n       action: none, low, high, inverse */\n\n    pwm2 {\n        aic,mode = "up-count";\n        aic,tb-clk-rate = <24000000>;\n        /*            CBD,    CBU,    CAD,    CAU,    PRD,   ZRO */\n        aic,action0 = "none", "none", "none", "high", "low", "none";\n        aic,action1 = "none", "none", "none", "low", "high", "none";\n        aic,default-level = <0>;\n        aic,rise-edge-delay = <10>;\n        aic,fall-edge-delay = <10>;\n        status = "okay";\n    };\n\n};\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u80cc\u5149\u63a7\u5236\u4f9d\u8d56 PWM \u6a21\u5757\uff0c\u8be6\u7ec6\u914d\u7f6e\u53ef\u53c2\u8003 PWM \u4f7f\u7528\u6307\u5357\u3002"}),"\n",(0,r.jsx)(e.h5,{id:"2223-display-interface",children:"2.2.2.3. Display Interface"}),"\n",(0,r.jsx)(e.h6,{id:"22231-rgb-display-interface",children:"2.2.2.3.1. RGB Display Interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&rgb0 {\n    pinctrl-names = "default";\n    pinctrl-0 = <&lcd_pins>;\n    status = "okay";\n\n    port@0 {\n        reg = <0>;\n        rgb0_in: endpoint {\n            remote-endpoint = <&de0_out>;\n        };\n    };\n\n    port@1 {\n        reg = <1>;\n        rgb0_out: endpoint {\n            remote-endpoint = <&panel_rgb_in>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pinctrl-names"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"SDK\u4e00\u822c\u4f1a\u628a\u8981\u4f7f\u7528\u7684\u67d0\u4e00\u529f\u80fd\u7684\u7aef\u53e3\u7ec4\u9884\u5148\u5b9a\u4e49\uff0c\u540e\u671f\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0c\u5b9a\u4e49\u4e00\u822c\u653e\u5728target/aicxxx/common/aicxxx-pinctrl.dtsi\u6587\u4ef6\u4e2d\uff0c\u76ee\u524d\u201cpinctrl-names\u201d \u5747\u8bbe\u7f6e\u4e3a\u201cdefault\u201d \u5373\u53ef"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pinctrl-0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5373\u6307\u793argb\u663e\u793a\u63a5\u53e3\u9884\u5148\u5b9a\u4e49\u7684\u7aef\u53e3\u7ec4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u5165\u7aef\u53e3\uff0c\u8fde\u63a5 display engine \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@1"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u51fa\u7aef\u53e3\uff0c\u8fde\u63a5 panel rgb \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h6,{id:"22232-lvds-display-interface",children:"2.2.2.3.2. LVDS Display Interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&lvds0 {\n    pinctrl-names = "default";\n    pinctrl-0 = <&lvds0_pins>;\n    lines = <0x43210>;\n    link-swap = <0>;\n    status = "okay";\n\n    port@0 {\n        reg = <0>;\n        lvds0_in: endpoint {\n            remote-endpoint = <&de0_out>;\n        };\n    };\n\n    port@1 {\n        reg = <1>;\n        lvds0_out: endpoint {\n            remote-endpoint = <&panel_lvds_in>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pinctrl-names"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"SDK\u4e00\u822c\u4f1a\u628a\u8981\u4f7f\u7528\u7684\u67d0\u4e00\u529f\u80fd\u7684\u7aef\u53e3\u7ec4\u9884\u5148\u5b9a\u4e49\uff0c\u540e\u671f\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0c\u5b9a\u4e49\u4e00\u822c\u653e\u5728target/aicxxx/common/aicxxx-pinctrl.dtsi\u6587\u4ef6\u4e2d\uff0c\u76ee\u524d\u201cpinctrl-names\u201d \u5747\u8bbe\u7f6e\u4e3a\u201cdefault\u201d \u5373\u53ef"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pinctrl-0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5373\u6307\u793alvds\u663e\u793a\u63a5\u53e3\u9884\u5148\u5b9a\u4e49\u7684\u7aef\u53e3\u7ec4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u5165\u7aef\u53e3\uff0c\u8fde\u63a5 display engine \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@1"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u51fa\u7aef\u53e3\uff0c\u8fde\u63a5 panel lvds \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Optional:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"link-swap"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6574\u578b\uff0clink0 \u4e0e link1 \u6574\u7ec4\u4ea4\u6362"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"lines"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6574\u578b\uff0c\u63a7\u5236 lvds link \u5185\u90e8 5 \u4e2a\u901a\u9053\u7684\u5dee\u5206\u4fe1\u53f7\u8f93\u51fa\uff0c\u5141\u8bb8 5 \u5bf9\u5dee\u5206\u4fe1\u53f7\u4efb\u610f\u4e92\u6362"}),"\n",(0,r.jsx)(e.p,{children:"5 \u4e2a\u901a\u9053\u5206\u522b\u4e3a D3 CK D2 D1 D0\uff0c\u7f3a\u7701\u503c\u4e3a\uff1a0x43210"}),"\n",(0,r.jsx)(e.p,{children:"0x43210 \u8868\u793a D3 \u901a\u9053\u8f93\u51fa D3\uff0cCK \u901a\u9053\u8f93\u51fa CK\uff0cD2 \u901a\u9053\u8f93\u51fa D2\uff0cD1 \u901a\u9053\u8f93\u51fa D1\uff0cD0 \u901a\u9053\u8f93\u51fa D0"}),"\n",(0,r.jsx)(e.p,{children:"0x01234 \u8868\u793a D3 \u901a\u9053\u8f93\u51fa D0\uff0cCK \u901a\u9053\u8f93\u51fa D1\uff0cD2 \u901a\u9053\u8f93\u51fa D2\uff0cD1 \u901a\u9053\u8f93\u51fa CK\uff0cD0 \u901a\u9053\u8f93\u51fa D3"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pols"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6574\u578b\uff0cLVDS\u5dee\u5206\u4fe1\u53f7\u6781\u6027\u63a7\u5236\u3002\u4f4e 5 bit \u5206\u522b\u63a7\u5236 LVDS \u4e94\u4e2a\u901a\u9053\u5dee\u5206\u4fe1\u53f7\u7684\u6781\u6027\u3002\u901a\u9053\u987a\u5e8f\u4e3a D3 CK D2 D1 D0"}),"\n",(0,r.jsx)(e.p,{children:"0x3 \u8868\u793a D1 D0 \u901a\u9053\u6781\u6027\u53cd\u76f8\uff0c0x8 \u8868\u793a CK \u901a\u9053\u53cd\u76f8"}),"\n",(0,r.jsx)(e.p,{children:"pols \u5c5e\u6027\u53d7 lines \u5c5e\u6027\u5f71\u54cd\uff0c\u5982\u679c CK \u901a\u9053\u9009\u62e9\u8f93\u51fa D0\uff0c\u5219\u8be5 bit \u63a7\u5236 D0 \u76f8\u4f4d\uff0c0x8 \u8868\u793a D0 \u53cd\u76f8"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"sync-ctrl"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5e03\u5c14\u578b\uff0c\u540c\u6b65\u524d\u7aef\u4fe1\u53f7\u6a21\u5f0f\uff0c\u9ed8\u8ba4\u5f00\u542f\u3002\u9632\u6b62\u524d\u7aef\u8f93\u51fa\u534a\u5e27\u6570\u636e\u65f6\u6253\u5f00 LVDS \u6a21\u5757\uff0c\u51fa\u73b0\u663e\u793a\u5f02\u5e38"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"phys"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6574\u578b\uff0cLVDS\u53c2\u8003\u7535\u538b\u63a7\u5236\u3002\u6570\u503c\u76f4\u63a5\u5199\u5165 LVDS_0_PHY_CTL \u548c LVDS_1_PHY_CTL \u5bc4\u5b58\u5668\uff0c\u53c2\u8003\u82af\u7247\u7528\u6237\u624b\u518c\u8fdb\u884c\u914d\u7f6e\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u6ce8\u89e3"}),"\n",(0,r.jsx)(e.p,{children:"lines\u3001pols \u548c phys \u5c5e\u6027\u4f1a\u540c\u65f6\u4f5c\u7528\u4e8e link0 \u548c link1"}),"\n",(0,r.jsx)(e.h6,{id:"22233-mipi-dsi-display-interface",children:"2.2.2.3.3. MIPI-DSI Display Interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&dsi0 {\n    pinctrl-names = "default";\n    pinctrl-0 = <&dsi_pins>;\n    data-lanes = <3 0 1 2>;\n    lane-polarities = <1 0 1 0>;\n    data-clk-inverse;\n    status = "okay";\n\n    port@0 {\n        reg = <0>;\n        dsi0_in: endpoint {\n            remote-endpoint = <&de0_out>;\n        };\n    };\n\n    port@1 {\n        reg = <1>;\n            dsi0_out: endpoint {\n            remote-endpoint = <&panel_dsi_in>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pinctrl-names"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"SDK\u4e00\u822c\u4f1a\u628a\u8981\u4f7f\u7528\u7684\u67d0\u4e00\u529f\u80fd\u7684\u7aef\u53e3\u7ec4\u9884\u5148\u5b9a\u4e49\uff0c\u540e\u671f\u76f4\u63a5\u4f7f\u7528\u5373\u53ef\uff0c\u5b9a\u4e49\u4e00\u822c\u653e\u5728target/aicxxx/common/aicxxx-pinctrl.dtsi\u6587\u4ef6\u4e2d\uff0c\u76ee\u524d\u201cpinctrl-names\u201d \u5747\u8bbe\u7f6e\u4e3a\u201cdefault\u201d \u5373\u53ef"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"pinctrl-0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5373\u6307\u793amipi-dsi\u663e\u793a\u63a5\u53e3\u9884\u5148\u5b9a\u4e49\u7684\u7aef\u53e3\u7ec4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u5165\u7aef\u53e3\uff0c\u8fde\u63a5 display engine \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@1"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u51fa\u7aef\u53e3\uff0c\u8fde\u63a5 panel dsi \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Optional:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"data-clk-inverse"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u5e03\u5c14\u578b\uff0cCLK Lane \u6b63\u8d1f\u6781\u53d6\u53cd"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"data-lanes"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"  > \u6570\u7ec4\uff0c\u6570\u636e\u901a\u9053\u8f93\u51fa\u9009\u62e9\uff0c\u9ed8\u8ba4\u4e3a <0 1 2 3>\n  >\n  > <0 1 2 3> \u8868\u793a\u6570\u636e\u901a\u90530 \u8f93\u51fa DATA0\uff0c\u6570\u636e\u901a\u90531 \u8f93\u51fa DATA1\uff0c\u4ee5\u6b64\u7c7b\u63a8\n  >\n  > <3 0 1 2> \u8868\u793a\u6570\u636e\u901a\u90530 \u8f93\u51fa DATA3\uff0c\u6570\u636e\u901a\u90531 \u8f93\u51fa DATA0\uff0c\u6570\u636e\u901a\u90532 \u8f93\u51fa DATA1\uff0c\u6570\u636e\u901a\u90533 \u8f93\u51fa DATA2\n  >\n  > \u5982\u679c\u662f\u4e24\u4e2a lane\uff0c\u53ef\u914d\u7f6e\u6210 <0 1>\uff0c\u6570\u636e\u901a\u90530 \u8f93\u51fa DATA0, \u6570\u636e\u901a\u90531 \u8f93\u51fa DATA1\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"lane-polarities"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"  > \u6570\u7ec4\uff0c\u8868\u793a\u6570\u636e\u901a\u9053\u6781\u6027\uff0c\u662f\u5426\u6b63\u8d1f\u6781\u53d6\u53cd\uff0c\u9ed8\u8ba4\u4e3a <0 0 0 0>\uff0c\u4e0e data-lanes \u914d\u7f6e\u7684\u901a\u9053\u987a\u5e8f\u4fdd\u6301\u4e00\u81f4\u3002\n  >\n  > data-lanes = <3 0 1 2>; lane-polarities = <1 0 1 0>; \u8868\u793a DATA3 \u548c DATA1 \u6b63\u8d1f\u6781\u53d6\u53cd\n"})}),"\n",(0,r.jsx)(e.h5,{id:"2224-display-engine",children:"2.2.2.4. Display Engine"}),"\n",(0,r.jsx)(e.h6,{id:"22241-display-engine",children:"2.2.2.4.1. Display Engine"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&de0 {\n        status = "okay";\n\n        port@0 {\n                reg = <0>;\n                de0_in: endpoint {\n                        remote-endpoint = <&fb0_out>;\n                };\n        };\n\n        port@1 {\n                reg = <1>;\n                de0_out: endpoint {\n                        remote-endpoint = <&lvds0_in>;\n                };\n        };\n};\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@0"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u5165\u7aef\u53e3\uff0c\u8fde\u63a5 display engine \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port@1"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u51fa\u7aef\u53e3\uff0c\u8fde\u63a5\u5230display interface \u7ed3\u70b9\uff0c\u6b64\u5904\u4f8b\u5b50\u4e3a\u8fde\u63a5 lvds \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"tearing-effect"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"tearing effetc \u6a21\u5f0f\uff0c\u652f\u6301 bypass / hold / auto \u4e09\u79cd\u6a21\u5f0f"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"tearing effect mode"}),(0,r.jsx)(e.th,{children:"macro"}),(0,r.jsx)(e.th,{children:"value"}),(0,r.jsx)(e.th,{children:"\u5907\u6ce8"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"bypass"}),(0,r.jsx)(e.td,{children:"TE_BYPASS"}),(0,r.jsx)(e.td,{children:"0"}),(0,r.jsx)(e.td,{children:"\u8fde\u7eed\u6a21\u5f0f\uff0c\u6301\u7eed\u5237\u65b0\uff0c\u4e0d\u542f\u7528te"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"hold"}),(0,r.jsx)(e.td,{children:"TE_HOLD"}),(0,r.jsx)(e.td,{children:"1"}),(0,r.jsx)(e.td,{children:"\u5355\u5e27\u6a21\u5f0f\uff0c\u9700\u8981\u624b\u52a8\u5237\u65b0"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"auto"}),(0,r.jsx)(e.td,{children:"TE_AUTO"}),(0,r.jsx)(e.td,{children:"2"}),(0,r.jsx)(e.td,{children:"\u81ea\u52a8\u5355\u5e27\u6a21\u5f0f\uff0c \u63a5\u53d7\u5230te\u4fe1\u53f7\u540e\u5237\u65b0\u4e00\u5e27\u6570\u636e"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"te-pulse-width"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"TE \u4fe1\u53f7\u7684\u8109\u51b2\u5bbd\u5ea6\uff0c\u8bbe\u7f6e\u5176\u8109\u51b2\u5bbd\u5ea6\u7b49\u4e8e\u591a\u5c11\u4e2apixel clock cycle"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h5,{id:"2225-display-fb0",children:"2.2.2.5. Display FB0"}),"\n",(0,r.jsx)(e.h6,{id:"22251-display-fb0",children:"2.2.2.5.1. Display FB0"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"&fb0 {\n    artinchip,uboot-logo-on=<1>;\n    rotation-degress = <270>;\n    rotation-buf-num = <2>;\n    height-virtual = <2160>;\n    disp-bright = <45>;\n    disp-contrast = <50>;\n    disp-saturation = <60>;\n    disp-hue = <50>;\n\n    port {\n        fb0_out: endpoint {\n            remote-endpoint = <&de0_in>;\n        };\n    };\n};\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Required properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"port"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6570\u636e\u8f93\u51fa\u7aef\u53e3\uff0c\u8fde\u63a5 display engine \u7ed3\u70b9"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"artinchip,uboot-logo-on"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u662f\u5426\u4fdd\u6301 uboot \u9636\u6bb5\u7684 logo"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Optional properties:"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"format"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["framebuffer \u5185\u5b58\u6570\u636e\u683c\u5f0f\uff0cstring \u578b\u53c2\u6570\uff0c\u7f3a\u7701\u4e3a ",(0,r.jsx)(e.code,{children:"a8r8g8b8"})," \uff0c\u8868\u793a 32 \u4f4d ARGB8888 \u683c\u5f0f\u3002\u663e\u793a\u9a71\u52a8\u76ee\u524d\u9002\u914d\u4e86\u4ee5\u4e0b\u51e0\u79cd\u5e38\u89c1\u683c\u5f0f\uff1a"]}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"format"}),(0,r.jsx)(e.th,{children:"strings"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ARGB8888"}),(0,r.jsx)(e.td,{children:"\u201ca8r8g8b8\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ABGR8888"}),(0,r.jsx)(e.td,{children:"\u201ca8b8g8r8\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"XRGB8888"}),(0,r.jsx)(e.td,{children:"\u201cx8r8g8b8\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB888"}),(0,r.jsx)(e.td,{children:"\u201cr8g8b8\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"RGB565"}),(0,r.jsx)(e.td,{children:"\u201cr5g6b5\u201d"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"ARGB1555"}),(0,r.jsx)(e.td,{children:"\u201ca1r5g5b5\u201d"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-bright"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u4eae\u5ea6\uff0c[0, 100], \u7f3a\u7701\u7b49\u4e8e 50\uff0c50 \u8868\u793a\u4e0d\u8c03\u8282\u4eae\u5ea6\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-contrast"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u5bf9\u6bd4\u5ea6\uff0c[0, 100], \u7f3a\u7701\u7b49\u4e8e 50\uff0c50 \u8868\u793a\u4e0d\u8c03\u8282\u5bf9\u6bd4\u5ea6\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-saturation"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u9971\u548c\u5ea6\uff0c[0, 100], \u7f3a\u7701\u7b49\u4e8e 50\uff0c50 \u8868\u793a\u4e0d\u8c03\u8282\u9971\u548c\u5ea6\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"disp-hue"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u663e\u793a\u8272\u8c03\uff0c[0, 100], \u7f3a\u7701\u7b49\u4e8e 50\uff0c50 \u8868\u793a\u4e0d\u8c03\u8282\u8272\u8c03\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"rotation-degress"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"framebuffer \u65cb\u8f6c\u89d2\u5ea6\uff0c\u5728\u7ad6\u5c4f\u6a2a\u7528\u6216\u6a2a\u5c4f\u7ad6\u7528\u65f6\u914d\u7f6e\uff0c\u652f\u6301 0\xb0/90\xb0/180\xb0/270\xb0 \u65cb\u8f6c\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"rotation-buf-num"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"framebuffer \u4e2d\u9700\u8981\u65cb\u8f6c\u7684 buffer \u4e2a\u6570\u3002\u90e8\u5206\u5e94\u7528\u7a0b\u5e8f\u4f1a\u4f7f\u7528\u53cc buffer \u6765\u907f\u514d\u6495\u88c2\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"width-virtual"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"framebuffer \u7684\u5185\u5b58\u5bbd\u5ea6\uff0c\u7f3a\u7701\u7b49\u4e8e width\u3002\u7528\u4e8e\u914d\u7f6e\u53cc buffer\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"height-virtual"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"framebuffer \u7684\u5185\u5b58\u9ad8\u5ea6\uff0c\u7f3a\u7701\u7b49\u4e8e height\u3002\u7528\u4e8e\u914d\u7f6e\u53cc buffer\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"width"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"display engine \u56fe\u50cf\u8f93\u51fa\u5bbd\u5ea6\uff0c\u7f3a\u7701\u7b49\u4e8e panel \u5b50\u8282\u70b9 display-timings \u4e2d\u7684 hactive \u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u9884\u7559\u8282\u70b9\uff0c\u4e3a display engine \u7684\u7f29\u653e\u529f\u80fd\u9884\u7559\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u914d\u7f6e\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"height"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"display engine \u56fe\u50cf\u8f93\u51fa\u9ad8\u5ea6\uff0c\u7f3a\u7701\u7b49\u4e8e panel \u5b50\u8282\u70b9 display-timings \u4e2d\u7684 vactive \u5c5e\u6027\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u9884\u7559\u8282\u70b9\uff0c\u4e3a display engine \u7684\u7f29\u653e\u529f\u80fd\u9884\u7559\uff0c\u4e00\u822c\u4e0d\u9700\u8981\u914d\u7f6e\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"3-\u8c03\u8bd5\u6307\u5357",children:"3. \u8c03\u8bd5\u6307\u5357"}),"\n",(0,r.jsx)(e.h3,{id:"31-\u8c03\u8bd5\u5f00\u5173",children:"3.1. \u8c03\u8bd5\u5f00\u5173"}),"\n",(0,r.jsx)(e.h4,{id:"311-de-\u8c03\u8bd5\u5f00\u5173",children:"3.1.1. DE \u8c03\u8bd5\u5f00\u5173"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make kernel-menuconfig\uff0c\u8fdb\u5165 kernel \u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6253\u5f00 DE \u6a21\u5757\u7684 DEBUG \u9009\u9879\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Kernel hacking\n        Artinchip Debug\n            [*] DE driver debug\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u6b64 DEBUG \u9009\u9879\u6253\u5f00\u7684\u5f71\u54cd\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"DE \u9a71\u52a8\u4ee5-O0\u7f16\u8bd1"}),"\n",(0,r.jsx)(e.li,{children:"DE \u9a71\u52a8\u7684 pr_dbg()\u548c dev_dbg()\u8c03\u8bd5\u4fe1\u606f\u4f1a\u88ab\u7f16\u8bd1"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u7cfb\u7edf\u8fd0\u884c\u65f6\uff0c\u5982\u679c\u8981\u6253\u5370 pr_dbg() \u548c dev_dbg() \u4fe1\u606f\uff0c\u8fd8\u9700\u8981\u8c03\u6574 loglevel \u4e3a8\uff0c\u4e24\u4e2a\u65b9\u6cd5\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u5728 board.dts \u4e2d\u4fee\u6539 bootargs\uff0c\u589e\u52a0 \u201cloglevel=8\u201d"}),"\n",(0,r.jsx)(e.li,{children:"\u5728\u677f\u5b50\u542f\u52a8\u5230 Linux shell \u540e\uff0c\u6267\u884c\u547d\u4ee4\uff1a"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"echo 8 > /proc/sys/kernel/printk\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u65e0\u7279\u6b8a\u8bf4\u660e\uff0c\u672c\u6587\u6863\u4e2d\u7684 DE \u9a71\u52a8\u8868\u793a\u663e\u793a\u6a21\u5757\u7684\u9a71\u52a8\uff0c\u5305\u542b\u663e\u793a\u5f15\u64ce\u6a21\u5757\uff0c\u663e\u793a\u63a5\u53e3\u6a21\u5757\uff0cLCD \u7684 panel \u9a71\u52a8\u3002\u5e76\u975e\u4ec5\u4ec5\u6307\u793a\u663e\u793a\u5f15\u64ce\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"312-cma-\u8c03\u8bd5\u5f00\u5173",children:"3.1.2. CMA \u8c03\u8bd5\u5f00\u5173"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 luban \u6839\u76ee\u5f55\u4e0b\u6267\u884c make kernel-menuconfig\uff0c\u8fdb\u5165 kernel \u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6253\u5f00 CMA \u6846\u67b6\u7684 DEBUG \u9009\u9879\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n     Memory Management options\n         [*]   CMA debug messages (DEVELOPMENT)\n         [*]   CMA debugfs interface\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u4e24\u4e2a DEBUG \u9009\u9879\u6253\u5f00\u7684\u5f71\u54cd\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"CMA \u6846\u67b6\u4e2d pr_debug() \u8c03\u8bd5\u4fe1\u606f\u4f1a\u88ab\u7f16\u8bd1"}),"\n",(0,r.jsx)(e.li,{children:"debugfs \u4e2d\u6dfb\u52a0 cma \u7ed3\u70b9"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"32-component",children:"3.2. Component"}),"\n",(0,r.jsx)(e.p,{children:"\u67e5\u770bComponent\u7684\u6ce8\u518c\u4fe1\u606f\uff0c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# mount -t debugfs none /sys/kernel/debug/\n# cat /sys/kernel/debug/device_component/soc\\:display-fb\nmaster name                                            status\n-------------------------------------------------------------\nsoc:display-fb                                          bound\n\ndevice name                                            status\n-------------------------------------------------------------\n98a00000.de                                             bound\n98800000.rgb                                            bound\npanel0                                                  bound\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c bound \u5931\u8d25\uff0c\u63a7\u5236\u53f0\u8f93\u51fa\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# cat /sys/kernel/debug/device_component/soc\\:display-fb\nmaster name                                            status\n-------------------------------------------------------------\nsoc:display-fb                                      not bound\n\ndevice name                                            status\n-------------------------------------------------------------\n18a00000.de                                         not bound\n18800000.rgb                                        not bound\n(unknown)                                      not registered\n"})}),"\n",(0,r.jsx)(e.h3,{id:"33-cma",children:"3.3. CMA"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 menuconfig \u914d\u7f6e\u4e2d\u4f7f\u80fd CMA debug \u5f00\u5173\u540e\uff0c\u53ef\u901a\u8fc7 debugfs \u8c03\u8bd5 CMA\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# mount -t debugfs none /sys/kernel/debug/\n# ls /sys/kernel/debug/cma/cma-reserved/\nalloc          bitmap         free           order_per_bit\nbase_pfn       count          maxchunk       used\n"})}),"\n",(0,r.jsx)(e.p,{children:"CMA \u8c03\u8bd5\u63a5\u53e3\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"alloc"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u7533\u8bf7 cma \u5185\u5b58\uff0c\u4ee5 page \u4e3a\u5355\u4f4d"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"free"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u91ca\u653e cma \u5185\u5b58\uff0c\u4ee5 page \u4e3a\u5355\u4f4d"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"base_pfn"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"cma \u5185\u5b58\u8d77\u59cb\u9875\u6846\u53f7"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"count"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"cma \u603b page \u6570"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"maxchunk"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"cma \u6700\u5927\u8fde\u7eed page \u6570"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"order_per_bit"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u6bcf\u4e2a bit \u4ee3\u8868 2 ^ order_per_bit \u4e2a page"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"bitmap"})}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u8bb0\u5f55 cma page \u4f7f\u7528\u60c5\u51b5\u7684\u4f4d\u56fe\u30021 \u8868\u793a\u5360\u7528\uff0c0 \u8868\u793a\u7a7a\u95f2"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u67e5\u770b cma \u4f7f\u7528\u60c5\u51b5\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# cat /sys/kernel/debug/cma/cma-reserved/bitmap\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295\n4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295\n4294967295 4294967295 2097151 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n# cat /sys/kernel/debug/cma/cma-reserved/count\n8192\n# cat /sys/kernel/debug/cma/cma-reserved/used\n1525\n# cat /sys/kernel/debug/cma/cma-reserved/base_pfn\n548864\n# cat /sys/kernel/debug/cma/cma-reserved/order_per_bit\n0\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u7533\u8bf7 100 \u4e2a page"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# echo 100 >  /sys/kernel/debug/cma/cma-reserved/alloc\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u91ca\u653e 100 \u4e2a page"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# echo 100 >  /sys/kernel/debug/cma/cma-reserved/free\n"})}),"\n",(0,r.jsx)(e.p,{children:"sysfs \u7684 meminfo \u7ed3\u70b9\u4ea6\u53ef\u67e5\u770b CMA \u7684\u4f7f\u7528\u60c5\u51b5\uff08\u4e3a\u8282\u7701\u7bc7\u5e45\uff0c\u5df2\u7701\u7565\u65e0\u5173\u4fe1\u606f\uff09\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# cat /proc/meminfo\n    ...\n    CmaTotal:          32768 kB\n    CmaFree:           29068 kB\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"CmaFree \u4e2d\u8bb0\u5f55\u7684\u4fe1\u606f\u5e76\u4e0d\u51c6\u786e\uff0c\u63a8\u8350\u4f7f\u7528 debugfs \u4e2d cma \u8282\u70b9\u7684 bitmap \u6765\u67e5\u770b cma page \u7684\u4f7f\u7528\u60c5\u51b5\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"34-dma-buf",children:"3.4. DMA-BUF"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 debugfs \u4e2d\u67e5\u770b\u5f53\u524d DMA-BUF \u7684\u4f7f\u7528\u60c5\u51b5\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"mount -t debugfs none /sys/kernel/debug\ncat /sys/kernel/debug/dma_buf/bufinfo\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf-17066878792223.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"Component, CMA\uff0cDMA-BUF \u76f8\u5173\u6982\u5ff5\u5728\u540e\u7eed\u8bbe\u8ba1\u8bf4\u660e\u7ae0\u8282\u4f1a\u6709\u8865\u5145\u4ecb\u7ecd\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"35-devfb",children:"3.5. /dev/fb"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 sysfs \u4e2d\u67e5\u770b /dev/fb \u7684\u4e00\u4e9b\u4fe1\u606f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# ls /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/ -l\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 bits_per_pixel\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 blank\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 console\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 cursor\n-r--r--r--    1 root     root          4096 Jan  1 00:01 dev\nlrwxrwxrwx    1 root     root             0 Jan  1 00:01 device -> ../../../soc:display-fb\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 mode\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 modes\n-r--r--r--    1 root     root          4096 Jan  1 00:01 name\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 pan\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 rotate\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 state\n-r--r--r--    1 root     root          4096 Jan  1 00:01 stride\nlrwxrwxrwx    1 root     root             0 Jan  1 00:01 subsystem -> ../../../../../../class/graphics\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 uevent\n-rw-r--r--    1 root     root          4096 Jan  1 00:01 virtual_size\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/bits_per_pixel\n32\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/blank\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/console\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/dev\n29:0\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/mode\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/pan\n0,0\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/name\naicfb0\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/stride\n3200\n# cat /sys/devices/platform/soc/soc\\:display-fb/graphics/fb0/virtual_size\n800,480\n"})}),"\n",(0,r.jsx)(e.h3,{id:"36-display-engine",children:"3.6. Display Engine"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 sysfs \u4e2d\u67e5\u770b\u5f53\u524d display engine \u7684\u4e00\u4e9b\u4fe1\u606f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# cat /sys/devices/platform/soc/18a00000.de/debug/display\nVideo Layer Enable       : 0\nVideo Layer Format       : 0\nVideo Layer Input Size   : 0 x 0\nVideo Layer Stride       : 0 0\nScaler Output Size       : 0 x 0\nUI Layer Control         : format: 0, color key: 0, alpha: 1\nUI Layer Input Size      : 1024 x 600\nUI Layer Color Key       : 0\nUI Layer Alpha           : mode: 0, g_alpha: 255\nUI Rectangle Control     : 1 0 0 0\nUI Rectangle Size        : (1024, 600) (0, 0) (0, 0) (0, 0)\nUI Rectangle Offset      : (0, 0) (0, 0) (0, 0) (0, 0)\nUI Rectangle Stride      : 4096 0 0 0\nTearing-effect           : TE mode: 0, TE pulse width: 0\nDisplay Dither           : dither_en: 0, red depth: 0, green depth: 0, blue depth: 0\nDisplay Timing           : hactive: 1024, vactive: 600 hfp: 160 hbp: 140 vfp: 20 vbp: 12 hsync: 20 vsync: 3\nDisplay Pixelclock       : 60000000 HZ\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"UI Layer Control \u4e2d\u7684 color key \u548c alpha \u8868\u793a enable / disable \u72b6\u6001\u3002 UI Layer Color Key \u624d\u8868\u793a color value\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"37-color-bar",children:"3.7. Color bar"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 sysfs \u4e2d\u4f7f\u7528 display engine \u7684 color bar \u6a21\u5f0f\u8fdb\u884c\u8c03\u8bd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"// \u5f00\u542f color bar\n# echo 1 >  /sys/devices/platform/soc/18a00000.de/debug/color_bar\n\n// \u5173\u95ed color bar\n# echo 0 >  /sys/devices/platform/soc/18a00000.de/debug/color_bar\n"})}),"\n",(0,r.jsx)(e.h3,{id:"38-framebuffer-\u622a\u56fe",children:"3.8. Framebuffer \u622a\u56fe"}),"\n",(0,r.jsx)(e.p,{children:"\u62f7\u8d1d /dev/fb0 \u88f8\u6570\u636e\uff0c\u4f7f\u7528 RawViewer \u67e5\u770b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# cp /dev/fb0 fb0.bgra\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u4f7f\u7528ADB pull ",(0,r.jsx)(e.code,{children:"fb0.bgra"})," \u6587\u4ef6\uff0c\u5728PC \u4e0a\u4f7f\u7528 RawViewer \u8f6f\u4ef6\u67e5\u770b\u3002"]}),"\n",(0,r.jsxs)(e.p,{children:["RawViewer \u8f6f\u4ef6\u53ef\u5728\u5176\u5b98\u7f51\u514d\u8d39\u4e0b\u8f7d\uff1a",(0,r.jsx)(e.a,{href:"http://www.filefriend.net/#RawViewer",children:"http://www.filefriend.net/#RawViewer"})]}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u7528 RawViewer \u67e5\u770b fb0.bgra \u6587\u4ef6\uff0c\u9700\u8981\u624b\u5de5\u8bbe\u7f6e\u6570\u636e\u6e90\u7684\u5bbd\u9ad8\uff0c\u5728\u5f00\u542f\u53cc buffer \u7684\u573a\u666f\u4e0b\uff0c\u8981\u5c06\u9ad8\u5ea6 * 2\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"4-\u6d4b\u8bd5\u6307\u5357",children:"4. \u6d4b\u8bd5\u6307\u5357"}),"\n",(0,r.jsx)(e.h3,{id:"41-\u6d4b\u8bd5\u73af\u5883",children:"4.1. \u6d4b\u8bd5\u73af\u5883"}),"\n",(0,r.jsx)(e.h4,{id:"411-\u786c\u4ef6",children:"4.1.1. \u786c\u4ef6"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5f00\u53d1\u677f\uff0c\u6216\u8005D211\u7684FPGA\u677f"}),"\n",(0,r.jsx)(e.li,{children:"\u53ef\u8f6c\u63a5LVDS\u7684\u5b50\u677f"}),"\n",(0,r.jsx)(e.li,{children:"LVDS\u5c4f\u5e55\uff0c7\u5bf8TFT\u5c4f\u5e55\uff0c\u9a71\u52a8\u82af\u7247EK79001+EK73215"}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"412-\u8f6f\u4ef6",children:"4.1.2. \u8f6f\u4ef6"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"PC\u7aef\u7684\u4e32\u53e3\u7ec8\u7aef\u8f6f\u4ef6\uff0c\u7528\u4e8ePC\u548c\u5f00\u53d1\u677f\u8fdb\u884c\u4e32\u53e3\u901a\u4fe1"}),"\n",(0,r.jsx)(e.li,{children:"\u663e\u793a\u6a21\u5757\u7684\u6d4b\u8bd5demo\uff1atest_dmabuf"}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"413-\u8f6f\u4ef6\u914d\u7f6e",children:"4.1.3. \u8f6f\u4ef6\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h5,{id:"4131-\u914d\u7f6e-lvds\u5c4f\u5e55",children:"4.1.3.1. \u914d\u7f6e LVDS\u5c4f\u5e55"}),"\n",(0,r.jsx)(e.p,{children:"\u6d4b\u8bd5\u4e2d\u9700\u8981\u7528\u5230LVDS\u5c4f\u5e55\uff0c\u4ee5\u9a71\u52a8\u82af\u7247EK79001+EK73215\u4e3a\u4f8b\uff0c\u5728 luban \u7684\u6839\u76ee\u5f55\u4e0b\u901a\u8fc7make kernel-menuconfig\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Device Drivers\n        Graphics support\n            Frame buffer Devices\n                <*> Artinchip Framebuffer support\n                    [*]   Artinchip display lvds support\n                        <*> Artinchip Framebuffer support\n                            Artinchip Panel Drivers (Artinchip general LVDS panel)  ---\x3e\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5728board.dts\u4e2d\uff0c\u4fee\u6539 LVDS \u76f8\u5173\u914d\u7f6e\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"panel"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'panel_lvds {\n    compatible = "artinchip,aic-general-lvds-panel";\n    enable-gpios = <&gpio_a 4 GPIO_ACTIVE_HIGH>;\n    data-mapping = "vesa-24";\n    data-channel = "single-link0";\n    status = "okay";\n\n    port {\n        panel_lvds_in: endpoint {\n            remote-endpoint = <&lvds0_out>;\n        };\n    };\n\n    display-timings {\n        native-mode = <&timing1>;\n        timing1: 1024x600 {\n            clock-frequency = <60000000>;\n            hactive = <1024>;\n            vactive = <600>;\n            hback-porch = <140>;\n            hfront-porch = <160>;\n            hsync-len = <20>;\n            vback-porch = <20>;\n            vfront-porch = <12>;\n            vsync-len = <3>;\n            de-active = <1>;\n            pixelclk-active = <1>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"4132-display-engine",children:"4.1.3.2. display engine"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&de0 {\n    status = "okay";\n\n    port@0 {\n        reg = <0>;\n        de0_in: endpoint {\n            remote-endpoint = <&fb0_out>;\n        };\n    };\n\n    port@1 {\n        reg = <1>;\n        de0_out: endpoint {\n            remote-endpoint = <&lvds0_in>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"4133-lvds-display-interface",children:"4.1.3.3. lvds display interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&lvds0 {\n    pinctrl-names = "default";\n    pinctrl-0 = <&lvds0_pins>;\n    status = "okay";\n\n    port@0 {\n        reg = <0>;\n        lvds0_in: endpoint {\n            remote-endpoint = <&de0_out>;\n        };\n    };\n\n    port@1 {\n        reg = <1>;\n        lvds0_out: endpoint {\n            remote-endpoint = <&panel_lvds_in>;\n        };\n    };\n};\n'})}),"\n",(0,r.jsx)(e.h5,{id:"4134-test_dmabuf-\u914d\u7f6e",children:"4.1.3.4. test_dmabuf \u914d\u7f6e"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728luban\u6839\u76ee\u5f55\uff0c\u8fd0\u884c",(0,r.jsx)(e.code,{children:"make menuconfig"}),"\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Artinchip packages\n    Sample code\n        [*] test-dma-buf\n"})}),"\n",(0,r.jsx)(e.h3,{id:"42-test_dmabuf-\u6d4b\u8bd5",children:"4.2. test_dmabuf \u6d4b\u8bd5"}),"\n",(0,r.jsx)(e.p,{children:"test_dmabuf\u7684\u4e3b\u8981\u529f\u80fd\u662f\u6d4b\u8bd5\u663e\u793a\u5f15\u64ceUI\u56fe\u5c42\u548cVidev\u56fe\u5c42blend\uff0c\u5728Video\u56fe\u5c42\u64ad\u653e\u4e00\u4e2a\u89c6\u9891\u5e27\u6587\u4ef6"}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u6253\u5f00test_dmabuf\u7684\u7f16\u8bd1\u540e\uff0c\u677f\u5b50\u4e0a\u7684test_dmabuf\u4f4d\u4e8e ",(0,r.jsx)(e.code,{children:"/usr/local/bin/"}),"\uff0c\u65e0\u9700\u8fdb\u5165\u8be5\u76ee\u5f55\uff0c\u76f4\u63a5\u8fd0\u884ctest_dmabuf\u5373\u53ef\uff1a"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"[aic@] # test_dmabuf -u\nUsage: test_dmabuf [options]:\n     -w, --width    need an integer argument\n     -h, --height   need an integer argument\n     -f, --format   video format, yuv420p etc\n     -i, --input    need a file name\n     -u, --usage\n\nExample: test_dmabuf -w 480 -h 320 -f yuv420p -i my.yuv\n\n[aic@] # test_dmabuf -w 480 -h 320 -f yuv420p -i my.yuv  - \u64ad\u653e\u4e00\u4e2ayuv420\u683c\u5f0f\u7684\u6587\u4ef6\n"})}),"\n",(0,r.jsx)(e.h2,{id:"5-\u8bbe\u8ba1\u8bf4\u660e",children:"5. \u8bbe\u8ba1\u8bf4\u660e"}),"\n",(0,r.jsx)(e.h3,{id:"51-\u6e90\u7801\u548c\u6587\u6863\u8bf4\u660e",children:"5.1. \u6e90\u7801\u548c\u6587\u6863\u8bf4\u660e"}),"\n",(0,r.jsx)(e.h4,{id:"511-\u6e90\u7801\u8bf4\u660e",children:"5.1.1. \u6e90\u7801\u8bf4\u660e"}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6a21\u5757\u6e90\u4ee3\u7801\u5728\u5185\u6838\u76ee\u5f55 linux-5.10/drivers/video/artinchip/disp \u4e0b\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"\u251c\u2500\u2500 aic_com.h       // \u663e\u793a\u9a71\u52a8\u5171\u7528\u7684\u5934\u6587\u4ef6\uff0c\u5176\u4e2d\u5b9a\u4e49\u4e86\u5bc4\u5b58\u5668\u3001\u5171\u7528\u6570\u636e\u7ed3\u6784\u3001\u5168\u5c40\u51fd\u6570\u7b49\n\u251c\u2500\u2500 aic_fb.c    // \u5bf9\u63a5 fbdev \u6846\u67b6\uff0c\u5e76\u8fdb\u884c\u6269\u5c55\n\u251c\u2500\u2500 aic_de.c    // \u663e\u793a\u5f15\u64ce\u9a71\u52a8\n\u251c\u2500\u2500 aic_dsi.c   // mipi-dsi \u663e\u793a\u63a5\u53e3\u9a71\u52a8\n\u251c\u2500\u2500 aic_lvds.c  // lvds \u663e\u793a\u63a5\u53e3\u9a71\u52a8\n\u251c\u2500\u2500 aic_rgb.c   // rgb \u663e\u793a\u63a5\u53e3\u9a71\u52a8\n\u251c\u2500\u2500 hw/         // \u663e\u793a\u5f15\u64ce\u548c\u663e\u793a\u63a5\u53e3\u7684\u5bc4\u5b58\u5668\u5c01\u88c5\n\u2514\u2500\u2500 panel/      // \u5c4f\u9a71\u52a8\n"})}),"\n",(0,r.jsx)(e.h4,{id:"512-\u6587\u6863\u8bf4\u660e",children:"5.1.2. \u6587\u6863\u8bf4\u660e"}),"\n",(0,r.jsx)(e.p,{children:"\u5173\u4e8e\u672c\u6a21\u5757\u7684device tree bindings\u6587\u6863\uff0c\u53ef\u67e5\u770b"}),"\n",(0,r.jsx)(e.p,{children:"/Documentation/devicetree/bindings/display/"}),"\n",(0,r.jsx)(e.p,{children:"/Documentation/devicetree/bindings/display/panel/"}),"\n",(0,r.jsx)(e.p,{children:"\u76ee\u5f55\u4e0b\u7684txt\u6587\u4ef6\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"52-\u6a21\u5757\u67b6\u6784",children:"5.2. \u6a21\u5757\u67b6\u6784"}),"\n",(0,r.jsx)(e.h4,{id:"521-fbdev\u6846\u67b6",children:"5.2.1. fbdev\u6846\u67b6"}),"\n",(0,r.jsx)(e.p,{children:"ArtInChip \u5e73\u53f0\u7684\u663e\u793a\u6a21\u5757\u9a71\u52a8\u57fa\u4e8e fbdev \u6846\u67b6\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5173\u4e8e fbdev \u67b6\u6784\u7684\u6587\u6863\uff1a"}),"\n",(0,r.jsxs)(e.p,{children:["\u53ef\u67e5\u770bDocumentation/fb/framebuffer.txt \u6216\u5728\u7ebf\u9605\u8bfb ",(0,r.jsx)(e.a,{href:"https:/www.kernel.org/doc/Documentation/fb/framebuffer.txt/",children:"https:/www.kernel.org/doc/Documentation/fb/framebuffer.txt"})]}),"\n",(0,r.jsx)(e.h4,{id:"522-componet\u6846\u67b6",children:"5.2.2. Componet\u6846\u67b6"}),"\n",(0,r.jsx)(e.p,{children:"\u6846\u67b6\u4ee3\u7801\uff1alinux-5.10/drivers/base/component.c"}),"\n",(0,r.jsx)(e.p,{children:"Linux \u5f15\u5165 Componet \u6846\u67b6\u662f\u4e3a\u4e86 Subsystems \u80fd\u6309\u7167\u4e00\u5b9a\u7684\u987a\u5e8f\u521d\u59cb\u5316\u8bbe\u5907\u3002Subsystems\uff0c\u4f8b\u5982\uff1aALSA, DRM\uff0c\u6574\u4e2a\u6846\u67b6\u5305\u542b\u8f83\u591a\u5b50\u8bbe\u5907\u6a21\u5757\uff0c\u4f46\u5185\u6838\u52a0\u8f7d\u6bcf\u4e2a\u5b50\u6a21\u5757\u7684\u65f6\u95f4\u4e0d\u5b9a\uff0c\u56e0\u6b64\u9700\u8981 Componet \u6846\u67b6\u8fdb\u884c\u7ea6\u675f\u3002"}),"\n",(0,r.jsx)(e.p,{children:"Component \u6846\u67b6\u901a\u8fc7 dts \u5c06\u6240\u6709\u5b50\u8bbe\u5907\u5173\u8054\u5230\u4e00\u4e2a\u4e3b\u8bbe\u5907\u4e0a\uff0c\u4e3b\u8bbe\u5907\u4f1a\u7ba1\u7406\u5b50\u8bbe\u5907\u7684\u52a0\u8f7d\u987a\u5e8f\uff0c\u4fdd\u8bc1\u6240\u6709\u8bbe\u5907\u6b63\u5e38\u4f7f\u7528\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5728 dts \u6587\u4ef6\u4e2d\uff0c\u663e\u793a\u5f15\u64ce\u3001\u663e\u793a\u63a5\u53e3\u3001panel\u3001fb0 \u901a\u8fc7 port \u7ed3\u70b9\u8fdb\u884c\u5173\u8054\uff0c\u5176\u4e2d fb0 \u4e3a\u4e3b\u8bbe\u5907\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"53-\u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",children:"5.3. \u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1"}),"\n",(0,r.jsx)(e.h4,{id:"531-\u521d\u59cb\u5316\u6d41\u7a0b",children:"5.3.1. \u521d\u59cb\u5316\u6d41\u7a0b"}),"\n",(0,r.jsx)(e.h5,{id:"5311-probe\u548cbind\u8fc7\u7a0b",children:"5.3.1.1. probe\u548cbind\u8fc7\u7a0b"}),"\n",(0,r.jsx)(e.p,{children:"\u4e3a\u4e86\u7ea6\u675f\u521d\u59cb\u5316\u987a\u5e8f\uff0cAICFB \u4e3a component \u7684 master \u8bbe\u5907\uff0cDE\u3001DI \u548c panel \u4e3a slave \u8bbe\u5907\uff0ccomponent \u6846\u67b6\u4fdd\u8bc1 master \u7684\u521d\u59cb\u5316\u987a\u5e8f\u5728\u6240\u6709 slave \u4e4b\u540e\u3002\u5404\u6a21\u5757\u7684\u521d\u59cb\u5316\u987a\u5e8f\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/driver_bind-17066881502075.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/driver_bind.png"})}),"\n",(0,r.jsxs)(e.p,{children:["\u56fe 6.22 ",(0,r.jsx)(e.em,{children:"\u663e\u793a\u6a21\u5757\u7684\u521d\u59cb\u5316\u987a\u5e8f"})]}),"\n",(0,r.jsx)(e.p,{children:"\u5176\u4e2d\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"master \u8c03\u7528 component_match_add() \u63a5\u53e3\u58f0\u660e\u4e00\u4e2a match \u961f\u5217\u3002"}),"\n",(0,r.jsx)(e.li,{children:"master \u8c03\u7528 component_master_add_with_match() \u5c06\u81ea\u5df1\u6ce8\u518c\u8fdb component \u6846\u67b6\u3002"}),"\n",(0,r.jsx)(e.li,{children:"slave \u8c03\u7528 component_add()\u5b8c\u6210 slave \u6ce8\u518c\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u5404\u6a21\u5757\u7684 probe \u987a\u5e8f\u6ca1\u6709\u7ea6\u675f\uff0c\u8bbe\u5907\u7684\u6ce8\u518c\u548c\u58f0\u660e\u5728 probe \u51fd\u6570\u4e2d\u8fdb\u884c\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u6bcf\u4e2a\u5b50\u8bbe\u5907\u90fd\u8981\u5b9e\u73b0\u81ea\u5df1\u7684 bind() \u548c unbind() \u63a5\u53e3\uff08struct component_ops\uff09\uff0c\u5f53 match \u961f\u5217\u4e2d\u7684\u6a21\u5757\u90fd\u5b8c\u6210 probe \u540e\uff0ccomponent \u6846\u67b6\u4f1a\u8c03\u7528\u6a21\u5757\u7684 bind() \u63a5\u53e3\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u5404 slave \u6309 match \u961f\u5217\u987a\u5e8f\u6267\u884c bind()\uff0cComponent \u6846\u67b6\u4fdd\u8bc1 master \u6700\u540e\u6267\u884c\u3002"}),"\n",(0,r.jsx)(e.li,{children:"aicfb->bind() \u4e3b\u8981\u5b8c\u6210 framebuffer \u7533\u8bf7\u3001fb \u8bbe\u5907\u6ce8\u518c\u3001\u4f7f\u80fd UI \u56fe\u5c42\u3001\u4f7f\u80fd panel \u7b49\u52a8\u4f5c\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.h5,{id:"5312-\u786c\u4ef6\u65f6\u5e8f\u8981\u6c42",children:["5.3.1.2. \u786c\u4ef6\u65f6\u5e8f\u8981\u6c42",(0,r.jsx)(e.a,{href:"#id2",children:"\xb6"})]}),"\n",(0,r.jsx)(e.p,{children:"DE\u3001DI\u3001panel \u4e09\u4e2a\u786c\u4ef6\u6a21\u5757\u5728\u521d\u59cb\u5316\u65f6\u6709\u4e00\u4e9b\u65f6\u5e8f\u8981\u6c42\uff0c\u5305\u542b\u5148\u540e\u987a\u5e8f\u3001\u5ef6\u8fdf\u5927\u5c0f\uff0c\u4e3b\u8981\u7ea6\u675f\u6765\u81ea\u4e8e panel \u4fa7\u3002 \u4e3a\u4e86\u5e94\u5bf9\u8fd9\u6837\u7684\u786c\u4ef6\u7279\u6027\uff0c\u9a71\u52a8\u8bbe\u8ba1\u4e2d\u4f7f\u7528 callback \u65b9\u5f0f\u6765\u5b9e\u73b0\u591a\u4e2a\u6a21\u5757\u95f4\u7684\u4e92\u76f8\u8c03\u7528\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/callbacks1-17066882134577.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/callbacks1.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u5728fb\u7684bind()\u4e2d\uff0c\u4f1a\u8c03\u7528\u8fd9\u4e9b\u56de\u8c03\u6765\u5b8c\u6210\u521d\u59cb\u5316\uff0c\u5982\u4e0b\u56fe\uff08\u5176\u4e2d\u5173\u7cfb\u6bd4\u8f83\u7ed5\u7684\u662f panel \u521d\u59cb\u5316\u903b\u8f91\uff09\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/fb_bind1-17066882208049.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/fb_bind1.png"})}),"\n",(0,r.jsx)(e.h4,{id:"532-\u9884\u7559\u5185\u5b58\u7ba1\u7406\u6d41\u7a0b",children:"5.3.2. \u9884\u7559\u5185\u5b58\u7ba1\u7406\u6d41\u7a0b"}),"\n",(0,r.jsx)(e.h5,{id:"5321-cma",children:"5.3.2.1. CMA"}),"\n",(0,r.jsx)(e.p,{children:"Linux-3.5 \u5f15\u5165\u4e86\u4e00\u5957 Contiguous Memory Allocator\uff0c\u7b80\u79f0 CMA\uff0c\u57fa\u4e8e DMA \u6620\u5c04\u6846\u67b6\u4e3a\u5185\u6838\u63d0\u4f9b\u8fde\u7eed\u5927\u5757\u5185\u5b58\u7684\u7533\u8bf7\u548c\u91ca\u653e\u3002CMA \u4e3b\u8981\u601d\u8def\u662f\u5c06\u9884\u7559\u5185\u5b58\u7eb3\u5165 DMA \u6620\u5c04\u7ba1\u7406\uff0c\u53ef\u4ee5\u7ed9\u7cfb\u7edf\u5185\u6240\u6709\u8bbe\u5907\u5171\u4eab\u4f7f\u7528\uff0c\u8fd9\u6837\u5c31\u65e2\u89e3\u51b3\u4e86\u4e3a GPU\u3001Camera\u3001\u663e\u793a\u7b49\u56fe\u50cf\u5904\u7406\u7c7b\u6a21\u5757\u9884\u7559\u5927\u5757\u7684\u8fde\u7eed\u5185\u5b58\uff0c\u53c8\u89e3\u51b3\u4e86\u9884\u7559\u5185\u5b58\u88ab\u7a7a\u7f6e\u7684\u95ee\u9898\uff0c\u63d0\u5347\u5185\u5b58\u4f7f\u7528\u7387\u3002"}),"\n",(0,r.jsx)(e.p,{children:"CMA \u672c\u8eab\u4e0d\u662f\u4e00\u5957\u5206\u914d\u5185\u5b58\u7684\u7b97\u6cd5\uff0c\u5b83\u7684\u5e95\u5c42\u4ecd\u7136\u8981\u4f9d\u8d56\u4f19\u4f34\u7b97\u6cd5\u7cfb\u7edf\u6765\u652f\u6301\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a CMA \u662f\u4ecb\u4e8e DMA mapping \u548c\u5185\u5b58\u7ba1\u7406\u4e4b\u95f4\u7684\u4e2d\u95f4\u5c42\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/cma-170668824010611.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/cma.png"})}),"\n",(0,r.jsx)(e.p,{children:"CMA\u7684\u5177\u4f53\u529f\u80fd\u6709\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u5728\u7cfb\u7edf\u7684\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0c\u6839\u636e\u5185\u6838\u7f16\u8bd1\u914d\u7f6e\u3001\u6216\u8005 DTS \u914d\u7f6e\u5c06\u5185\u5b58\u4e2d\u67d0\u5757\u533a\u57df\u7528\u4e8e CMA\uff0c\u7136\u540e\u5185\u6838\u4e2d\u5176\u4ed6\u6a21\u5757\u53ef\u4ee5\u901a\u8fc7 DMA \u7684\u63a5\u53e3 API \u7533\u8bf7\u8fde\u7eed\u5185\u5b58\uff0c\u8fd9\u5757\u533a\u57df\u6211\u4eec\u79f0\u4e4b\u4e3a CMA area\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u63d0\u4f9b cma_alloc()\u548c cma_release()\u4e24\u4e2a\u63a5\u53e3\u51fd\u6570\u7528\u4e8e\u5206\u914d\u548c\u91ca\u653e CMA pages\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u8bb0\u5f55\u548c\u8ddf\u8e2a CMA area \u4e2d\u5404\u4e2a pages \u7684\u72b6\u6001\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u8c03\u7528\u4f19\u4f34\u7cfb\u7edf\u63a5\u53e3\uff0c\u8fdb\u884c\u771f\u6b63\u7684\u5185\u5b58\u5206\u914d\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"CMA \u4e3b\u8981\u63a5\u53e3"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"CNA area \u7684\u58f0\u660e"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"setup_bootmem() -> dma_contiguous_reserve()\uff0c\u5b9a\u4e49\u5728 kernel/dma/contiguous.c\uff0c\u5176\u4e2d\u6709\u786e\u5b9a CMA area size \u7684\u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"#ifdef CONFIG_CMA_SIZE_SEL_MBYTES\n       selected_size = size_bytes;\n#elif defined(CONFIG_CMA_SIZE_SEL_PERCENTAGE)\n       selected_size = cma_early_percent_memory();\n#elif defined(CONFIG_CMA_SIZE_SEL_MIN)\n       selected_size = min(size_bytes, cma_early_percent_memory());\n#elif defined(CONFIG_CMA_SIZE_SEL_MAX)\n       selected_size = max(size_bytes, cma_early_percent_memory());\n#endif\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u7136\u540e\u4f1a\u8c03\u7528 dma_contiguous_reserve_area() -> cma_declare_contiguous() \u53bb\u521d\u59cb\u5316 CMA \u7684\u914d\u7f6e\u53c2\u6570\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsxs)(e.p,{children:["\u8ba1\u7b97 CMA \u5185\u5b58\u5927\u5c0f\u7684\u8fc7\u7a0b\u4e2d\uff0csize_bytes \u6765\u6e90\u4e8e\u5185\u6838\u7f16\u8bd1\u914d\u7f6e\u4e2d CONFIG_CMA_SIZE_MBYTES\uff0c\u901a\u8fc7\u8ba1\u7b97\u5c06 size \u9650\u5b9a\u5728 4MB \u5bf9\u9f50\u3002 \u53c2\u8003 ",(0,r.jsx)(e.a,{href:"../02_config_guide/menuconfig/index.html#ref-to-cma-config",children:"CMA\u914d\u7f6e"})," \u8fdb\u884c\u8bbe\u7f6e\u3002"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"CMA \u521d\u59cb\u5316"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u89c1 mm/cma.c \u4e2d\u7684 cma_init_reserved_areas() -> init_cma_reserved_pageblock()\uff0c\u5176\u4e2d\u4f1a\u8bbe\u7f6e page \u5c5e\u6027\u4e3a MIGRATE_CMA\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7533\u8bf7 CMA"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u4f7f\u7528 DMA \u6807\u51c6\u63a5\u53e3 dma_alloc_coherent() \u548c dma_alloc_wc()\uff0c\u4f1a\u95f4\u63a5\u8c03\u7528 dma_alloc_from_contiguous()\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u91ca\u653e CMA"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u4f7f\u7528 DMA \u6807\u51c6\u63a5\u53e3 dma_free_coherent()\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h5,{id:"5322-dma-buf",children:"5.3.2.2. DMA-BUF"}),"\n",(0,r.jsx)(e.p,{children:"CMA \u89e3\u51b3\u7684\u662f\u9884\u7559\u5185\u5b58\u7a7a\u95f2\u671f\u95f4\u5982\u4f55\u7ed9\u5176\u4ed6\u8bbe\u5907\u5171\u4eab\u7684\u95ee\u9898\uff0cDMA-BUF \u89e3\u51b3\u7684\u662f\u4f7f\u7528\u671f\u95f4\u591a\u4e2a\u8bbe\u5907\u5171\u4eab\u7684\u95ee\u9898\u3001\u4ee5\u53ca\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u5982\u4f55\u5171\u4eab\u5185\u5b58\u7684\u95ee\u9898\u3002DMA-BUF \u53ef\u51cf\u5c11\u591a\u4f59\u7684\u62f7\u8d1d\uff0c\u63d0\u5347\u7cfb\u7edf\u8fd0\u884c\u6548\u7387\u3002"}),"\n",(0,r.jsx)(e.p,{children:"DMA-BUF \u6700\u521d\u539f\u578b\u662fs hrbuf\uff0c\u4e8e 2011 \u5e74\u9996\u6b21\u63d0\u51fa\uff0c\u5b9e\u73b0\u4e86 \u201cBuffer Sharing\u201d \u7684\u6982\u5ff5\u9a8c\u8bc1\u3002shrbuf \u88ab\u793e\u533a\u91cd\u6784\u53d8\u8eab\u4e3a DMA-BUF\uff0c2012\u5e74\u5408\u5165 Linux-3.3 \u4e3b\u7ebf\u7248\u672c\u3002"}),"\n",(0,r.jsx)(e.p,{children:"DMA-BUF \u88ab\u5e7f\u6cdb\u7528\u5728\u591a\u5a92\u4f53\u9a71\u52a8\u4e2d\uff0c\u5c24\u5176\u5728 V4L2\u3001DRM \u5b50\u7cfb\u7edf\u4e2d\u7ecf\u5e38\u7528\u5230\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"DMA-BUF vs ION"})}),"\n",(0,r.jsx)(e.p,{children:"\u4ece Linux-5.6 \u5f00\u59cb\uff0cDMA-BUF \u6b63\u5f0f\u5408\u5165\u4e86\u539f\u6765 ION \u7684 heap \u7ba1\u7406\u529f\u80fd\uff0c\u793e\u533a\u7684\u4e3b\u5206\u652f\u662f\u6253\u7b97\u629b\u5f03 ION \u4e86\u3002\u5728Linux-5.11\uff0c\u4e3b\u5206\u652f\u5df2\u7ecf\u5220\u9664\u4e86 drivers/staging/android/ion \u4ee3\u7801\uff0c\u539f\u56e0\u662f\u201c\u539f\u5382\u5bf9ION\u7684\u652f\u6301\u5728\u793e\u533a\u4e2d\u4e0d\u592a\u6d3b\u8dc3\uff0c\u5f88\u96be\u6301\u7eed\u66f4\u65b0ION\u201d\uff0c\u800c\u4e14ION\u8fd8\u5e26\u6765\u4e86\u51e0\u4e2aABI break\u3002"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"ION \u6709\u5927\u91cf\u7684 heap \u903b\u8f91\u7ba1\u7406\uff0c\u800c DMA-BUF \u7684 heap \u66f4\u591a\u662f\u5206\u914d\u63a5\u53e3\u4e0a\u7684\u7ba1\u7406\uff08\u793e\u533a\u66f4\u5bb9\u6613\u63a5\u53d7\uff09\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"ION \u662f\u751f\u4ea7\u4e00\u4e2a\u5b57\u7b26\u8bbe\u5907 /dev/ion\uff0c\u800c DMA-BUF \u4e3a\u6bcf\u4e2a heap \u751f\u6210\u4e00\u4e2a\u5b57\u7b26\u8bbe\u5907\uff0c\u4fbf\u4e8e\u7528\u6237\u6001\u7684heap\u533a\u5206\u548c\u6743\u9650\u7ba1\u7406\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"ION \u9650\u5236\u6700\u591a32\u4e2a heap\uff0cDMA-BUF \u6ca1\u6709\u8fd9\u4e2a\u9650\u5236\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"DMA-BUF\u4e2d\u5b9e\u73b0\u4e86\u4e24\u4e2a\u521d\u59cb\u7684 heap\uff1asystem heap \u548c cma heap\uff0c\u4e0e\u539f ION \u4e2d\u7684\u529f\u80fd\u7c7b\u4f3c\uff0c\u4f46\u505a\u4e86\u5f88\u5927\u7b80\u5316\uff08\u4e3a\u4e86\u65b9\u4fbf\u793e\u533a review\uff09\uff0c\u5220\u6389\u539f\u6765 ION \u4e2d\u9488\u5bf9 system\u3001cma \u505a\u8fc7\u7684\u4e00\u4e9b\u4f18\u5316\uff0c\u6d89\u53ca uncached buffers\u3001large page allocation\u3001page pooling\u548cdeferred freeing\u3002 DMA-BUF \u4e2d\u7684 CMA\uff0c\u53ea\u6dfb\u52a0\u4e86default CMA \u533a\u57df\u3002\u539f ION \u4e2d\u7684 CMA \u662f\u6dfb\u52a0\u4e86\u6240\u6709 DMA \u533a\u57df\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u5de5\u4f5c\u673a\u5236"})}),"\n",(0,r.jsx)(e.p,{children:"\u4e3a\u4e86\u89e3\u51b3\u5404\u4e2a\u9a71\u52a8\u4e4b\u95f4\u7684 buffer \u5171\u4eab\u95ee\u9898\uff0cDMA-BUF \u5c06 buffer \u4e0e file \u7ed3\u5408\u4f7f\u7528\uff0c\u8ba9 DMA-BUF \u65e2\u662f\u4e00\u5757\u7269\u7406 buffer\uff0c\u540c\u65f6\u4e5f\u662f\u4e2a Linux \u6807\u51c6 file\u3002\u5178\u578b\u7684\u5e94\u7528\u6846\u56fe\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf1-170668827127813.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf1.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u5206\u914d buffer \u7684\u6a21\u5757\u4e3a exporter\uff0c\u4f7f\u7528\u8be5 buffer \u7684\u6a21\u5757\u4e3a importer\u3002"}),"\n",(0,r.jsx)(e.p,{children:"DMA-BUF \u652f\u6301\u8fde\u7eed\u7269\u7406\u5185\u5b58\u3001\u6563\u5217\u7269\u7406\u5185\u5b58\u7684 buffer \u7ba1\u7406\u3002ArtInChip \u5e73\u53f0\u76ee\u524d\u53ea\u652f\u6301\u8fde\u7eed\u7269\u7406\u5185\u5b58\u7684 DMA-BUF\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u4e3b\u8981\u63a5\u53e3"})}),"\n",(0,r.jsx)(e.p,{children:"\u5185\u6838\u7a7a\u95f4"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u4f5c\u4e3a exporter"}),"\n",(0,r.jsxs)(e.p,{children:["\u6ce8\u518c\u63a5\u53e3 ",(0,r.jsx)(e.code,{children:"dma_buf_export()"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u4f5c\u4e3a importer"}),"\n",(0,r.jsxs)(e.p,{children:["\u83b7\u53d6buf\u7684\u63a5\u53e3\uff1a",(0,r.jsx)(e.code,{children:"dma_buf_get"}),",",(0,r.jsx)(e.code,{children:"dma_buf_attach()"}),",",(0,r.jsx)(e.code,{children:"dma_buf_map_attachment"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u7528\u6237\u7a7a\u95f4"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsx)(e.p,{children:"\u901a\u8fc7 ioctl \u6765\u7ba1\u7406 DMA-BUF\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u57fa\u4e8e DMA-BUF \u7684 Video Layer buffer \u7ba1\u7406"})}),"\n",(0,r.jsx)(e.p,{children:"UI Layer\u7684 buffer\uff0c\u7531 driver \u7533\u8bf7\uff0c\u901a\u8fc7 /dev/fb0 \u900f\u4f20\u5230\u7528\u6237\u6001\uff0c\u7528\u6237\u6001\u4f7f\u7528 mmap() \u5b9e\u73b0 buffer \u5171\u4eab\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u4f46\u5bf9\u4e8e Video Layer \u7684 buffer\uff0c\u60c5\u51b5\u6709\u6240\u4e0d\u540c\uff0c\u7533\u8bf7\u591a\u5927 buffer\u3001\u591a\u5c11\u4e2a buffer \u90fd\u662f\u7531\u5e94\u7528\u573a\u666f\u786e\u5b9a\uff0c\u6240\u4ee5\u5e94\u8be5\u662f\u7528\u6237\u6001\u53d1\u8d77\u7533\u8bf7\u3002\u540c\u65f6\u8fd9\u4e2a buffer \u8fd8\u8981\u6ee1\u8db3\u7269\u7406\u8fde\u7eed\u7684\u7279\u6027\uff0cDE \u786c\u4ef6\u624d\u80fd\u7528\u6765\u505a\u56fe\u5c42\u53e0\u52a0\u5904\u7406\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_heap-170668828133515.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_heap.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u5de6\u56fe\uff0c\u662f ION \u65f6\u4ee3\u7684\u4f7f\u7528\u65b9\u6cd5\uff0c\u65b0\u7248 Linux\uff08Linux-5.6\u4ee5\u540e\uff09\u7684 DMA-BUF \u5df2\u7ecf\u652f\u6301\u4e86 heap \u529f\u80fd\uff0c\u4ece\u529f\u80fd\u4e0a\u5b8c\u5168\u53ef\u4ee5\u66ff\u4ee3 ION\u3002\u5bf9\u7528\u6237\u6001\u6765\u8bf4\uff0c\u770b\u5230\u7684\u5dee\u522b\u4e0d\u518d\u662f\u5355\u4e00\u7684 /dev/ion \u8bbe\u5907\u8282\u70b9\uff0c\u800c\u662f\u6709\u591a\u4e2a /dev/* \u8bbe\u5907\u8282\u70b9\uff0c\u6bd4\u5982 CMA heap \u4f1a\u751f\u6210 /dev/dma_heap/reserved\uff0cSystem heap \u4f1a\u751f\u6210 /dev/dma_heap/system\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u4f7f\u7528 DMA-BUF \u7684\u60c5\u51b5\u4e0b\uff0cAPP \u548c fb \u9a71\u52a8\u5171\u4eab buffer \u7684\u521d\u59cb\u5316\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_app-170668828975517.png",alt:"../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_app.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u5176\u4e2d\u7b2c3\u6b65\u7684\u64cd\u4f5c\u6bd4\u8f83\u5570\u55e6\uff0cfb \u9a71\u52a8\u6839\u636e APP \u4f20\u6765\u7684\u4e00\u7ec4fd[]\uff0c\u9010\u4e2a\u53bb\u5411 DMA-BUF \u6a21\u5757\u7533\u8bf7\u4ee5\u4e0b\u8d44\u6e90\uff1adma_buf -> attatch -> sg_table -> dma_addr_t\uff0c\u5e76\u5c06\u8fd9\u7ec4\u8d44\u6e90\u4fdd\u5b58\u5728\u672c\u5730\uff08struct aic_de_dmabuf\uff09\uff0c\u7528\u4e8e\u91ca\u653e DMA-BUF\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u8fd9\u91cc\u9762\u6709\u4e00\u4e2a\u5047\u8bbe\uff1asg_table \u4e2d\u53ea\u6709\u4e00\u4e2a sg\u3002\u4e5f\u5c31\u662f\u8bf4\u5355\u4e2a DMA-BUF \u5fc5\u987b\u662f\u7269\u7406\u8fde\u7eed\u7684\uff0c\u4e0d\u80fd\u662f\u591a\u5757 buf \u62fc\u8d77\u6765\u7684\uff0c\u5426\u5219\u7269\u7406\u5730\u5740 dma_addr_t \u5c31\u4e0d\u80fd\u4ee3\u8868\u591a\u5757 buf \u7684\u8d77\u59cb\u5730\u5740\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5bf9\u4e8e\u91ca\u653e\u8fc7\u7a0b\uff0cAPP\u9700\u8981\u5148\u901a\u77e5FB\u9a71\u52a8\u8981\u91ca\u653e\u7684fb[]\uff0c\u7136\u540e\u518d\u4f7f\u7528\u7528\u6237\u6001\u6587\u4ef6\u63a5\u53e3close()\u9010\u4e2a\u5173\u95edfb[]\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"\u4e4b\u6240\u4ee5\u7533\u8bf7\u201c\u4e00\u7ec4fd[]\u201d\uff0c\u662f\u56e0\u4e3avideo\u64ad\u653e\u8fc7\u7a0b\u4e2d\u4e3a\u4e86\u8fb9\u663e\u793a\u8fb9\u89e3\u7801\uff0c\u81f3\u5c11\u9700\u8981\u4e24\u5957 Buffer \u6765\u5b9e\u73b0\u4e52\u4e53\u6548\u679c\uff08\u5b9e\u9645\u5e94\u7528\u4e2d\u4e3a\u4e86\u66f4\u6d41\u7545\uff0c\u53ef\u80fd\u8fd8\u9700\u8981\u7533\u8bf7\u591a\u5957 Buffer \u6784\u6210\u5faa\u73af Buffer\uff09\u3002\u8fd9\u91cc\u8bf4\u7684\u201c\u4e00\u5957Buffer\u201d\u5bf9\u5e94\u89c6\u9891\u7684\u4e00\u5e27\u6570\u636e\uff0c\u800c\u4e00\u5e27\u89c6\u9891\u6570\u636e\u5f80\u5f80\u5206\u6210YUV\u4e09\u4e2a\u5206\u91cf\uff0c\u6bcf\u4e2a\u5206\u91cf\u5728\u89e3\u7801\u8fc7\u7a0b\u4e2d\u662f\u9700\u8981\u5206\u522b\u5904\u7406\uff08\u5bf9\u5e94DE\u5bc4\u5b58\u5668\u4e2daddr0\u3001addr1\u3001addr2\uff09\uff0c\u6240\u4ee5\u201c\u4e00\u5957Buffer\u201d\u5e94\u8be5\u662f Y\u3001U\u3001V \u51713\u4e2aBuffer\u3002\u5bf9\u4e8e\u4e52\u4e53\u7ed3\u6784\u7684 Buffer\uff0c\u5c31\u9700\u8981\u7533\u8bf7 3*2=6 \u4e2aDMA-BUF\u7684fd\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["UI Layer \u7684 buffer \u7533\u8bf7\uff0c\u662f\u76f4\u63a5\u8c03\u7528\u901a\u7528 DMA \u63a5\u53e3 ",(0,r.jsx)(e.code,{children:"dma_alloc_coherent()"}),"\uff0c\u6700\u7ec8\u5728 CMA \u5185\u5b58\u4e2d\u5206\u914d\u3002\u8fd9\u6837\u5e76\u4e0d\u5f71\u54cd Video Layer\u7684 buffer \u8d70 DMA-BUF \u7533\u8bf7\uff0cCMA \u6a21\u5757\u5185\u90e8\u4f1a\u5904\u7406\u597d\u6765\u81ea\u5404\u79cd\u63a5\u53e3\u7684 Buffer \u7533\u8bf7\u3002"]}),"\n",(0,r.jsx)(e.h5,{id:"533-backlight",children:"5.3.3. Backlight"}),"\n",(0,r.jsx)(e.p,{children:"Backlight \u4f7f\u7528\u5185\u6838\u4e2d pwm-backlight \u80cc\u5149\u9a71\u52a8\uff0c\u4ee3\u7801\u89c1 linux-5.10driversvideobacklightpwm_bl.c\u3002"}),"\n",(0,r.jsx)(e.p,{children:"panel \u9a71\u52a8\u53ef\u4ee5\u901a\u8fc7 DTS \u83b7\u53d6\u80cc\u5149\u9a71\u52a8\u7684 device node , \u7136\u540e backlight API \u63a7\u5236\u80cc\u5149\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"backlight_enable() \u4f7f\u80fd\u80cc\u5149"}),"\n",(0,r.jsx)(e.li,{children:"backlight_update_status() \u5bf9\u80cc\u5149\u72b6\u6001\u8fdb\u884c\u66f4\u65b0"}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'backlight {\n   compatible = "pwm-backlight";\n   /* pwm node name; pwm device No.; period_ns; pwm_polarity */\n   pwms = <&pwm 0 1000000 PWM_POLARITY_INVERTED>;\n   brightness-levels = <0 10 20 30 40 50 60 70 80 90 100>;\n   default-brightness-level = <8>;\n   status = "okay";\n};\n\npanel_rgb {\n   compatible = "artinchip,aic-general-rgb-panel";\n\n   backlight = <&backlight>;\n\n};  // \u4e3a\u8282\u7701\u7bc7\u5e45\uff0c\u5df2\u7701\u7565\u65e0\u5173\u914d\u7f6e\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u5e94\u7528\u7a0b\u5e8f\u5bf9\u80cc\u5149\u8fdb\u884c\u64cd\u4f5c\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"echo 2 > /sys/class/backlight/backlight/brightness\n"})}),"\n",(0,r.jsx)(e.h3,{id:"54-\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",children:"5.4. \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1"}),"\n",(0,r.jsx)(e.h4,{id:"541-uapivideoartinchip_videoh",children:"5.4.1. uapi/video/artinchip_video.h"}),"\n",(0,r.jsx)(e.h5,{id:"5411-struct-aic_rect",children:"5.4.1.1. struct aic_rect"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"struct aic_rect {\n    int x;\n    int y;\n    int width;\n    int height;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5412-struct-aic_point",children:"5.4.1.2. struct aic_point"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"struct aic_point {\n    int x;\n    int y;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5413-struct-aic_size",children:"5.4.1.3. struct aic_size"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"struct aic_size {\n    int width;\n    int height;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5414-enum-aic_pixel_format",children:"5.4.1.4. enum aic_pixel_format"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"enum aic_pixel_format {\n    AIC_FMT_ARGB_8888            = 0x00,\n    AIC_FMT_ABGR_8888            = 0x01,\n    AIC_FMT_RGBA_8888            = 0x02,\n    AIC_FMT_BGRA_8888            = 0x03,\n    AIC_FMT_XRGB_8888            = 0x04,\n    AIC_FMT_XBGR_8888            = 0x05,\n    AIC_FMT_RGBX_8888            = 0x06,\n    AIC_FMT_BGRX_8888            = 0x07,\n    AIC_FMT_RGB_888              = 0x08,\n    AIC_FMT_BGR_888              = 0x09,\n    AIC_FMT_ARGB_1555            = 0x0a,\n    AIC_FMT_ABGR_1555            = 0x0b,\n    AIC_FMT_RGBA_5551            = 0x0c,\n    AIC_FMT_BGRA_5551            = 0x0d,\n    AIC_FMT_RGB_565              = 0x0e,\n    AIC_FMT_BGR_565              = 0x0f,\n    AIC_FMT_ARGB_4444            = 0x10,\n    AIC_FMT_ABGR_4444            = 0x11,\n    AIC_FMT_RGBA_4444            = 0x12,\n    AIC_FMT_BGRA_4444            = 0x13,\n\n    AIC_FMT_YUV420P              = 0x20,\n    AIC_FMT_NV12                 = 0x21,\n    AIC_FMT_NV21                 = 0x22,\n    AIC_FMT_YUV422P              = 0x23,\n    AIC_FMT_NV16                 = 0x24,\n    AIC_FMT_NV61                 = 0x25,\n    AIC_FMT_YUYV                 = 0x26,\n    AIC_FMT_YVYU                 = 0x27,\n    AIC_FMT_UYVY                 = 0x28,\n    AIC_FMT_VYUY                 = 0x29,\n    AIC_FMT_YUV400               = 0x2a,\n    AIC_FMT_YUV444P              = 0x2b,\n\n    AIC_FMT_YUV420_64x32_TILE    = 0x30,\n    AIC_FMT_YUV420_128x16_TILE   = 0x31,\n    AIC_FMT_YUV422_64x32_TILE    = 0x32,\n    AIC_FMT_YUV422_128x16_TILE   = 0x33,\n    AIC_FMT_MAX,\n};\n"})}),"\n",(0,r.jsx)(e.h4,{id:"542-uapivideoartinchip_fbh",children:"5.4.2. uapi/video/artinchip_fb.h"}),"\n",(0,r.jsx)(e.h5,{id:"5421-struct-aicfb_layer_num",children:"5.4.2.1. struct aicfb_layer_num"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_layer_num - aicfb layer number\n * @vi_num: number of video layers\n * @ui_num: number of UI layers\n *\n *  total_layer_num = vi_num + ui_num\n *\n *  layer id range: [0, total_layer_num - 1]\n */\nstruct aicfb_layer_num {\n    unsigned int vi_num;\n    unsigned int ui_num;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5422-struct-aicfb_layer_capability",children:"5.4.2.2. struct aicfb_layer_capability"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_layer_capability - aicfb layer capability\n * @layer_id: the layer id\n * @layer_type: the layer type\n *  0: UI layer\n *  1: Video layer\n * @max_width:  the max pixels per line\n * @max_height: the max lines\n * @cap_flags:  flags of layer capability\n */\nstruct aicfb_layer_capability {\n    unsigned int layer_id;\n    unsigned int layer_type;\n    unsigned int max_width;\n    unsigned int max_height;\n    unsigned int cap_flags;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5423-struct-aicfb_buffer",children:"5.4.2.3. struct aicfb_buffer"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_buffer - aicfb frame buffer\n * @phy_addr[3]: address of frame buffer\n *  single addr for interleaved fomart with 1 plane,\n *  double addr for semi-planar fomart with 2 planes,\n *  triple addr for planar format with 3 planes\n * @size: width and height of aicfb_buffer\n * @stride[3]: stride for all planes\n * @crop_en: corp disable/enable ctrl\n *  0: disable crop the buffer\n *  1: enable crop the buffer\n * @crop: crop info\n * @format: color format\n * @buf_flags: aicfb buffer flags\n */\nstruct aicfb_buffer {\n    unsigned int            phy_addr[AICFB_PLANE_NUM];\n    unsigned int            dmabuf_fd[AICFB_PLANE_NUM];\n    unsigned int            stride[AICFB_PLANE_NUM];\n    struct aic_size         size;\n    unsigned int            crop_en;\n    struct aic_rect         crop;\n    enum aic_pixel_format   format;\n    unsigned int            buf_flags;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5424-struct-aicfb_layer_data",children:"5.4.2.4. struct aicfb_layer_data"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_layer_data - aicfb layer data\n * @enable\n *  0: disable the layer\n *  1: enable the layer\n * @layer_id: the layer id\n *\n * @rect_id: the rectanglular window id of the layer\n *  only used by layers with multi-rectangular windows\n *  for example: if the layer has 4 rectangular windows,\n *  rect_id can be 0,1,2 or 3 for different windows\n *\n * @scale_size:  scaling size\n *  if the layer can be scaled. the scaling size can be different\n *  from the input buffer. the input buffer can be original aicfb_buffer\n *  or crop aicfb_buffer, otherwise, the scaling size will be ignore\n *\n * @pos: left-top x/y coordinate of the screen in pixels\n * @buf: frame buffer\n */\nstruct aicfb_layer_data {\n    unsigned int enable;\n    unsigned int layer_id;\n    unsigned int rect_id;\n    struct aic_size scale_size;\n    struct aic_point pos;\n    struct aicfb_buffer buf;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5425-struct-aicfb_config_lists",children:"5.4.2.5. struct aicfb_config_lists"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_config_lists - aicfb config lists\n * @num: the total number of layer data config lists\n * @layers[]: the array of aicfb_layer_data lists\n */\nstruct aicfb_config_lists {\n    unsigned int num;\n    struct aicfb_layer_data layers[];\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5426-struct-aicfb_alpha_config",children:"5.4.2.6. struct aicfb_alpha_config"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_alpha_config - aicfb layer alpha blending config\n *\n * @layer_id: the layer id\n *\n * @enable\n *  0: disable alpha\n *  1: enable alpha\n *\n * @mode: alpha mode\n *  0: pixel alpha mode\n *  1: global alpha mode\n *  2: mixder alpha mode(alpha = pixel alpha * global alpha / 255)\n *\n * @value: global alpha value (0~255)\n *  used by global alpha mode and mixer alpha mode\n *\n */\nstruct aicfb_alpha_config {\n    unsigned int layer_id;\n    unsigned int enable;\n    unsigned int mode;\n    unsigned int value;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5427-struct-aicfb_ck_config",children:"5.4.2.7. struct aicfb_ck_config"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * struct aicfb_ck_config - aicfb layer color key blending config\n *\n * @layer_id: the layer id\n *\n * @ck_enable\n *  0: disable color key\n *  1: enable color key\n *\n *\n * @ck_value: color key rgb value to match the layer pixels\n *  bit[31:24]: reserved\n *  bit[23:16]: R value\n *  bit[15:8]: G value\n *  bit[7:0]: B value\n *\n */\nstruct aicfb_ck_config {\n    unsigned int layer_id;\n    unsigned int enable;\n    unsigned int value;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5428-struct-aicfb_dmabuf_fd",children:"5.4.2.8. struct aicfb_dmabuf_fd"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"/**\n * Transfer dma-buf fd from userspace to the importers in kernel.\n *\n * @fd: the actual fd, requested by mmap() in userspace\n * @phy_addr: the physical address of the actual fd\n *\n */\nstruct aicfb_dmabuf_fd {\n    int fd;\n    unsigned int phy_addr;\n};\n"})}),"\n",(0,r.jsx)(e.h5,{id:"5429-ioctl\u547d\u4ee4",children:"5.4.2.9. ioctl\u547d\u4ee4"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"#define IOC_TYPE_FB       'F'\n\n#define AICFB_WAIT_FOR_VSYNC  _IOW(IOC_TYPE_FB, 0x20, unsigned int)\n\n/** get layer number */\n#define AICFB_GET_LAYER_NUM  _IOR(IOC_TYPE_FB, 0x21, struct aicfb_layer_num)\n\n/** get layer capability */\n#define AICFB_GET_LAYER_CAPABILITY  _IOWR(IOC_TYPE_FB, 0x22,\\\n                    struct aicfb_layer_capability)\n\n/** get layer config data */\n#define AICFB_GET_LAYER_CONFIG  _IOWR(IOC_TYPE_FB, 0x23, \\\n                    struct aicfb_layer_data)\n\n/** update layer config data */\n#define AICFB_UPDATE_LAYER_CONFIG  _IOW(IOC_TYPE_FB, 0x24, \\\n                    struct aicfb_layer_data)\n\n/** update layer config data lists */\n#define AICFB_UPDATE_LAYER_CONFIG_LISTS  _IOW(IOC_TYPE_FB, 0x25, \\\n                        struct aicfb_config_lists)\n\n/** get layer alpha blendig config */\n#define AICFB_GET_ALPHA_CONFIG  _IOWR(IOC_TYPE_FB, 0x26, \\\n                    struct aicfb_alpha_config)\n\n/** update layer alpha blendig config */\n#define AICFB_UPDATE_ALPHA_CONFIG  _IOW(IOC_TYPE_FB, 0x27, \\\n                    struct aicfb_alpha_config)\n\n/** get layer color key config */\n#define AICFB_GET_CK_CONFIG  _IOWR(IOC_TYPE_FB, 0x26, struct aicfb_ck_config)\n\n/** update layer color key config */\n#define AICFB_UPDATE_CK_CONFIG  _IOW(IOC_TYPE_FB, 0x27, struct aicfb_ck_config)\n\n/** get screen size */\n#define AICFB_GET_SCREEN_SIZE  _IOR(IOC_TYPE_FB, 0x40, struct aic_size)\n\n/** get layer config data which the standard framebuffer is used\n * call this API to get which layer the standard framebuffer is used.\n */\n#define AICFB_GET_FB_LAYER_CONFIG  _IOR(IOC_TYPE_FB, 0x41, \\\n                    struct aicfb_layer_data)\n\n#define AICFB_GET_DMABUF _IOW(IOC_TYPE_FB, 0x50, struct aicfb_dmabuf_fd)\n#define AICFB_PUT_DMABUF _IOW(IOC_TYPE_FB, 0x51, struct aicfb_dmabuf_fd)\n\n/** export a dma_buf fd, associates /dev/fb0 */\n#define AICFB_TO_DMABUF_FD _IOW(IOC_TYPE_FB, 0x52, struct aicfb_dmabuf_fd)\n"})}),"\n",(0,r.jsx)(e.h3,{id:"55-\u63a5\u53e3\u8bbe\u8ba1",children:"5.5. \u63a5\u53e3\u8bbe\u8ba1"}),"\n",(0,r.jsx)(e.h4,{id:"551-\u6982\u8ff0",children:"5.5.1. \u6982\u8ff0"}),"\n",(0,r.jsx)(e.p,{children:"AICFB \u663e\u793a\u9a71\u52a8\u63a5\u53e3\u5206\u53ef\u4e3a\u6807\u51c6\u529f\u80fd\u548c\u6269\u5c55\u529f\u80fd\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6807\u51c6\u529f\u80fd\uff1a"}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u5c06\u7269\u7406\u663e\u5b58\u6620\u5c04\u5230\u7528\u6237\u7a7a\u95f4"}),"\n",(0,r.jsx)(e.li,{children:"\u83b7\u53d6\u663e\u793a\u5c4f\u7684\u5206\u8fa8\u7387\u548c\u83b7\u53d6 Framebuffer \u7684\u50cf\u7d20\u683c\u5f0f"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301\u5355\u7f13\u51b2 Framebuffer \u548c\u53cc\u7f13\u51b2 Framebuffer \u53ef\u914d\u7f6e"}),"\n"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u6269\u5c55\u529f\u80fd\uff1a"}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u83b7\u53d6\u56fe\u5c42\u4e2a\u6570"}),"\n",(0,r.jsx)(e.li,{children:"\u83b7\u53d6\u56fe\u5c42\u80fd\u529b"}),"\n",(0,r.jsx)(e.li,{children:"\u83b7\u53d6\u56fe\u5c42\u914d\u7f6e\u6570\u636e"}),"\n",(0,r.jsx)(e.li,{children:"\u66f4\u65b0\u56fe\u5c42\u914d\u7f6e\u6570\u636e"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301\u540c\u65f6\u66f4\u65b0\u591a\u56fe\u5c42\u914d\u7f6e\u6570\u636e"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301\u56fe\u5c42 scaler \u8bbe\u7f6e"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 alpha blending \u8bbe\u7f6e"}),"\n",(0,r.jsx)(e.li,{children:"\u652f\u6301 color key"}),"\n",(0,r.jsx)(e.li,{children:"\u83b7\u53d6\u663e\u793a\u5c4f\u5927\u5c0f"}),"\n",(0,r.jsx)(e.li,{children:"\u7ed1\u5b9a DMA-BUF"}),"\n",(0,r.jsx)(e.li,{children:"\u89e3\u7ed1 DMA-BUF"}),"\n",(0,r.jsx)(e.li,{children:"\u5c06 /dev/fb0 \u5bfc\u51fa\u4e3a dmabuf fd"}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"552-framebuffer\u6807\u51c6\u63a5\u53e3",children:"5.5.2. Framebuffer\u6807\u51c6\u63a5\u53e3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"int ioctl(int fd, unsigned long cmd, CMD_DATA_TYPE *cmddata);\n"})}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u53c2\u6570"}),(0,r.jsx)(e.th,{children:"\u63cf\u8ff0"}),(0,r.jsx)(e.th,{children:"\u8f93\u5165/\u8f93\u51fa"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"Fd"}),(0,r.jsx)(e.td,{children:"\u6253\u5f00FB\u8bbe\u5907\u540e\u8bbe\u5907\u63cf\u8ff0\u7b26"}),(0,r.jsx)(e.td,{children:"\u8f93\u5165"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"cmd"}),(0,r.jsx)(e.td,{children:"\u4e3b\u8981\u7684cmd\u547d\u4ee4\u5982\u4e0b\uff1aFBIOGET_VSCREENINFO\uff1a\u83b7\u53d6\u5c4f\u5e55\u53ef\u53d8\u4fe1\u606fFBIOPUT_VSCREENINFO\uff1a\u8bbe\u7f6e\u5c4f\u5e55\u53ef\u53d8\u4fe1\u606fFBIOGET_FSCREENINFO\uff1a\u83b7\u53d6\u5c4f\u5e55\u56fa\u5b9a\u4fe1\u606fFBIOPAN_DISPLAY\uff1a\u8bbe\u7f6ePAN \u663e\u793aFBIO_WAITFORVSYNC: \u7b49\u5f85vsync\u4fe1\u53f7"}),(0,r.jsx)(e.td,{children:"\u8f93\u5165"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"cmddata"}),(0,r.jsx)(e.td,{children:"\u5404cmd \u5bf9\u5e94\u7684\u6570\u636e\u7c7b\u578b\u5206\u522b\u662f\uff1a\u5c4f\u5e55\u53ef\u53d8\u4fe1\u606f\uff1astruct fb_var_screeninfo *\u7c7b\u578b\u5c4f\u5e55\u56fa\u5b9a\u4fe1\u606f\uff1astruct fb_fix_screeninfo *\u7c7b\u578bPAN\u663e\u793a\uff1astruct fb_var_screeninfo *\u7c7b\u578b"}),(0,r.jsx)(e.td,{children:"\u8f93\u5165/\u8f93\u51fa"})]})]})]}),"\n",(0,r.jsx)(e.h4,{id:"553-\u6269\u5c55\u63a5\u53e3",children:"5.5.3. \u6269\u5c55\u63a5\u53e3"}),"\n",(0,r.jsx)(e.h5,{id:"5531-aicfb_wait_for_vsync",children:"5.5.3.1. AICFB_WAIT_FOR_VSYNC"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, unsigned int *pvalue);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u7b49\u5f85Vsync\u4fe1\u53f7"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsx)(e.td,{children:"CMD: AICFB_WAIT_FOR_VSYNCpvalue:\u8be5\u503c\u65e0\u610f\u4e49\uff0c\u56fa\u5b9a\u4e3aNULL"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5532-aicfb_get_layer_num",children:"5.5.3.2. AICFB_GET_LAYER_NUM"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_layer_num *pvalue);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u83b7\u53d6\u663e\u793a\u56fe\u5c42\u7684\u4e2a\u6570, \u5305\u62ecUI \u56fe\u5c42\u4e2a\u6570\u548cVideo \u56fe\u5c42"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_LAYER_NUMplayer_num: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-layer-num",children:"struct aicfb_layer_num"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5533-aicfb_get_layer_capability",children:"5.5.3.3. AICFB_GET_LAYER_CAPABILITY"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_layer_capability *player_cap);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u83b7\u53d6\u5f53\u524d\u56fe\u5c42\u7684\u80fd\u529b"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_LAYER_CAPABILITYplayer_cap: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-layer-capability",children:"struct aicfb_layer_capability"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u8c03\u7528\u63a5\u53e3\u524d\u8981\u5148\u586b\u5199\u7ed3\u6784\u4f53\u4e2d\u7684 layer_id"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5534-aicfb_get_layer_config",children:"5.5.3.4. AICFB_GET_LAYER_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_layer_data *player_conf);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u83b7\u53d6\u56fe\u5c42\u914d\u7f6e\u4fe1\u606f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_LAYER_CONFIGplayer_conf: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-layer-data",children:"struct aicfb_layer_data"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u8c03\u7528\u63a5\u53e3\u524d\u8981\u5148\u586b\u5199\u7ed3\u6784\u4f53\u4e2d\u7684layer_id\uff0c\u5982\u679c\u662f\u591a\u77e9\u5f62\u7a97\u53e3\u8981\u540c\u65f6\u586b\u5199rect_win_id"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5535-aicfb_update_layer_config",children:"5.5.3.5. AICFB_UPDATE_LAYER_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_layer_data *player_conf)"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u66f4\u65b0\u56fe\u5c42\u914d\u7f6e\u4fe1\u606f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_UPDATE_LAYER_CONFIGplayer_ocnf:\u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-layer-data",children:"struct aicfb_layer_data"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0: \u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u5982\u679c\u662f\u4ec5\u66f4\u65b0\u56fe\u5c42\u7684\u90e8\u5206config data \u4fe1\u606f\uff0c\u53ef\u4ee5\u5148\u8c03\u7528\u63a5\u53e3AICFB_GET_LAYER_CONFIG\uff0c\u83b7\u53d6\u5f53\u524d\u56fe\u5c42\u4fe1\u606f\uff0c\u7136\u540e\u518d\u4fee\u6539\u8981\u66f4\u65b0\u7684\u56fe\u50cf\u4fe1\u606f\uff0c\u6700\u540e\u518d\u8c03\u7528\u6b64\u63a5\u53e3\u66f4\u65b0\u56fe\u5c42\u4fe1\u606f"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5536-aicfb_update_layer_config_lists",children:"5.5.3.6. AICFB_UPDATE_LAYER_CONFIG_LISTS"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_config_lists *player_lists);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u66f4\u65b0\u56fe\u5c42\u914d\u7f6e\u6570\u636e\u5217\u8868"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_UPDATE_LAYER_CONFIG_LISTS aicfb_config_listsplayer_lists: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-config-lists",children:"struct aicfb_config_lists"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u901a\u8fc7\u6b64\u63a5\u53e3\u53ef\u4ee5\u540c\u65f6\u66f4\u65b0\u591a\u4e2a\u56fe\u5c42\u6216\u8005\u591a\u4e2a\u7a97\u53e3\u7684\u914d\u7f6e\u4fe1\u606f\u901a\u8fc7\u6b64\u63a5\u53e3\u8c03\u7528\u7684\u597d\u5904\u662f\u76f8\u5173\u56fe\u5c42\u914d\u7f6e\u7684\u66f4\u65b0\u53ef\u4ee5\u540c\u65f6\u751f\u6548"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5537-aicfb_get_alpha_config",children:"5.5.3.7. AICFB_GET_ALPHA_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_alpha_config *alpha);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u83b7\u53d6\u5f53\u524d\u56fe\u5c42\u7684Alpha\u914d\u7f6e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_ALPHA_CONFIGalpha: \u53c2\u7ed3\u8003\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-alpha-config",children:"struct aicfb_alpha_config"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5538-aicfb_update_alpha_config",children:"5.5.3.8. AICFB_UPDATE_ALPHA_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_alpha_config *alpha);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u66f4\u65b0\u5f53\u524d\u56fe\u5c42\u7684Alpha\u914d\u7f6e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_UPDATE_ALPHA_CONFIGalpha: \u53c2\u7ed3\u8003\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-alpha-config",children:"struct aicfb_alpha_config"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"5539-aicfb_get_ck_config",children:"5.5.3.9. AICFB_GET_CK_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_ck_config *player_ck);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u83b7\u53d6\u5f53\u524d\u56fe\u5c42\u7684CK\u914d\u7f6e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_CK_CONFIGplayer_ck: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-ck-config",children:"struct aicfb_ck_config"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5f53\u524d\u56fe\u5c42\u4e0d\u652f\u6301 color key"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"55310-aicfb_update_ck_config",children:"5.5.3.10. AICFB_UPDATE_CK_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_ck_config *player_ck);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u66f4\u65b0\u5f53\u524d\u56fe\u5c42\u7684CK\u914d\u7f6e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_SET_CK_CONFIGplayer_ck: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-ck-config",children:"struct aicfb_ck_config"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a \u6210\u529f-1\uff1a\u5f53\u524d\u56fe\u5c42\u4e0d\u652f\u6301 color key"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"55311-aicfb_get_screen_size",children:"5.5.3.11. AICFB_GET_SCREEN_SIZE"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aic_size *pscreen_size);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u66f4\u65b0\u5f53\u524d\u56fe\u5c42\u7684CK\u914d\u7f6e"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_SCREEN_SIZEpscreen_size: \u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aic-size",children:"struct aic_size"})," \u5b9a\u4e49\u4e86\u5c4f\u5e55\u7684\u5bbd\uff0c\u9ad8\u4fe1\u606f"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"55312-aicfb_get_fb_layer_config",children:"5.5.3.12. AICFB_GET_FB_LAYER_CONFIG"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_layer_data *player_conf);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u83b7\u53d6\u6807\u51c6framebuffer\u5360\u7528\u7684\u56fe\u5c42\u4fe1\u606f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_FB_LAYER_CONFIGplayer_conf: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-layer-data",children:"struct aicfb_layer_data"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"55313-aicfb_get_dmabuf",children:"5.5.3.13. AICFB_GET_DMABUF"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_dmabuf_fd *fds);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u901a\u77e5 fb \u9a71\u52a8\u7ed1\u5b9a DMA-BUF"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_GET_DMABUFfds: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-dmabuf-fd",children:"struct aicfb_dmabuf_fd"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"APP \u5728\u5c06 dmabuf \u9001\u7ed9 DE \u663e\u793a\u4e4b\u524d\u5fc5\u987b\u8fdb\u884c\u7ed1\u5b9a\uff0c\u5426\u5219\u65e0\u6cd5\u663e\u793a buf \u4e2d\u7684\u5185\u5bb9"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"55314-aicfb_put_dmabuf",children:"5.5.3.14. AICFB_PUT_DMABUF"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_dmabuf_fd *fds);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u901a\u77e5 fb \u9a71\u52a8\u89e3\u7ed1 DMA-BUF"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_PUT_DMABUFfds: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-dmabuf-fd",children:"struct aicfb_dmabuf_fd"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de \u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u65e0"})]})]})]}),"\n",(0,r.jsx)(e.h5,{id:"55315-aicfb_to_dmabuf_fd",children:"5.5.3.15. AICFB_TO_DMABUF_FD"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:"\u63a5\u53e3\u5b9a\u4e49"}),(0,r.jsx)(e.th,{children:"int ioctl(int fd, unsigned long cmd, struct aicfb_dmabuf_fd *fds);"})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,r.jsx)(e.td,{children:"\u5c06 /dev/fb0 \u5bfc\u51fa\u4e3a\u4e00\u4e2a dmabuf fd"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,r.jsxs)(e.td,{children:["CMD: AICFB_TO_DMABUF_FDfds: \u53c2\u8003\u7ed3\u6784\u4f53 ",(0,r.jsx)(e.a,{href:"data_structure.html#ref-to-aicfb-dmabuf-fd",children:"struct aicfb_dmabuf_fd"})," \u5b9a\u4e49"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u8fd4\u56de \u503c"}),(0,r.jsx)(e.td,{children:"0\uff1a\u6210\u529f-1\uff1a\u5931\u8d25"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,r.jsx)(e.td,{children:"\u5bfc\u51fa\u7684 dmabuf fd \u4e0d\u652f\u6301 mmap \u64cd\u4f5c\uff0c\u65e0\u6cd5\u5f97\u5230\u4e00\u4e2a\u6709\u6548\u7684\u865a\u62df\u5730\u5740"})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"56-app-demo",children:"5.6. APP Demo"}),"\n",(0,r.jsx)(e.h4,{id:"561-framebuffer\u6807\u51c6\u63a5\u53e3\u7684\u4f7f\u7528",children:"5.6.1. Framebuffer\u6807\u51c6\u63a5\u53e3\u7684\u4f7f\u7528"}),"\n",(0,r.jsx)(e.p,{children:"\u6807\u51c6framebuffer\u63a5\u53e3\u64cd\u4f5c\u793a\u4f8b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'int main()\n{\n    int fd = 0;\n    struct fb_var_screeninfo vi;\n    struct fb_fix_screeninfo fi;\n\n    void *fb_ptr = NULL;\n\n    fd = open("/dev/fb0", O_RDWR);\n    if (fd < 0) {\n        printf("failed to open fb0\\n");\n        return -1;\n    }\n\n    // \u83b7\u53d6\u53ef\u53d8\u5c4f\u5e55\u53c2\u6570\uff0c\u5982\u5206\u8fa8\u7387\uff0c\u50cf\u7d20\u683c\u5f0f\n    if (ioctl(fd, FBIOGET_VSCREENINFO, &vi) < 0) {\n        printf("failed to get fb0 info\\n");\n        close(fd);\n        return -1;\n    }\n\n    // \u83b7\u53d6\u5c4f\u5e55\u56fa\u5b9a\u53c2\u6570\uff0c\u5305\u62ec\u663e\u5b58\u8d77\u59cb\u7269\u7406\u5730\u5740\u3001\u663e\u5b58\u5927\u5c0f\u548c\u884c\u95f4\u8ddd\n    if (ioctl(fd, FBIOGET_FSCREENINFO, &fi) < 0) {\n        printf("failed to get fb0 info\\n");\n        close(fd);\n        return -1;\n    }\n\n    // framebuffer \u7f13\u51b2\u533a\u6620\u5c04\u5230\u7528\u6237\u7a7a\u95f4\uff1a\n    fb_ptr = mmap(0, fi.smem_len, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);\n    if (fb_ptr == MAP_FAILED) {\n        printf("failed to mmap framebuffer\\n");\n        close(fd);\n        return -1;\n    }\n\n    // \u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u628a\u8981\u663e\u793a\u5230\u5c4f\u5e55\u7684\u56fe\u50cf\u6570\u636e\u5199\u5165fb_ptr\u5373\u53ef\n    ........\n    ........\n\n    munmap(fb_ptr, fi.smem_len);\n    close(fd);\n\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(e.h4,{id:"562-aicfb\u6269\u5c55\u63a5\u53e3\u7684\u4f7f\u7528",children:"5.6.2. AICFB\u6269\u5c55\u63a5\u53e3\u7684\u4f7f\u7528"}),"\n",(0,r.jsx)(e.p,{children:"\u4ee3\u7801\u8be6\u89c1 source/artinchip/test-fb/test_fb.c"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'// SPDX-License-Identifier: GPL-2.0-only\n/*\n * Copyright (C) 2020-2021 Artinchip Technology Co., Ltd.\n * Authors:  Matteo <duanmt@artinchip.com>\n */\n\n#include "base.h"\n#include "artinchip_fb.h"\n\n/* Global macro and variables */\n\n#define AICFB_LAYER_MAX_NUM 2\n#define FB_DEV "/dev/fb0"\n\nstatic const char sopts[] = "nscflLaAkKedw:h:m:v:u";\nstatic const struct option lopts[] = {\n    {"get_layer_num",   no_argument, NULL, \'n\'},\n    {"get_screen_size", no_argument, NULL, \'s\'},\n    {"get_layer_cap",   no_argument, NULL, \'c\'},\n    {"get_fb_layer",    no_argument, NULL, \'f\'},\n    {"get_layer",       no_argument, NULL, \'l\'},\n    {"set_layer",       no_argument, NULL, \'L\'},\n    {"get_alpha",       no_argument, NULL, \'a\'},\n    {"set_alpha",     required_argument, NULL, \'A\'},\n    {"get_ck_cfg",      no_argument, NULL, \'k\'},\n    {"set_ck_cfg",      no_argument, NULL, \'K\'},\n    {"enable",      no_argument, NULL, \'e\'},\n    {"disable",     no_argument, NULL, \'d\'},\n    {"id",        required_argument, NULL, \'i\'},\n    {"width",     required_argument, NULL, \'w\'},\n    {"height",    required_argument, NULL, \'h\'},\n    {"mode",      required_argument, NULL, \'m\'},\n    {"value",     required_argument, NULL, \'v\'},\n    {"usage",       no_argument, NULL, \'u\'},\n    {0, 0, 0, 0}\n};\n\n/* Functions */\n\nvoid usage(char *program)\n{\n    printf("Usage: %s [options]: \\n", program);\n    printf("\\t -n, --get_layer_num \\n");\n    printf("\\t -s, --get_screen_size \\n");\n    printf("\\t -c, --get_layer_cap \\n");\n    printf("\\t -f, --get_fb_layer \\n");\n    printf("\\t -l, --get_layer \\n");\n    printf("\\t -L, --set_layer\\tneed other options: -i x -e/d -w y -h z\\n");\n    printf("\\t -a, --get_alpha \\n");\n    printf("\\t -A, --set_alpha\\tneed other options: -e/d -m x -v y \\n");\n    printf("\\t -k, --get_ck_cfg \\n");\n    printf("\\t -K, --set_ck_cfg\\tneed other options: -e/d -v x \\n");\n    printf("\\t -e, --enable \\n");\n    printf("\\t -d, --disable \\n");\n    printf("\\t -i, --id\\t\\tneed an integer argument of Layer ID\\n");\n    printf("\\t -w, --width\\t\\tneed an integer argument\\n");\n    printf("\\t -h, --height\\t\\tneed an integer argument\\n");\n    printf("\\t -m, --mode\\t\\tneed an integer argument\\n");\n    printf("\\t -v, --value\\t\\tneed an integer argument\\n");\n    printf("\\t -u, --usage \\n");\n    printf("\\n");\n    printf("Example: %s -l\\n", program);\n    printf("Example: %s -L -i 1 -e -w 800 -h 480\\n", program);\n    printf("Example: %s -A -e -w 800 -h 480\\n", program);\n    printf("Example: %s -K -e -v 0x3F\\n", program);\n}\n\n/* Open a device file to be needed. */\nint device_open(char *_fname, int _flag)\n{\n    s32 fd = -1;\n\n    fd = open(_fname, _flag);\n    if (fd < 0) {\n        ERR("Failed to open %s", _fname);\n        exit(0);\n    }\n    return fd;\n}\n\nint get_layer_num(int fd)\n{\n    int ret = 0;\n    struct aicfb_layer_num n = {0};\n\n    ret = ioctl(fd, AICFB_GET_LAYER_NUM, &n);\n    if (ret < 0) {\n        ERR("ioctl() return %d\\n", ret);\n    }\n    else {\n        printf("The number of video layer: %d\\n", n.vi_num);\n        printf("The number of UI layer: %d\\n", n.ui_num);\n    }\n    return ret;\n}\n\nint get_layer_cap(int fd)\n{\n    int i;\n    int ret = 0;\n    struct aicfb_layer_capability cap = {0};\n\n    for (i = 0; i < AICFB_LAYER_MAX_NUM; i++) {\n        memset(&cap, 0, sizeof(struct aicfb_layer_capability));\n        cap.layer_id = i;\n        ret = ioctl(fd, AICFB_GET_LAYER_CAPABILITY, &cap);\n        if (ret < 0) {\n            ERR("ioctl() return %d\\n", ret);\n            return ret;\n        }\n\n        printf("\\n--------------- Layer %d ---------------\\n", i);\n        printf("Type: %s\\n", cap.layer_type == AICFB_LAYER_TYPE_VIDEO ?\n            "Video" : "UI");\n        printf("Max Width: %d (%#x)\\n", cap.max_width, cap.max_width);\n        printf("Max height: %d (%#x)\\n", cap.max_height, cap.max_height);\n        printf("Flag: %#x\\n", cap.cap_flags);\n        printf("---------------------------------------\\n");\n    }\n    return ret;\n}\n\nint get_one_layer_cfg(int fd, int cmd, int id)\n{\n    int ret = 0;\n    struct aicfb_layer_data layer = {0};\n\n    layer.layer_id = id;\n    ret = ioctl(fd, cmd, &layer);\n    if (ret < 0) {\n        ERR("ioctl() return %d\\n", ret);\n        return ret;\n    }\n\n    printf("\\n--------------- Layer %d ---------------\\n", layer.layer_id);\n    printf("Enable: %d\\n", layer.enable);\n    printf("Layer ID: %d\\n", layer.layer_id);\n    printf("Rect ID: %d\\n", layer.rect_id);\n    printf("Scale Size: w %d, h %d\\n",\n        layer.scale_size.width, layer.scale_size.height);\n    printf("Position: x %d, y %d\\n", layer.pos.x, layer.pos.y);\n    printf("Buffer: \\n");\n    printf("\\tPixel format: %#x\\n", layer.buf.format);\n    printf("\\tPhysical addr: %#x %#x %#x\\n",\n        layer.buf.phy_addr[0], layer.buf.phy_addr[1],\n        layer.buf.phy_addr[2]);\n    printf("\\tStride: %d %d %d\\n", layer.buf.stride[0],\n        layer.buf.stride[1], layer.buf.stride[2]);\n    printf("\\tSize: w %d, h %d\\n",\n        layer.buf.size.width, layer.buf.size.height);\n    printf("\\tCrop enable: %d\\n", layer.buf.crop_en);\n    printf("\\tCrop: x %d, y %d, w %d, h %d\\n",\n        layer.buf.crop.x, layer.buf.crop.y,\n        layer.buf.crop.width, layer.buf.crop.height);\n    printf("\\tFlag: %#x\\n", layer.buf.buf_flags);\n    printf("---------------------------------------\\n");\n\n    return 0;\n}\n\nint get_fb_layer_cfg(int fd)\n{\n    return get_one_layer_cfg(fd, AICFB_GET_FB_LAYER_CONFIG, 0);\n}\n\nint get_layer_cfg(int fd)\n{\n    int i;\n\n    for (i = 0; i < AICFB_LAYER_MAX_NUM; i++)\n        get_one_layer_cfg(fd, AICFB_GET_LAYER_CONFIG, i);\n\n    return 0;\n}\n\nint set_layer_cfg(int fd, int id, int enable, int width, int height)\n{\n    int ret = 0;\n    struct aicfb_layer_data layer = {0};\n\n    if ((id < 0) || (enable < 0) || (width < 0) || (height < 0)) {\n        ERR("Invalid argument.\\n");\n        return -1;\n    }\n\n    layer.layer_id = id;\n    layer.enable = enable;\n    layer.scale_size.width = layer.buf.size.width;\n    layer.scale_size.height = layer.buf.size.height;\n    ret = ioctl(fd, AICFB_UPDATE_LAYER_CONFIG, &layer);\n    if (ret < 0)\n        ERR("ioctl() return %d\\n", ret);\n\n    return ret;\n}\n\nint get_layer_alpha(int fd)\n{\n    int i;\n    int ret = 0;\n    struct aicfb_alpha_config alpha = {0};\n\n    for (i = 1; i < AICFB_LAYER_MAX_NUM; i++) {\n        alpha.layer_id = i;\n        ret = ioctl(fd, AICFB_GET_ALPHA_CONFIG, &alpha);\n        if (ret < 0) {\n            ERR("ioctl() return %d\\n", ret);\n            return ret;\n        }\n\n        printf("\\n--------------- Layer %d ---------------\\n", i);\n        printf("Alpha enable: %d\\n", alpha.enable);\n        printf("Alpla mode: %d (0, pixel; 1, global; 2, mix)\\n",\n            alpha.mode);\n        printf("Alpha value: %d (%#x)\\n", alpha.value, alpha.value);\n        printf("---------------------------------------\\n");\n    }\n\n    return 0;\n}\n\nint set_layer_alpha(int fd, int enable, int mode, int val)\n{\n    int ret = 0;\n    struct aicfb_alpha_config alpha = {0};\n\n    if ((enable < 0) || (mode < 0) || (val < 0)) {\n        ERR("Invalid argument.\\n");\n        return -1;\n    }\n\n    alpha.layer_id = 1;\n    alpha.enable = enable;\n    alpha.mode = mode;\n    alpha.value = val;\n    ret = ioctl(fd, AICFB_UPDATE_ALPHA_CONFIG, &alpha);\n    if (ret < 0)\n        ERR("ioctl() return %d\\n", ret);\n\n    return ret;\n}\n\nint get_ck_cfg(int fd)\n{\n    int i;\n    int ret = 0;\n    struct aicfb_ck_config ck = {0};\n\n    for (i = 1; i < AICFB_LAYER_MAX_NUM; i++) {\n        ck.layer_id = i;\n        ret = ioctl(fd, AICFB_GET_CK_CONFIG, &ck);\n        if (ret < 0) {\n            ERR("ioctl() return %d\\n", ret);\n            return ret;\n        }\n\n        printf("\\n--------------- Layer %d ---------------\\n", i);\n        printf("Color key enable: %d\\n", ck.enable);\n        printf("Color key value: R %#x, G %#x, B %#x\\n",\n            (ck.value >> 16) & 0xFF, (ck.value >> 8) & 0xFF,\n            ck.value & 0xFF);\n        printf("---------------------------------------\\n");\n    }\n    return 0;\n}\n\nint set_ck_cfg(int fd, int enable, int val)\n{\n    int ret = 0;\n    struct aicfb_ck_config ck = {0};\n\n    if ((enable < 0) || (val < 0)) {\n        ERR("Invalid argument.\\n");\n        return -1;\n    }\n\n    ck.layer_id = 1;\n    ck.enable = enable;\n    ck.value = val;\n    ret = ioctl(fd, AICFB_UPDATE_CK_CONFIG, &ck);\n    if (ret < 0)\n        ERR("ioctl() return %d\\n", ret);\n\n    return ret;\n}\n\nint get_screen_size(int fd)\n{\n    int ret = 0;\n    struct aic_size s = {0};\n\n    ret = ioctl(fd, AICFB_GET_SCREEN_SIZE, &s);\n    if (ret < 0) {\n        ERR("ioctl() return %d\\n", ret);\n        return ret;\n    }\n\n    printf("Screen width: %d (%#x)\\n", s.width, s.width);\n    printf("Screen height: %d (%#x)\\n", s.height, s.height);\n    return 0;\n}\n\nint main(int argc, char **argv)\n{\n    int dev_fd = -1;\n    int ret = 0;\n    int c = 0;\n    int layer_id = 0;\n    int enable = 0;\n    int mode = 0;\n    int width = 0;\n    int height = 0;\n    int value = 0;\n\n    dev_fd = device_open(FB_DEV, O_RDWR);\n    if (dev_fd < 0) {\n        ERR("Failed to open %s, return %d\\n", FB_DEV, dev_fd);\n        return -1;\n    }\n\n    while ((c = getopt_long(argc, argv, sopts, lopts, NULL)) != -1) {\n        switch (c) {\n        case \'n\':\n            ret = get_layer_num(dev_fd);\n            goto end;\n        case \'s\':\n            ret = get_screen_size(dev_fd);\n            goto end;\n        case \'c\':\n            ret = get_layer_cap(dev_fd);\n            goto end;\n        case \'f\':\n            ret = get_fb_layer_cfg(dev_fd);\n            goto end;\n        case \'l\':\n            ret = get_layer_cfg(dev_fd);\n            goto end;\n        case \'a\':\n            ret = get_layer_alpha(dev_fd);\n            goto end;\n        case \'k\':\n            ret = get_ck_cfg(dev_fd);\n            goto end;\n        case \'e\':\n            enable = 1;\n            continue;\n        case \'d\':\n            enable = 0;\n            continue;\n        case \'i\':\n            layer_id = str2int(optarg);\n            continue;\n        case \'w\':\n            width = str2int(optarg);\n            continue;\n        case \'h\':\n            height = str2int(optarg);\n            continue;\n        case \'m\':\n            mode = str2int(optarg);\n            continue;\n        case \'v\':\n            value = str2int(optarg);\n            continue;\n        case \'u\':\n            usage(argv[0]);\n            goto end;\n        default:\n            continue;\n        }\n    }\n\n    optind = 0;\n    while ((c = getopt_long(argc, argv, sopts, lopts, NULL)) != -1) {\n        switch (c) {\n        case \'L\':\n            ret = set_layer_cfg(dev_fd, layer_id, enable, width, height);\n            goto end;\n        case \'A\':\n            ret = set_layer_alpha(dev_fd, enable, mode, value);\n            goto end;\n        case \'K\':\n            ret = set_ck_cfg(dev_fd, enable, value);\n            goto end;\n        default:\n            continue;\n        }\n    }\n\nend:\n    if (dev_fd > 0)\n        close(dev_fd);\n\n    return ret;\n}\n'})}),"\n",(0,r.jsx)(e.h4,{id:"563-dma-buf\u7684\u4f7f\u7528",children:"5.6.3. DMA-BUF\u7684\u4f7f\u7528"}),"\n",(0,r.jsx)(e.p,{children:"\u4ee3\u7801\u8be6\u89c1 source/artinchip/test-dma-buf/"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'// SPDX-License-Identifier: GPL-2.0-only\n/*\n * Copyright (C) 2020-2021 Artinchip Technology Co., Ltd.\n * Authors:  Matteo <duanmt@artinchip.com>\n */\n\n#include <artinchip/sample_base.h>\n#include <linux/dma-buf.h>\n#include <linux/dma-heap.h>\n#include <video/artinchip_fb.h>\n\n/* Global macro and variables */\n\n#define AICFB_VID_BUF_NUM   2\n#define AIC_CMA_BUF_MAX     (8 * 1024 * 1024)\n#define DMA_HEAP_DEV        "/dev/dma_heap/reserved"\n#define FB_DEV          "/dev/fb0"\n\nstatic const char sopts[] = "m:w:h:f:i:u";\nstatic const struct option lopts[] = {\n    {"width",     required_argument, NULL, \'w\'},\n    {"height",    required_argument, NULL, \'h\'},\n    {"format",    required_argument, NULL, \'f\'},\n    {"input",     required_argument, NULL, \'i\'},\n    {"usage",       no_argument, NULL, \'u\'},\n    {0, 0, 0, 0}\n};\n\nstruct video_data_format {\n    enum aic_pixel_format format;\n    char f_str[12];\n    int y_shift;\n    int u_shift;\n    int v_shift;\n};\n\nstruct video_data_format g_vformat[] = {\n    {AIC_FMT_YUV420P, "yuv420p", 0, 2, 2},\n    {AIC_FMT_YUV422P, "yuv422p", 0, 1, 1},\n    {AIC_FMT_YUV444P, "yuv444p", 0, 0, 0},\n\n    {AIC_FMT_MAX, "", 0, 0, 0}\n};\n\nstruct video_plane {\n    int fd;\n    char *buf;\n    int len;\n};\n\nstruct video_buf {\n    struct video_plane y;\n    struct video_plane u;\n    struct video_plane v;\n};\n\nstruct aicfb_video_layer {\n    int w;\n    int h;\n    struct video_data_format *f;\n    struct video_buf vbuf[AICFB_VID_BUF_NUM];\n};\n\nstatic int g_fb_fd = -1;\nstatic struct aicfb_video_layer g_vlayer = {0};\n\n/* Functions */\n\nvoid usage(char *program)\n{\n    printf("Usage: %s [options]: \\n", program);\n    printf("\\t -w, --width\\t\\tneed an integer argument\\n");\n    printf("\\t -h, --height\\t\\tneed an integer argument\\n");\n    printf("\\t -f, --format\\t\\tvideo format, yuv420p etc\\n");\n    printf("\\t -i, --input\\t\\tneed a file name \\n");\n    printf("\\t -u, --usage \\n");\n    printf("\\n");\n    printf("Example: %s -w 480 -h 320 -f yuv420p -i my.yuv\\n", program);\n}\n\n/* Open a device file to be needed. */\nint device_open(char *_fname, int _flag)\n{\n    s32 fd = -1;\n\n    fd = open(_fname, _flag);\n    if (fd < 0) {\n        ERR("Failed to open %s", _fname);\n        exit(0);\n    }\n    return fd;\n}\n\nint vidbuf_request_one(struct video_plane *plane, int len, int fd)\n{\n    int ret;\n    char *buf = NULL;\n    struct dma_heap_allocation_data data = {0};\n\n    if ((len < 0) || (len > AIC_CMA_BUF_MAX)) {\n        ERR("Invalid len %d\\n", len);\n        return -1;\n    }\n\n    data.fd = 0;\n    data.len = len;\n    data.fd_flags = O_RDWR;\n    data.heap_flags = 0;\n    ret = ioctl(fd, DMA_HEAP_IOCTL_ALLOC, &data);\n    if (ret < 0) {\n        ERR("ioctl() failed! errno: %d[%s]\\n", errno, strerror(errno));\n        return -1;\n    }\n\n    DBG("Get dma_heap fd: %d\\n", data.fd);\n    plane->fd = data.fd;\n\n    buf = mmap(NULL, len, PROT_READ|PROT_WRITE, MAP_SHARED, data.fd, 0);\n    if (buf == MAP_FAILED) {\n        ERR("mmap() failed! errno: %d[%s]\\n", errno, strerror(errno));\n        return -1;\n    }\n    DBG("Get virtual address: %p\\n", buf);\n    plane->buf = buf;\n    plane->len = len;\n    return 0;\n}\n\nvoid aic_fb_open(void)\n{\n    if (g_fb_fd > 0)\n        return;\n\n    g_fb_fd = device_open(FB_DEV, O_RDWR);\n    if (g_fb_fd < 0)\n        ERR("Failed to open %s. errno: %d[%s]\\n",\n            FB_DEV, errno, strerror(errno));\n}\n\nint set_ui_layer_alpha(int val)\n{\n    int ret = 0;\n    struct aicfb_alpha_config alpha = {0};\n\n    alpha.layer_id = 1;\n    alpha.enable = 1;\n    alpha.mode = 1;\n    alpha.value = val;\n    ret = ioctl(g_fb_fd, AICFB_UPDATE_ALPHA_CONFIG, &alpha);\n    if (ret < 0)\n        ERR("ioctl() failed! errno: %d[%s]\\n", errno, strerror(errno));\n\n    return ret;\n}\n\nint vidbuf_request(struct aicfb_video_layer *vlayer)\n{\n    int i, j;\n    int heap_fd = -1;\n    int y_frame = vlayer->w * vlayer->h;\n\n    heap_fd = device_open(DMA_HEAP_DEV, O_RDWR);\n    if (heap_fd < 0) {\n        ERR("Failed to open %s, errno: %d[%s]\\n",\n            DMA_HEAP_DEV, errno, strerror(errno));\n        return -1;\n    }\n\n    /* Prepare two group buffer for video player,\n       and each group has three planes: y, u, v. */\n    for (i = 0; i < AICFB_VID_BUF_NUM; i++) {\n        struct video_plane *p = (struct video_plane *)&vlayer->vbuf[i];\n        int *shift = &vlayer->f->y_shift;\n        for (j = 0; j < AICFB_PLANE_NUM; j++, p++)\n            vidbuf_request_one(p, y_frame >> shift[j], heap_fd);\n    }\n\n    close(heap_fd);\n    return 0;\n}\n\nvoid vidbuf_release(struct aicfb_video_layer *vlayer)\n{\n    int i, j;\n\n    for (i = 0; i < AICFB_VID_BUF_NUM; i++) {\n        struct video_plane *p = (struct video_plane *)&vlayer->vbuf[i];\n        for (j = 0; j < AICFB_PLANE_NUM; j++, p++) {\n            if (munmap(p->buf, p->len) < 0)\n                ERR("munmap() failed! errno: %d[%s]\\n",\n                    errno, strerror(errno));\n        }\n    }\n}\n\nvoid vidbuf_dmabuf_begin(struct aicfb_video_layer *vlayer)\n{\n    int i, j;\n    struct aicfb_dmabuf_fd fds = {0};\n\n    for (i = 0; i < AICFB_VID_BUF_NUM; i++) {\n        struct video_plane *plane = (struct video_plane *)&vlayer->vbuf[i];\n        for (j = 0; j < AICFB_PLANE_NUM; j++, plane++) {\n            fds.fd = plane->fd;\n            if (ioctl(g_fb_fd, AICFB_GET_DMABUF, &fds) < 0)\n                ERR("ioctl() failed! err %d[%s]\\n",\n                    errno, strerror(errno));\n        }\n    }\n}\n\nvoid vidbuf_dmabuf_end(struct aicfb_video_layer *vlayer)\n{\n    int i, j;\n    struct aicfb_dmabuf_fd fds = {0};\n\n    for (i = 0; i < AICFB_VID_BUF_NUM; i++) {\n        struct video_plane *plane = (struct video_plane *)&vlayer->vbuf[i];\n        for (j = 0; j < AICFB_PLANE_NUM; j++, plane++) {\n            fds.fd = plane->fd;\n            if (ioctl(g_fb_fd, AICFB_PUT_DMABUF, &fds) < 0)\n                ERR("ioctl() failed! err %d[%s]\\n",\n                    errno, strerror(errno));\n        }\n    }\n}\n\nvoid video_layer_set(struct aicfb_video_layer *vlayer, int index)\n{\n    struct aicfb_layer_data layer = {0};\n    struct video_buf *vbuf = &vlayer->vbuf[index];\n\n    layer.layer_id = 0;\n    layer.enable = 1;\n    layer.scale_size.width = vlayer->w * 4;\n    layer.scale_size.height = vlayer->h * 4;\n    layer.pos.x = 10;\n    layer.pos.y = 10;\n    layer.buf.size.width = vlayer->w;\n    layer.buf.size.height = vlayer->h;\n    layer.buf.format = vlayer->f->format;\n    layer.buf.dmabuf_fd[0] = vbuf->y.fd;\n    layer.buf.dmabuf_fd[1] = vbuf->u.fd;\n    layer.buf.dmabuf_fd[2] = vbuf->v.fd;\n    layer.buf.stride[0] = vlayer->w;\n    layer.buf.stride[1] = vlayer->w >> 1;\n    layer.buf.stride[2] = vlayer->w >> 1;\n\n    if (ioctl(g_fb_fd, AICFB_UPDATE_LAYER_CONFIG, &layer) < 0)\n        ERR("ioctl() failed! err %d[%s]\\n", errno, strerror(errno));\n}\n\nvoid vidbuf_cpu_begin(struct video_buf *vbuf)\n{\n    int i;\n    struct dma_buf_sync flag;\n    struct video_plane *p = (struct video_plane *)vbuf;\n\n    for (i = 0; i < AICFB_PLANE_NUM; i++, p++) {\n        flag.flags = DMA_BUF_SYNC_WRITE | DMA_BUF_SYNC_START;\n        if (ioctl(p->fd, DMA_BUF_IOCTL_SYNC, &flag) < 0)\n            ERR("ioctl() failed! err %d[%s]\\n",\n                errno, strerror(errno));\n    }\n}\n\nvoid vidbuf_cpu_end(struct video_buf *vbuf)\n{\n    int i;\n    struct dma_buf_sync flag;\n    struct video_plane *p = (struct video_plane *)vbuf;\n\n    for (i = 0; i < AICFB_PLANE_NUM; i++, p++) {\n        flag.flags = DMA_BUF_SYNC_WRITE | DMA_BUF_SYNC_END;\n        if (ioctl(p->fd, DMA_BUF_IOCTL_SYNC, &flag) < 0)\n            ERR("ioctl() failed! err %d[%s]\\n",\n                errno, strerror(errno));\n    }\n}\n\nint vidbuf_read(struct aicfb_video_layer *vlayer, int index, int fd)\n{\n    int i, ret;\n    static int frame_cnt = 0;\n    struct video_plane *p = (struct video_plane *)&vlayer->vbuf[index];\n\n    if (frame_cnt == 0)\n        lseek(fd, 0, SEEK_SET);\n\n    for (i = 0; i < AICFB_PLANE_NUM; i++, p++) {\n        DBG("Frame %d - %d, offset %ld, len %d\\n", frame_cnt, i,\n             lseek(fd, 0, SEEK_CUR), p->len);\n        ret = read(fd, p->buf, p->len);\n        if (ret != p->len) {\n            ERR("read(%d) return %d. errno: %d[%s]\\n", p->len,\n                ret, errno, strerror(errno));\n            return -1;\n        }\n    }\n    frame_cnt++;\n    return ret;\n}\n\nint format_parse(char *str)\n{\n    int i;\n\n    for (i = 0; g_vformat[i].format != AIC_FMT_MAX; i++) {\n        if (strncasecmp(g_vformat[i].f_str, str, strlen(str)) == 0)\n            return i;\n    }\n\n    ERR("Invalid format: %s\\n", str);\n    return 0;\n}\n\nint main(int argc, char **argv)\n{\n    int vid_fd = -1;\n    int ret = 0;\n    int c = 0;\n    int fsize = 0;\n    int index = 0;\n\n    DBG("Compile time: %s\\n", __TIME__);\n    while ((c = getopt_long(argc, argv, sopts, lopts, NULL)) != -1) {\n        switch (c) {\n        case \'w\':\n            g_vlayer.w = str2int(optarg);\n            continue;\n        case \'h\':\n            g_vlayer.h = str2int(optarg);\n            continue;\n        case \'f\':\n            g_vlayer.f = &g_vformat[format_parse(optarg)];\n            break;\n        case \'i\':\n            vid_fd = device_open(optarg, O_RDONLY);\n            if (vid_fd < 0) {\n                ERR("Failed to open %s. errno: %d[%s]\\n",\n                    optarg, errno, strerror(errno));\n                return -1;\n            }\n            fsize = lseek(vid_fd, 0, SEEK_END);\n            DBG("open(%s) %d, size %d\\n", optarg, vid_fd, fsize);\n            break;\n        case \'u\':\n            usage(argv[0]);\n            return 0;\n        default:\n            break;\n        }\n    }\n\n    aic_fb_open();\n    set_ui_layer_alpha(128);\n    vidbuf_request(&g_vlayer);\n    vidbuf_dmabuf_begin(&g_vlayer);\n\n    do {\n        struct video_buf *vbuf = &g_vlayer.vbuf[index];\n\n        vidbuf_cpu_begin(vbuf);\n        ret = vidbuf_read(&g_vlayer, index, vid_fd);\n        vidbuf_cpu_end(vbuf);\n        if (ret < 0)\n            break;\n\n        video_layer_set(&g_vlayer, index);\n        index = !index;\n        usleep(40000);\n        if (lseek(vid_fd, 0, SEEK_CUR) == fsize)\n            break;\n    } while (1);\n\n    vidbuf_dmabuf_end(&g_vlayer);\n    vidbuf_release(&g_vlayer);\n\n    if (vid_fd > 0)\n        close(vid_fd);\n    if (g_fb_fd > 0)\n        close (g_fb_fd);\n    return ret;\n}\n'})})]})}function x(n={}){const{wrapper:e}={...(0,d.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},1151:(n,e,i)=>{i.d(e,{Z:()=>t,a:()=>s});var r=i(7294);const d={},l=r.createContext(d);function s(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:s(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);