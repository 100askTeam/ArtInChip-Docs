"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9073],{4225:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>r,default:()=>x,frontMatter:()=>c,metadata:()=>d,toc:()=>h});var n=s(5893),t=s(1151);const c={sidebar_position:19},r="I2C \u5f00\u53d1\u6307\u5357",d={id:"D213-DevKit/part3/07-4_I2C-Useguide",title:"I2C \u5f00\u53d1\u6307\u5357",description:"1. \u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/D213-DevKit/part3/07-4_I2C-Useguide.md",sourceDirName:"D213-DevKit/part3",slug:"/D213-DevKit/part3/07-4_I2C-Useguide",permalink:"/en/docs/D213-DevKit/part3/07-4_I2C-Useguide",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/07-4_I2C-Useguide.md",tags:[],version:"current",sidebarPosition:19,frontMatter:{sidebar_position:19},sidebar:"d213dkSidebar",previous:{title:"GPAI \u4f7f\u7528\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/07-3_ GPAI-Useguide"},next:{title:"MAC \u4f7f\u7528\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/07-5_MAC-Useguide"}},l={},h=[{value:"1. \u6a21\u5757\u4ecb\u7ecd",id:"1-\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"1.1. \u672f\u8bed\u5b9a\u4e49",id:"11-\u672f\u8bed\u5b9a\u4e49",level:3},{value:"1.2. \u6a21\u5757\u7b80\u4ecb",id:"12-\u6a21\u5757\u7b80\u4ecb",level:3},{value:"2. I2C\u914d\u7f6e",id:"2-i2c\u914d\u7f6e",level:2},{value:"2.1. \u5185\u6838\u914d\u7f6e",id:"21-\u5185\u6838\u914d\u7f6e",level:3},{value:"2.1.1. master\u9a71\u52a8\u4f7f\u80fd",id:"211-master\u9a71\u52a8\u4f7f\u80fd",level:4},{value:"2.1.2. slave\u9a71\u52a8\u4f7f\u80fd",id:"212-slave\u9a71\u52a8\u4f7f\u80fd",level:4},{value:"2.1.3. eeprom\u9a71\u52a8\u4f7f\u80fd",id:"213-eeprom\u9a71\u52a8\u4f7f\u80fd",level:4},{value:"2.2. DTS\u914d\u7f6e",id:"22-dts\u914d\u7f6e",level:3},{value:"2.2.1. I2C\u516c\u5171\u53c2\u6570\u914d\u7f6e",id:"221-i2c\u516c\u5171\u53c2\u6570\u914d\u7f6e",level:4},{value:"2.2.2. I2C master\u914d\u7f6e",id:"222-i2c-master\u914d\u7f6e",level:4},{value:"2.2.3. I2C slave\u914d\u7f6e",id:"223-i2c-slave\u914d\u7f6e",level:4},{value:"3. \u8c03\u8bd5\u6307\u5357",id:"3-\u8c03\u8bd5\u6307\u5357",level:2},{value:"3.1. I2C\u901a\u4fe1\u8c03\u8bd5",id:"31-i2c\u901a\u4fe1\u8c03\u8bd5",level:3},{value:"3.2. \u8c03\u8bd5\u5f00\u5173",id:"32-\u8c03\u8bd5\u5f00\u5173",level:3},{value:"3.2.1. \u8c03\u6574log\u7b49\u7ea7",id:"321-\u8c03\u6574log\u7b49\u7ea7",level:4},{value:"3.2.2. \u6253\u5f00\u8c03\u8bd5\u5f00\u5173",id:"322-\u6253\u5f00\u8c03\u8bd5\u5f00\u5173",level:4},{value:"4. \u6d4b\u8bd5\u6307\u5357",id:"4-\u6d4b\u8bd5\u6307\u5357",level:2},{value:"4.1. \u6d4b\u8bd5\u73af\u5883",id:"41-\u6d4b\u8bd5\u73af\u5883",level:3},{value:"4.1.1. \u786c\u4ef6",id:"411-\u786c\u4ef6",level:4},{value:"4.1.2. \u8f6f\u4ef6",id:"412-\u8f6f\u4ef6",level:4},{value:"4.2. \u6d4b\u8bd5\u914d\u7f6e",id:"42-\u6d4b\u8bd5\u914d\u7f6e",level:3},{value:"4.3. i2c-tools\u6d4b\u8bd5",id:"43-i2c-tools\u6d4b\u8bd5",level:3},{value:"4.3.1. i2cdetect",id:"431-i2cdetect",level:4},{value:"4.3.2. i2cset",id:"432-i2cset",level:4},{value:"4.3.3. i2cget",id:"433-i2cget",level:4},{value:"4.3.4. i2ctransfer",id:"434-i2ctransfer",level:4},{value:"4.3.5. eeprog",id:"435-eeprog",level:4},{value:"5. \u8bbe\u8ba1\u8bf4\u660e",id:"5-\u8bbe\u8ba1\u8bf4\u660e",level:2},{value:"5.1. \u6e90\u7801\u8bf4\u660e",id:"51-\u6e90\u7801\u8bf4\u660e",level:3},{value:"5.2. \u6a21\u5757\u67b6\u6784",id:"52-\u6a21\u5757\u67b6\u6784",level:3},{value:"5.2.1. I2C master",id:"521-i2c-master",level:4},{value:"5.2.2. I2C slave",id:"522-i2c-slave",level:4},{value:"5.3. \u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",id:"53-\u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",level:3},{value:"5.3.1. \u521d\u59cb\u5316\u6d41\u7a0b",id:"531-\u521d\u59cb\u5316\u6d41\u7a0b",level:4},{value:"5.3.2. \u4f20\u8f93\u6d41\u7a0b",id:"532-\u4f20\u8f93\u6d41\u7a0b",level:4},{value:"5.3.3. I2C\u6a21\u5757\u603b\u7ebf\u4fe1\u53f7",id:"533-i2c\u6a21\u5757\u603b\u7ebf\u4fe1\u53f7",level:4},{value:"5.3.3.1. master transmitter",id:"5331-master-transmitter",level:5},{value:"5.3.3.2. master receiver",id:"5332-master-receiver",level:5},{value:"5.3.4. \u4e2d\u65ad\u6d41\u7a0b",id:"534-\u4e2d\u65ad\u6d41\u7a0b",level:4},{value:"5.4. \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",id:"54-\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",level:3},{value:"5.5. \u63a5\u53e3\u8bbe\u8ba1",id:"55-\u63a5\u53e3\u8bbe\u8ba1",level:3},{value:"5.5.1. i2c_handle_tx_abort",id:"551-i2c_handle_tx_abort",level:4},{value:"5.5.2. i2c_scl_cnt",id:"552-i2c_scl_cnt",level:4},{value:"5.5.3. i2c_set_timmings_master",id:"553-i2c_set_timmings_master",level:4},{value:"5.5.4. i2c_init_master",id:"554-i2c_init_master",level:4},{value:"5.5.5. i2c_xfer_msg_init",id:"555-i2c_xfer_msg_init",level:4},{value:"5.5.6. i2c_xfer_msg",id:"556-i2c_xfer_msg",level:4},{value:"5.5.7. i2c_xfer",id:"557-i2c_xfer",level:4},{value:"5.5.8. i2c_handle_read",id:"558-i2c_handle_read",level:4},{value:"5.5.9. i2c_handle_write",id:"559-i2c_handle_write",level:4},{value:"5.5.10. i2c_init_slave",id:"5510-i2c_init_slave",level:4},{value:"5.5.11. i2c_reg_slave",id:"5511-i2c_reg_slave",level:4},{value:"5.5.12. i2c_unreg_slave",id:"5512-i2c_unreg_slave",level:4},{value:"6. \u5e38\u89c1\u95ee\u9898",id:"6-\u5e38\u89c1\u95ee\u9898",level:2}];function a(e){const i={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h1,{id:"i2c-\u5f00\u53d1\u6307\u5357",children:"I2C \u5f00\u53d1\u6307\u5357"}),"\n",(0,n.jsx)(i.h2,{id:"1-\u6a21\u5757\u4ecb\u7ecd",children:"1. \u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,n.jsx)(i.h3,{id:"11-\u672f\u8bed\u5b9a\u4e49",children:"1.1. \u672f\u8bed\u5b9a\u4e49"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u672f\u8bed"}),(0,n.jsx)(i.th,{children:"\u5b9a\u4e49"}),(0,n.jsx)(i.th,{children:"\u6ce8\u91ca\u8bf4\u660e"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"SDA"}),(0,n.jsx)(i.td,{children:"I2C\u6570\u636e\u7ebf"}),(0,n.jsx)(i.td,{})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"SCL"}),(0,n.jsx)(i.td,{children:"I2C\u65f6\u949f\u7ebf"}),(0,n.jsx)(i.td,{})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"I2C algorithm"}),(0,n.jsx)(i.td,{children:"I2C\u901a\u4fe1\u65b9\u6cd5"}),(0,n.jsx)(i.td,{children:"\u63d0\u4f9b\u4ea7\u751fI2C\u603b\u7ebf\u8bbf\u95ee\u7684\u901a\u4fe1\u51fd\u6570"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"I2C adapter"}),(0,n.jsx)(i.td,{children:"I2C\u9002\u914d\u5668"}),(0,n.jsx)(i.td,{children:"\u5bf9I2C\u63a7\u5236\u5668\u7684\u8f6f\u4ef6\u62bd\u8c61"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"I2C client"}),(0,n.jsx)(i.td,{children:"I2C\u5ba2\u6237\u7aef"}),(0,n.jsx)(i.td,{children:"\u4e00\u4e2aclient\u5bf9\u5e94\u4e00\u4e2aI2C device"})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"12-\u6a21\u5757\u7b80\u4ecb",children:"1.2. \u6a21\u5757\u7b80\u4ecb"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u6a21\u5757\u662f\u4e00\u4e2a\u4e24\u7ebf\u63a5\u53e3\uff0c\u901a\u8fc7SCL\u548cSDA\u4e24\u6839\u7ebf\u5373\u53ef\u5b8c\u6210\u6570\u636e\u7684\u4f20\u8f93\u3002I2C V1.0\u7684\u8bbe\u8ba1\u5b8c\u5168\u9075\u4eceI2C\u603b\u7ebf\u534f\u8bae\u6807\u51c6\uff0c\u4e0d\u652f\u6301SMBus\u534f\u8bae\u3002"}),"\n",(0,n.jsx)(i.p,{children:"\u57fa\u672c\u7279\u6027\u5982\u4e0b\uff1a"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"\u652f\u6301master\u548cslave\u6a21\u5f0f"}),"\n",(0,n.jsx)(i.li,{children:"\u6700\u9ad8\u4f20\u8f93\u901f\u7387\u4e3a400Kb/s"}),"\n",(0,n.jsx)(i.li,{children:"\u652f\u63017bit\u548c10bit\u5bfb\u5740"}),"\n",(0,n.jsx)(i.li,{children:"\u4e14\u786c\u4ef6\u652f\u6301I2C\u603b\u7ebf\u6302\u6b7b\u6062\u590d\u673a\u5236"}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"2-i2c\u914d\u7f6e",children:"2. I2C\u914d\u7f6e"}),"\n",(0,n.jsx)(i.h3,{id:"21-\u5185\u6838\u914d\u7f6e",children:"2.1. \u5185\u6838\u914d\u7f6e"}),"\n",(0,n.jsx)(i.h4,{id:"211-master\u9a71\u52a8\u4f7f\u80fd",children:"2.1.1. master\u9a71\u52a8\u4f7f\u80fd"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Device Drivers\n        I2C support---\x3e\n                <*> I2C support\n                <*> I2C device interface\n                    I2C Hardware Bus support---\x3e\n                        <*> ArtInChip I2C support\n"})}),"\n",(0,n.jsx)(i.h4,{id:"212-slave\u9a71\u52a8\u4f7f\u80fd",children:"2.1.2. slave\u9a71\u52a8\u4f7f\u80fd"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Device Drivers\n        I2C support---\x3e\n                <*> I2C support\n                <*> I2C device interface\n                    I2C Hardware Bus support---\x3e\n                        <*> ArtInChip I2C support\n                        <*> ArtInChip I2C as slave mode\n                <*> I2C slave support\n                <*>     I2C eeprom slave driver\n"})}),"\n",(0,n.jsx)(i.p,{children:"\u6ce8\u89e3"}),"\n",(0,n.jsx)(i.p,{children:"\u5728\u5c06I2C\u4f5c\u4e3aslave\u65f6\uff0c\u9700\u8981\u4e00\u4e2abackend\u7a0b\u5e8f\uff0c\u4f5c\u4e3aI2C slave\u7684\u529f\u80fd\u903b\u8f91\u5b9e\u73b0\u3002\u6b64\u5904\u9009\u62e9\u5185\u6838\u81ea\u5e26\u7684eeprom\uff0c\u5373I2C\u4f5c\u4e3aslave\u65f6\uff0c\u662f\u5f53\u505a\u4e00\u4e2aeeprom\u7684\u529f\u80fd\u5728\u4f7f\u7528\u3002\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u81ea\u5df1\u5b9e\u73b0\u76f8\u5e94\u7684backend\u4ee3\u7801"}),"\n",(0,n.jsx)(i.h4,{id:"213-eeprom\u9a71\u52a8\u4f7f\u80fd",children:"2.1.3. eeprom\u9a71\u52a8\u4f7f\u80fd"}),"\n",(0,n.jsx)(i.p,{children:"\u4f7f\u7528I2C\u63a5\u53e3\u4e0eeeprom\u901a\u4fe1\uff0c\u662f\u4e00\u79cd\u5e94\u7528\u975e\u5e38\u5e7f\u6cdb\u7684\u573a\u666f\u3002\u6b64\u5904\u4ecb\u7ecd\u5982\u4f55\u4f7f\u80fd\u5185\u6838\u7684eeprom\u9a71\u52a8(\u9700\u8981\u5148\u4f7f\u80fdI2C\u7684master\u9a71\u52a8)\u3002"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Device Drivers\n        Misc devices---\x3e\n                EEPROM support---\x3e\n                        <*> I2C EEPROMs/RAMs/ROMs from most vendors\n"})}),"\n",(0,n.jsx)(i.h3,{id:"22-dts\u914d\u7f6e",children:"2.2. DTS\u914d\u7f6e"}),"\n",(0,n.jsx)(i.h4,{id:"221-i2c\u516c\u5171\u53c2\u6570\u914d\u7f6e",children:"2.2.1. I2C\u516c\u5171\u53c2\u6570\u914d\u7f6e"}),"\n",(0,n.jsx)(i.p,{children:"\u4ee5I2C0\u4e3a\u4f8b"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:'i2c0: i2c@19220000 {\n        compatible = "artinchip,aic-i2c-v1.0";\n        reg = <0x0 0x19220000 0x0 0x400>;\n        interrupts-extended = <&plic0 84 IRQ_TYPE_LEVEL_HIGH>;\n        clocks = <&cmu CLK_I2C0>;\n        resets = <&rst RESET_I2C0>;\n        #address-cells = <1>;\n        #size-cells = <0>;\n};\n'})}),"\n",(0,n.jsx)(i.h4,{id:"222-i2c-master\u914d\u7f6e",children:"2.2.2. I2C master\u914d\u7f6e"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:'&i2c0 {\n        pinctrl-names = "default";\n        pinctrl-0 = <&i2c0_pins_a>;\n        status = "okay";\n        eeprom@50 {\n                compatible = "atmel,24c64";\n                reg = <0x50>;\n                pagesize = <32>;\n        };\n};\n'})}),"\n",(0,n.jsx)(i.p,{children:"\u6ce8\u89e3"}),"\n",(0,n.jsx)(i.p,{children:"\u8be5\u914d\u7f6e\u662f\u5c06eeprom\u6302\u5728I2C0\u603b\u7ebf\u4e0a\u7684\u914d\u7f6e\uff0creg\u5c5e\u6027\u8868\u793aslave\u8bbe\u5907\u7684\u5730\u5740\uff0cpagesize\u8868\u793aeeprom\u4e00\u9875\u670932byte\u3002\u82e5\u5728I2C\u603b\u7ebf\u4e0a\u6302\u5176\u5b83\u8bbe\u5907\uff0c\u5bf9DTS\u8fdb\u884c\u76f8\u5e94\u4fee\u6539\u5373\u53ef\u3002"}),"\n",(0,n.jsx)(i.h4,{id:"223-i2c-slave\u914d\u7f6e",children:"2.2.3. I2C slave\u914d\u7f6e"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:'&i2c0 {\n        pinctrl-names = "default";\n        pinctrl-0 = <&i2c0_pins_a>;\n        status = "okay";\n        slave@54 {\n                compatible = "slave-24c02";\n                reg = <0x40000054>;\n        };\n};\n'})}),"\n",(0,n.jsx)(i.p,{children:"\u6ce8\u89e3"}),"\n",(0,n.jsx)(i.p,{children:"\u5185\u6838\u7684I2C\u5b50\u7cfb\u7edf\u6846\u67b6\u4f1a\u901a\u8fc7\u67e5\u770breg\u5c5e\u6027\u7684bit30\uff0c\u5224\u65adI2C\u662f\u5de5\u4f5c\u5728\u4e3b\u673a\u6a21\u5f0f\u8fd8\u662f\u4ece\u673a\u6a21\u5f0f\u3002\u82e5bit30\u4e3a1\uff0c\u5219\u4e3a\u4ece\u673a\u6a21\u5f0f\u3002\u4e0a\u8ff0\u914d\u7f6e\u8868\u793aI2C\u5de5\u4f5c\u5728\u4ece\u673a\u6a21\u5f0f\uff0c\u8bbe\u5907\u5730\u5740\u4e3a0x54\u3002"}),"\n",(0,n.jsx)(i.p,{children:"\u82e5\u9700\u8981\u8bbe\u7f6e\u4ece\u673a\u4e3a10bit\u5bfb\u5740\uff0c\u5219\u9700\u8981\u8bbe\u7f6ereg\u5c5e\u6027\u7684bit31\u4e3a1\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u914d\u7f6e\u4ece\u673a\u5730\u5740\u4e3a0x139\u3002"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:'&i2c0 {\n        pinctrl-names = "default";\n        pinctrl-0 = <&i2c0_pins_a>;\n        status = "okay";\n        slave@139 {\n                compatible = "slave-24c02";\n                reg = <0xC0000139>;\n        };\n};\n'})}),"\n",(0,n.jsx)(i.h2,{id:"3-\u8c03\u8bd5\u6307\u5357",children:"3. \u8c03\u8bd5\u6307\u5357"}),"\n",(0,n.jsx)(i.h3,{id:"31-i2c\u901a\u4fe1\u8c03\u8bd5",children:"3.1. I2C\u901a\u4fe1\u8c03\u8bd5"}),"\n",(0,n.jsx)(i.p,{children:"\u5728\u4f7f\u80fdI2C\u7684\u9a71\u52a8\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7i2c-tools\u4e2d\u7684i2cdetect\u5de5\u5177\uff0c\u5feb\u901f\u68c0\u6d4bI2C\u901a\u4fe1\u529f\u80fd\u662f\u5426\u6b63\u5e38\u3002\u4f7f\u80fd\u9a71\u52a8\u540e\uff0c\u4f1a\u521b\u5efa\u51fa\u76f8\u5e94\u7684I2C\u9002\u914d\u5668\uff0c\u4f46\u662fI2C\u901a\u4fe1\u529f\u80fd\u662f\u5426\u6b63\u5e38\u4ecd\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u53ef\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u6d4b\u8bd5\uff1a"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"i2cdetect -y -r 0\n"})}),"\n",(0,n.jsx)(i.p,{children:"\u6b64\u547d\u4ee4\u7528\u6765\u6d4b\u8bd5I2C\u603b\u7ebf0\u4e0a\u7684\u5730\u5740\u5206\u5e03\u60c5\u51b5\u3002\u5982\u679c\u901a\u4fe1\u6b63\u5e38\uff0c\u5373\u4f7f\u603b\u7ebf\u4e0a\u6ca1\u6709\u6302\u63a5\u4efb\u4f55I2C\u8bbe\u5907\uff0c\u90a3\u4e48\u4e5f\u4f1a\u7acb\u5373\u8fd4\u56de\u7ed3\u679c\u3002\u5982\u679c\u5728\u8be5\u6d4b\u8bd5\u4e2d\u8fd4\u56detransfer timeout\uff0c\u90a3\u4e48\u9700\u8981\u5148\u68c0\u67e5I2C\u7684SDA\u548cSCL\u662f\u5426\u6709\u4e0a\u62c9(\u8be5\u95ee\u9898\u4e00\u822c\u662f\u7531\u4e8e\u6ca1\u6709\u4e0a\u62c9\u5bfc\u81f4)\u3002\u5982\u679c\u6709\u4e0a\u62c9\uff0c\u90a3\u4e48\u9700\u8981\u8fdb\u4e00\u6b65\u8fdb\u884c\u8c03\u8bd5\u3002"}),"\n",(0,n.jsx)(i.h3,{id:"32-\u8c03\u8bd5\u5f00\u5173",children:"3.2. \u8c03\u8bd5\u5f00\u5173"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u7684\u9a71\u52a8\u7531\u4e00\u4e9bdev_dbg\u7684\u8c03\u8bd5\u4fe1\u606f\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4e0d\u4f1a\u6253\u5370\u7684\uff0c\u5f53\u9700\u8981\u8fdb\u884c\u8ddf\u8e2a\u8c03\u8bd5\u65f6\uff0c\u53ef\u901a\u8fc7\u4ee5\u4e0b\u6b65\u9aa4\u6253\u5f00\u8fd9\u4e9b\u8c03\u8bd5\u4fe1\u606f\u3002"}),"\n",(0,n.jsx)(i.h4,{id:"321-\u8c03\u6574log\u7b49\u7ea7",children:"3.2.1. \u8c03\u6574log\u7b49\u7ea7"}),"\n",(0,n.jsx)(i.p,{children:"\u901a\u8fc7menuconfig\u8c03\u6574\u5185\u6838\u7684log\u7b49\u7ea7"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Kernel hacking---\x3e\n    printk and dmesg options---\x3e\n        (8) Default console loglevel (1-15)\n"})}),"\n",(0,n.jsx)(i.h4,{id:"322-\u6253\u5f00\u8c03\u8bd5\u5f00\u5173",children:"3.2.2. \u6253\u5f00\u8c03\u8bd5\u5f00\u5173"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"Kernel hacking---\x3e\n    Artinchip Debug---\x3e\n        [*] I2C driver debug\n"})}),"\n",(0,n.jsx)(i.h2,{id:"4-\u6d4b\u8bd5\u6307\u5357",children:"4. \u6d4b\u8bd5\u6307\u5357"}),"\n",(0,n.jsx)(i.h3,{id:"41-\u6d4b\u8bd5\u73af\u5883",children:"4.1. \u6d4b\u8bd5\u73af\u5883"}),"\n",(0,n.jsx)(i.h4,{id:"411-\u786c\u4ef6",children:"4.1.1. \u786c\u4ef6"}),"\n",(0,n.jsxs)(i.blockquote,{children:["\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"\u6d4b\u8bd5\u677f\uff1a\u5e26\u6709\u4e24\u4e2aI2C\u63a5\u53e3\u7684\u6d4b\u8bd5\u677f"}),"\n",(0,n.jsx)(i.li,{children:"PC\uff1a\u7528\u4e8e\u548c\u6d4b\u8bd5\u677f\u4ea4\u4e92"}),"\n",(0,n.jsx)(i.li,{children:"\u4e32\u53e3\u7ebf\uff1a\u8fde\u63a5\u6d4b\u8bd5\u677f\u7684\u8c03\u8bd5\u4e32\u53e3"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:"412-\u8f6f\u4ef6",children:"4.1.2. \u8f6f\u4ef6"}),"\n",(0,n.jsxs)(i.blockquote,{children:["\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"PC\u7aef\u4e32\u53e3\u7ec8\u7aef\u8f6f\u4ef6"}),"\n",(0,n.jsx)(i.li,{children:"i2c-tools\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5305"}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"42-\u6d4b\u8bd5\u914d\u7f6e",children:"4.2. \u6d4b\u8bd5\u914d\u7f6e"}),"\n",(0,n.jsx)(i.p,{children:"\u5c06\u6d4b\u8bd5\u677f\u7684\u4e24\u4e2aI2C\uff0c\u4e00\u4e2a\u914d\u7f6e\u4e3amaster\uff0c\u4e00\u4e2a\u914d\u7f6e\u4e3aslave\u3002\u4e24\u4e2aI2C\u63a5\u53e3\u5bf9\u63a5\u3002 \u7f16\u8bd1\u7b2c\u4e09\u65b9\u6d4b\u8bd5\u5de5\u5177i2c-tools\uff0c\u5229\u7528i2c-tools\u63d0\u4f9b\u7684\u5de5\u5177\u8fdb\u884c\u6d4b\u8bd5"}),"\n",(0,n.jsx)(i.h3,{id:"43-i2c-tools\u6d4b\u8bd5",children:"4.3. i2c-tools\u6d4b\u8bd5"}),"\n",(0,n.jsx)(i.h4,{id:"431-i2cdetect",children:"4.3.1. i2cdetect"}),"\n",(0,n.jsx)(i.p,{children:"i2cdetect\u7528\u4e8e\u6d4b\u8bd5\u7cfb\u7edf\u4e2d\u6709\u54ea\u4e9bI2C\u603b\u7ebf\uff0c\u4ee5\u53caI2C\u603b\u7ebf\u4e0a\u6709\u54ea\u4e9b\u5730\u5740\u88ab\u4f7f\u7528"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"i2cdetect -l"})," \uff1a\u5217\u51fa\u7cfb\u7edf\u4e2d\u6240\u6709\u7684I2C\u603b\u7ebf"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/i2cdetect_1-17067556663161.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/i2cdetect_1.png"})}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"i2cdetect -y -r 0"})," \uff1a\u67e5\u8be2I2C-0\u603b\u7ebf\u4e0a\u54ea\u4e9b\u5730\u5740\u6709\u6302\u63a5I2C\u8bbe\u5907\u3002\u5982\u4e0b\u5982\u6240\u793a\uff0c0x51\u5730\u5740\u4e0a\u6709\u6302\u63a5I2C\u8bbe\u5907"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/i2cdetect_2-17067556722703.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/i2cdetect_2.png"})}),"\n",(0,n.jsx)(i.h4,{id:"432-i2cset",children:"4.3.2. i2cset"}),"\n",(0,n.jsx)(i.p,{children:"i2cset\u7528\u4e8e\u6bcf\u6b21\u5411I2C\u8bbe\u5907\u5199\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u636e"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"i2cset -f -y 0 0x54 1 0x39"})," \uff1aI2C\u4ece\u8bbe\u5907\u5730\u5740\u4e3a0x54\uff0c\u5c06\u4ece\u8bbe\u5907\u4e2d\u5730\u57401\u5904\u7684\u6570\u636e\u8bbe\u7f6e\u4e3a0x39"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/i2cset-17067556796495.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/i2cset.png"})}),"\n",(0,n.jsx)(i.h4,{id:"433-i2cget",children:"4.3.3. i2cget"}),"\n",(0,n.jsx)(i.p,{children:"i2cget\u7528\u4e8e\u6bcf\u6b21\u4eceI2C\u8bbe\u5907\u8bfb\u53d6\u4e00\u4e2a\u5b57\u8282\u7684\u6570\u636e"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"i2cget -f -y 0 0x54 1"})," \uff1aI2C\u4ece\u8bbe\u5907\u5730\u5740\u4e3a0x54\uff0c\u8bfb\u53d6\u4ece\u8bbe\u5907\u6570\u636e\u5730\u5740\u4e3a1\u5904\u76841\u5b57\u8282\u6570\u636e"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/i2cget-17067556875597.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/i2cget.png"})}),"\n",(0,n.jsx)(i.h4,{id:"434-i2ctransfer",children:"4.3.4. i2ctransfer"}),"\n",(0,n.jsx)(i.p,{children:"i2ctransfer\u7528\u4e8e\u4e0eI2C\u8bbe\u5907\u4e4b\u95f4\u4f20\u8f93\u6570\u636e\uff0c\u6bcf\u6b21\u53ef\u8bfb\u5199\u591a\u4e2a\u6570\u636e"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"i2ctransfer -f -y 0 w17@0x54 0 0x5a-"})," \uff1aI2C\u8bbe\u5907\u5730\u5740\u4e3a0x54\uff0c\u5411\u4ece\u8bbe\u5907\u5199\u516516byte\u6570\u636e\uff0c0\u4e3a\u5c06\u8981\u5199\u5165\u6570\u636e\u7684\u8d77\u59cb\u5730\u5740\uff0c\u5199\u5165\u7684\u6570\u636e\u4e3a0x5a\uff0c0x59\uff0c0x58\u2026"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/i2ctransfer_1-17067556957419.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/i2ctransfer_1.png"})}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"i2ctransfer -f -y 0 w1@0x54 0 r16"})," \uff1aI2C\u8bbe\u5907\u5730\u5740\u4e3a0x54\uff0c\u4eceI2C\u8bbe\u5907\u8bfb\u53d616byte\u6570\u636e\uff0c\u8bfb\u6570\u636e\u7684\u8d77\u59cb\u5730\u5740\u4e3a0"]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/i2ctransfer_2-170675571392111.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/i2ctransfer_2.png"})}),"\n",(0,n.jsx)(i.h4,{id:"435-eeprog",children:"4.3.5. eeprog"}),"\n",(0,n.jsx)(i.p,{children:"eeprog\u662f\u8bfb\u5199eeprom\u7684\u5de5\u5177\uff0c\u6bcf\u6b21\u8bfb\u5199\u7684message\u53ea\u6709\u4e00\u4e2a\u5b57\u8282\u3002\u82e5\u8981\u8bfb\u51998\u4e2a\u5b57\u8282\uff0c\u5219\u4f1a\u5206\u62108\u4e2amessage\u8fdb\u884c\u8bfb\u5199"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"eeprog -f /dev/i2c-0 0x51 -r 0:8 -16"})," \uff1aI2C\u8bbe\u5907\u5730\u5740\u4e3a0x51\uff0c\u8bfb\u53d6\u7684\u6570\u636e\u8d77\u59cb\u5730\u5740\u662f0\uff0c\u8bfb\u53d68byte\u6570\u636e\uff0c-16\u8868\u793aI2C\u8bbe\u5907\u7684\u6570\u636e\u5730\u5740\u9700\u898116bit\u8868\u793a"]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"date | eeprog /dev/i2c-0 0x51 -w 0x200 -16"})," \uff1a\u5c06date\u547d\u4ee4\u8fd4\u56de\u7684\u6570\u636e\u5199\u5165\u5230eeprom\u4e2d\uff0c\u5199\u5165\u7684\u8d77\u59cb\u5730\u5740\u662f0x200"]}),"\n",(0,n.jsx)(i.p,{children:"\u6ce8\u610f"}),"\n",(0,n.jsx)(i.p,{children:"i2c-tools\u9ed8\u8ba4\u662f\u4e0d\u652f\u6301eeprog\u7684\u7f16\u8bd1\u7684\uff0c\u5e76\u4e14\u4f7f\u7528eeprog\u65f6\u9700\u8981\u786e\u4fdd\u88ab\u64cd\u4f5c\u7684eeprom\u6ca1\u6709\u901a\u8fc7DTS\u6302\u8f7d\u5230I2C\u603b\u7ebf\uff0c\u5426\u5219\u4f1a\u4e00\u76f4\u8fd4\u56de\u8be5eeprom\u5904\u4e8ebusy\u72b6\u6001\u3002"}),"\n",(0,n.jsx)(i.h2,{id:"5-\u8bbe\u8ba1\u8bf4\u660e",children:"5. \u8bbe\u8ba1\u8bf4\u660e"}),"\n",(0,n.jsx)(i.h3,{id:"51-\u6e90\u7801\u8bf4\u660e",children:"5.1. \u6e90\u7801\u8bf4\u660e"}),"\n",(0,n.jsx)(i.p,{children:"\u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1alinux-5.10/drivers/i2c/busses/"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u7684\u9a71\u52a8\u6587\u4ef6\u5982\u4e0b\uff1a"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u6587\u4ef6"}),(0,n.jsx)(i.th,{children:"\u8bf4\u660e"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"i2c-artinchip.h"}),(0,n.jsx)(i.td,{children:"aic I2C\u516c\u7528\u5934\u6587\u4ef6\uff0cI2C\u6a21\u5757\u7684\u5bc4\u5b58\u5668\u5b9a\u4e49\uff0c\u7ed3\u6784\u4f53\u5b9a\u4e49\u7b49"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"i2c-artinchip-master.c"}),(0,n.jsx)(i.td,{children:"I2C\u4f5c\u4e3amaster\u65f6\u7684\u9a71\u52a8\u6587\u4ef6"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"i2c-artinchip-slave.c"}),(0,n.jsx)(i.td,{children:"I2C\u4f5c\u4e3aslave\u65f6\u7684\u9a71\u52a8\u6587\u4ef6"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"i2c-artinchip-common.c"}),(0,n.jsx)(i.td,{children:"I2C\u4e00\u4e9b\u516c\u7528\u5bc4\u5b58\u5668\u8bfb\u5199\u51fd\u6570\u7684\u5b9e\u73b0\uff0c\u4ee5\u53caplaform_driver\u7684\u5b9a\u4e49"})]})]})]}),"\n",(0,n.jsx)(i.h3,{id:"52-\u6a21\u5757\u67b6\u6784",children:"5.2. \u6a21\u5757\u67b6\u6784"}),"\n",(0,n.jsx)(i.p,{children:"linux\u4e2dI2C\u5b50\u7cfb\u7edf\u7684\u4f53\u7cfb\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/subsystem_arch-170675580586213.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/subsystem_arch.png"})}),"\n",(0,n.jsx)(i.p,{children:"\u5728I2C\u5b50\u7cfb\u7edf\u4e2d\uff0cSOC\u5382\u5546\u9700\u8981\u5b9e\u73b0\u7684\u5c31\u662fI2C adapter\u90e8\u5206\u7684\u9a71\u52a8\uff0cI2C adapter\u662f\u5bf9I2C controller\u7684\u8f6f\u4ef6\u62bd\u8c61\u3002\u5177\u4f53\u5230\u4e0a\u56fe\uff0c\u5c31\u662f\u5b9e\u73b0I2C adapter\u7684algorithm\u4ee5\u53ca\u7279\u5b9aSOC\u7684I2C\u4ee3\u7801\u90e8\u5206\u3002I2C\u6a21\u5757\u652f\u6301master\u548cslave\u4e24\u79cd\u6a21\u5f0f\uff0c\u6240\u4ee5I2C adapter\u7684\u9a71\u52a8\u5b9e\u73b0\u4e5f\u5c31\u5206\u4e3a\u4e24\u90e8\u5206\uff1aI2C master\u9a71\u52a8\u548cI2C slave\u9a71\u52a8\u3002"}),"\n",(0,n.jsx)(i.h4,{id:"521-i2c-master",children:"5.2.1. I2C master"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u4f5c\u4e3amaster\u65f6\uff0c\u9a71\u52a8\u7684\u5b9e\u73b0\u4e3b\u8981\u5305\u62ec4\u4e2a\u90e8\u5206\uff1a"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"\u786c\u4ef6\u53c2\u6570\u914d\u7f6e\uff1a\u4e3b\u8981\u662f\u8bbe\u7f6eI2C\u5de5\u4f5c\u7684\u4e3b\u673a\u6a21\u5f0f\uff0c7bit\u621610bit\u5bfb\u5740\uff0c\u5bfb\u5740\u7684\u4ece\u673a\u5730\u5740\u8bbe\u7f6e\uff0cFIFO\u8bbe\u7f6e\u4ee5\u53ca\u603b\u7ebf\u4f20\u8f93\u901f\u7387\u7b49\u3002"}),"\n",(0,n.jsx)(i.li,{children:"SCL\u65f6\u5e8f\u53c2\u6570\u8bbe\u7f6e\uff1a\u6839\u636e\u8bbe\u7f6e\u7684\u603b\u7ebf\u4f20\u8f93\u901f\u7387\uff0c\u8bbe\u7f6eSCL\u7684\u9ad8\u4f4e\u7535\u5e73\u65f6\u95f4\u3002"}),"\n",(0,n.jsx)(i.li,{children:"i2c_algorithm\u7684\u5b9e\u73b0\uff1a\u4f5c\u4e3a\u4e3b\u673a\u7aef\uff0c\u4e3b\u8981\u662fmaster_xfer\u7684\u5b9e\u73b0\u3002\u5728\u9a71\u52a8\u5b9e\u73b0\u4e2d\uff0c\u4ee5message\u4e3a\u5355\u4f4d\u8fdb\u884c\u6570\u636e\u7684\u6536\u53d1\uff0c\u6570\u636e\u7684\u4f20\u8f93\u91c7\u7528\u4e2d\u65ad\u7684\u65b9\u5f0f\u3002"}),"\n",(0,n.jsx)(i.li,{children:"\u4e2d\u65ad\u7684\u5904\u7406\uff1a\u5904\u7406master\u7aef\u7684\u6570\u636e\u6536\u53d1\uff0c\u5e76\u4ea7\u751f\u76f8\u5e94\u7684start\u3001ack\u3001nack\u3001restart\u3001stop\u4fe1\u53f7\u3002"}),"\n"]}),"\n",(0,n.jsx)(i.h4,{id:"522-i2c-slave",children:"5.2.2. I2C slave"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u4f5c\u4e3a\u4ece\u673a\u65f6\uff0c\u9700\u8981\u4e00\u4e2a\u76f8\u5e94\u7684\u540e\u7aef\u8f6f\u4ef6(\u5bf9I2C\u4ece\u8bbe\u5907\u7684\u8f6f\u4ef6\u6a21\u62df)\uff0c\u8be5\u540e\u7aef\u8f6f\u4ef6\u4e0eI2C adapter\u9a71\u52a8\uff0c\u7ec4\u5408\u6210\u5177\u6709\u76f8\u5e94\u529f\u80fd\u7684I2C\u4ece\u8bbe\u5907\u3002\u5185\u6838\u7684I2C\u5b50\u7cfb\u7edf\u6846\u67b6\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2aEEPROM\u7684\u8f6f\u4ef6\u540e\u7aef\uff0c\u4e0eI2C slave\u9a71\u52a8\u4e00\u8d77\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u5177\u6709I2C\u63a5\u53e3\u7684EEPROM\u4f7f\u7528\u3002"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/twi_slave-170675582861915.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/twi_slave.png"})}),"\n",(0,n.jsx)(i.p,{children:"I2C\u4f5c\u4e3aslave\u65f6\uff0c\u9a71\u52a8\u7684\u5b9e\u73b0\u4e3b\u8981\u5305\u62ec3\u4e2a\u90e8\u5206\uff1a"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"\u786c\u4ef6\u53c2\u6570\u914d\u7f6e\uff1a\u8bbe\u7f6eI2C\u5de5\u4f5c\u7684\u4ece\u6a21\u5f0f\uff0cFIFO\u8bbe\u7f6e\u7b49\u3002"}),"\n",(0,n.jsx)(i.li,{children:"i2c_algorithm\u7684\u5b9e\u73b0\uff1a\u4f5c\u4e3a\u4ece\u673a\u7aef\uff0c\u4e3b\u8981\u662freg_slave\u548cunreg_slave\u7684\u5b9e\u73b0\u3002reg_slave\u7528\u4e8e\u5c06\u4e00\u4e2ai2c_client\u6ce8\u518c\u5230\u4ece\u6a21\u5f0f\u7684i2c adapter\u4e0a\uff0cunreg_slave\u7684\u529f\u80fd\u4e0ereg_slave\u76f8\u53cd\u3002"}),"\n",(0,n.jsx)(i.li,{children:"\u4e2d\u65ad\u7684\u5904\u7406\uff1a\u5904\u7406I2C\u4ece\u673a\u63a5\u6536\u5230\u7684\u5404\u79cd\u4e2d\u65ad\u4fe1\u53f7\uff0c\u5e76\u8c03\u7528\u76f8\u5e94\u7684\u56de\u8c03\u51fd\u6570\u8fdb\u884c\u6570\u636e\u7684\u8bfb\u5199\u3002"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"\u7efc\u4e0a\uff0cI2C\u6a21\u5757\u7684\u9a71\u52a8\u5b9e\u73b0\uff0c\u4e3b\u8981\u7684\u5de5\u4f5c\u6709\uff1a"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"\u63d0\u4f9bI2C\u63a7\u5236\u5668\u7684platform\u9a71\u52a8\uff0c\u521d\u59cb\u5316I2C\u9002\u914d\u5668\uff0c\u5224\u65adI2C\u6a21\u5757\u5de5\u4f5c\u7684\u4e3b\u4ece\u6a21\u5f0f\uff0c\u6267\u884c\u4e0d\u540c\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u3002"}),"\n",(0,n.jsx)(i.li,{children:"I2C\u6a21\u5757\u4f5c\u4e3a\u4e3b\u673a\u65f6\uff0c\u63d0\u4f9bI2C\u9002\u914d\u5668\u7684algorithm\uff0c\u5e76\u7528\u5177\u4f53\u9002\u914d\u5668\u7684xxx_xfer\u51fd\u6570\u586b\u5145i2c_algorithm\u7684master_xfer\u6307\u9488\uff0c\u5e76\u628ai2c_algorithm\u6307\u9488\u8d4b\u503c\u7ed9i2c_adapter\u7684algo\u6307\u9488\u3002\u5904\u7406master\u7aef\u65f6\u5e8f\u7684\u8bbe\u7f6e\u4ee5\u53caI2C\u4f5c\u4e3a\u4e3b\u673a\u65f6\u7684\u5404\u79cd\u4e2d\u65ad\u4fe1\u53f7\u5904\u7406\u3002"}),"\n",(0,n.jsx)(i.li,{children:"I2C\u6a21\u5757\u4f5c\u4e3a\u4ece\u673a\u65f6\uff0c\u63d0\u4f9bI2C\u9002\u914d\u5668\u7684algorithm\uff0c\u5b9e\u73b0\u5177\u4f53\u9002\u914d\u5668\u7684reg_slave\u548cunreg_slave\u51fd\u6570\uff0c\u5e76\u628ai2c_algorithm\u6307\u9488\u8d4b\u503c\u7ed9i2c_adapter\u7684algo\u6307\u9488\u3002\u5904\u7406I2C\u4f5c\u4e3a\u4ece\u673a\u65f6\u7684\u5404\u79cd\u4e2d\u65ad\u4fe1\u53f7\u5904\u7406\u3002"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"53-\u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",children:"5.3. \u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1"}),"\n",(0,n.jsx)(i.h4,{id:"531-\u521d\u59cb\u5316\u6d41\u7a0b",children:"5.3.1. \u521d\u59cb\u5316\u6d41\u7a0b"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u6a21\u5757\u9a71\u52a8\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/design_11-170675584793417.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/design_11.png"})}),"\n",(0,n.jsx)(i.h4,{id:"532-\u4f20\u8f93\u6d41\u7a0b",children:"5.3.2. \u4f20\u8f93\u6d41\u7a0b"}),"\n",(0,n.jsx)(i.p,{children:"\u5728I2C master\u9a71\u52a8\u4e2d\uff0c\u6570\u636e\u7684\u4f20\u8f93\u7531i2c_xfer\u53d1\u8d77\uff0c\u53ef\u4ee5\u5b8c\u6210\u591a\u4e2ai2c_msg\u7684\u4f20\u8f93\u3002\u4f20\u8f93\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/design_21-170675586319119.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/design_21.png"})}),"\n",(0,n.jsx)(i.h4,{id:"533-i2c\u6a21\u5757\u603b\u7ebf\u4fe1\u53f7",children:"5.3.3. I2C\u6a21\u5757\u603b\u7ebf\u4fe1\u53f7"}),"\n",(0,n.jsx)(i.p,{children:"\u5728I2C\u603b\u7ebf\u7684\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\uff0c\u7531start/restart/stop\u4f5c\u4e3a\u603b\u7ebf\u7684\u63a7\u5236\u4fe1\u53f7\u3002\u4e86\u89e3I2C\u6a21\u5757\u4e2dstart/restart/stop\u4fe1\u53f7\u7684\u751f\u6210\u65b9\u5f0f\uff0c\u6709\u52a9\u4e8e\u4e86\u89e3\u9a71\u52a8\u7684\u6e90\u7801\u5b9e\u73b0\u3002"}),"\n",(0,n.jsx)(i.h5,{id:"5331-master-transmitter",children:"5.3.3.1. master transmitter"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/design_31-170675589067621.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/design_31.png"})}),"\n",(0,n.jsx)(i.p,{children:"\u5bf9\u56fe\u4e2d3\u4e2a\u5173\u952e\u70b9\u7684\u89e3\u91ca\uff1a"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"I2C\u4f5c\u4e3amaster transmitter\u65f6\uff0c\u5f53\u5411TXFIFO\u4e2d\u5199\u5165\u6570\u636e\u65f6\uff0cI2C\u6a21\u5757\u4f1a\u81ea\u52a8\u53d1\u51fastart\u4fe1\u53f7"}),"\n",(0,n.jsx)(i.li,{children:"\u82e5stop\u4f4d\u672a\u7f6e\u4f4d\uff0c\u5219\u5f53TXFIFO\u4e2d\u7684\u6570\u636e\u5168\u90e8\u53d1\u9001\uff0cTXFIFO\u4e3a\u7a7a\u65f6\uff0c\u4f1a\u4fdd\u6301SCL\u4e3a\u4f4e\u7535\u5e73\uff0c\u76f4\u5230\u518d\u6b21\u5411TXFIFO\u4e2d\u5199\u5165\u6570\u636e"}),"\n",(0,n.jsx)(i.li,{children:"\u518d\u6b21\u5411TXFIFO\u5199\u5165\u6570\u636e\u65f6\uff0c\u5c06stop\u4f4d\u7f6e1\uff0c\u5219\u5728\u5b8c\u6210\u8be5\u5b57\u8282\u7684\u53d1\u9001\u540e\uff0cmaster\u4f1a\u81ea\u52a8\u53d1\u9001stop\u4fe1\u53f7"}),"\n"]}),"\n",(0,n.jsx)(i.h5,{id:"5332-master-receiver",children:"5.3.3.2. master receiver"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/design_41-170675589860723.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/design_41.png"})}),"\n",(0,n.jsx)(i.p,{children:"\u5bf9\u56fe\u4e2d3\u4e2a\u5173\u952e\u70b9\u7684\u89e3\u91ca\uff1a"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsx)(i.li,{children:"I2C\u4f5c\u4e3amaster receiver\u65f6\uff0c\u5f53\u5411TXFIFO\u5199\u5165\u8bfb\u547d\u4ee4(\u5373\u5411I2C_DATA_CMD\u5199\u5165\u8bfb\u547d\u4ee4)\u65f6\uff0cI2C\u6a21\u5757\u4f1a\u81ea\u52a8\u53d1\u9001start\u4fe1\u53f7"}),"\n",(0,n.jsx)(i.li,{children:"\u5f53\u63a5\u6536\u5230slave\u7aef\u53d1\u9001\u7684\u6570\u636e\u540e\uff0c\u53ea\u6709\u518d\u6b21\u53d1\u9001\u4e00\u6b21\u8bfb\u547d\u4ee4\uff0c\u624d\u4f1a\u5bf9\u672c\u6b21\u6536\u5230\u7684\u6570\u636e\u6062\u590dACK\u786e\u8ba4\u4fe1\u53f7"}),"\n",(0,n.jsx)(i.li,{children:"master\u5728\u63a5\u6536\u5230\u6700\u540e\u4e00\u4e2a\u6570\u636e\u540e\uff0c\u56de\u590dNACK\uff0cslave\u7aef\u624d\u4f1a\u7ed3\u675f\u6570\u636e\u7684\u4f20\u9001\u3002\u5728\u53d1\u9001\u6700\u540e\u4e00\u4e2a\u8bfb\u547d\u4ee4\u65f6\uff0c\u540c\u65f6\u5c06stop\u4f4d\u7f6e\u4f4d\uff0c\u5219master\u5728\u63a5\u6536\u5230slave\u53d1\u9001\u7684\u6570\u636e\u540e\uff0cI2C\u6a21\u5757\u4f1a\u81ea\u52a8\u53d1\u9001NACK\u4fe1\u53f7"}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"\u6ce8\u89e3"}),"\n",(0,n.jsx)(i.p,{children:"I2C\u6a21\u5757\u7684\u6570\u636e\u4f20\u8f93\uff0c\u65e0\u8bba\u662ftransmitter\u8fd8\u662freceiver\uff0c\u90fd\u4f1a\u7528\u5230TXFIFO\uff0ctransmitter\u65f6\u7528\u6765\u53d1\u9001\u6570\u636e\uff0creceiver\u65f6\u7528\u6765\u53d1\u9001\u547d\u4ee4\u3002\u6240\u4ee5\uff0c\u4e2d\u65ad\u5904\u7406\u4e2d\uff0c\u89e6\u53d1TXFIFO_EMPTY\u4e2d\u65ad\u7684\uff0c\u53ef\u80fd\u662fread msg\uff0c\u4e5f\u53ef\u80fd\u662fwrite msg"}),"\n",(0,n.jsx)(i.h4,{id:"534-\u4e2d\u65ad\u6d41\u7a0b",children:"5.3.4. \u4e2d\u65ad\u6d41\u7a0b"}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/design_51-170675591505625.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/design_51.png"})}),"\n",(0,n.jsx)(i.h3,{id:"54-\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",children:"5.4. \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1"}),"\n",(0,n.jsx)(i.p,{children:"\u7ba1\u7406I2C\u63a7\u5236\u5668\u8d44\u6e90\u7684\u9876\u5c42\u7ed3\u6784\u4f53"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"struct aic_i2c_dev {\n        struct device *dev;\n        void __iomem *base;\n        struct i2c_adapter adap;\n        struct completion cmd_complete;\n        struct clk *clk;\n        struct reset_control *rst;\n        int irq;\n        enum aic_i2c_speed i2c_speed;\n        u16 scl_hcnt;\n        u16 scl_lcnt;\n        u32 abort_source;\n        struct i2c_msg *msg;\n        enum aic_msg_status msg_status;\n        int buf_write_idx;\n        int buf_read_idx;\n        bool is_first_message;\n        bool is_last_message;\n        int msg_err;\n        struct i2c_timings timings;\n        u32 master_cfg;\n        u32 slave_cfg;\n        struct i2c_client *slave;\n};\n"})}),"\n",(0,n.jsx)(i.p,{children:"\u90e8\u5206\u53d8\u91cf\u8bf4\u660e\uff1a"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"cmd_complete\uff1a\u5b8c\u6210\u91cf\uff0c\u7528\u4e8e\u6307\u793a\u4e00\u4e2amessage\u662f\u5426\u4f20\u8f93\u5b8c\u6210"}),"\n",(0,n.jsx)(i.li,{children:"scl_hcnt\uff1aSCL\u65f6\u949f\u9ad8\u7535\u5e73\u65f6\u949f\u6570"}),"\n",(0,n.jsx)(i.li,{children:"scl_lcnt\uff1aSCL\u65f6\u949f\u4f4e\u7535\u5e73\u65f6\u949f\u6570"}),"\n",(0,n.jsx)(i.li,{children:"msg\uff1a\u6307\u5411\u5f53\u524d\u4f20\u8f93\u7684message"}),"\n",(0,n.jsx)(i.li,{children:"buf_write_idx\uff1a\u5f53\u524dmessage\u4e3awrite msg\u65f6\uff0cbuf_write_idx\u4e3a\u5199\u6570\u636e\u7684\u8ba1\u6570\u3002\u5f53\u524dmessage\u4e3aread msg\u65f6\uff0cbuf_write_idx\u4e3a\u5199\u547d\u4ee4\u7684\u8ba1\u6570(I2C\u6a21\u5757\u9700\u8981\u6bcf\u6b21\u5199read\u547d\u4ee4\uff0c\u624d\u80fd\u8bfb\u51fa\u6570\u636e)\u3002"}),"\n",(0,n.jsx)(i.li,{children:"buf_read_idx\uff1a\u8bfb\u6570\u636e\u7684\u8ba1\u6570"}),"\n",(0,n.jsx)(i.li,{children:"is_first_message\uff1a\u662f\u5426\u662f\u7b2c\u4e00\u4e2amessage"}),"\n",(0,n.jsx)(i.li,{children:"is_last_message\uff1a\u662f\u5426\u662f\u6700\u540e\u4e00\u4e2amessage"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"55-\u63a5\u53e3\u8bbe\u8ba1",children:"5.5. \u63a5\u53e3\u8bbe\u8ba1"}),"\n",(0,n.jsx)(i.h4,{id:"551-i2c_handle_tx_abort",children:"5.5.1. i2c_handle_tx_abort"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"int i2c_handle_tx_abort(struct aic_i2c_dev *i2c_dev)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u6253\u5370i2c\u53d1\u751fabort\u7684\u539f\u56e0\uff0c\u5e76\u8fd4\u56de\u76f8\u5e94\u7684error\u503c"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"\u6839\u636e\u4e0d\u540c\u7684abort\u539f\u56e0\uff0c\u8fd4\u56de\u4e0d\u540c\u7684error\u503c"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"552-i2c_scl_cnt",children:"5.5.2. i2c_scl_cnt"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"int i2c_scl_cnt(u32 ic_clk, enum aic_i2c_speed aic_speed, u16 *hcnt, u16 *lcnt)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u6839\u636ei2c\u6a21\u5757\u5de5\u4f5c\u7684\u65f6\u949f\u9891\u7387\u548ci2c\u7684\u4f20\u8f93\u901f\u7387\uff0c\u8fd4\u56de\u9700\u8981\u8bbe\u7f6e\u7684hcnt\u503c\u548clcnt\u503c"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"ic_clk\uff1ai2c\u6a21\u5757\u5de5\u4f5c\u7684\u65f6\u949f\u9891\u7387\uff0c\u4ee5KHz\u4e3a\u5355\u4f4daic_speed\uff1a\u8868\u793ai2c\u7684\u4f20\u8f93\u901f\u7387\uff0c\u662f\u6807\u51c6\u6a21\u5f0f\u8fd8\u662f\u5feb\u901f\u6a21\u5f0fhcnt\uff1a\u6307\u5411\u9700\u8981\u8bbe\u7f6e\u7684hcnt\u503c\u7684\u6307\u9488lcnt\uff1a\u6307\u5411\u9700\u8981\u8bbe\u7f6e\u7684lcnt\u503c\u7684\u6307\u9488"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"0\uff1a\u51fd\u6570\u6267\u884c\u6210\u529f-EINVAL\uff1ahcnt\u6216lcnt\u4e3a\u7a7a\u6307\u9488"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"553-i2c_set_timmings_master",children:"5.5.3. i2c_set_timmings_master"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static int i2c_set_timmings_master(struct aic_i2c_dev *i2c_dev)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u8bbe\u7f6emaster\u4ea7\u751fSCL\u65f6\u949f\u7684\u65f6\u5e8f\u53c2\u6570"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"0\uff1a\u51fd\u6570\u6267\u884c\u6210\u529f-EINVAL\uff1a\u53c2\u6570\u975e\u6cd5"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{children:"\u82e5\u5728DTS\u4e2d\u6709\u8bbe\u7f6ei2c\u7684\u65f6\u5e8f\u53c2\u6570scl_raise_ns\u6216scl_fall_ns\uff0c\u5219\u4f1a\u7531i2c_parse_fw_timings\u5bf9DTS\u8fdb\u884c\u89e3\u6790\uff0c\u5728\u6b64\u51fd\u6570\u4e2d\u4e0d\u518d\u8c03\u7528i2c_scl_cnt\u8fdb\u884c\u8bbe\u7f6e"})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"554-i2c_init_master",children:"5.5.4. i2c_init_master"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static void i2c_init_master(struct aic_i2c_dev *i2c_dev)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u521d\u59cb\u5316master\u6a21\u5f0f\u4e0b\u7684\u53c2\u6570\u8bbe\u7f6e\uff0c\u5199\u5165hcnt\u548clcnt\uff0c\u914d\u7f6eTXFIFO\u548cRXFIFO\u9608\u503c\uff0c\u5c06i2c\u914d\u7f6e\u4e3a\u4e3b\u6a21\u5f0f"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"\u65e0"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"555-i2c_xfer_msg_init",children:"5.5.5. i2c_xfer_msg_init"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static void i2c_xfer_msg_init(struct aic_i2c_dev *i2c_dev)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u5728\u4f20\u8f93\u6bcf\u4e2amsg\u524d\u8fdb\u884c\u7684\u521d\u59cb\u5316\uff0c\u4e3b\u8981\u662f\u5c06\u6307\u793a\u6bcf\u4e2amsg\u72b6\u6001\u7684\u53d8\u91cf\u8bbe\u7f6e\u4e3a\u521d\u59cb\u503c\uff0c\u5e76\u8bbe\u7f6e\u4f20\u8f93\u7684\u4ece\u5730\u5740\u8bbe\u7f6e\uff0c\u4f7f\u80fd\u4e2d\u65ad"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"\u65e0"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"556-i2c_xfer_msg",children:"5.5.6. i2c_xfer_msg"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"| \u51fd\u6570\u539f\u578b | static int i2c_xfer_msg(struct aic_i2c_dev *i2c_dev, struct i2c_msg *msg, bool is_first, bool is_last) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u5355\u4e2amsg\u7684\u4f20\u8f93\u51fd\u6570\uff0c\u82e5\u5f53\u524dmsg\u662f\u7b2c\u4e00\u4e2amsg\uff0c\u5219\u4f1a\u7b49\u5f85\u603b\u7ebf\u7a7a\u95f2\uff0c\u7136\u540e\u6267\u884ci2c_xfer_msg_init\u8fdb\u884cmsg\u4f20\u8f93\u524d\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7b49\u5f85\u5f53\u524dmsg\u4f20\u8f93\u5b8c\u6210 |\n| \u53c2\u6570\u5b9a\u4e49 | i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53msg\uff1a\u6307\u5411\u5f53\u524d\u5c06\u8981\u4f20\u8f93\u7684msgis_first\uff1a\u6307\u793a\u5f53\u524dmsg\u662f\u5426\u662f\u7b2c\u4e00\u4e2amsgis_last\uff1a\u6307\u793a\u5f53\u524dmsg\u662f\u5426\u662f\u6700\u540e\u4e00\u4e2amsg |\n| \u8fd4\u56de\u503c   | 0\uff1a\u6267\u884c\u6210\u529f<0\uff1a\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef                            |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,n.jsx)(i.h4,{id:"557-i2c_xfer",children:"5.5.7. i2c_xfer"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"| \u51fd\u6570\u539f\u578b | static int i2c_xfer(struct i2c_adapter *i2c_adap, struct i2c_msg msgs[], int num) |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | i2c\u7684\u4f20\u8f93\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u53ef\u5b8c\u6210\u591a\u4e2amsg\u7684\u4f20\u8f93\uff0c\u4f7f\u7528\u8be5\u51fd\u6570\u5b8c\u6210\u5bf9i2c_algorithm\u4e2dmaster_xfer\u51fd\u6570\u6307\u9488\u7684\u586b\u5145 |\n| \u53c2\u6570\u5b9a\u4e49 | i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53msgs\uff1a\u6307\u5411msg\u6570\u7ec4\u7684\u6307\u9488num\uff1a\u9700\u8981\u4f20\u8f93\u7684msg\u4e2a\u6570 |\n| \u8fd4\u56de\u503c   | 0\uff1a\u6267\u884c\u6210\u529f<0\uff1a\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef                            |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,n.jsx)(i.h4,{id:"558-i2c_handle_read",children:"5.5.8. i2c_handle_read"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{children:"| \u51fd\u6570\u539f\u578b | static void i2c_handle_read(struct aic_i2c_dev *i2c_dev)     |\n| -------- | ------------------------------------------------------------ |\n| \u529f\u80fd\u8bf4\u660e | \u5f53\u89e6\u53d1RX_FULL\u4e2d\u65ad\u65f6\uff0c\u8c03\u7528\u8be5\u51fd\u6570\u8bfb\u53d6\u63a5\u6536\u5230\u7684\u6570\u636e\uff0c\u82e5\u5b8c\u6210\u5f53\u524dmsg\u7684\u63a5\u6536\uff0c\u5219\u91ca\u653e\u5b8c\u6210\u91cf\u3002\u8be5\u51fd\u6570\u5728\u4e2d\u65ad\u4e2d\u8c03\u7528 |\n| \u53c2\u6570\u5b9a\u4e49 | i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53                |\n| \u8fd4\u56de\u503c   | \u65e0                                                           |\n| \u6ce8\u610f\u4e8b\u9879 |                                                              |\n"})}),"\n",(0,n.jsx)(i.h4,{id:"559-i2c_handle_write",children:"5.5.9. i2c_handle_write"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static void i2c_handle_write(struct aic_i2c_dev *i2c_dev)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u5f53\u89e6\u53d1TX_EMPTY\u4e2d\u65ad\u65f6\uff0c\u8c03\u7528\u8be5\u51fd\u6570\u3002\u82e5\u662f\u8bfbmsg\uff0c\u5219\u8c03\u7528\u8be5\u51fd\u6570\u53d1\u9001\u8bfb\u547d\u4ee4\uff0c\u82e5\u662f\u5199msg\uff0c\u5219\u8c03\u7528\u8be5\u51fd\u6570\u53d1\u9001\u6570\u636e"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"\u65e0"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"5510-i2c_init_slave",children:"5.5.10. i2c_init_slave"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static void i2c_init_slave(struct aic_i2c_dev *i2c_dev)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u521d\u59cb\u5316slave\u6a21\u5f0f\u4e0b\u7684\u53c2\u6570\u8bbe\u7f6e\uff0c\u914d\u7f6eTXFIFO\u548cRXFIFO\u9608\u503c\uff0c\u8bbe\u7f6ei2c\u4e3aslave\u6a21\u5f0f"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"\u65e0"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"5511-i2c_reg_slave",children:"5.5.11. i2c_reg_slave"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static int i2c_reg_slave(struct i2c_client *slave)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u521d\u59cb\u5316slave\u6a21\u5f0f\u4e0b\u7684\u53c2\u6570\u8bbe\u7f6e\uff0c\u914d\u7f6eslave\u662f10bit\u5bfb\u5740\u8fd8\u662f7bit\u5bfb\u5740\uff0c\u8bbe\u7f6e\u4ece\u673a\u7684\u5730\u5740"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"0\uff1a\u6267\u884c\u6210\u529f-EBUSY\uff1a\u5fd9\u7b49\u5f85"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h4,{id:"5512-i2c_unreg_slave",children:"5.5.12. i2c_unreg_slave"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,n.jsx)(i.th,{children:"static int i2c_unreg_slave(struct i2c_client *slave)"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,n.jsx)(i.td,{children:"\u4e0ei2c_reg_slave\u529f\u80fd\u76f8\u53cd"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,n.jsx)(i.td,{children:"i2c_dev\uff1a\u6307\u5411\u81ea\u5b9a\u4e49\u7684struct aic_i2c_dev\u7ed3\u6784\u4f53"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u8fd4\u56de\u503c"}),(0,n.jsx)(i.td,{children:"0\uff1a\u6267\u884c\u6210\u529f"})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,n.jsx)(i.td,{})]})]})]}),"\n",(0,n.jsx)(i.h2,{id:"6-\u5e38\u89c1\u95ee\u9898",children:"6. \u5e38\u89c1\u95ee\u9898"}),"\n",(0,n.jsx)(i.p,{children:"\u200b"})]})}function x(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},1151:(e,i,s)=>{s.d(i,{Z:()=>d,a:()=>r});var n=s(7294);const t={},c=n.createContext(t);function r(e){const i=n.useContext(c);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),n.createElement(c.Provider,{value:i},e.children)}}}]);