"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[2467],{2492:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>t,default:()=>l,frontMatter:()=>s,metadata:()=>p,toc:()=>o});var r=i(5893),d=i(1151);const s={sidebar_position:33},t="\u89e6\u6478\u5c4f\u8c03\u8bd5\u6307\u5357",p={id:"D213-DevKit/part3/10-1_TouchscreenDebuggingGuide",title:"\u89e6\u6478\u5c4f\u8c03\u8bd5\u6307\u5357",description:"1. RTP\u8c03\u8bd5\u914d\u7f6e",source:"@site/docs/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide.md",sourceDirName:"D213-DevKit/part3",slug:"/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide",permalink:"/en/docs/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide.md",tags:[],version:"current",sidebarPosition:33,frontMatter:{sidebar_position:33},sidebar:"d213dkSidebar",previous:{title:"\u786c\u4ef6\u6388\u6743\u8ba4\u8bc1",permalink:"/en/docs/D213-DevKit/part3/08-4_HardwareAuthorizationCertification"},next:{title:"\u663e\u793a\u5c4f\u8c03\u8bd5\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/10-2_DisplayDebuggingGuide"}},a={},o=[{value:"1. RTP\u8c03\u8bd5\u914d\u7f6e",id:"1-rtp\u8c03\u8bd5\u914d\u7f6e",level:2},{value:"1.1. \u6982\u8ff0",id:"11-\u6982\u8ff0",level:3},{value:"1.2. \u5185\u6838\u914d\u7f6e",id:"12-\u5185\u6838\u914d\u7f6e",level:3},{value:"1.3. DTS\u53c2\u6570\u914d\u7f6e",id:"13-dts\u53c2\u6570\u914d\u7f6e",level:3},{value:"1.4. \u8c03\u8bd5",id:"14-\u8c03\u8bd5",level:3},{value:"2. CTP\u8c03\u8bd5\u914d\u7f6e",id:"2-ctp\u8c03\u8bd5\u914d\u7f6e",level:2},{value:"2.1. \u6982\u8ff0",id:"21-\u6982\u8ff0",level:3},{value:"2.2. \u5185\u6838\u914d\u7f6e",id:"22-\u5185\u6838\u914d\u7f6e",level:3},{value:"2.2.1. \u9a71\u52a8\u79fb\u690d",id:"221-\u9a71\u52a8\u79fb\u690d",level:4},{value:"2.2.2. \u5185\u6838\u914d\u7f6e",id:"222-\u5185\u6838\u914d\u7f6e",level:4},{value:"2.3. DTS\u53c2\u6570\u914d\u7f6e",id:"23-dts\u53c2\u6570\u914d\u7f6e",level:3},{value:"2.4. \u8c03\u8bd5",id:"24-\u8c03\u8bd5",level:3}];function c(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"\u89e6\u6478\u5c4f\u8c03\u8bd5\u6307\u5357",children:"\u89e6\u6478\u5c4f\u8c03\u8bd5\u6307\u5357"}),"\n",(0,r.jsx)(e.h2,{id:"1-rtp\u8c03\u8bd5\u914d\u7f6e",children:"1. RTP\u8c03\u8bd5\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h3,{id:"11-\u6982\u8ff0",children:"1.1. \u6982\u8ff0"}),"\n",(0,r.jsx)(e.p,{children:"\u76f8\u6bd4CTP\u7535\u5bb9\u89e6\u6478\u5c4f\uff0cRTP\u7535\u963b\u89e6\u6478\u5c4f\u7684\u914d\u7f6e\u548c\u8c03\u8bd5\u7a0d\u5fae\u7b80\u5355\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u989d\u5916\u7684\u89e6\u6478\u5c4f\u9a71\u52a8\uff0c\u53ea\u9700\u8981\u6839\u636e\u539f\u7406\u56fe\u8bbe\u7f6e\u5bf9\u5e94\u7684dts\u53c2\u6570\uff0c\u7136\u540e\u628a\u7cfb\u7edf\u81ea\u5e26\u7684RTP\u63a7\u5236\u5668\u9a71\u52a8\u52a0\u8f7d\u5373\u53ef\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["\u8be6\u7ec6\u7684\u539f\u7406\u4ecb\u7ecd\u8bf7\u53c2\u8003 ",(0,r.jsx)(e.a,{href:"../../interface/rtp/index.html#ref-luban-rtp",children:"\u63a5\u53e3\u90e8\u5206\u5173\u4e8eRTP\u7684\u8bf4\u660e"})]}),"\n",(0,r.jsx)(e.h3,{id:"12-\u5185\u6838\u914d\u7f6e",children:"1.2. \u5185\u6838\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u5728luban\u6839\u76ee\u5f55\u4e0b\u6267\u884c make km (make kernel-menuconfig)\uff0c\u8fdb\u5165kernel\u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Device Drivers\n        Input device support\n            [*] Touchscreens\n                <*> Artinchip resistive touchscreen controller support\n"})}),"\n",(0,r.jsx)(e.h3,{id:"13-dts\u53c2\u6570\u914d\u7f6e",children:"1.3. DTS\u53c2\u6570\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"board.dts\u4e2d\u7684\u53c2\u6570\u914d\u7f6e\u65f6\u8bf7\u786e\u4fdd\u786c\u4ef6\u8fde\u7ebf\u548c\u6240\u914d\u7f6e\u53c2\u6570\u4e00\u81f4\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&rtp {\n    aic,max-pressure = <800>;       //\u6700\u5927\u538b\u611f\u503c\uff0c\u8d85\u8fc7\u6b64\u503c\u7684\u5750\u6807\u4e8b\u4ef6\u88ab\u5ffd\u7565\uff0c\u6309\u538b\u529b\u5ea6\u8d8a\u5c0f\u8be5\u503c\u8d8a\u5927\uff0c\u5373\u503c\u8d8a\u5927\u89e6\u6478\u8d8a\u654f\u611f\n    aic,x-plate = <235>;            //\u7528\u4e07\u7528\u8868\u6d4b\u91cf\u89e6\u6478\u677fX+ \u548c X-\u4e4b\u95f4\u7684\u7535\u963b\u503c\u83b7\u5f97\n    pinctrl-names = "default";      //\u9ed8\u8ba4\n    pinctrl-0 = <&rtp_pins>;        //RTP\u89e6\u6478\u677f\u63a5\u7ebf\u5bf9\u5e94\u7684PIN\u811a\n    status = "okay";                //RTP\u9a71\u52a8\u4f7f\u80fd\u6807\u5fd7\n};\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u5176\u4e2drtp_pins\u5b9a\u4e49\u5728d211-pinctrl.dtsi,4\u4e2apin\u811a\u9700\u8981\u5206\u522b\u5bf9\u5e94RTP\u5c4f\u7684X+ \u3001Y+ \u3001X- \u3001Y- \u9700\u8981\u786c\u4ef6\u786e\u8ba4\u65e0\u8bef\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"rtp_pins: rtp-0 {\n    pins {\n        pinmux = <AIC_PINMUX('A', 8, 2)>,\n                 <AIC_PINMUX('A', 9, 2)>,\n                 <AIC_PINMUX('A', 10, 2)>,\n                 <AIC_PINMUX('A', 11, 2)>;\n    };\n};\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u786c\u4ef6\u63a5\u7ebf\u793a\u4f8b\u56fe\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/rtp1-17067702051561.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/rtp1.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u6ce8\u610f"}),"\n",(0,r.jsx)(e.p,{children:"\u8bf7\u52a1\u5fc5\u786e\u4fdddts\u6240\u914d\u7f6e\u7684\u53c2\u6570\u548c\u5f15\u811a\u4e0e\u786c\u4ef6\u539f\u7406\u56fe\u4e00\u81f4"}),"\n",(0,r.jsx)(e.h3,{id:"14-\u8c03\u8bd5",children:"1.4. \u8c03\u8bd5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6d4b\u91cf\u786c\u4ef6\u901a\u8def"}),"\n",(0,r.jsx)(e.p,{children:"\u6d4b\u91cf\u786c\u4ef6\u901a\u8def\u662f\u5426\u6b63\u5e38\uff0c\u6d4b\u91cf\u7535\u538b\u4fe1\u53f7\u662f\u5426\u6b63\u5e38"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u67e5\u770b\u6253\u5370\u4fe1\u606f"}),"\n",(0,r.jsx)(e.p,{children:"\u6253\u5f00\u8c03\u8bd5\u9009\u9879\uff0c\u7cfb\u7edf\u542f\u52a8\u65f6\u770b\u662f\u5426\u6709\u5f02\u5e38\u6253\u5370"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Kernel hacking\n        Artinchip Debug\n            [*] RTP driver debug\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u67e5\u770b\u8282\u70b9\u4fe1\u606f"}),"\n",(0,r.jsx)(e.p,{children:"\u5728RTP\u521d\u59cb\u5316\u6210\u529f\u540e\uff0c\u4f1a\u5728sysfs\u4e2d\u6ce8\u518c\u751f\u6210\u4e00\u4e2astatus\u8282\u70b9\uff0c\u5176\u4e2d\u6253\u5370\u4e86\u5f53\u524d\u7684RTP\u914d\u7f6e\u53ca\u72b6\u6001\u4fe1\u606f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# cat /sys/devices/platform/soc/19252000.rtp/status\nIn RTP controller V1.00:\nMode 0/2, RTP enale 0, Press detect enable 0\nManual mode status 0\nPressure enable 1, max 800, x-plate 235, y-plate 0\nPoint num: 1, Sample period: 0, Fuzz: 0\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u83b7\u53d6\u5750\u6807\u4fe1\u606f"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u7cfb\u7edf\u6709\u7f16\u8bd1getevent\u5de5\u5177\uff0c\u89e6\u6478\u5c4f\u6709\u89e6\u6478\u65f6\u8fdb\u884c\u5750\u6807\u7684\u6253\u5370"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# getevent\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u83b7\u53d6\u8bbe\u5907\u4fe1\u606f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# cat /proc/bus/input/devices\n\n\u4f8b\u5982\uff1a\nI: Bus=0019 Vendor=0000 Product=0001 Version=0000\nN: Name="Power Button"\nP: Phys=LNXPWRBN/button/input0\nS: Sysfs=/devices/LNXSYSTM:00/LNXPWRBN:00/input/input0\nU: Uniq=\nH: Handlers=kbd event0\nB: PROP=0\nB: EV=3\nB: KEY=10000000000000 0\n\nI: Bus=0011 Vendor=0001 Product=0001 Version=ab41\nN: Name="AT Translated Set 2 keyboard"\nP: Phys=isa0060/serio0/input0\nS: Sysfs=/devices/platform/i8042/serio0/input/input1\nU: Uniq=\nH: Handlers=sysrq kbd event1 leds\nB: PROP=0\nB: EV=120013\nB: KEY=402000000 3803078f800d001 feffffdfffefffff fffffffffffffffe\nB: MSC=10\nB: LED=7\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"2-ctp\u8c03\u8bd5\u914d\u7f6e",children:"2. CTP\u8c03\u8bd5\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h3,{id:"21-\u6982\u8ff0",children:"2.1. \u6982\u8ff0"}),"\n",(0,r.jsx)(e.p,{children:"\u76f8\u6bd4RTP\u7535\u963b\u89e6\u6478\u5c4f\uff0c CTP\u7535\u5bb9\u89e6\u6478\u5c4f\u7684\u8c03\u8bd5\u7a0d\u5fae\u7e41\u7410\u4e00\u70b9\uff0cCTP\u9a71\u52a8\u4e00\u822c\u7531\u89e6\u6478\u5c4f\u539f\u5382\u63d0\u4f9b\uff0c\u7ecf\u8fc7\u79fb\u690d\u6dfb\u52a0\u5230SDK\u4e2d\u7f16\u8bd1\u548c\u4f7f\u7528 \u672c\u7ae0\u8282\u4ee5GT9xx\u4e3a\u4f8b\u6765\u8bf4\u660e\u4e00\u6b3e\u65b0\u7684CTP\u7684\u8c03\u8bd5\u548c\u79fb\u690d\u8fc7\u7a0b\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"22-\u5185\u6838\u914d\u7f6e",children:"2.2. \u5185\u6838\u914d\u7f6e"}),"\n",(0,r.jsx)(e.h4,{id:"221-\u9a71\u52a8\u79fb\u690d",children:"2.2.1. \u9a71\u52a8\u79fb\u690d"}),"\n",(0,r.jsx)(e.p,{children:"\u9a71\u52a8\u5b58\u653e\u8def\u5f84\uff1asource/linux-5.10/drivers/input/touchscreen/gt9xx"}),"\n",(0,r.jsx)(e.p,{children:"\u5176\u4e2dsource/linux-5.10/drivers/input/touchscreen/Makefile\u4fee\u6539\u6dfb\u52a0\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"diff --git a/drivers/input/touchscreen/Makefile b/drivers/input/touchscreen/Makefile\nindex 75924acd8..4be057598 100644\n--- a/drivers/input/touchscreen/Makefile\n+++ b/drivers/input/touchscreen/Makefile\n@@ -116,3 +116,6 @@ obj-$(CONFIG_TOUCHSCREEN_ROHM_BU21023)      += rohm_bu21023.o\n obj-$(CONFIG_TOUCHSCREEN_RASPBERRYPI_FW)       += raspberrypi-ts.o\n obj-$(CONFIG_TOUCHSCREEN_IQS5XX)       += iqs5xx.o\n obj-$(CONFIG_TOUCHSCREEN_ZINITIX)      += zinitix.o\n+obj-$(CONFIG_INPUT_TOUCHSCREEN)   += gt9xx/\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5176\u4e2dsource/linux-5.10/drivers/input/touchscreen/Kconfig\u4fee\u6539\u6dfb\u52a0\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'diff --git a/drivers/input/touchscreen/Kconfig b/drivers/input/touchscreen/Kconfig\nindex a8d18a679..6acdc3b63 100644\n--- a/drivers/input/touchscreen/Kconfig\n+++ b/drivers/input/touchscreen/Kconfig\n@@ -1344,5 +1344,7 @@ config TOUCHSCREEN_ZINITIX\n\n          To compile this driver as a module, choose M here: the\n          module will be called zinitix.\n-\n+source "drivers/input/touchscreen/gt9xx/Kconfig"\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6ce8\u610f"}),"\n",(0,r.jsx)(e.p,{children:"\u8bf7\u4ece\u89e6\u6478\u5c4f\u4f9b\u5e94\u5546\u5904\u83b7\u53d6\u548c\u5185\u6838\u7248\u672c\u5339\u914d\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5982\u679c\u7248\u672c\u4e0d\u5339\u914d\u5219\u53ef\u80fd\u7f16\u8bd1\u51fa\u9519\uff0c\u9700\u8981\u81ea\u884c\u9002\u914d\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"222-\u5185\u6838\u914d\u7f6e",children:"2.2.2. \u5185\u6838\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u5728luban\u6839\u76ee\u5f55\u4e0b\u6267\u884c make km (make kernel-menuconfig)\uff0c\u8fdb\u5165kernel\u7684\u529f\u80fd\u914d\u7f6e\uff0c\u6309\u5982\u4e0b\u9009\u62e9\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Linux\n    Device Drivers\n        Input device support\n            [*] Touchscreens\n                <M> gt9xx based touchscreens\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u9a71\u52a8\u4ee5ko\u7684\u65b9\u5f0f\u7f16\u8bd1\u540e\uff0c\u7cfb\u7edf\u542f\u52a8\u540e\u5728\u542f\u52a8\u811a\u672cS10mdev\u81ea\u52a8\u52a0\u8f7d\uff0c\u5982\u4e0b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'start() {\n     echo -n "Starting $DAEMON... "\n     start-stop-daemon -S -b -m -p $PIDFILE -x /sbin/mdev -- -df\n     [ $? -eq 0 ] && echo "OK" || echo "ERROR"\n\n     # coldplug modules\n     find /sys/ -name modalias -print0 | \\\n         xargs -0 sort -u | \\\n         tr \'\\n\' \'\\0\' | \\\n         xargs -0 modprobe -abq\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u5c0f\u6280\u5de7"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u4e0d\u9700\u8981\u81ea\u52a8\u52a0\u8f7d\uff0c\u53ef\u6ce8\u91ca\u6389\u6240\u793a\u4ee3\u7801\uff0c\u4eff\u7167\u5176\u4ed6\u542f\u52a8\u670d\u52a1\u81ea\u5b9a\u4e49\u52a0\u8f7d\u670d\u52a1\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"23-dts\u53c2\u6570\u914d\u7f6e",children:"2.3. DTS\u53c2\u6570\u914d\u7f6e"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"board.dts\u4e2d\u8981\u6dfb\u52a0\u7684\u53c2\u6570\u9009\u9879\u9700\u8981\u67e5\u770b\u9a71\u52a8\u4ee3\u7801\u4e2d\u6240\u8981\u89e3\u6790\u7684dts\u53c2\u6570\u800c\u6dfb\u52a0\uff0c\u793a\u4f8b\u5982\u4e0b\uff1a"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"GT9xx\u9a71\u52a8\u7a0b\u5e8f\u4e2d\u6240\u8981\u89e3\u6790\u7684dts\u53c2\u6570"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'    static int gtp_parse_dt(struct device *dev,\n                    struct goodix_ts_platform_data *pdata)\n{\n    int ret;\n    u32  key_nums;\n    struct property *prop;\n    u32 key_map[MAX_KEY_NUMS];\n    struct device_node *np = dev->of_node;\n\n    gtp_parse_dt_coords(dev, pdata);\n\n    ret = of_property_read_u32(np, "irq-flags",\n                &pdata->irq_flags);\n    if (ret) {\n        dev_info(dev,\n            "Failed get int-trigger-type from dts,set default\\n");\n        pdata->irq_flags = GTP_DEFAULT_INT_TRIGGER;\n    }\n    of_property_read_u32(np, "goodix,int-sync", &pdata->int_sync);\n    if (pdata->int_sync)\n        dev_info(dev, "int-sync enabled\\n");\n\n    of_property_read_u32(np, "goodix,driver-send-cfg",\n                &pdata->driver_send_cfg);\n    if (pdata->driver_send_cfg)\n        dev_info(dev, "driver-send-cfg enabled\\n");\n\n    of_property_read_u32(np, "goodix,swap-x2y", &pdata->swap_x2y);\n    if (pdata->swap_x2y)\n        dev_info(dev, "swap-x2y enabled\\n");\n\n    of_property_read_u32(np, "goodix,slide-wakeup", &pdata->slide_wakeup);\n    if (pdata->slide_wakeup)\n        dev_info(dev, "slide-wakeup enabled\\n");\n\n    of_property_read_u32(np, "goodix,auto-update", &pdata->auto_update);\n    if (pdata->auto_update)\n        dev_info(dev, "auto-update enabled\\n");\n\n    of_property_read_u32(np, "goodix,auto-update-cfg",\n                &pdata->auto_update_cfg);\n    if (pdata->auto_update_cfg)\n        dev_info(dev, "auto-update-cfg enabled\\n");\n\n    of_property_read_u32(np, "goodix,esd-protect", &pdata->esd_protect);\n    if (pdata->esd_protect)\n        dev_info(dev, "esd-protect enabled\\n");\n\n    of_property_read_u32(np, "goodix,type-a-report",\n                &pdata->type_a_report);\n    if (pdata->type_a_report)\n        dev_info(dev, "type-a-report enabled\\n");\n\n    of_property_read_u32(np, "goodix,resume-in-workqueue",\n                &pdata->resume_in_workqueue);\n    if (pdata->resume_in_workqueue)\n        dev_info(dev, "resume-in-workqueue enabled\\n");\n\n    of_property_read_u32(np, "goodix,power-off-sleep",\n                &pdata->power_off_sleep);\n    if (pdata->power_off_sleep)\n        dev_info(dev, "power-off-sleep enabled\\n");\n\n    of_property_read_u32(np, "goodix,pen-suppress-finger",\n                &pdata->pen_suppress_finger);\n    if (pdata->pen_suppress_finger)\n        dev_info(dev, "pen-suppress-finger enabled\\n");\n\n    prop = of_find_property(np, "touchscreen-key-map", NULL);\n    if (prop) {\n        key_nums = prop->length / sizeof(key_map[0]);\n        key_nums = key_nums > MAX_KEY_NUMS ? MAX_KEY_NUMS : key_nums;\n\n        dev_dbg(dev, "key nums %d\\n", key_nums);\n        ret = of_property_read_u32_array(np,\n                "touchscreen-key-map", key_map,\n                key_nums);\n        if (ret) {\n            dev_err(dev, "Unable to read key codes\\n");\n            pdata->key_nums = 0;\n            memset(pdata->key_map, 0,\n                MAX_KEY_NUMS * sizeof(pdata->key_map[0]));\n        }\n        pdata->key_nums = key_nums;\n        memcpy(pdata->key_map, key_map,\n            key_nums * sizeof(pdata->key_map[0]));\n        dev_info(dev, "key-map is [%x %x %x %x]\\n",\n            pdata->key_map[0], pdata->key_map[1],\n            pdata->key_map[2], pdata->key_map[3]);\n    }\n\n    pdata->irq_gpio = of_get_named_gpio(np, "irq-gpios", 0);\n    if (!gpio_is_valid(pdata->irq_gpio))\n        dev_err(dev, "No valid irq gpio");\n\n    pdata->rst_gpio = of_get_named_gpio(np, "reset-gpios", 0);\n    if (!gpio_is_valid(pdata->rst_gpio))\n        dev_err(dev, "No valid rst gpio");\n\n    return 0;\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"board.dts\u4e2d\u6240\u6dfb\u52a0\u7684\u53c2\u6570\u9879"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'&i2c3 {\n    pinctrl-names = "default";\n    pinctrl-0 = <&i2c3_pins_a>;\n    status = "okay";\n\n    gt9xx@5d {\n        status = "okay";\n        compatible = "goodix,gt9xx";\n        reg = <0x5d>;                               //CTP\u8bbe\u5907\u5730\u5740\uff0c\u53ef\u4ee5\u4ece\u89c4\u683c\u4e66\u4e2d\u83b7\u53d6\n        reset-gpios = <&gpio_a 8 GPIO_ACTIVE_LOW>;\n        irq-gpios = <&gpio_a 9 GPIO_ACTIVE_HIGH>;\n        irq-flags = <2>;\n\n        touchscreen-max-id = <11>;\n        touchscreen-size-x = <1024>;                //CTP x\u8f74\u7684\u8303\u56f4\n        touchscreen-size-y = <600>;                 //CTP y\u8f74\u7684\u8303\u56f4\n        touchscreen-max-w = <1024>;                  //MAX width\n        touchscreen-max-p = <512>;                  //MAX pressure\n\n        goodix,int-sync = <1>;\n    };\n};\n'})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"CTP\u8bbe\u5907\u5730\u5740\u83b7\u53d6\uff1a"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u4ece\u89c4\u683c\u4e66\u4e2d\u53ef\u4ee5\u770b\u51faGT9xx\u6839\u636e\u521d\u59cb\u5316\u65f6\u5e8f\u7684\u4e0d\u540c\u652f\u6301\u4e24\u79cd\u8bbe\u5907\u5730\u5740\uff0c\u9ed8\u8ba4\u65f6\u5e8f\u7684\u8bfb\u5199\u5730\u5740\u4e3a0xBA/0xBB,\u8bfb\u5199\u5730\u5740\u53bb\u6389\u6700\u540e\u4e00\u4f4d\u8bfb\u5199\u4f4d\u5c31\u662f\u8bbe\u5907\u5730\u5740\uff0c\u5373\uff1a0x5d"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/slave_addr-17067702833823.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/slave_addr.png"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u786c\u4ef6\u63a5\u7ebf\u793a\u4f8b\u56fe\u5982\u4e0b\uff1a"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/ctp1-17067702893135.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/ctp1.png"})}),"\n",(0,r.jsx)(e.p,{children:"\u6ce8\u610f"}),"\n",(0,r.jsx)(e.p,{children:"\u8bf7\u52a1\u5fc5\u786e\u4fdddts\u6240\u914d\u7f6e\u7684\u53c2\u6570\u548c\u5f15\u811a\u4e0e\u786c\u4ef6\u539f\u7406\u56fe\u4e00\u81f4"}),"\n",(0,r.jsx)(e.h3,{id:"24-\u8c03\u8bd5",children:"2.4. \u8c03\u8bd5"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u6d4b\u91cf\u786c\u4ef6\u901a\u8def"}),"\n",(0,r.jsx)(e.p,{children:"\u6d4b\u91cf\u786c\u4ef6\u901a\u8def\u662f\u5426\u6b63\u5e38\uff0c\u6d4b\u91cf\u7535\u538b\u4fe1\u53f7\u662f\u5426\u6b63\u5e38"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u67e5\u770b\u6253\u5370\u4fe1\u606f"}),"\n",(0,r.jsx)(e.p,{children:"\u5728board.dts\u4e2d\u4fee\u6539bootargs\uff0c\u589e\u52a0\u201cloglevel=8\u201d \u8c03\u9ad8\u6253\u5370\u7ea7\u522b\uff0c\u7cfb\u7edf\u542f\u52a8\u65f6\u6216insmod\u9a71\u52a8\u6a21\u5757\u65f6\u770b\u662f\u5426\u6709\u5f02\u5e38\u6253\u5370"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u83b7\u53d6\u5750\u6807\u4fe1\u606f"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u7cfb\u7edf\u6709\u7f16\u8bd1getevent\u5de5\u5177\uff0c\u89e6\u6478\u5c4f\u6709\u89e6\u6478\u65f6\u8fdb\u884c\u5750\u6807\u7684\u6253\u5370"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"# getevent\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u83b7\u53d6\u8bbe\u5907\u4fe1\u606f"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:'# cat /proc/bus/input/devices\n\n\u4f8b\u5982\uff1a\uff08\u4ee5GT9xx\u4e3a\u4f8b\uff09\nI: Bus=0018 Vendor=dead Product=beef Version=28bb\nN: Name="goodix-ts"\nP: Phys=input/ts\nS: Sysfs=/devices/virtual/input/input0\nU: Uniq=\nH: Handlers=event0\nB: PROP=2\nB: EV=b\nB: KEY=1c00 0 0 0 0 0\nB: ABS=6e1800000000000\n'})}),"\n"]}),"\n"]})]})}function l(n={}){const{wrapper:e}={...(0,d.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(c,{...n})}):c(n)}},1151:(n,e,i)=>{i.d(e,{Z:()=>p,a:()=>t});var r=i(7294);const d={},s=r.createContext(d);function t(n){const e=r.useContext(s);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function p(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(d):n.components||d:t(n.components),r.createElement(s.Provider,{value:e},n.children)}}}]);