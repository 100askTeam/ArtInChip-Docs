"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[4578],{4102:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>o,frontMatter:()=>_,metadata:()=>r,toc:()=>a});var c=d(5893),i=d(1151);const _={sidebar_position:15},s="AudioCodec \u4f7f\u7528\u6307\u5357",r={id:"D213-DevKit/part3/06-9_AudioCodec-Useguide",title:"AudioCodec \u4f7f\u7528\u6307\u5357",description:"1. \u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/D213-DevKit/part3/06-9_AudioCodec-Useguide.md",sourceDirName:"D213-DevKit/part3",slug:"/D213-DevKit/part3/06-9_AudioCodec-Useguide",permalink:"/en/docs/D213-DevKit/part3/06-9_AudioCodec-Useguide",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/06-9_AudioCodec-Useguide.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"d213dkSidebar",previous:{title:"I2S \u4f7f\u7528\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/06-8_I2S-Useguide"},next:{title:"CAN \u4f7f\u7528\u6307\u5357",permalink:"/en/docs/D213-DevKit/part3/07-1_CAN-Useguide"}},t={},a=[{value:"1. \u6a21\u5757\u4ecb\u7ecd",id:"1-\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"1.1. \u672f\u8bed\u5b9a\u4e49",id:"11-\u672f\u8bed\u5b9a\u4e49",level:3},{value:"1.2. \u6a21\u5757\u7b80\u4ecb",id:"12-\u6a21\u5757\u7b80\u4ecb",level:3},{value:"2. AudioCodec\u914d\u7f6e",id:"2-audiocodec\u914d\u7f6e",level:2},{value:"2.1. \u5185\u6838\u914d\u7f6e",id:"21-\u5185\u6838\u914d\u7f6e",level:3},{value:"2.2. DTS\u914d\u7f6e",id:"22-dts\u914d\u7f6e",level:3},{value:"2.2.1. d211\u914d\u7f6e",id:"221-d211\u914d\u7f6e",level:4},{value:"3. \u8c03\u8bd5\u6307\u5357",id:"3-\u8c03\u8bd5\u6307\u5357",level:2},{value:"4. \u6d4b\u8bd5\u6307\u5357",id:"4-\u6d4b\u8bd5\u6307\u5357",level:2},{value:"4.1. \u6d4b\u8bd5\u73af\u5883",id:"41-\u6d4b\u8bd5\u73af\u5883",level:3},{value:"4.1.1. \u786c\u4ef6",id:"411-\u786c\u4ef6",level:4},{value:"4.1.2. \u8f6f\u4ef6",id:"412-\u8f6f\u4ef6",level:4},{value:"4.2. \u521b\u5efa\u58f0\u5361",id:"42-\u521b\u5efa\u58f0\u5361",level:3},{value:"4.3. \u97f3\u9891\u6d4b\u8bd5",id:"43-\u97f3\u9891\u6d4b\u8bd5",level:3},{value:"4.3.1. \u914d\u7f6e\u97f3\u9891\u8def\u5f84",id:"431-\u914d\u7f6e\u97f3\u9891\u8def\u5f84",level:4},{value:"4.3.1.1. \u81ea\u52a8\u914d\u7f6e",id:"4311-\u81ea\u52a8\u914d\u7f6e",level:5},{value:"4.3.1.2. \u624b\u52a8\u914d\u7f6e\xb6",id:"4312-\u624b\u52a8\u914d\u7f6e",level:5},{value:"4.3.2. \u6d4b\u8bd5\u97f3\u9891\u64ad\u653e",id:"432-\u6d4b\u8bd5\u97f3\u9891\u64ad\u653e",level:4},{value:"4.3.3. \u6d4b\u8bd5\u97f3\u9891\u5f55\u97f3",id:"433-\u6d4b\u8bd5\u97f3\u9891\u5f55\u97f3",level:4},{value:"4.3.4. \u8c03\u6574\u64ad\u653e\u97f3\u91cf",id:"434-\u8c03\u6574\u64ad\u653e\u97f3\u91cf",level:4},{value:"4.3.5. \u8c03\u6574DMIC\u5f55\u97f3\u97f3\u91cf",id:"435-\u8c03\u6574dmic\u5f55\u97f3\u97f3\u91cf",level:4},{value:"4.3.6. \u8c03\u6574AMIC\u5f55\u97f3\u97f3\u91cf",id:"436-\u8c03\u6574amic\u5f55\u97f3\u97f3\u91cf",level:4},{value:"4.3.7. \u8c03\u6574PGA\u589e\u76ca",id:"437-\u8c03\u6574pga\u589e\u76ca",level:4},{value:"5. \u8bbe\u8ba1\u6307\u5357",id:"5-\u8bbe\u8ba1\u6307\u5357",level:2},{value:"5.1. \u6e90\u7801\u8bf4\u660e",id:"51-\u6e90\u7801\u8bf4\u660e",level:3},{value:"5.2. \u6a21\u5757\u67b6\u6784\u8bbe\u8ba1",id:"52-\u6a21\u5757\u67b6\u6784\u8bbe\u8ba1",level:3},{value:"5.2.1. ALSA\u8f6f\u4ef6\u67b6\u6784",id:"521-alsa\u8f6f\u4ef6\u67b6\u6784",level:4},{value:"5.2.2. AIC\u5b9e\u73b0\u67b6\u6784\xb6",id:"522-aic\u5b9e\u73b0\u67b6\u6784",level:4},{value:"5.3. \u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",id:"53-\u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",level:3},{value:"5.3.1. \u521d\u59cb\u5316\u6d41\u7a0b",id:"531-\u521d\u59cb\u5316\u6d41\u7a0b",level:4},{value:"5.3.2. \u97f3\u9891\u901a\u8def\u8bbe\u7f6e",id:"532-\u97f3\u9891\u901a\u8def\u8bbe\u7f6e",level:4},{value:"5.3.3. \u97f3\u9891\u901a\u8def\u7684\u6ce8\u518c",id:"533-\u97f3\u9891\u901a\u8def\u7684\u6ce8\u518c",level:4},{value:"5.3.4. \u97f3\u9891\u63a7\u4ef6\u8bbe\u7f6e\xb6",id:"534-\u97f3\u9891\u63a7\u4ef6\u8bbe\u7f6e",level:4},{value:"5.3.5. dmaengine_pcm\u6ce8\u518c",id:"535-dmaengine_pcm\u6ce8\u518c",level:4},{value:"5.3.6. period-bytes\u5bf9\u9f50",id:"536-period-bytes\u5bf9\u9f50",level:4},{value:"5.3.7. pop\u97f3\u6d88\u9664",id:"537-pop\u97f3\u6d88\u9664",level:4},{value:"5.3.8. \u521b\u5efa\u58f0\u5361",id:"538-\u521b\u5efa\u58f0\u5361",level:4},{value:"5.4. \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",id:"54-\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",level:3},{value:"5.5. \u63a5\u53e3\u8bbe\u8ba1",id:"55-\u63a5\u53e3\u8bbe\u8ba1",level:3},{value:"5.5.1. aic_codec_trigger",id:"551-aic_codec_trigger",level:4},{value:"5.5.2. aic_codec_get_mod_freq",id:"552-aic_codec_get_mod_freq",level:4},{value:"5.5.3. aic_codec_hw_params",id:"553-aic_codec_hw_params",level:4},{value:"5.5.4. aic_codec_startup",id:"554-aic_codec_startup",level:4},{value:"5.5.5. aic_codec_dai_probe",id:"555-aic_codec_dai_probe",level:4},{value:"6. \u5e38\u89c1\u95ee\u9898",id:"6-\u5e38\u89c1\u95ee\u9898",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.h1,{id:"audiocodec-\u4f7f\u7528\u6307\u5357",children:"AudioCodec \u4f7f\u7528\u6307\u5357"}),"\n",(0,c.jsx)(n.h2,{id:"1-\u6a21\u5757\u4ecb\u7ecd",children:"1. \u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,c.jsx)(n.h3,{id:"11-\u672f\u8bed\u5b9a\u4e49",children:"1.1. \u672f\u8bed\u5b9a\u4e49"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u672f\u8bed"}),(0,c.jsx)(n.th,{children:"\u5b9a\u4e49"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"PCM"}),(0,c.jsx)(n.td,{children:"\u8109\u51b2\u7f16\u7801\u8c03\u5236"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"PDM"}),(0,c.jsx)(n.td,{children:"\u8109\u51b2\u5bc6\u5ea6\u8c03\u5236"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"SDM"}),(0,c.jsx)(n.td,{children:"Sigma Delta Modulation"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"DF"}),(0,c.jsx)(n.td,{children:"\u62bd\u503c\u6ee4\u6ce2\u5668"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"IF"}),(0,c.jsx)(n.td,{children:"\u63d2\u503c\u6ee4\u6ce2\u5668"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"HDF"}),(0,c.jsx)(n.td,{children:"\u9ad8\u901a\u6ee4\u6ce2\u5668"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"DVC"}),(0,c.jsx)(n.td,{children:"\u6570\u5b57\u97f3\u91cf\u63a7\u5236\u5668"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"DMICI/F"}),(0,c.jsx)(n.td,{children:"\u6570\u5b57MIC\u63a5\u53e3"})]})]})]}),"\n",(0,c.jsx)(n.h3,{id:"12-\u6a21\u5757\u7b80\u4ecb",children:"1.2. \u6a21\u5757\u7b80\u4ecb"}),"\n",(0,c.jsx)(n.p,{children:"AudioCodec\u662f\u4e00\u4e2a\u5185\u7f6e\u5728SOC\u5185\u90e8\u7684\u97f3\u9891codec\u6a21\u5757\u3002\u8be5\u6a21\u5757\u5185\u90e8\u96c6\u6210\u4e86ADC\u3001DMIC\u97f3\u9891\u8f93\u5165\u548cPWM\u97f3\u9891 \u8f93\u51fa\uff0c\u7ecf\u8fc7\u6570\u5b57\u4fe1\u53f7\u7684\u5904\u7406\uff0c\u5b9e\u73b0\u97f3\u9891\u4fe1\u53f7\u7684\u5f55\u5165\u4ee5\u53ca\u64ad\u653e\u7b49\u529f\u80fd\u3002\u8be5\u6a21\u5757\u8fd8\u5177\u6709\u4ee5\u4e0b\u7279\u6027\uff1a"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u652f\u63011\u8def\u6a21\u62df\u97f3\u9891\u8f93\u5165"}),"\n",(0,c.jsx)(n.li,{children:"\u652f\u6301\u6570\u5b57DMIC\u7acb\u4f53\u58f0\u8f93\u5165"}),"\n",(0,c.jsx)(n.li,{children:"\u652f\u63012\u8def\u5355\u7aef\u8f93\u51fa(\u7acb\u4f53\u58f0)\uff0c\u62161\u8def\u5dee\u5206\u8f93\u51fa(\u5355\u58f0\u9053)"}),"\n",(0,c.jsx)(n.li,{children:"\u65e0DAC\u8bbe\u8ba1\uff0c\u8f93\u51fa\u91c7\u7528PWM\u8f93\u51fa"}),"\n",(0,c.jsx)(n.li,{children:"\u8f93\u5165\u548c\u8f93\u51fa\u901a\u8def\u5747\u652f\u6301\u6570\u5b57\u97f3\u91cf\u63a7\u5236"}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"2-audiocodec\u914d\u7f6e",children:"2. AudioCodec\u914d\u7f6e"}),"\n",(0,c.jsx)(n.h3,{id:"21-\u5185\u6838\u914d\u7f6e",children:"2.1. \u5185\u6838\u914d\u7f6e"}),"\n",(0,c.jsx)(n.p,{children:"\u6309\u7167ALSA\u7684\u6846\u67b6\u8bbe\u8ba1\uff0cAudioCodec\u7684\u6570\u636e\u4f20\u8f93\u4f7f\u7528DMA\u65b9\u5f0f\uff0c\u9700\u8981DMA-engine\u7684\u652f\u6301\uff0c\u6240\u4ee5\u5728menuconfig \u4e2d\u9700\u8981\u6253\u5f00DMA-engine\u7684\u9a71\u52a8\u652f\u6301\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"Device Drivers---\x3e\n    [*] DMA Engine support---\x3e\n            <*> Artinchip SoCs DMA support\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u5728menuconfig\u4e2d\u6253\u5f00ALSA\u6846\u67b6\u7684\u652f\u6301\uff0c\u4f7f\u80fdAIC\u7684AudioCodec\u9a71\u52a8"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"Device Drivers---\x3e\n    <*> Sound card support---\x3e\n            <*> Advanced Linux Sound Architecture---\x3e\n                    <*> ALSA for SoC audio support---\x3e\n                            <*> ArtInChip CODEC Support\n"})}),"\n",(0,c.jsx)(n.h3,{id:"22-dts\u914d\u7f6e",children:"2.2. DTS\u914d\u7f6e"}),"\n",(0,c.jsx)(n.h4,{id:"221-d211\u914d\u7f6e",children:"2.2.1. d211\u914d\u7f6e"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'codec: codec@18610000 {\n    #sound-dai-cells = <0>;\n    compatible = "artinchip,aic-codec-v1.0";\n    reg = <0x18610000 0x400>;\n    interrupts = <GIC_SPI 22 IRQ_TYPE_LEVEL_HIGH>;\n    clocks = <&cmu CLK_CODEC>;\n    resets = <&rst RESET_CODEC>;\n    dmas = <&dma DMA_CODEC>, <&dma DMA_CODEC>;\n    dma-names = "rx", "tx";\n};\n\ncodec-analog {\n    #sound-dai-cells = <0>;\n    compatible = "artinchip,codec-analog";\n    dmas = <&dma 15>, <&dma DMA_CODEC>;\n    dma-names = "rx", "tx";\n};\n'})}),"\n",(0,c.jsx)(n.p,{children:"xxx/board.dts\u4e2d\u7684\u914d\u7f6e"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'&codec {\n    pinctrl-names = "default";\n    pinctrl-0 = <&amic_pins>, <&dmic_pins_a>, <&spk_pins_b>;\n    pa-gpios = <&gpio_f 13 GPIO_ACTIVE_LOW>;\n    status = "okay";\n};\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u6839\u636e\u5b9e\u9645\u7684\u677f\u7ea7\u914d\u7f6e\uff0c\u8bbe\u7f6epinctrl-0\u7684\u503c\u3002"}),"\n",(0,c.jsx)(n.h2,{id:"3-\u8c03\u8bd5\u6307\u5357",children:"3. \u8c03\u8bd5\u6307\u5357"}),"\n",(0,c.jsx)(n.h2,{id:"4-\u6d4b\u8bd5\u6307\u5357",children:"4. \u6d4b\u8bd5\u6307\u5357"}),"\n",(0,c.jsx)(n.h3,{id:"41-\u6d4b\u8bd5\u73af\u5883",children:"4.1. \u6d4b\u8bd5\u73af\u5883"}),"\n",(0,c.jsx)(n.h4,{id:"411-\u786c\u4ef6",children:"4.1.1. \u786c\u4ef6"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u6d4b\u8bd5\u677f\uff1a\u5e26\u6709DMIC\u7684\u6d4b\u8bd5\u677f"}),"\n",(0,c.jsx)(n.li,{children:"PC\uff1a\u7528\u4e8e\u548c\u6d4b\u8bd5\u677f\u4ea4\u4e92"}),"\n",(0,c.jsx)(n.li,{children:"\u4e32\u53e3\u7ebf\uff1a\u8fde\u63a5\u6d4b\u8bd5\u677f\u7684\u8c03\u8bd5\u4e32\u53e3"}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"412-\u8f6f\u4ef6",children:"4.1.2. \u8f6f\u4ef6"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"PC\u7aef\u4e32\u53e3\u7ec8\u7aef\u8f6f\u4ef6"}),"\n",(0,c.jsx)(n.li,{children:"alsa-lib\u548calsa-utils\u7b2c\u4e09\u65b9\u8f6f\u4ef6\u5305"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"42-\u521b\u5efa\u58f0\u5361",children:"4.2. \u521b\u5efa\u58f0\u5361"}),"\n",(0,c.jsxs)(n.p,{children:["AudioCodec\u662fSOC\u5185\u7f6e\u7684codec\uff0c\u6240\u4ee5\u5728AudioCodec\u7684\u9a71\u52a8\u4e2d\uff0c\u5df2\u76f4\u63a5\u521b\u5efa\u58f0\u5361\uff0c\u4e0d\u9700\u8981\u518d\u5355\u72ec\u7f16\u5199machine\u9a71\u52a8\u3002\u5728\u6309\u7167 ",(0,c.jsx)(n.a,{href:"2_configure.html",children:"AudioCodec\u914d\u7f6e"})," \u914d\u7f6e\u540e\uff0c\u5185\u6838\u4f1a\u521b\u5efa\u51fa\u540daic-SoundCard\u7684\u58f0\u5361\uff0c\u5bf9\u6b64\u58f0\u5361\u8fdb\u884c\u64cd\u4f5c\u5373\u53ef\u3002"]}),"\n",(0,c.jsx)(n.h3,{id:"43-\u97f3\u9891\u6d4b\u8bd5",children:"4.3. \u97f3\u9891\u6d4b\u8bd5"}),"\n",(0,c.jsx)(n.h4,{id:"431-\u914d\u7f6e\u97f3\u9891\u8def\u5f84",children:"4.3.1. \u914d\u7f6e\u97f3\u9891\u8def\u5f84"}),"\n",(0,c.jsx)(n.p,{children:"AudioCodec\u7684\u97f3\u9891\u901a\u8def\u4e2d\uff0c\u5b58\u5728\u8f83\u591a\u7684\u5f00\u5173\uff0c\u6df7\u97f3\u5668\uff0c\u6570\u5b57\u97f3\u91cf\u8c03\u8282\u5668\uff0c\u591a\u8def\u9009\u62e9\u5668\u7b49\u5668\u4ef6\u3002\u6240\u4ee5\u5728\u6267\u884c \u64ad\u653e\u6216\u5f55\u97f3\u4efb\u52a1\u524d\uff0c\u9700\u8981\u5148\u914d\u7f6e\u97f3\u9891\u8def\u5f84\uff0c\u4f7f\u97f3\u9891\u6570\u636e\u53ef\u4ee5\u6b63\u786e\u6d41\u901a\u3002"}),"\n",(0,c.jsx)(n.h5,{id:"4311-\u81ea\u52a8\u914d\u7f6e",children:"4.3.1.1. \u81ea\u52a8\u914d\u7f6e"}),"\n",(0,c.jsx)(n.p,{children:"\u5728SDK\u7684target/aic16xx/perxx/rootfs_overlay/var/lib/alsa\u76ee\u5f55\u4e0b\uff0c\u5b58\u653e\u6709asound.state\u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u4fdd\u5b58\u7684\u662f\u58f0\u5361\u5404\u4e2a\u63a7\u4ef6\u7684\u914d\u7f6e\u503c\u3002\u5728\u5185\u6838\u542f\u52a8\u65f6\uff0c\u4f1a\u81ea\u52a8\u52a0\u8f7d\u8be5\u6587\u4ef6\uff0c \u5b8c\u6210\u97f3\u9891\u901a\u8def\u7684\u914d\u7f6e\u3002"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/load_asound_state-17067518348841.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/load_asound_state.png"})}),"\n",(0,c.jsxs)(n.h5,{id:"4312-\u624b\u52a8\u914d\u7f6e",children:["4.3.1.2. \u624b\u52a8\u914d\u7f6e",(0,c.jsx)(n.a,{href:"#id9",children:"\xb6"})]}),"\n",(0,c.jsx)(n.p,{children:"\u4e00\u822c\u4f7f\u7528asound.state\u6587\u4ef6\u9ed8\u8ba4\u7684\u914d\u7f6e\u5373\u53ef\u3002\u5982\u679c\u5185\u6838\u542f\u52a8\u65f6\u7684\u9ed8\u8ba4\u914d\u7f6e\u4e0d\u6ee1\u8db3\u9700\u6c42\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7amixer\u5de5\u5177\u8fdb\u884c\u624b\u52a8\u914d\u7f6e\u3002amixer\u7684\u4f7f\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"amixer sset 'control-name-string' value\n"})}),"\n",(0,c.jsx)(n.p,{children:"control-name-string\u548cvalue\u7684\u503c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u67e5\u770b\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/amixer_scontents-17067518413023.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/amixer_scontents.png"})}),"\n",(0,c.jsx)(n.p,{children:"\u4fee\u6539\u8bbe\u7f6e\u793a\u4f8b\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/amixer_example-17067518498775.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/amixer_example.png"})}),"\n",(0,c.jsx)(n.p,{children:"\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7alsactl\u547d\u4ee4\u5c06\u4fee\u6539\u4fdd\u5b58\u5230asound.state\u6587\u4ef6\u4e2d\u3002\u5728\u540e\u7eed\u7684\u4e0a\u7535\u8fc7\u7a0b\u4e2d\uff0c\u5185\u6838\u4f1a\u52a0\u8f7d\u6700\u65b0\u7684\u4fee\u6539\u914d\u7f6e\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"alsactl -f /var/lib/alsa/asound.state store\n"})}),"\n",(0,c.jsx)(n.h4,{id:"432-\u6d4b\u8bd5\u97f3\u9891\u64ad\u653e",children:"4.3.2. \u6d4b\u8bd5\u97f3\u9891\u64ad\u653e"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"aplay test.wav\n"})}),"\n",(0,c.jsx)(n.h4,{id:"433-\u6d4b\u8bd5\u97f3\u9891\u5f55\u97f3",children:"4.3.3. \u6d4b\u8bd5\u97f3\u9891\u5f55\u97f3"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"arecord -d 10 -f dat -t wav test.wav\n"})}),"\n",(0,c.jsx)(n.p,{children:"-d\uff1a\u6307\u5b9a\u5f55\u97f3\u65f6\u957f\uff0c\u5355\u4f4d\u4e3a\u79d2"}),"\n",(0,c.jsx)(n.p,{children:"-f\uff1a\u6307\u5b9a\u5f55\u5236\u7684\u683c\u5f0f\uff0cdat\u8868\u793a16bit\u5c0f\u7aef\u6570\u636e\uff0c48K\u91c7\u6837\u7387\uff0c\u7acb\u4f53\u58f0"}),"\n",(0,c.jsx)(n.p,{children:"-t\uff1a\u6307\u5b9a\u751f\u6210\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u4e3awav\u6587\u4ef6"}),"\n",(0,c.jsx)(n.p,{children:"test.wav\uff1a\u751f\u6210\u7684wav\u6587\u4ef6\u540d"}),"\n",(0,c.jsx)(n.h4,{id:"434-\u8c03\u6574\u64ad\u653e\u97f3\u91cf",children:"4.3.4. \u8c03\u6574\u64ad\u653e\u97f3\u91cf"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"amixer sset 'AUDIO' 140\n"})}),"\n",(0,c.jsx)(n.h4,{id:"435-\u8c03\u6574dmic\u5f55\u97f3\u97f3\u91cf",children:"4.3.5. \u8c03\u6574DMIC\u5f55\u97f3\u97f3\u91cf"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"amixer sset 'DMICIN' 140\n"})}),"\n",(0,c.jsx)(n.h4,{id:"436-\u8c03\u6574amic\u5f55\u97f3\u97f3\u91cf",children:"4.3.6. \u8c03\u6574AMIC\u5f55\u97f3\u97f3\u91cf"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"amixer sset 'ADC' 140\n"})}),"\n",(0,c.jsx)(n.h4,{id:"437-\u8c03\u6574pga\u589e\u76ca",children:"4.3.7. \u8c03\u6574PGA\u589e\u76ca"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"amixer sset 'PGA Gain' 8\n"})}),"\n",(0,c.jsx)(n.h2,{id:"5-\u8bbe\u8ba1\u6307\u5357",children:"5. \u8bbe\u8ba1\u6307\u5357"}),"\n",(0,c.jsx)(n.h3,{id:"51-\u6e90\u7801\u8bf4\u660e",children:"5.1. \u6e90\u7801\u8bf4\u660e"}),"\n",(0,c.jsx)(n.p,{children:"\u6e90\u4ee3\u7801\u4f4d\u4e8e\uff1alinux-5.10/sound/soc/artinchip/aic-codec.c"}),"\n",(0,c.jsx)(n.h3,{id:"52-\u6a21\u5757\u67b6\u6784\u8bbe\u8ba1",children:"5.2. \u6a21\u5757\u67b6\u6784\u8bbe\u8ba1"}),"\n",(0,c.jsx)(n.h4,{id:"521-alsa\u8f6f\u4ef6\u67b6\u6784",children:"5.2.1. ALSA\u8f6f\u4ef6\u67b6\u6784"}),"\n",(0,c.jsx)(n.p,{children:"Linux\u4e2d\u7684\u97f3\u9891\u91c7\u7528ALSA\u9a71\u52a8\u6846\u67b6\uff0c\u8be5\u6846\u67b6\u7ba1\u7406Linux\u4e0b\u6240\u6709\u4e0e\u97f3\u9891\u76f8\u5173\u7684\u8d44\u6e90\uff0ccodec\u7684\u9a71\u52a8\u6309\u7167ALSA\u6846\u67b6\u8fdb\u884c\u8bbe\u8ba1\u5f00\u53d1\u3002ALSA\u6574\u4f53\u6846\u67b6\u5982\u4e0b\u56fe\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/alsa-17067519420937.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/alsa.png"})}),"\n",(0,c.jsx)(n.p,{children:"\u5982\u4e0a\u56fe\uff0cALSA\u97f3\u9891\u6846\u67b6\u5c06\u5e95\u5c42\u7684\u786c\u4ef6\u9a71\u52a8\u5206\u4e3a\u4e09\u90e8\u5206\uff1amachine\u3001platform\u4e0ecodec\u3002\u4e09\u8005\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/machine_codec_platform-17067519506169.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/machine_codec_platform.png"})}),"\n",(0,c.jsx)(n.p,{children:"platform driver\u5305\u542b\u4e86soc\u5e73\u53f0\u7684\u97f3\u9891DMA\u548c\u6570\u5b57\u97f3\u9891\u63a5\u53e3(I2S\u3001PCM\u3001SPDIF\u3001AC97\u7b49)\u7684\u914d\u7f6e\u548c\u7ba1\u7406\uff0c\u5b83\u4e0d\u5305\u542b\u4efb\u4f55\u4e0e\u677f\u5b50\u6216\u673a\u5668\u76f8\u5173\u7684\u4ee3\u7801\uff0c\u8be5\u90e8\u5206\u9a71\u52a8\u7531SOC\u5382\u5546\u5b9e\u73b0\u3002"}),"\n",(0,c.jsx)(n.p,{children:"codec driver\u7684\u4e00\u4e2a\u91cd\u8981\u539f\u5219\u5c31\u662f\u8981\u6c42codec\u9a71\u52a8\u7684\u5e73\u53f0\u65e0\u5173\u6027\u3002\u5b83\u5305\u542b\u97f3\u9891\u63a7\u4ef6\u3001\u97f3\u9891\u63a5\u53e3\u3001DAPM\u7684\u5b9a\u4e49\u7b49\u3002codec\u7684\u9a71\u52a8\u4e00\u822c\u7531codec IC\u5382\u5546\u5b9e\u73b0\u3002"}),"\n",(0,c.jsx)(n.p,{children:"machine driver\u4e3b\u8981\u662f\u9488\u5bf9\u8bbe\u5907\u7684\uff0c\u4e3b\u8981\u4f5c\u7528\u6709\u4e09\u4e2a\uff1a 1. \u5b9e\u73b0codec\u548cplatform\u7684\u8026\u5408\uff0cmachine driver\u662f\u677f\u7ea7\u4e0a\u7684codec\u548cSOC\u4e4b\u95f4\u7684\u6865\u6881\uff0c\u63cf\u8ff0\u4e8c\u8005\u5982\u4f55\u8fde\u63a5\u3002 2. \u8d1f\u8d23\u5904\u7406\u673a\u5668\u7279\u6709\u7684\u7684\u4e00\u4e9b\u63a7\u4ef6\u548c\u97f3\u9891\u4e8b\u4ef6(\u5982\u677f\u5b50\u4e0a\u9700\u8981\u6253\u5f00\u653e\u5927\u5668\u7b49)\u3002 3. \u521b\u5efa\u58f0\u5361\u3002\u4e00\u822c\u677f\u5361\u7684\u8bbe\u8ba1\u8005\u53ea\u9700\u8981\u5b9e\u73b0\u8fd9\u90e8\u5206\u7684\u9a71\u52a8\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u5355\u72ec\u7684platform driver\u548ccodec driver\u662f\u4e0d\u80fd\u5de5\u4f5c\u7684\uff0c\u5fc5\u987b\u7531machine driver\u628a\u5b83\u4eec\u7ed3\u5408\u5728\u4e00\u8d77\u624d\u80fd\u5b8c\u6210\u6574\u4e2a\u8bbe\u5907\u7684\u97f3\u9891\u5904\u7406\u5de5\u4f5c\u3002ALSA\u6846\u67b6\u5c06\u5e95\u5c42\u786c\u4ef6\u5212\u5206\u4e3a\u4e09\u90e8\u5206\u540e\uff0c\u4f7f\u5f97platform\u548ccodec\u7684\u9a71\u52a8\u5b9e\u73b0\u53d8\u5f97\u66f4\u52a0\u7b80\u5355\uff0c\u4e8c\u8005\u4f9d\u9760cpu_dai\u548ccodec_dai\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\u8fd9\u79cd\u7ed3\u6784\u4e0b\u7684\u97f3\u9891\u6570\u636e\u6d41\u901a\u8def\u5f84\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/data_flow-170675196155813.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/data_flow.png"})}),"\n",(0,c.jsxs)(n.h4,{id:"522-aic\u5b9e\u73b0\u67b6\u6784",children:["5.2.2. AIC\u5b9e\u73b0\u67b6\u6784",(0,c.jsx)(n.a,{href:"#aic",children:"\xb6"})]}),"\n",(0,c.jsx)(n.p,{children:"\u4e0e\u5e38\u89c1\u7684codec\u82af\u7247\u4e0d\u540c\uff0cAIC\u7684AudioCodec\u662fSOC\u5185\u7f6e\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u97f3\u9891\u6570\u636e\u53ef\u4ee5\u76f4\u63a5\u4f20\u8f93\u5230AudioCodec\u6a21\u5757\uff0c\u800c\u4e0d\u9700\u8981I2S\u8fd9\u7c7b\u97f3\u9891\u63a5\u53e3\u3002AudioCodec\u7684\u97f3\u9891\u6570\u636e\u6d41\u901a\u8def\u5f84\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/aic_data_flow-170675198884917.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/aic_data_flow.png"})}),"\n",(0,c.jsx)(n.p,{children:"\u82e5\u662f\u4e00\u9897\u5355\u72ec\u7684codec\u82af\u7247\uff0c\u53ea\u9700\u8981\u5b9e\u73b0\u76f8\u5e94\u7684codec driver\uff0cplatform driver\u7531SOC\u5382\u5546\u5b9e\u73b0\uff0cmachine driver\u7531\u677f\u7ea7\u5f00\u53d1\u8005\u5b9e\u73b0\uff0c\u5e76\u6700\u7ec8\u521b\u5efa\u58f0\u5361\u3002\u4f46\u662fAudioCodec\u672c\u8eab\u5c31\u662fSOC\u4e2d\u7684\u4e00\u4e2a\u6a21\u5757\uff0c\u4e0d\u9700\u8981I2S\u7b49\u97f3\u9891\u63a5\u53e3\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u4e5f\u4e0d\u9700\u8981\u518d\u5355\u72ec\u5b9e\u73b0machine driver\uff0c\u6240\u4ee5\u5728\u5b9e\u73b0SOC\u5185\u7f6e\u7684AudioCodec\u6a21\u5757\u7684\u9a71\u52a8\u65f6\uff0c\u9664\u4e86\u5b9e\u73b0\u97f3\u9891\u901a\u8def\u63a7\u5236\u548c\u97f3\u9891\u63a7\u4ef6\u5916\uff0c\u8fd8\u9700\u8981\u5b9e\u73b0\u58f0\u5361\u7684\u521b\u5efa\uff0c\u4ee5\u4fbf\u7528\u6237\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528AudioCodec\u6a21\u5757\u7684\u9a71\u52a8\u8fdb\u884c\u5f55\u97f3\u548c\u64ad\u653e\u3002"}),"\n",(0,c.jsx)(n.p,{children:"AudioCodec\u6a21\u5757\u4e0d\u9700\u8981I2S\u63a5\u53e3\uff0c\u6240\u4ee5\u5728\u9a71\u52a8\u5b9e\u73b0\u4e2d\u5e76\u6ca1\u6709\u4e25\u683c\u610f\u4e49\u4e0a\u7684cpu_dai\u3002\u4f46\u662fALSA\u6846\u67b6\u5728\u521b\u5efa\u58f0\u5361\u65f6\uff0c\u9700\u8981\u6839\u636ecpu_dai\u548ccodec_dai\u7684\u540d\u5b57\u8fdb\u884c\u67e5\u627e\u5339\u914d\uff0c\u67e5\u627e\u4e0d\u5230\u5219\u4e0d\u80fd\u521b\u5efa\u58f0\u5361\u3002\u6240\u4ee5\u4e3a\u4e86\u80fd\u6210\u529f\u521b\u5efa\u58f0\u5361\uff0c\u5728AudioCodec\u7684\u9a71\u52a8\u5b9e\u73b0\u4e2d\u9700\u8981\u521b\u5efa\u4e00\u4e2adummy_cpu_dai\uff0c\u8be5cpu_dai\u7684\u4f5c\u7528\u662f\u4e3a\u4e86platform\u548ccodec\u7684\u8026\u5408\uff0c\u5e76\u4e0d\u80fd\u5bf9\u8be5cpu_dai\u8fdb\u884c\u4efb\u4f55\u64cd\u4f5c\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u7efc\u4e0a\uff0cAIC\u7684AudioCodec\u6a21\u5757\u7684\u9a71\u52a8\u5b9e\u73b0\u53ef\u4ee5\u5206\u4e3a\u4e09\u90e8\u5206\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["platform driver\u7684\u5b9e\u73b0\uff1a","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"dma\u7684\u6ce8\u518c\u548c\u7ba1\u7406\uff0c\u7528\u4e8e\u5728\u5185\u5b58\u548cAudioCodec\u4e4b\u95f4\u4f20\u8f93\u6570\u636e"}),"\n",(0,c.jsx)(n.li,{children:"cpu_dai\u90e8\u5206\u7684\u5b9a\u4e49\uff0c\u7528\u4e8e\u5b9e\u73b0\u548ccodec driver\u7684\u8026\u5408"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["codec driver\u7684\u5b9e\u73b0\uff1a","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"codec_dai\u7684\u6ce8\u518c\u548c\u7ba1\u7406\uff0c\u7528\u4e8e\u5b9e\u73b0\u548cplatform driver\u7684\u8026\u5408\uff0c\u4ee5\u53ca\u5bf9AudioCodec\u6a21\u5757\u9891\u7387\u3001\u91c7\u6837\u7387\u3001\u91c7\u6837\u6df1\u5ea6\u7684\u8bbe\u7f6e"}),"\n",(0,c.jsx)(n.li,{children:"DAPM\u97f3\u9891\u8def\u5f84\u548c\u97f3\u9891\u63a7\u4ef6\u7684\u7ba1\u7406"}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["machine driver\u7684\u5b9e\u73b0\uff1a","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u7528\u4e8e\u5b9e\u73b0platform\u548ccodec\u7684\u8026\u5408\uff0c\u5e76\u521b\u5efa\u58f0\u5361"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"53-\u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1",children:"5.3. \u5173\u952e\u6d41\u7a0b\u8bbe\u8ba1"}),"\n",(0,c.jsx)(n.h4,{id:"531-\u521d\u59cb\u5316\u6d41\u7a0b",children:"5.3.1. \u521d\u59cb\u5316\u6d41\u7a0b"}),"\n",(0,c.jsx)(n.p,{children:"AudioCodec\u6a21\u5757\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u5982\u4e0b\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u91ca\u653eclock\u548creset\u4fe1\u53f7"}),"\n",(0,c.jsx)(n.li,{children:"\u91ca\u653eAudioCodec\u6a21\u5757\u7684\u5168\u5c40\u590d\u4f4d\u4fe1\u53f7"}),"\n",(0,c.jsx)(n.li,{children:"\u914d\u7f6eplayback\u548ccapture\u7684DMA\u4f20\u8f93\u53c2\u6570"}),"\n",(0,c.jsx)(n.li,{children:"\u6ce8\u518ccodec\u7aefcomponent driver\u548ccodec_dai driver"}),"\n",(0,c.jsx)(n.li,{children:"\u6ce8\u518cplatform\u7aefcomponent driver\u548ccpu_dai driver"}),"\n",(0,c.jsx)(n.li,{children:"\u521b\u5efa\u58f0\u5361\u8bbe\u5907\uff0c\u521d\u59cb\u5316\u58f0\u5361\u7684\u5404\u4e2a\u53c2\u6570\u5b9e\u4f8b"}),"\n",(0,c.jsx)(n.li,{children:"\u6ce8\u518c\u58f0\u5361"}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"532-\u97f3\u9891\u901a\u8def\u8bbe\u7f6e",children:"5.3.2. \u97f3\u9891\u901a\u8def\u8bbe\u7f6e"}),"\n",(0,c.jsx)(n.p,{children:"\u5728AudioCodec\u9a71\u52a8\u4e2d\uff0c\u975e\u5e38\u91cd\u8981\u7684\u73af\u8282\u662f\u97f3\u9891\u901a\u8def\u7684\u8bbe\u7f6e\uff0c\u97f3\u9891\u901a\u8def\u662f\u97f3\u9891\u6570\u636e\u7684\u6d41\u901a\u65b9\u5411\uff0c\u97f3\u9891\u901a\u8def\u8bbe\u7f6e\u7684\u6b63\u786e\u4e0e\u5426\u5173\u7cfb\u5230\u58f0\u5361\u662f\u5426\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002Linux\u5185\u6838\u4e2d\uff0c\u5f15\u5165\u4e86DAPM\u673a\u5236\uff0c\u5bf9\u97f3\u9891\u901a\u8def\u8fdb\u884c\u52a8\u6001\u7684\u4e0a\u4e0b\u7535\u7ba1\u7406\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u529f\u8017\u3002AudioCodec\u7684\u97f3\u9891\u901a\u8def\u8bbe\u8ba1\u5982\u4e0b\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/data_path-170675201157219.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/data_path.png"})}),"\n",(0,c.jsx)(n.p,{children:"\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5728capture\u7aef\uff0c\u5de6\u53f3\u58f0\u9053\u7684\u97f3\u9891\u4fe1\u53f7\u4f9d\u6b21\u7ecf\u8fc7DMICI/F\u3001DF\u3001HPF\u3001DVC\uff0c\u8f93\u51fa\u7684DMIC_OUT\u97f3\u9891\u4fe1\u53f7\u53ef\u4ee5\u76f4\u63a5\u5b58\u50a8\u5230RXFIFO\u4e2d\uff0c\u6216\u662f\u7ecf\u8fc7\u6df7\u97f3\u5668MIX0\u6216MIX1\u76f4\u63a5\u8f93\u51fa\u5230playback\u7aef\u3002capture\u901a\u8def\u4e2d\uff0cHPF\u548cDVC\u90fd\u53ef\u4ee5bypass\uff0c\u97f3\u9891\u4fe1\u53f7\u53ef\u4ee5\u4e0d\u7ecf\u8fc7\u8fd9\u4e24\u4e2a\u6a21\u5757\u7684\u5904\u7406\uff0c\u76f4\u63a5\u65c1\u8def\u5230\u4e0b\u4e00\u4e2a\u6a21\u5757\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u5728playback\u7aef\uff0cMIX0\u548cMIX1\u7684\u97f3\u9891\u8f93\u5165\u4fe1\u53f7\uff0c\u53ef\u4ee5\u6765\u81eaTXFIFO\uff0c\u4e5f\u53ef\u4ee5\u6765\u81eaDMIC_OUT\u3002MIX0\u548cMIX1\u7684\u8f93\u51fa\u4fe1\u53f7\u4f9d\u6b21\u7ecf\u8fc7DVC\u3001IF\u3001FADE\u3001SDM\u3001PWM\u8f93\u51fa\uff0c\u5b9e\u73b0\u97f3\u9891\u7684\u64ad\u653e\u529f\u80fd\u3002playback\u901a\u8def\u4e2d\uff0cDVC\u548cFADE\u90fd\u53ef\u4ee5bypass\uff0c\u97f3\u9891\u4fe1\u53f7\u53ef\u4ee5\u4e0d\u7ecf\u8fc7\u8fd9\u4e24\u4e2a\u6a21\u5757\u7684\u5904\u7406\uff0c\u76f4\u63a5\u65c1\u8def\u5230\u4e0b\u4e00\u4e2a\u6a21\u5757\u3002"}),"\n",(0,c.jsx)(n.p,{children:"capture\u7aef\u7684\u97f3\u9891\u901a\u8def\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/capture_data_path-170675201888021.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/capture_data_path.png"})}),"\n",(0,c.jsx)(n.p,{children:"playback\u7aef\u7684\u97f3\u9891\u901a\u8def\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/playback_data_path-170675202580823.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/playback_data_path.png"})}),"\n",(0,c.jsx)(n.h4,{id:"533-\u97f3\u9891\u901a\u8def\u7684\u6ce8\u518c",children:"5.3.3. \u97f3\u9891\u901a\u8def\u7684\u6ce8\u518c"}),"\n",(0,c.jsx)(n.p,{children:"\u5728ALSA\u7684DAPM\u4e2d\uff0c\u97f3\u9891\u901a\u8def\u4e0a\u7684\u7ed3\u70b9\u7528widget\u8868\u793a\uff0cwidget\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5bf9\u97f3\u9891\u63a7\u4ef6\u7684\u8fdb\u4e00\u6b65\u5c01\u88c5\uff0c\u5b83\u628a\u97f3\u9891\u63a7\u4ef6\u548c\u7535\u6e90\u7ba1\u7406\u8fdb\u884c\u4e86\u7ed3\u5408\uff0c\u540c\u65f6\u8fd8\u5177\u5907\u97f3\u9891\u8def\u5f84\u7684\u8fde\u63a5\u529f\u80fd\u3002\u5b9e\u73b0\u97f3\u9891\u901a\u8def\u7684\u6ce8\u518c\uff0c\u9700\u8981\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5148\u628a\u97f3\u9891\u8def\u5f84\u4e2d\u7684\u7ed3\u70b9\u521d\u59cb\u5316\u4e3astruct snd_soc_dapm_widget\u7c7b\u578b\u7684\u5b9e\u4f8b\uff1a"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'static const struct snd_soc_dapm_widget aic_codec_dapm_widgets[] = {\n    SND_SOC_DAPM_ADC("DMICIF", "Capture-dmic", RX_DMIC_IF_CTRL_REG,\n                    RX_DMIC_IF_EN, 0),\n    /* MUX */\n    SND_SOC_DAPM_MUX("PWM ch0", TX_PWM_CTRL_REG, TX_PWM0_EN,\n                        0, &pwm0_output_mux),\n    SND_SOC_DAPM_MUX("PWM ch1", TX_PWM_CTRL_REG, TX_PWM1_EN,\n                        0, &pwm1_output_mux),\n    SND_SOC_DAPM_MUX("HPF", SND_SOC_NOPM, 0, 0, &hpf_mux),\n    SND_SOC_DAPM_MUX("FADE ch0", SND_SOC_NOPM, 0, 0, &fade0_mux),\n    SND_SOC_DAPM_MUX("FADE ch1", SND_SOC_NOPM, 0, 0, &fade1_mux),\n    SND_SOC_DAPM_MUX("ADC HPF", SND_SOC_NOPM, 0, 0, &adc_hpf_mux),\n\n    /* Sigma-Delta Modulation */\n    SND_SOC_DAPM_DAC("SDM ch0", "Playback", TX_SDM_CTRL_REG,\n                    TX_SDM_CH0_EN, 0),\n    SND_SOC_DAPM_DAC("SDM ch1", "Playback", TX_SDM_CTRL_REG,\n                    TX_SDM_CH1_EN, 0),\n    /* PGA */\n    SND_SOC_DAPM_PGA("DVC 0", ADC_DVC0_CTRL_REG, ADC_DVC0_CTRL_DVC0_EN,\n            0, NULL, 0),\n    SND_SOC_DAPM_PGA("DVC 1", RX_DVC_1_2_CTRL_REG, RX_DVC1_EN, 0, NULL, 0),\n    SND_SOC_DAPM_PGA("DVC 2", RX_DVC_1_2_CTRL_REG, RX_DVC2_EN, 0, NULL, 0),\n    SND_SOC_DAPM_PGA("DVC 3", TX_DVC_3_4_CTRL_REG, TX_DVC3_EN, 0, NULL, 0),\n    SND_SOC_DAPM_PGA("DVC 4", TX_DVC_3_4_CTRL_REG, TX_DVC4_EN, 0, NULL, 0),\n    SND_SOC_DAPM_PGA("PGA", ADC_CTL1_REG, ADC_CTL1_PGA_EN, 0, NULL, 0),\n\n    /* Mixer */\n    SND_SOC_DAPM_MIXER("MIXER0", SND_SOC_NOPM, 0, 0,\n                aic_codec_mixer0_controls,\n                ARRAY_SIZE(aic_codec_mixer0_controls)),\n    SND_SOC_DAPM_MIXER("MIXER1", SND_SOC_NOPM, 0, 0,\n                aic_codec_mixer1_controls,\n                ARRAY_SIZE(aic_codec_mixer1_controls)),\n\n    /* SUPPLY */\n    SND_SOC_DAPM_SUPPLY("FADE", FADE_CTRL0_REG, FADE_CTRL0_EN, 0, NULL, 0),\n    SND_SOC_DAPM_SUPPLY("IF", TX_PLAYBACK_CTRL_REG, TX_PLAYBACK_IF_EN,\n                        0, NULL, 0),\n    SND_SOC_DAPM_SUPPLY("Mic Bias", ADC_CTL1_REG, ADC_CTL1_MBIAS_EN,\n                        0, NULL, 0),\n    SND_SOC_DAPM_SUPPLY("TX GLBEN", GLOBE_CTL_REG, GLOBE_TX_GLBEN,\n                        0, NULL, 0),\n    SND_SOC_DAPM_SUPPLY("RX GLBEN", GLOBE_CTL_REG, GLOBE_RX_GLBEN,\n                        0, NULL, 0),\n\n    SND_SOC_DAPM_DAC("IF ch0", "Playback", TX_PLAYBACK_CTRL_REG,\n                    TX_IF_CH0_EN, 0),\n    SND_SOC_DAPM_DAC("IF ch1", "Playback", TX_PLAYBACK_CTRL_REG,\n                    TX_IF_CH1_EN, 0),\n\n    /* AIF OUT */\n    SND_SOC_DAPM_AIF_OUT("AUDOUTL", "Playback", 0, TXFIFO_CTRL_REG,\n                            TXFIFO_CH0_EN, 0),\n    SND_SOC_DAPM_AIF_OUT("AUDOUTR", "Playback", 1, TXFIFO_CTRL_REG,\n                            TXFIFO_CH1_EN, 0),\n\n    /* AIF IN */\n    SND_SOC_DAPM_AIF_IN("DMICOUTL", "Capture-dmic", 0, DMIC_RXFIFO_CTRL_REG,\n                        DMIC_RXFIFO_CH0_EN, 0),\n    SND_SOC_DAPM_AIF_IN("DMICOUTR", "Capture-dmic", 1, DMIC_RXFIFO_CTRL_REG,\n                        DMIC_RXFIFO_CH1_EN, 0),\n    SND_SOC_DAPM_AIF_IN("ADCOUT", "Capture-adc", 0, ADC_RXFIFO_CTRL_REG,\n                        ADC_RXFIFO_EN, 0),\n    /* ADC */\n    SND_SOC_DAPM_ADC("ADC", "ADC Capture-adc", ADC_CTL1_REG,\n                        ADC_CTL1_ADC_EN, 0),\n\n    SND_SOC_DAPM_INPUT("AMIC"),\n    SND_SOC_DAPM_INPUT("DMIC"),\n    SND_SOC_DAPM_OUTPUT("SPK_OUT0"),\n    SND_SOC_DAPM_OUTPUT("SPK_OUT1"),\n};\n'})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:["\u5229\u7528\u5b9e\u4f8b\u5316\u7684widget\u5b9a\u4e49route\u4fe1\u606f\u3002DAPM\u4e2d\uff0c\u5229\u7528struct snd_soc_dapm_route\u7ed3\u6784\u4f53\u8868\u793a\u4e24\u4e2awidget\u7684\u8fde\u63a5\u5173\u7cfb\u3002",(0,c.jsx)(n.code,{children:"struct snd_soc_dapm_route\u6309\u7167 *{\u201c\u76ee\u7684widget\u201d, \u201c\u63a7\u4ef6\u201d\uff0c \u201c\u6e90widget\u201d}* "}),"\u7684\u65b9\u5f0f\u8fdb\u884c\u5b9a\u4e49\u3002"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'static const struct snd_soc_dapm_route aic_codec_dapm_route[] = {\n    {"DMICOUTL", NULL, "RX GLBEN"},\n    {"DMICOUTR", NULL, "RX GLBEN"},\n    {"DMICIF", NULL, "DMIC"},\n    {"HPF", "Bypass", "DMICIF"},\n    {"HPF", "HPF Enable", "DMICIF"},\n    {"DVC 1", NULL, "HPF"},\n    {"DVC 2", NULL, "HPF"},\n    {"DMICOUTL", NULL, "DVC 1"},\n    {"DMICOUTR", NULL, "DVC 2"},\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    {"ADCOUT", NULL, "RX GLBEN"},\n    {"AMIC", NULL, "Mic Bias"},\n    {"PGA", NULL, "AMIC"},\n    {"ADC", NULL, "PGA"},\n    {"ADC HPF", "Bypass", "ADC"},\n    {"ADC HPF", "HPF Enable", "ADC"},\n    {"DVC 0", NULL, "ADC HPF"},\n    {"ADCOUT", NULL, "DVC 0"},\n#endif\n\n    {"AUDOUTL", NULL, "TX GLBEN"},\n    {"AUDOUTR", NULL, "TX GLBEN"},\n    /* MIXER */\n    {"MIXER0", "audoutl switch", "AUDOUTL"},\n    {"MIXER0", "audoutr switch", "AUDOUTR"},\n    {"MIXER0", "dmicoutl switch", "DMICOUTL"},\n    {"MIXER0", "dmicoutr switch", "DMICOUTR"},\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    {"MIXER0", "adcout switch", "ADCOUT"},\n#endif\n\n    {"MIXER1", "audoutl switch", "AUDOUTL"},\n    {"MIXER1", "audoutr switch", "AUDOUTR"},\n    {"MIXER1", "dmicoutl switch", "DMICOUTL"},\n    {"MIXER1", "dmicoutr switch", "DMICOUTR"},\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    {"MIXER1", "adcout switch", "ADCOUT"},\n#endif\n\n    {"FADE ch0", NULL, "FADE"},\n    {"FADE ch1", NULL, "FADE"},\n    {"IF ch0", NULL, "IF"},\n    {"IF ch1", NULL, "IF"},\n\n    {"DVC 3", NULL, "MIXER0"},\n    {"IF ch0", NULL, "DVC 3"},\n    {"FADE ch0", "Bypass", "IF ch0"},\n    {"FADE ch0", "Fade Enable", "IF ch0"},\n    {"SDM ch0", NULL, "FADE ch0"},\n    {"PWM ch0", "Single_ended", "SDM ch0"},\n    {"PWM ch0", "Differential", "SDM ch0"},\n    {"SPK_OUT0", NULL, "PWM ch0"},\n\n    {"DVC 4", NULL, "MIXER1"},\n    {"IF ch1", NULL, "DVC 4"},\n    {"FADE ch1", "Bypass", "IF ch1"},\n    {"FADE ch1", "Fade Enable", "IF ch1"},\n    {"SDM ch1", NULL, "FADE ch1"},\n    {"PWM ch1", "Single_ended", "SDM ch1"},\n    {"PWM ch1", "Differential", "SDM ch1"},\n    {"SPK_OUT1", NULL, "PWM ch1"},\n};\n'})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5c06\u4e0a\u9762\u5b9a\u4e49\u7684\u4e24\u4e2a\u6570\u7ec4\u8d4b\u503c\u7ed9codec\u7684component driver"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"static const struct snd_soc_component_driver aic_codec_component = {\n    .controls = aic_codec_controls,\n    .num_controls = ARRAY_SIZE(aic_codec_controls),\n    .dapm_widgets = aic_codec_dapm_widgets,\n    .num_dapm_widgets = ARRAY_SIZE(aic_codec_dapm_widgets),\n    .dapm_routes = aic_codec_dapm_route,\n    .num_dapm_routes = ARRAY_SIZE(aic_codec_dapm_route),\n    .idle_bias_on = 1,\n    .use_pmdown_time = 1,\n    .endianness = 1,\n    .non_legacy_dai_naming = 1,\n};\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u8c03\u7528devm_snd_soc_register_component\uff0c\u5b8c\u6210\u97f3\u9891\u8def\u5f84\u7684\u6ce8\u518c"}),"\n"]}),"\n",(0,c.jsxs)(n.h4,{id:"534-\u97f3\u9891\u63a7\u4ef6\u8bbe\u7f6e",children:["5.3.4. \u97f3\u9891\u63a7\u4ef6\u8bbe\u7f6e",(0,c.jsx)(n.a,{href:"#id8",children:"\xb6"})]}),"\n",(0,c.jsx)(n.p,{children:"\u97f3\u9891\u901a\u8def\u662f\u97f3\u9891\u6570\u636e\u6d41\u901a\u7684\u8def\u5f84\uff0c\u800c\u97f3\u9891\u63a7\u4ef6\u662f\u8d1f\u8d23\u97f3\u91cf\u5927\u5c0f\u7684\u8c03\u8282\uff0c\u4ee5\u53ca\u4e00\u4e9b\u5f00\u5173\u7684\u63a7\u5236\u7b49\u529f\u80fd\u3002AudioCodec\u7684\u97f3\u9891\u63a7\u4ef6\u6709DVC\u7684\u97f3\u91cf\u8c03\u8282\uff0cDVC\u3001HPF\u3001FADE\u65c1\u8def\u9009\u62e9\uff0cMIX\u7684\u589e\u76ca\u4f7f\u80fd\uff0c\u4ee5\u53caDMICI/F\u6570\u636e\u4ea4\u6362\u5f00\u5173\u7b49\u3002\u4e0e\u97f3\u9891\u901a\u8def\u7684widget\u4e0d\u540c\uff0c\u97f3\u9891\u63a7\u4ef6\u4e00\u822c\u662f\u4e0d\u5177\u6709\u52a8\u6001\u4e0a\u4e0b\u7535\u63a7\u5236\u529f\u80fd\u7684\u3002\u97f3\u9891\u63a7\u4ef6\u7684\u6ce8\u518c\u9700\u8981\u4e09\u4e2a\u6b65\u9aa4\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5b9a\u4e49struct snd_kcontrol_new\u7c7b\u578b\u7684\u97f3\u9891\u63a7\u4ef6"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'static const struct snd_kcontrol_new aic_codec_controls[] = {\n    SOC_DOUBLE_TLV("DMICIN Capture Volume", RX_DVC_1_2_CTRL_REG,\n                    RX_DVC1_GAIN, RX_DVC2_GAIN,\n                    0xFF, 0, aic_codec_dvc_scale),\n    SOC_DOUBLE_TLV("AUDIO Playback Volume", TX_DVC_3_4_CTRL_REG,\n                    TX_DVC3_GAIN, TX_DVC4_GAIN,\n                    0xFF, 0, aic_codec_dvc_scale),\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    SOC_SINGLE_TLV("ADC Capture Volume", ADC_DVC0_CTRL_REG,\n                    ADC_DVC0_CTRL_DVC0_GAIN,\n                    0xFF, 0, aic_codec_dvc_scale),\n    SOC_SINGLE_TLV("PGA Gain", ADC_CTL2_REG, ADC_CTL2_PGA_GAIN_SEL,\n                    0xF, 0, aic_pga_scale),\n#endif\n    SOC_SINGLE_TLV("MIX1AUDL Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER1_AUDOUTL_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n    SOC_SINGLE_TLV("MIX1AUDR Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER1_AUDOUTR_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n    SOC_SINGLE_TLV("MIX1DMICL Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER1_DMICOUTL_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n    SOC_SINGLE_TLV("MIX1DMICR Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER1_DMICOUTR_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    SOC_SINGLE_TLV("MIX1ADC Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER1_ADCOUT_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n#endif\n    SOC_SINGLE_TLV("MIX0AUDL Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER0_AUDOUTL_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n    SOC_SINGLE_TLV("MIX0AUDR Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER0_AUDOUTR_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n    SOC_SINGLE_TLV("MIX0DMICL Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER0_DMICOUTL_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n    SOC_SINGLE_TLV("MIX0DMICR Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER0_DMICOUTR_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    SOC_SINGLE_TLV("MIX0ADC Playback Gain", TX_MIXER_CTRL_REG,\n                    TX_MIXER0_ADCOUT_GAIN, 1,\n                    1, aic_mixer_source_gain_scale),\n#endif\n    SOC_ENUM("Data Swap Switch", dmicif_data_enum),\n    SOC_ENUM("RXFIFO Delay Time", dmic_rx_dlt_length_enum),\n    SOC_ENUM("RXFIFO Dealy Switch", dmic_rx_dlt_en_enum),\n    SOC_ENUM("AMIC bias voltage level", mic_bias_voltage_enum),\n    SOC_ENUM("PWM0 mode select", pwm0_mode_enum),\n    SOC_ENUM("PWM1 mode select", pwm1_mode_enum),\n    SOC_ENUM("MIXER0 swicth", mixer0_enable_enum),\n    SOC_ENUM("MIXER1 swicth", mixer1_enable_enum),\n};\n'})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5c06\u5b9a\u4e49\u7684\u97f3\u9891\u63a7\u4ef6\u6570\u7ec4\u8d4b\u503c\u7ed9codec\u7684component driver"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"static const struct snd_soc_component_driver aic_codec_component = {\n    .controls = aic_codec_controls,\n    .num_controls = ARRAY_SIZE(aic_codec_controls),\n    .dapm_widgets = aic_codec_dapm_widgets,\n    .num_dapm_widgets = ARRAY_SIZE(aic_codec_dapm_widgets),\n    .dapm_routes = aic_codec_dapm_route,\n    .num_dapm_routes = ARRAY_SIZE(aic_codec_dapm_route),\n    .idle_bias_on = 1,\n    .use_pmdown_time = 1,\n    .endianness = 1,\n    .non_legacy_dai_naming = 1,\n};\n"})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u8c03\u7528devm_snd_soc_register_component\u5b8c\u6210\u97f3\u9891\u63a7\u4ef6\u7684\u6ce8\u518c\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"535-dmaengine_pcm\u6ce8\u518c",children:"5.3.5. dmaengine_pcm\u6ce8\u518c"}),"\n",(0,c.jsx)(n.p,{children:"\u5728d211\u4e2d\uff0ccapture\u7aef\u65b0\u589e\u4e86amic\u901a\u8def\u3002\u5728DMA\u4f20\u8f93\u65f6\uff0camic\u548cdmic\u4f7f\u7528\u4e0d\u540c\u7684dma id\u3002\u6240\u4ee5\u4e3a\u4e86\u533a\u5206\u4e0d\u540c\u7684dma id\uff0c\u5728DTS\u4e2d\u65b0\u589e\u4e86\u4e00\u4e2a\u7ed3\u70b9\uff0c\u7528\u4e8e\u6ce8\u518c\u4e00\u4e2a\u65b0\u7684dma pcm\u8bbe\u5907\u3002\u5e76\u65b0\u589eaic-codec-analog.c\u6587\u4ef6\uff0c\u5728\u8be5\u6587\u4ef6\u4e2d\u5b9e\u73b0\u5bf9\u65b0\u7684dma pcm\u8bbe\u5907\u7684\u6ce8\u518c\u3002"}),"\n",(0,c.jsx)(n.h4,{id:"536-period-bytes\u5bf9\u9f50",children:"5.3.6. period-bytes\u5bf9\u9f50"}),"\n",(0,c.jsx)(n.p,{children:"\u5728\u4f7f\u7528DMA\u4f20\u8f93\u97f3\u9891\u6570\u636e\u65f6\uff0cDMA\u8981\u6c42\u6bcf\u6b21\u4f20\u8f93\u7684\u6570\u636e\u957f\u5ea6\u5fc5\u987b128bytes/8bytes\u5bf9\u9f50\u3002\u5728ALSA\u6846\u67b6\u4e0b\uff0c\u97f3\u9891\u6570\u636e\u4ee5period\u4e3a\u5468\u671f\u8c03\u7528DMA\u4f20\u8f93\uff0c\u6bcf\u6b21\u4f20\u8f93\u7684\u6570\u636e\u957f\u5ea6\u4e3aperiod bytes\u3002\u6240\u4ee5\uff0c\u5fc5\u987b\u6ee1\u8db3period bytes\u6309\u7167128bytes/8bytes\u5bf9\u9f50\u3002ALSA\u4e2d\u63d0\u4f9b\u4e86\u76f8\u5e94\u7684API\u63a5\u53e3(snd_pcm_hw_constraint_step)\u6765\u6ee1\u8db3\u8fd9\u4e00\u9700\u6c42\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'static int aic_codec_startup(struct snd_pcm_substream *substream,\n            struct snd_soc_dai *dai)\n{\n    int ret;\n\n    /* Make sure that the period bytes are 8/128 bytes aligned according to\n    * the DMA transfer requested.\n    */\n#ifdef CONFIG_SND_SOC_AIC_CODEC_V1\n    ret = snd_pcm_hw_constraint_step(substream->runtime, 0,\n                SNDRV_PCM_HW_PARAM_PERIOD_BYTES, 8);\n    if (ret < 0) {\n        dev_err(dai->dev, "Could not apply period step: %d\\n", ret);\n        return ret;\n    }\n\n    ret = snd_pcm_hw_constraint_step(substream->runtime, 0,\n                SNDRV_PCM_HW_PARAM_BUFFER_BYTES, 8);\n    if (ret < 0) {\n        dev_err(dai->dev, "Could not apply buffer step: %d\\n", ret);\n        return ret;\n    }\n#else\n    ret = snd_pcm_hw_constraint_step(substream->runtime, 0,\n                SNDRV_PCM_HW_PARAM_PERIOD_BYTES, 128);\n    if (ret < 0) {\n        dev_err(dai->dev, "Could not apply period step: %d\\n", ret);\n        return ret;\n    }\n\n    ret = snd_pcm_hw_constraint_step(substream->runtime, 0,\n                SNDRV_PCM_HW_PARAM_BUFFER_BYTES, 128);\n    if (ret < 0) {\n        dev_err(dai->dev, "Could not apply buffer step: %d\\n", ret);\n        return ret;\n    }\n#endif\n\n    return ret;\n}\n'})}),"\n",(0,c.jsx)(n.h4,{id:"537-pop\u97f3\u6d88\u9664",children:"5.3.7. pop\u97f3\u6d88\u9664"}),"\n",(0,c.jsx)(n.p,{children:"\u5728\u97f3\u9891\u7684\u9a71\u52a8\u8bbe\u8ba1\u4e2d\uff0c\u64ad\u653e\u4e0a\u4e0b\u7535\u65f6\u7684pop\u97f3\u662f\u7ecf\u5e38\u9047\u5230\u7684\u4e00\u4e2a\u95ee\u9898\u3002pop\u97f3\u4ea7\u751f\u7684\u4e3b\u8981\u539f\u56e0\u5982\u4e0b\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u97f3\u9891\u901a\u8def\u4e2d\u7684\u63a7\u4ef6\u8fd8\u672a\u5168\u90e8\u95ed\u5408\u65f6\uff0c\u529f\u653e\u5374\u5df2\u5904\u4e8e\u5de5\u4f5c\u72b6\u6001\u3002\u6b64\u65f6\u5f53\u5176\u5b83\u63a7\u4ef6\u95ed\u5408\u5f62\u6210\u64ad\u653e\u901a\u8def\u65f6\uff0c\u901a\u8def\u4e2d\u7535\u6d41\u7684\u53d8\u5316\u7ecf\u529f\u653e\u653e\u5927\uff0c\u5f62\u6210pop\u97f3\u3002"}),"\n",(0,c.jsx)(n.li,{children:"\u5728\u6b63\u5e38\u64ad\u653e\u8fc7\u7a0b\u4e2d\uff0c\u64ad\u653e\u4e0d\u540c\u91c7\u6837\u7387\u7684\u97f3\u9891\u6587\u4ef6\u65f6\uff0c\u5bfc\u81f4audio\u9891\u7387\u5207\u6362\uff0c\u6b64\u65f6\u4e5f\u5bb9\u6613\u4ea7\u751fpop\u97f3\u3002\u4f8b\u5982\uff0c\u5f53\u524d\u64ad\u653e\u7684\u662f48K\u91c7\u6837\u7387\u7684\u97f3\u9891\u6587\u4ef6\uff0c\u4e0b\u4e00\u4e2a\u97f3\u9891\u6587\u4ef6\u7684\u91c7\u6837\u7387\u662f22.05K\uff0c\u9700\u8981\u5207\u6362audio\u6a21\u5757\u7684\u5de5\u4f5c\u9891\u7387\uff0c\u5207\u6362\u9891\u7387\u65f6\u6709\u53ef\u80fd\u4ea7\u751fpop\u97f3\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"\u57fa\u4e8e\u4ee5\u4e0a\u539f\u56e0\uff0c\u4e3a\u4e86\u6d88\u9664pop\u97f3\u7684\u95ee\u9898\uff0caudio\u7684\u9a71\u52a8\u8bbe\u8ba1\u4e2d\u505a\u4e86\u4ee5\u4e0b\u51e0\u70b9\u8bbe\u8ba1\uff1a"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u5728DTS\u4e2d\u6dfb\u52a0gpio\u5f15\u811a\uff0c\u7528\u4e8e\u63a7\u5236\u529f\u653e\u7684\u4f7f\u80fd\u548c\u7981\u7528"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'&codec {\n    pinctrl-names = "default";\n    pinctrl-0 = <&amic_pins>, <&dmic_pins_a>, <&spk_pins_b>;\n    pa-gpios = <&gpio_f 13 GPIO_ACTIVE_LOW>;\n    status = "okay";\n};\n'})}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u8c03\u6574\u97f3\u9891\u901a\u8def\u4e2d\u7684\u4e0a\u4e0b\u7535\u987a\u5e8f\uff0c\u786e\u4fdd\u901a\u8def\u6700\u540e\u624d\u4f7f\u80fd\u529f\u653e\u3002ALSA\u4e2d\u63d0\u4f9b\u7684widget\u5b8f\u5df2\u7ecf\u5bf9\u4e0a\u4e0b\u7535\u505a\u597d\u4e86\u6392\u5e8f\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u5b8f\u5b9a\u4e49widget\u5373\u53ef\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:'static const struct snd_soc_dapm_widget aic_codec_card_dapm_widgets[] = {\n    SND_SOC_DAPM_SPK("Speaker", aic_codec_spk_event),\n};\n\nstatic int aic_codec_spk_event(struct snd_soc_dapm_widget *w,\n                    struct snd_kcontrol *k, int event)\n{\n    if (SND_SOC_DAPM_EVENT_ON(event) && !IS_ERR_OR_NULL(gpiod_pa))\n        gpiod_set_value(gpiod_pa, 1);\n    else if (SND_SOC_DAPM_EVENT_OFF(event) && !IS_ERR_OR_NULL(gpiod_pa))\n        gpiod_set_value(gpiod_pa, 0);\n\n    msleep(100);\n\n    return 0;\n}\n\nstatic const struct snd_soc_dapm_widget aic_codec_dapm_widgets[] = {\n    ...\n    SND_SOC_DAPM_SUPPLY("TX GLBEN", GLOBE_CTL_REG, GLOBE_TX_GLBEN,\n                        0, NULL, 0),\n    SND_SOC_DAPM_SUPPLY("RX GLBEN", GLOBE_CTL_REG, GLOBE_RX_GLBEN,\n                        0, NULL, 0),\n    ...\n}\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5728\u4f7f\u80fd\u548c\u7981\u7528\u529f\u653e\u7684widget\u65f6\uff0c\u901a\u8fc7aic_codec_spk_event\u56de\u8c03\u51fd\u6570\u4f7f\u80fd\u548c\u7981\u7528\u529f\u653e\u3002soc-dapm.c\u6587\u4ef6\u7684dapm_up_seq\u548cdapm_down_seq\u6570\u7ec4\u5b9a\u4e49\u4e86\u5404\u4e2awidget\u7684\u4e0a\u4e0b\u7535\u987a\u5e8f\u3002\u800c\u7531SND_SOC_DAPM_SPK\u5b8f\u5b9a\u4e49\u7684\u529f\u653ewidget\uff0c\u5904\u4e8e\u4e0a\u7535\u65f6\u6700\u540e\u4e0a\u7535\uff0c\u6389\u7535\u65f6\u8f83\u65e9\u6389\u7535\u7684\u4f4d\u7f6e\u3002\u5c06TX\u548cRX\u7684\u5168\u5c40\u4f7f\u80fd\u52a0\u5165widget\u94fe\u8def\uff0c\u786e\u4fdd\u5148\u4e8e\u529f\u653e\u4f7f\u80fd\u3002"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"audio\u9700\u8981\u8c03\u6574\u9891\u7387\u65f6\uff0c\u5148\u5173\u95ed\u529f\u653e\uff0c\u9891\u7387\u8c03\u6574\u540e\uff0c\u518d\u5c06\u529f\u653e\u6062\u590d\u5230\u9891\u7387\u8c03\u6574\u524d\u7684\u72b6\u6001\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.h4,{id:"538-\u521b\u5efa\u58f0\u5361",children:"5.3.8. \u521b\u5efa\u58f0\u5361"}),"\n",(0,c.jsx)(n.p,{children:"\u521b\u5efa\u58f0\u5361\u7684\u4e00\u4e2a\u5173\u952e\u6b65\u9aa4\u662f\u5b9e\u73b0platform driver\u548ccodec driver\u7684\u8026\u5408\uff0cALSA\u6846\u67b6\u4e2d\uff0c\u5b9e\u73b0\u4e8c\u8005\u8026\u5408\u662f\u901a\u8fc7struct snd_soc_dai_link\u5b9e\u73b0\u7684\u3002\u5728\u8c03\u7528devm_snd_soc_register_component\u65f6\uff0c\u4f1a\u628a\u76f8\u5e94\u7684platform\u548ccodec\u6240\u5bf9\u5e94\u7684component\u6ce8\u518c\u5230\u94fe\u8868\u4e2d\u3002\u5728\u6ce8\u518c\u58f0\u5361\u65f6\uff0c\u4f1a\u6839\u636esnd_soc_dai_link\u4e2d\u5b9a\u4e49\u7684codecs->dai_name\u548ccpus->dai_name\u8fdb\u884c\u67e5\u627e\uff0c\u5982\u679c\u5728\u94fe\u8868\u4e2d\u53ef\u4ee5\u67e5\u627e\u5230\u76f8\u5e94\u7684dai\uff0c\u5219\u8026\u5408\u6210\u529f\uff0c\u5426\u5219\u4f1a\u8026\u5408\u5931\u8d25\u3002"}),"\n",(0,c.jsx)(n.h3,{id:"54-\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1",children:"5.4. \u6570\u636e\u7ed3\u6784\u8bbe\u8ba1"}),"\n",(0,c.jsx)(n.p,{children:"\u7ba1\u7406AudioCodec\u7684\u914d\u7f6e\u4fe1\u606f"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"struct aic_codec {\n    struct device *dev;\n    struct regmap *regmap;\n    struct clk *clk;\n    struct reset_control *rst;\n    struct resource *res;\n    struct snd_dmaengine_dai_dma_data  capture_dma_dmic;\n    struct snd_dmaengine_dai_dma_data  capture_dma_adc;\n    struct snd_dmaengine_dai_dma_data  playback_dma;\n};\n"})}),"\n",(0,c.jsx)(n.h3,{id:"55-\u63a5\u53e3\u8bbe\u8ba1",children:"5.5. \u63a5\u53e3\u8bbe\u8ba1"}),"\n",(0,c.jsx)(n.h4,{id:"551-aic_codec_trigger",children:"5.5.1. aic_codec_trigger"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,c.jsx)(n.th,{children:"static int aic_codec_trigger(struct snd_pcm_substream *substream, int cmd, struct snd_soc_dai *dai)"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,c.jsx)(n.td,{children:"AudioCodec\u7684\u89e6\u53d1\u51fd\u6570\uff0c\u6839\u636ecmd\u6267\u884c\u4e0d\u540c\u7684\u64cd\u4f5c"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,c.jsx)(n.td,{children:"substream\uff1a\u6307\u5411\u9700\u8981\u6267\u884ccmd\u7684substreamcmd\uff1a\u9700\u8981\u6267\u884c\u7684\u64cd\u4f5cdai\uff1aunused"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,c.jsx)(n.td,{children:"0\uff1a\u6267\u884c\u6210\u529f-EINVAL\uff1a\u53c2\u6570\u975e\u6cd5"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,c.jsx)(n.td,{children:"\u53ef\u4ee5\u4f20\u9012\u7684cmd\u53c2\u6570\u6709\uff1aSNDRV_PCM_TRIGGER_STARTSNDRV_PCM_TRIGGER_RESUMESNDRV_PCM_TRIGGER_PAUSE_RELEASESNDRV_PCM_TRIGGER_STOPSNDRV_PCM_TRIGGER_SUSPENDSNDRV_PCM_TRIGGER_PAUSE_PUSH"})]})]})]}),"\n",(0,c.jsx)(n.h4,{id:"552-aic_codec_get_mod_freq",children:"5.5.2. aic_codec_get_mod_freq"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,c.jsx)(n.th,{children:"static unsigned int aic_codec_get_mod_freq(struct aic_codec *codec, struct snd_pcm_hw_params *params)"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,c.jsx)(n.td,{children:"\u6839\u636e\u4f20\u5165\u7684\u53c2\u6570params\uff0c\u83b7\u53d6\u9700\u8981\u8bbe\u7f6e\u7684AudioCodec\u6a21\u5757\u7684\u65f6\u949f\u9891\u7387"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,c.jsx)(n.td,{children:"codec\uff1a\u6307\u5411aic_codec\u7684\u6307\u9488params\uff1a\u4f20\u5165\u7684\u786c\u4ef6\u53c2\u6570\u6307\u9488"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,c.jsx)(n.td,{children:"\u6267\u884c\u6210\u529f\u8fd4\u56de\u9700\u8981\u8bbe\u7f6e\u7684codec\u65f6\u949f\u9891\u7387\uff0c\u5426\u5219\u8fd4\u56de0"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsx)(n.h4,{id:"553-aic_codec_hw_params",children:"5.5.3. aic_codec_hw_params"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,c.jsx)(n.th,{children:"static int aic_codec_hw_params(struct snd_pcm_substream *substream, struct snd_pcm_hw_params *params, struct snd_soc_dai *dai)"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,c.jsx)(n.td,{children:"\u6839\u636e\u4f20\u5165\u7684params\u53c2\u6570\uff0c\u8bbe\u7f6ecodec\u6a21\u5757\u7684\u65f6\u949f\u53ca\u91c7\u6837\u7387"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,c.jsx)(n.td,{children:"substream\uff1a\u6307\u5411\u9700\u8981\u8bbe\u7f6e\u7684subtsreamparams\uff1a\u9700\u8981\u8bbe\u7f6e\u7684\u786c\u4ef6\u53c2\u6570dai\uff1aunused"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,c.jsx)(n.td,{children:"0\uff1a\u6267\u884c\u6210\u529f-EINVAL\uff1a\u53c2\u6570\u975e\u6cd5"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsx)(n.h4,{id:"554-aic_codec_startup",children:"5.5.4. aic_codec_startup"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,c.jsx)(n.th,{children:"static int aic_codec_startup(struct snd_pcm_substream *substream, struct snd_soc_dai *dai)"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u529f\u80fd\u8bf4\u660e"}),(0,c.jsx)(n.td,{children:"AudioCodec\u7684startup\u51fd\u6570\uff0c\u6267\u884c\u97f3\u9891\u6d41trigger\u524d\u9700\u8981\u8bbe\u7f6e\u7684\u64cd\u4f5c\u3002 \u6b64\u5904\u7528\u4e8e\u8bbe\u7f6eperiod\u548cdma buffer\u7684\u5bf9\u9f50\u65b9\u5f0f"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,c.jsx)(n.td,{children:"substream\uff1a\u6307\u5411\u9700\u8981\u6267\u884cstartup\u7684substreamdai\uff1a\u8bbe\u7f6e\u7684dai\u6307\u9488"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,c.jsx)(n.td,{children:"0\uff1a\u6267\u884c\u6210\u529f-EINVAL\uff1a\u53c2\u6570\u975e\u6cd5"})]})]})]}),"\n",(0,c.jsx)(n.h4,{id:"555-aic_codec_dai_probe",children:"5.5.5. aic_codec_dai_probe"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u51fd\u6570\u539f\u578b"}),(0,c.jsx)(n.th,{children:"static int aic_codec_dai_probe(struct snd_soc_dai *dai)"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u529f\u80fd\u539f\u578b"}),(0,c.jsx)(n.td,{children:"\u6267\u884cdma\u7684\u521d\u59cb\u5316\u64cd\u4f5c"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u53c2\u6570\u5b9a\u4e49"}),(0,c.jsx)(n.td,{children:"dai\uff1a\u6307\u5411codec_dai\u7684\u6307\u9488"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u8fd4\u56de\u503c"}),(0,c.jsx)(n.td,{children:"0\uff1a\u6267\u884c\u6210\u529f"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"\u6ce8\u610f\u4e8b\u9879"}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"6-\u5e38\u89c1\u95ee\u9898",children:"6. \u5e38\u89c1\u95ee\u9898"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsx)(n.li,{children:"\u6267\u884camixer\u65f6\u62a5\u9519\uff0c\u663e\u793a\u627e\u4e0d\u5230alsa.conf\u914d\u7f6e\u6587\u4ef6"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/amixer_error-170675210571925.png",alt:"../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/amixer_error.png"})}),"\n",(0,c.jsx)(n.p,{children:"\u8be5\u95ee\u9898\u7684\u539f\u56e0\u662f\u627e\u4e0d\u5230ALSA\u7684\u8def\u5f84\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u89e3\u51b3\uff1a"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"export ALSA_CONFIG_DIR=/usr/share/alsa/\n"})})]})}function o(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(l,{...e})}):l(e)}},1151:(e,n,d)=>{d.d(n,{Z:()=>r,a:()=>s});var c=d(7294);const i={},_=c.createContext(i);function s(e){const n=c.useContext(_);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),c.createElement(_.Provider,{value:n},e.children)}}}]);