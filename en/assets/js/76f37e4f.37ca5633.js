"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3142],{6989:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>f,frontMatter:()=>d,metadata:()=>s,toc:()=>a});var r=i(5893),c=i(1151);const d={sidebar_position:7},l="QT + Directfb + GE",s={id:"Luban-SDK/part4/01-7_QT+Directfb+GE",title:"QT + Directfb + GE",description:"1. GE\u4ecb\u7ecd",source:"@site/docs/Luban-SDK/part4/01-7_QT+Directfb+GE.md",sourceDirName:"Luban-SDK/part4",slug:"/Luban-SDK/part4/01-7_QT+Directfb+GE",permalink:"/en/docs/Luban-SDK/part4/01-7_QT+Directfb+GE",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/Luban-SDK/part4/01-7_QT+Directfb+GE.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"lunbansdkSidebar",previous:{title:"Directfb Cross Compile",permalink:"/en/docs/Luban-SDK/part4/01-6_DirectfbCrossCompile"},next:{title:"SysterKit\u5f00\u53d1",permalink:"/en/docs/category/systerkit\u5f00\u53d1"}},t={},a=[{value:"1. GE\u4ecb\u7ecd",id:"1-ge\u4ecb\u7ecd",level:2},{value:"2. \u529f\u80fd\u79fb\u690d",id:"2-\u529f\u80fd\u79fb\u690d",level:2},{value:"3. \u6a21\u5757\u6dfb\u52a0",id:"3-\u6a21\u5757\u6dfb\u52a0",level:2},{value:"4. dma buf",id:"4-dma-buf",level:2},{value:"4.1. \u4ee3\u7801\u4fee\u6539",id:"41-\u4ee3\u7801\u4fee\u6539",level:3},{value:"4.2. \u6838\u5fc3\u4ee3\u7801",id:"42-\u6838\u5fc3\u4ee3\u7801",level:3},{value:"5. fbdev",id:"5-fbdev",level:2},{value:"5.1. \u4ee3\u7801\u4fee\u6539",id:"51-\u4ee3\u7801\u4fee\u6539",level:3},{value:"5.2. \u6838\u5fc3\u4ee3\u7801",id:"52-\u6838\u5fc3\u4ee3\u7801",level:3},{value:"6. gfxdriver",id:"6-gfxdriver",level:2},{value:"6.1. \u63a5\u53e3\u65b9\u5f0f",id:"61-\u63a5\u53e3\u65b9\u5f0f",level:3},{value:"6.2. \u529f\u80fd\u58f0\u660e",id:"62-\u529f\u80fd\u58f0\u660e",level:3},{value:"6.3. \u529f\u80fd\u51fd\u6570",id:"63-\u529f\u80fd\u51fd\u6570",level:3},{value:"7. GFX",id:"7-gfx",level:2}];function o(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"qt--directfb--ge",children:"QT + Directfb + GE"}),"\n",(0,r.jsx)(n.h2,{id:"1-ge\u4ecb\u7ecd",children:"1. GE\u4ecb\u7ecd"}),"\n",(0,r.jsx)(n.p,{children:"GE(Graphics Engine) \u662f\u4e00\u4e2a\u7528\u6765\u8fdb\u884c2D\u56fe\u5f62\u52a0\u901f\u7684\u786c\u4ef6\u6a21\u5757\u3002\u4e3b\u8981\u5305\u62ec\u683c\u5f0f\u8f6c\u6362\u3001\u65cb\u8f6c\u3001 \u955c\u50cf\u3001\u7f29\u653e\u3001Alpha\u6df7\u5408\u3001Color Key\u3001\u4f4d\u5757\u642c\u79fb\u3001Dither\u7b49\u529f\u80fd\uff0c \u4ee5\u4e0b\u7279\u6027\u5e94\u8be5\u4f1a\u88abDirectfb\u4f7f\u7528\u7684\u5230\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u6c34\u5e73\u548c\u5782\u76f4Flip"}),"\n",(0,r.jsx)(n.li,{children:"\u6240\u6709\u683c\u5f0f\u652f\u630190/180/270\u5ea6\u65cb\u8f6c"}),"\n",(0,r.jsx)(n.li,{children:"RGB\u683c\u5f0f\u652f\u6301\u4efb\u610f\u89d2\u5ea6\u65cb\u8f6c"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u63011/16x ~ 16x\u7f29\u653e"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301porter-duff\u89c4\u5219\u7684Alpha\u6df7\u5408"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u77e9\u5f62\u586b\u5145"}),"\n",(0,r.jsx)(n.li,{children:"\u4f4d\u5757\u642c\u79fb(bit block transfer)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"2-\u529f\u80fd\u79fb\u690d",children:"2. \u529f\u80fd\u79fb\u690d"}),"\n",(0,r.jsx)(n.p,{children:"\u56e0\u4e3a\u5e73\u53f0\u7684\u5dee\u5f02\uff0c\u9700\u8981\u5728Directfb\u4ee3\u7801\u4e2d\u6ce8\u5165\u5982\u4e0b\u4fe1\u606f\u6765\u652f\u6301\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"dmabuf surface\u652f\u6301"}),"\n",(0,r.jsx)(n.li,{children:"fbdev\u63a5\u53e3"}),"\n",(0,r.jsx)(n.li,{children:"gfxdrivers\u63a5\u53e3"}),"\n",(0,r.jsx)(n.li,{children:"gfx\u903b\u8f91"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:"https://photos.100ask.net/artinchip-docs/d213-devkit/dfb-ge-17068609338211.jpg",alt:"../../_images/dfb-ge.jpg"})}),"\n",(0,r.jsxs)(n.p,{children:["\u56fe 1.11 ",(0,r.jsx)(n.em,{children:"\u79fb\u690d\u67b6\u6784\u56fe"})]}),"\n",(0,r.jsx)(n.h2,{id:"3-\u6a21\u5757\u6dfb\u52a0",children:"3. \u6a21\u5757\u6dfb\u52a0"}),"\n",(0,r.jsx)(n.p,{children:"\u9700\u8981\u5728Directfb\u4e2d\u6dfb\u52a0\u5bf9ge\u6a21\u5757\u7684\u7f16\u8bd1\uff0c\u4fee\u6539\u5bf9\u8c61\u4e3a\u201cconfigure.in\u201d \u6587\u4ef6\uff0c\u5177\u4f53\u65b9\u6cd5\u662f\u53c2\u8003\u67d0\u4e00\u4e2a\u6a21\u5757\u4eff\u5199\uff0c \u8b6c\u5982\uff1avmware\uff0c \u5728\u76f8\u5e94\u7684\u5730\u65b9\u6dfb\u52a0ge \u7684check \u4e3a \u201cyes\u201d\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'@@ -1925,6 +1925,7 @@ sis315=no\nvdpau=no\n+ge=yes\nvmware=no\n\nif test "$have_linux" = "yes"; then\n@@ -1938,7 +1939,7 @@ AC_ARG_WITH(gfxdrivers,\n                            [radeon, savage, sh772x, sis315, tdfx, unichrome,]\n-                           [vdpau, vmware. @<:@default=all@:>@]),\n+                           [vdpau, ge, vmware. @<:@default=all@:>@]),\n            [gfxdrivers="$withval"], [gfxdrivers=all])\n@@ -1966,6 +1967,7 @@ if test "$gfxdrivers" = "all"; then\ncheckfor_vdpau=yes\n+  checkfor_ge=yes\ncheckfor_vmware=no\n\n                checkfor_vdpau=yes\n                ;;\n+          ge)\n+               checkfor_ge=yes\n+               ;;\n        *)\n'})}),"\n",(0,r.jsx)(n.h2,{id:"4-dma-buf",children:"4. dma buf"}),"\n",(0,r.jsx)(n.p,{children:"AIC GE \u9700\u8981\u8fde\u7eed\u7684\u5185\u5b58\u4f5c\u4e3a\u64cd\u4f5cbuf\uff0c\u56e0\u6b64\u9700\u8981\u5728surface pool \u4e2d\u6dfb\u52a0 aic\u7684\u64cd\u4f5c\u63a5\u53e3"}),"\n",(0,r.jsx)(n.h3,{id:"41-\u4ee3\u7801\u4fee\u6539",children:"4.1. \u4ee3\u7801\u4fee\u6539"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"modified:   src/core/local_surface_pool.c\n    modified:   src/core/prealloc_surface_pool.c\n    modified:   src/core/surface_buffer.h\n    modified:   src/core/surface_core.c\nadd\uff1a       src/core/dmabuf_surface_pool.c\n"})}),"\n",(0,r.jsx)(n.h3,{id:"42-\u6838\u5fc3\u4ee3\u7801",children:"4.2. \u6838\u5fc3\u4ee3\u7801"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6dfb\u52a0width \u548c height \u53d8\u91cf\u7684\u4f7f\u7528"}),"\n",(0,r.jsx)(n.li,{children:"\u5b9e\u73b0dmabufSurfacePoolFuncs\u7684\u51fd\u6570"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"const SurfacePoolFuncs dmabufSurfacePoolFuncs = {\n    .PoolDataSize       = dmabufPoolDataSize,\n    .PoolLocalDataSize  = dmabufPoolLocalDataSize,\n    .AllocationDataSize = dmabufAllocationDataSize,\n\n    .InitPool           = dmabufInitPool,\n    .JoinPool           = dmabufJoinPool,\n    .DestroyPool        = dmabufDestroyPool,\n    .LeavePool          = dmabufLeavePool,\n\n    .AllocateBuffer     = dmabufAllocateBuffer,\n    .DeallocateBuffer   = dmabufDeallocateBuffer,\n\n    .Lock               = dmabufLock,\n    .Unlock             = dmabufUnlock,\n};\n"})}),"\n",(0,r.jsx)(n.h2,{id:"5-fbdev",children:"5. fbdev"}),"\n",(0,r.jsx)(n.h3,{id:"51-\u4ee3\u7801\u4fee\u6539",children:"5.1. \u4ee3\u7801\u4fee\u6539"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"modified:   systems/fbdev/fb.h\nmodified:   systems/fbdev/fbdev.c\nmodified:   systems/fbdev/fbdev.h\nmodified:   systems/fbdev/fbdev_surface_pool.c\n"})}),"\n",(0,r.jsx)(n.h3,{id:"52-\u6838\u5fc3\u4ee3\u7801",children:"5.2. \u6838\u5fc3\u4ee3\u7801"}),"\n",(0,r.jsx)(n.p,{children:"fbdev\u4e2d\u505a\u4e24\u5757\u517c\u5bb9\u6027\u4fee\u6539"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6dfb\u52a0width \u548c height \u53d8\u91cf\u7684\u4f7f\u7528"}),"\n",(0,r.jsx)(n.li,{children:"\u6dfb\u52a0gfxdriver\u7684\u63a5\u53e3\u53d8\u91cf"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"--- a/systems/fbdev/fbdev_surface_pool.c\n+++ b/systems/fbdev/fbdev_surface_pool.c\n@@ -66,6 +66,8 @@ typedef struct {\ntypedef struct {\n    int    magic;\n\n+   int    width;\n+   int    height;\n    Chunk *chunk;\n} FBDevAllocationData;\n\n@@ -278,6 +280,9 @@ fbdevAllocateBuffer( CoreSurfacePool       *pool,\n    surface = buffer->surface;\n    D_MAGIC_ASSERT( surface, CoreSurface );\n\n+   alloc->width = buffer->config.size.w;\n+   alloc->height = buffer->config.size.h;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"6-gfxdriver",children:"6. gfxdriver"}),"\n",(0,r.jsx)(n.p,{children:"gfxdirver\u662fdirectfb \u96c6\u6210GE\u7684\u63a5\u53e3\uff0c\u4e3b\u8981\u5b9e\u73b0 ge_driver \u548c ge_device"}),"\n",(0,r.jsx)(n.h3,{id:"61-\u63a5\u53e3\u65b9\u5f0f",children:"6.1. \u63a5\u53e3\u65b9\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:"gfxdriver \u662f\u6a21\u62df Linux \u7684 driver \u7684\u65b9\u5f0f\uff0c\u5411 QT \u6ce8\u518c\u81ea\u5df1\uff0c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"driver_init_device\ndriver_init_driver\ndriver_probe\n"})}),"\n",(0,r.jsx)(n.h3,{id:"62-\u529f\u80fd\u58f0\u660e",children:"6.2. \u529f\u80fd\u58f0\u660e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"#define GE_SUPPORTED_DRAWINGFLAGS (DSDRAW_BLEND)\n#define GE_SUPPORTED_BLITTINGFLAGS (DSBLIT_BLEND_ALPHACHANNEL | \\\n                                    DSBLIT_BLEND_COLORALPHA   | \\\n                                    DSBLIT_SRC_COLORKEY       | \\\n                                    DSBLIT_ROTATE90           | \\\n                                    DSBLIT_ROTATE180          | \\\n                                    DSBLIT_ROTATE270          | \\\n                                    DSBLIT_FLIP_HORIZONTAL    | \\\n                                    DSBLIT_FLIP_VERTICAL)\n\n#define GE_SUPPORTED_BLITTINGFUNCTIONS  (DFXL_BLIT | \\\n                                        DFXL_STRETCHBLIT)\n\n#define GE_SUPPORTED_DRAWINGFUNCTIONS (DFXL_FILLRECTANGLE)\ndevice_info->caps.accel    = GE_SUPPORTED_DRAWINGFUNCTIONS |\n                            GE_SUPPORTED_BLITTINGFUNCTIONS;\n\ndevice_info->caps.drawing  = GE_SUPPORTED_DRAWINGFLAGS;\ndevice_info->caps.blitting = GE_SUPPORTED_BLITTINGFLAGS;\n"})}),"\n",(0,r.jsx)(n.h3,{id:"63-\u529f\u80fd\u51fd\u6570",children:"6.3. \u529f\u80fd\u51fd\u6570"}),"\n",(0,r.jsx)(n.p,{children:"\u901a\u8fc7src/core/gfxcard.h \u4e2d\u7684 GraphicsDeviceFuncs \u5b9e\u73b0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"funcs->CheckState    = ge_check_state;\nfuncs->SetState      = ge_set_state;\nfuncs->EngineSync    = ge_sync;\nfuncs->EngineReset   = ge_reset;\nfuncs->FlushTextureCache  = ge_flush_texture_cache;\n\nfuncs->FillRectangle = ge_fill_rectangle;\nfuncs->Blit          = ge_blit;\nfuncs->StretchBlit   = ge_stretch_blit;\n"})}),"\n",(0,r.jsx)(n.h2,{id:"7-gfx",children:"7. GFX"}),"\n",(0,r.jsx)(n.p,{children:"GFX driver \u662f\u9a71\u52a8\uff0c\u662f\u548cDirectFB\u7684\u63a5\u53e3\u63cf\u8ff0\uff0c\u771f\u6b63\u7684\u5b9e\u73b0\u662f\u901a\u8fc7\u8c03\u7528 aic_mpp \u5e93"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"--- a/src/gfx/Makefile.am\n+++ b/src/gfx/Makefile.am\n+libdirectfb_gfx_la_LDFLAGS = -lmpp_decoder -lmpp_ge\n"})})]})}function f(e={}){const{wrapper:n}={...(0,c.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>l});var r=i(7294);const c={},d=r.createContext(c);function l(e){const n=r.useContext(d);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),r.createElement(d.Provider,{value:n},e.children)}}}]);