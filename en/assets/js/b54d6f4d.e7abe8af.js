"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3252],{4101:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>d,toc:()=>a});var i=t(5893),r=t(1151);const o={sidebar_position:15},s="\u8c03\u8bd5\u914d\u7f6e",d={id:"D213-DevKit/part5/03-15_DebugConfiguration",title:"\u8c03\u8bd5\u914d\u7f6e",description:"\u6b64\u7ae0\u8282\u63cf\u8ff0\u4e00\u4e9b\u5e38\u7528\u7684 SPL/U-Boot \u8c03\u8bd5\u914d\u7f6e\u65b9\u6cd5\u3002",source:"@site/docs/D213-DevKit/part5/03-15_DebugConfiguration.md",sourceDirName:"D213-DevKit/part5",slug:"/D213-DevKit/part5/03-15_DebugConfiguration",permalink:"/en/docs/D213-DevKit/part5/03-15_DebugConfiguration",draft:!1,unlisted:!1,editUrl:"https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part5/03-15_DebugConfiguration.md",tags:[],version:"current",sidebarPosition:15,frontMatter:{sidebar_position:15},sidebar:"d213dkSidebar",previous:{title:"\u56fe\u50cf\u663e\u793a",permalink:"/en/docs/D213-DevKit/part5/03-14_ImageDisplay"},next:{title:"OpenSBI",permalink:"/en/docs/D213-DevKit/part5/03-16_OpenSBI"}},c={},a=[{value:"1. JTAG \u8c03\u8bd5",id:"1-jtag-\u8c03\u8bd5",level:3},{value:"1.1. JTAG \u4e0b\u8f7d\u914d\u7f6e",id:"11-jtag-\u4e0b\u8f7d\u914d\u7f6e",level:4},{value:"1.2. Relocation \u540e\u7684\u8c03\u8bd5",id:"12-relocation-\u540e\u7684\u8c03\u8bd5",level:4},{value:"2. \u6253\u5370\u8bbe\u7f6e",id:"2-\u6253\u5370\u8bbe\u7f6e",level:3}];function l(e){const n={code:"code",h1:"h1",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"\u8c03\u8bd5\u914d\u7f6e",children:"\u8c03\u8bd5\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"\u6b64\u7ae0\u8282\u63cf\u8ff0\u4e00\u4e9b\u5e38\u7528\u7684 SPL/U-Boot \u8c03\u8bd5\u914d\u7f6e\u65b9\u6cd5\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"1-jtag-\u8c03\u8bd5",children:"1. JTAG \u8c03\u8bd5"}),"\n",(0,i.jsx)(n.h4,{id:"11-jtag-\u4e0b\u8f7d\u914d\u7f6e",children:"1.1. JTAG \u4e0b\u8f7d\u914d\u7f6e"}),"\n",(0,i.jsx)(n.p,{children:"SPL \u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d\u5230\u82af\u7247 SRAM \u8fd0\u884c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"restore ./output/images/u-boot-spl-dtb.bin binary 0x103100\nadd-symbol-file ./output/build/uboot-2021.10/spl/u-boot-spl\n\n# 1: eMMC; 2: SD; 4: SPINOR; 5: SPINAND; 6: SDFAT32\nset $a0=5\nset $a1=0\nset $pc=0x103100\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0b\u8f7d\u8fd0\u884c SPL \u65f6\uff0c\u901a\u8fc7 a0 \u4f20\u9012\u542f\u52a8\u8bbe\u5907\u4fe1\u606f\u3002 \u5177\u4f53\u503c\u8bf7\u53c2\u8003\u6e90\u7801 ",(0,i.jsx)(n.code,{children:"boot_param.h"})," \u3002"]}),"\n",(0,i.jsx)(n.p,{children:"U-Boot \u4e0d\u80fd\u76f4\u63a5\u4e0b\u8f7d\u6267\u884c\uff0c\u5fc5\u987b\u901a\u8fc7 OpenSBI \u6765\u8df3\u8f6c\u6267\u884c\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Enable L1 Cache\nset $mhcr = 0x17f\nset $mhint = 0x650C\nset $mxstatus = 0x638000\n\nrestore ./output/images/env.bin binary 0x43100000\nrestore ./output/images/u-boot.dtb binary 0x42200000\nrestore ./output/images/u-boot-dtb.bin binary 0x40200000\n\n# restore ./output/images/fw_jump.bin binary 0x40000000\nload ./output/images/fw_jump.elf\n\nset $a0=0\nset $a1=0x42200000\n# 1: eMMC, 5: NAND 7:USB\nset $a3=7\nset $pc=0x40000000\n\ncontinue\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0b\u8f7d\u8fd0\u884c U-Boot \u65f6\uff0c\u901a\u8fc7 a3 \u4f20\u9012\u542f\u52a8\u8bbe\u5907\u4fe1\u606f\u3002 \u5177\u4f53\u503c\u8bf7\u53c2\u8003\u6e90\u7801 ",(0,i.jsx)(n.code,{children:"boot_param.h"})," \u3002"]}),"\n",(0,i.jsx)(n.h4,{id:"12-relocation-\u540e\u7684\u8c03\u8bd5",children:"1.2. Relocation \u540e\u7684\u8c03\u8bd5"}),"\n",(0,i.jsx)(n.p,{children:"U-Boot \u5728\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u5c06\u8fd0\u884c\u7a7a\u95f4\u8fc1\u79fb\u5230 DRAM \u672b\u7aef\uff0c\u4ee3\u7801\u6bb5\u548c\u76f8\u5173\u7684\u6570\u636e\u8fdb\u884c\u91cd\u5b9a\u4f4d\u4e4b\u540e\uff0c \u8c03\u8bd5\u5668\u539f\u672c\u52a0\u8f7d\u7684 elf \u6587\u4ef6\u4e0e\u5b9e\u9645\u8fd0\u884c\u7684\u4ee3\u7801\u5730\u5740\u4e0d\u4e00\u81f4\uff0c\u56e0\u6b64\u7ee7\u7eed\u8c03\u8bd5\u662f\u4e0d\u6b63\u786e\u7684\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u91cd\u5b9a\u4f4d\u53d1\u751f\u5728 ",(0,i.jsx)(n.code,{children:"board_init_f"})," \u4e0e ",(0,i.jsx)(n.code,{children:"board_init_r"})," \u4e4b\u95f4\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u5c06\u65ad\u70b9\u6253\u5728\u4e0b\u9762\u7684\u4f4d\u7f6e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"call_board_init_r  // arch/riscv/cpu/start.S\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e\u518d\u6dfb\u52a0\u65b0\u7684\u7b26\u53f7\u8868\uff0c\u5982\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"(gdb) add-symbol-file uboot-2021.10/build/updater/u-boot 0x43f51000\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u8fd9\u91cc\u7684\u5730\u5740 0x43f51000 \u662f\u91cd\u5b9a\u4f4d\u4e4b\u540e\u7684 U-Boot \u5f00\u59cb\u5730\u5740\uff0c\u8be5\u5730\u5740\u53ef\u4ee5\u4ece\u542f\u52a8\u6253\u5370\u4e2d\u53ef\u4ee5\u67e5\u770b\u5230\uff0c \u5982\u4e0b\u9762\u7684 Relocating to 0x43f51000 \u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Relocation Offset is: 0x03d51000\nRelocating to 0x43f51000, new gd at 0x43b4ce20, sp at 0x43b44230\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5728\u6dfb\u52a0\u4e86\u65b0\u7684\u7b26\u53f7\u8868\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u8bbe\u7f6e\u65b0\u7684\u65ad\u70b9\u4e86\uff0c\u6bd4\u5982\u53ef\u4ee5\u8bbe\u7f6e\u65ad\u70b9\u5728 board_init_r \u51fd\u6570\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"(gdb) b board_init_r\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u7136\u540e continue \u8fd0\u884c\u5373\u53ef\u3002"}),"\n",(0,i.jsx)(n.h3,{id:"2-\u6253\u5370\u8bbe\u7f6e",children:"2. \u6253\u5370\u8bbe\u7f6e"}),"\n",(0,i.jsxs)(n.p,{children:["\u5728\u542f\u52a8\u6d41\u7a0b\u8c03\u8bd5\u6216\u8005\u6a21\u5757\u8c03\u8bd5\u7684\u65f6\u5019\uff0c\u5982\u679c\u9700\u8981\u901a\u8fc7\u4e32\u53e3\u6253\u5370\u4fe1\u606f\u8fdb\u884c\u8c03\u8bd5\uff0c\u53ef\u4ee5\u901a\u8fc7 Kconfig \u914d\u7f6e\u4e2d\u7684 ",(0,i.jsx)(n.code,{children:"Artinchip debug"})," \u4f7f\u80fd\u6253\u5370\u4fe1\u606f\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"make uboot-menuconfig\nArtinchip debug  ---\x3e\n[ ] Enable early print information\n[ ] Enable device binding log\n[ ] Enable mmc driver log\n[ ] Enable spi-nand driver log\n[ ] Enable spi-nor driver log\n[ ] Enable spi driver log\n[ ] Enable mmc framework trace log\n[ ] Show boot time\n[ ] Show UBI debug log\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u5176\u4e2d\u7b2c\u4e00\u9879\uff1aEnable early print information \u53ef\u4ee5\u5c06\u4e32\u53e3\u521d\u59cb\u5316\u4e4b\u524d\u7684\u8c03\u8bd5\u4fe1\u606f\u6253\u5370\u51fa\u6765\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u6ce8\u610f"}),"\n",(0,i.jsx)(n.p,{children:"SPL \u4e2d\uff0c\u4f7f\u7528\u4e0a\u8ff0\u914d\u7f6e\u65f6\uff0c\u4e0d\u80fd\u540c\u65f6\u4f7f\u80fd TINY_PRINTF"})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>d,a:()=>s});var i=t(7294);const r={},o=i.createContext(r);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);