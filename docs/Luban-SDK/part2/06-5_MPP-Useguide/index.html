<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Luban-SDK/part2/06-5_MPP-Useguide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">MPP使用指南 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://artinchip.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://artinchip.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://artinchip.100ask.net/docs/Luban-SDK/part2/06-5_MPP-Useguide"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="MPP使用指南 | 东山Π"><meta data-rh="true" name="description" content="1. 模块介绍"><meta data-rh="true" property="og:description" content="1. 模块介绍"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://artinchip.100ask.net/docs/Luban-SDK/part2/06-5_MPP-Useguide"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/Luban-SDK/part2/06-5_MPP-Useguide" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/en/docs/Luban-SDK/part2/06-5_MPP-Useguide" hreflang="en"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/Luban-SDK/part2/06-5_MPP-Useguide" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d875fe7e.css">
<script src="/assets/js/runtime~main.ccbe88ba.js" defer="defer"></script>
<script src="/assets/js/main.498bbc78.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">东山Π</b></a><a class="navbar__item navbar__link" href="/docs/D213-DevKit/BoardIntroduction">D213-DevKit</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/luban-sdk使用指南">Luban-SDK</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/Luban-SDK/part2/06-5_MPP-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/Luban-SDK/part2/06-5_MPP-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/ArtInChip-Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/luban-sdk使用指南">Luban SDK使用指南</a><button aria-label="展开侧边栏分类 &#x27;Luban SDK使用指南&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/mpp开发">MPP开发</a><button aria-label="折叠侧边栏分类 &#x27;MPP开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Luban-SDK/part2/06-5_MPP-Useguide">MPP使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Luban-SDK/part2/06-6_MPPPlayer-Useguide">MPP 播放器使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Luban-SDK/part2/06-7_Gstreamer-Useguide">Gstreamer 使用指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/lvgl开发">LVGL开发</a><button aria-label="展开侧边栏分类 &#x27;LVGL开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/qt开发">QT开发</a><button aria-label="展开侧边栏分类 &#x27;QT开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/systerkit开发">SysterKit开发</a><button aria-label="展开侧边栏分类 &#x27;SysterKit开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/mpp开发"><span itemprop="name">MPP开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">MPP使用指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>MPP使用指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-模块介绍">1. 模块介绍<a href="#1-模块介绍" class="hash-link" aria-label="1. 模块介绍的直接链接" title="1. 模块介绍的直接链接">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="11-术语定义">1.1. 术语定义<a href="#11-术语定义" class="hash-link" aria-label="1.1. 术语定义的直接链接" title="1.1. 术语定义的直接链接">​</a></h2>
<table><thead><tr><th>术语</th><th>定义</th><th>注释说明</th></tr></thead><tbody><tr><td>VE</td><td>Video Engine</td><td>视频加速引擎</td></tr><tr><td>MPP</td><td>Media Process Platform</td><td>通用多媒体处理软件平台</td></tr><tr><td>packet</td><td>video bitstream packet</td><td>一帧视频或图片码流数据</td></tr><tr><td>frame</td><td>frame</td><td>一帧解码后的视频或图片数据</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="12-模块简介">1.2. 模块简介<a href="#12-模块简介" class="hash-link" aria-label="1.2. 模块简介的直接链接" title="1.2. 模块简介的直接链接">​</a></h2>
<p>MPP(Media Process Platform)是 Artinchip 自主研发的通用多媒体处理软件平台，适用于 Artinchip 芯片系列。支持在 Linux 平台上运行， 屏蔽了Artinchip不同芯片平台多种多媒体硬件模块（VE、GE 等）版本的差异，为使用者提供简单易用的多媒体处理 API，支持多种多媒体解决方案。</p>
<p>目前支持硬件模块包括：</p>
<ul>
<li>VE：视频、图片编解码功能</li>
<li>GE：2D图形加速</li>
</ul>
<p>MPP在系统架构的层次图如下图：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_system1-17066914716631.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_system1.png" class="img_ev3q"></p>
<p>图 6.43 <em>MPP系统框架层次图</em></p>
<ul>
<li>
<ul>
<li>
<p>硬件层 Hardware</p>
<p>硬件层是 Artinchip 系列芯片平台的多媒体硬件加速引擎 VE/GE。VE 模块硬件层接口请参考芯片用户手册 VE 模块GE 模块硬件层接口请参考芯片用户手册 GE 模块</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>MPP 内核空间层</p>
<p>包括 VE/GE 模块驱动，MPP Heap 内存管理框架。VE 模块驱动请参考 <a href="/docs/Luban-SDK/ve/index.html#ref-luban-ve">VE 使用指南</a>GE 模块驱动请参考 <a href="/docs/Luban-SDK/ge/index.html#ref-luban-ge">GE 使用指南</a></p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>MPP 用户空间层</p>
<p>MPP 用户态程序，包括 视频解码 mpp_decoder、视频编码 mpp_encoder、2D图像处理 mpp_ge 等功能模块。</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>应用层</p>
<p>分为两部分：提供简易播放器应用 mpp_player; 对接第三方开源库 openmax、gstreamer、lvgl等。</p>
</li>
</ul>
</li>
</ul>
<h1>2. 参数配置</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="21-内核配置">2.1. 内核配置<a href="#21-内核配置" class="hash-link" aria-label="2.1. 内核配置的直接链接" title="2.1. 内核配置的直接链接">​</a></h2>
<p>MPP 依赖 VE 驱动，MPP Heap 内存管理框架，请在 MPP 编译前进行配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="211-mpp-heap">2.1.1. MPP Heap<a href="#211-mpp-heap" class="hash-link" aria-label="2.1.1. MPP Heap的直接链接" title="2.1.1. MPP Heap的直接链接">​</a></h3>
<p>ArtInChip 平台使用 DMA-BUF 来实现多媒体模块间的 buffer 共享。对于 DMA-BUF，Kernel 提供 System Heap 和 CMA Heap 两个 exporter。 前者直接申请匿名页面，后者则在 CMA 内存中申请页面。</p>
<p>虽然通过这两个 exporter 都能拿到足够的物理连续内存，但它们在系统长时间运行后，都面临内存碎片化问题。特别是在 64 M 小内存方案中，碎片化问题尤为严重。</p>
<p>为了 <strong>解决内存碎片化</strong> 的问题，ArtInChip 基于 CMA Heap 进行封装，提供一个私有的 exporter ，即 <strong>MPP Heap</strong> 。</p>
<p>在 luban 根目录下执行 make kernel-menuconfig，进入 kernel 的功能配置，按如下选择：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Device Drivers  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DMABUF options ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] Explicit Synchronization Framework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*]   Sync File Validation Framework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] userspace dmabuf misc driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [ ] Move notify between drivers (EXPERIMENTAL)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt; &gt; Selftests for the dma-buf interfaces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] DMA-BUF Userland Memory Heaps  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [ ]   DMA-BUF System Heap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [*]   DMA-BUF CMA Heap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [*]   DMA-BUF MPP Heap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>MPP Heap 在 CMA 内存中申请一大块物理连续内存，使用 genpool 算法 进行管理，提供给 MPP 中间件专用，其大小配置：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Library routines  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*] DMA Contiguous Memory Allocator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [ ]   Enable separate DMA Contiguous Memory Area for each NUMA Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        *** Default contiguous memory area size: ***</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (16)  Size in Mega Bytes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        (8)   Size in Mega Bytes for MPP Heap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在上述例子中，系统预留了 16M CMA 内存，MPP Heap 再从 16M CMA 内存中申请 8M。</p>
<p>因为 MPP Heap 的内存 是从 CMA 中申请的，前者是后者的子集，所以 MPP Heap 的 size 要小于 CMA 的 size。</p>
<p>注解</p>
<p>为了兼顾系统中其他需要物理连续内存的模块，不能将 CMA 内存全部分配给 MPP Heap，分配数值设置可参考 <a href="/docs/Luban-SDK/part2/5_design_guide.html#ref-mpp-heap-size">mpp heap 设置</a>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="212-ve-驱动">2.1.2. VE 驱动<a href="#212-ve-驱动" class="hash-link" aria-label="2.1.2. VE 驱动的直接链接" title="2.1.2. VE 驱动的直接链接">​</a></h3>
<p>VE 模块驱动配置请参考 VE 使用指南 <a href="/docs/Luban-SDK/ve/2_config_guide.html#ref-ve-config">内核配置</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="22-dts-参数配置">2.2. DTS 参数配置<a href="#22-dts-参数配置" class="hash-link" aria-label="2.2. DTS 参数配置的直接链接" title="2.2. DTS 参数配置的直接链接">​</a></h2>
<p>VE 模块 DTS 配置请参考 VE 使用指南 <a href="/docs/Luban-SDK/ve/2_config_guide.html#ref-ve-config">内核配置</a></p>
<h1>3. 调试指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="31-调试开关">3.1. 调试开关<a href="#31-调试开关" class="hash-link" aria-label="3.1. 调试开关的直接链接" title="3.1. 调试开关的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="311-mpp调试">3.1.1. MPP调试<a href="#311-mpp调试" class="hash-link" aria-label="3.1.1. MPP调试的直接链接" title="3.1.1. MPP调试的直接链接">​</a></h3>
<p>MPP调试log等级分为ERROR, WARNING, INFO, DEBUG, VERBOSE。通过LOGL_DEFAULT定义MPP全局的log等级。 默认log等级为INFO。</p>
<p>源文件路径：aic-mpp/base/log.h</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum log_level {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_ERROR = 0,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_WARNING,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_INFO,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_DEBUG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_VERBOSE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_COUNT,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_DEFAULT = LOGL_INFO,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LOGL_FORCE_DEBUG = 0x10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="312-子模块调试">3.1.2. 子模块调试<a href="#312-子模块调试" class="hash-link" aria-label="3.1.2. 子模块调试的直接链接" title="3.1.2. 子模块调试的直接链接">​</a></h3>
<p>打开子模块调试log方式，在子模块中添加：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define LOG_DEBUG</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="313-mpp-heap-调试">3.1.3. MPP Heap 调试<a href="#313-mpp-heap-调试" class="hash-link" aria-label="3.1.3. MPP Heap 调试的直接链接" title="3.1.3. MPP Heap 调试的直接链接">​</a></h3>
<p>打开 MPP Heap 调试开关，可查看 MPP 中间件对预留内存的使用情况。</p>
<p>在 luban 根目录下执行 make kernel-menuconfig，进入 kernel 的功能配置，按如下选择：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Memory Management options  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*]   MPP debugfs interface</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>系统启动后挂载 debugfs</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mount -t debugfs none /sys/kernel/debug/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过查 看 mpp 目录下的节点，即可获取 mpp heap 的内存使用情况</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cd /sys/kernel/dedbug/mpp/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bitmap    count     maxchunk  used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2048</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat maxchunk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1448</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat bitmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 16777215 0 0 0 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>count : MPP Heap 中包含的 page 总数</li>
<li>used : MPP Heap 中已被申请的 page 总数</li>
<li>maxchunk : MPP Heap 中还能申请到最大的连续 page 总数</li>
<li>bitmap : MPP Heap 中记录 page 状态的 bitmap</li>
</ul>
<p>一个 page 大小为 4K ， bitmap 节点打印输出十进制数据。</p>
<p>4294967295 转换为十六进制为 <code>0xFFFFFFFF</code> ， 二进制为 <code>0b11111111111111111111111111111111</code> 。 一个 bit 表示一个 page 的状态，1 表示已被申请，0 表示空闲。4294967295 表示 32 个 page 全部被占用，总共 32 * 4K 大小。</p>
<p>小技巧</p>
<p>实际调试时要注意大小端问题。</p>
<h1>4. 测试指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="41-运行测试用例">4.1. 运行测试用例<a href="#41-运行测试用例" class="hash-link" aria-label="4.1. 运行测试用例的直接链接" title="4.1. 运行测试用例的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="411-mpp_test">4.1.1. mpp_test<a href="#411-mpp_test" class="hash-link" aria-label="4.1.1. mpp_test的直接链接" title="4.1.1. mpp_test的直接链接">​</a></h3>
<p>mpp_test 的主要功能是测试 mpp_decoder 接口，解码视频或图片文件并通过 display 接口显示在屏幕上。</p>
<p>目前支持 h264, jpg，png 的解码和显示，使用方式如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # mpp_test -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage: mpp_test [options]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -i                             input stream file name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -t                             directory of test files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -d                             display the picture</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -c                             enable compare output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -f                             output pixel format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -l                             loop time</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -s                             save output data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    -h                             help</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example1(test single file): mpp_test -i test.264</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example2(test some files) : mpp_test -t /usr/data/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="412-pic_test">4.1.2. pic_test<a href="#412-pic_test" class="hash-link" aria-label="4.1.2. pic_test的直接链接" title="4.1.2. pic_test的直接链接">​</a></h3>
<p>pic_test 的主要功能是测试 JPEG/PNG 图片解码和显示，相比于 mpp_test 代码更加精简。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # pic_test -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage: dec_test [options]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-i                             input stream file name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-h                             help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h1>5. 设计说明</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="51-源码说明">5.1. 源码说明<a href="#51-源码说明" class="hash-link" aria-label="5.1. 源码说明的直接链接" title="5.1. 源码说明的直接链接">​</a></h2>
<p>在 luban 的根目录下通过 make menuconfig 打开 aic-mpp，并进行编译。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Artinchip packages  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*] aic-mpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>源文件目录：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aic-mpp$ tree</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── base             // 公共模块：包括内存分配和链表等基础功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ge              // 2D 图形加速模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── ve              // 编解码器模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├── include     // ve 模块头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── common      // 编解码器公共组件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|   ├── decoder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        ├── h264   // h.264 解码模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        ├── jpeg   // jpg 解码模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│        └── png    // png 解码模块</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── include         // mpp 对外头文件</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── mpp_test        // mpp 测试用例</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="52-模块架构">5.2. 模块架构<a href="#52-模块架构" class="hash-link" aria-label="5.2. 模块架构的直接链接" title="5.2. 模块架构的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="521-mpp-软件框架">5.2.1. MPP 软件框架<a href="#521-mpp-软件框架" class="hash-link" aria-label="5.2.1. MPP 软件框架的直接链接" title="5.2.1. MPP 软件框架的直接链接">​</a></h3>
<p>mpp 软件框图如下所示：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_framework1-17066995071203.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_framework1.png" class="img_ev3q"></p>
<p>图 6.44 <em>mpp 软件框架</em><a href="#id12">¶</a></p>
<p>分为三个部分：</p>
<blockquote>
<ul>
<li>mpp_decoder，实现h264、jpeg、png等解码功能</li>
<li>mpp_encoder，实现jpeg编码（功能还未完成）。</li>
<li>mpp_ge，实现2D图形加速功能</li>
</ul>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="53-mpp_decoder-设计以及接口说明">5.3. mpp_decoder 设计以及接口说明<a href="#53-mpp_decoder-设计以及接口说明" class="hash-link" aria-label="5.3. mpp_decoder 设计以及接口说明的直接链接" title="5.3. mpp_decoder 设计以及接口说明的直接链接">​</a></h2>
<p>mpp_decoder 由三个主要模块组成：</p>
<ul>
<li>解码模块（H264、JPEG、PNG等）：负责将码流数据解码成视频图像</li>
<li>输入码流数据管理模块（Packet manager）：负责视频、图片码流数据和 buffer 的管理</li>
<li>显示帧管理模块（Frame manager）：负责解码图像 buffer 的管理</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="531-packet-管理机制">5.3.1. packet 管理机制<a href="#531-packet-管理机制" class="hash-link" aria-label="5.3.1. packet 管理机制的直接链接" title="5.3.1. packet 管理机制的直接链接">​</a></h3>
<p>Packet manager 负责管理码流数据和 buffer。初始化时，该模块申请一块物理连续的内存（buffer大小可由外部配置），用于存放视频/图片码流数据。</p>
<p>Packet manager 管理的数据单元为 packet，packet 表示一笔码流数据，它可以是完整的一帧数据，也支持不是完整的一帧数据。 每个 packet 与物理内存中的码流数据一一对应，它记录了每一笔码流的物理内存基地址、物理内存结束地址、物理内存偏移、虚拟内存地址、码流数据长度等信息。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/packet_manager1-17066995321425.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/packet_manager1.png" class="img_ev3q"></p>
<p>图 6.45 <em>packet管理</em></p>
<p>packet 通过 empty list 和 ready list 两个链表进行管理。 其中，empty list 用于存放空闲的 packet，ready list 用于存放待解码的 packet。</p>
<p>送码流数据时，从 empty list 获取一个空闲 packet，填充数据后，再把 packet 放入 ready list；</p>
<p>解码前，解码器从 ready list 获取一个填充数据的 packet，使用完后再把该 packet 放入 empty list。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/pm_flow1-17066995412247.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/pm_flow1.png" class="img_ev3q"></p>
<p>图 6.46 <em>packet manager 调用流程</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="532-frame-管理机制">5.3.2. frame 管理机制<a href="#532-frame-管理机制" class="hash-link" aria-label="5.3.2. frame 管理机制的直接链接" title="5.3.2. frame 管理机制的直接链接">​</a></h3>
<p>Frame manager 负责管理图像 buffer。Frame manager 内部通过两个链表来管理图像 buffer：empty list 和 render list。 其中，empty list 存放可以给解码输出使用的图像 buffer，render list 存放解码完成但还未显示的图像 buffer。 在运行过程中，正在显示的图像 buffer 和用于参考的图像 buffer 可能不在这两个 list 中。</p>
<ol>
<li>frame 状态迁移</li>
</ol>
<p>初始化时，该模块申请指定个数的图像 buffer（个数可由外部配置），每个图像 buffer 的信息存放在内部数组中。 每个图像 buffer 有4种状态：</p>
<ul>
<li>Decoding: 该帧正在被解码器使用（用于解码输出或作为参考帧）</li>
<li>wait_render: 该帧在 render list 中，等待显示</li>
<li>Rendering: 该帧正在被显示占用</li>
<li>IDLE: 该帧处于空闲状态（既没有被显示占用，也没有被解码器用作参考帧）</li>
</ul>
<p>其状态转移如下图所示：</p>
<ul>
<li>初始化时，所有图像 buffer 都在 empty list 中，此时处于 IDLE 状态；</li>
<li>解码模块从 empty list 链表头部获取一个空图像 buffer，此时 buffer 被解码模块占用，从 IDLE 状态变为 Decoding 状态;</li>
<li>解码完成后，解码模块还图像数据。此时分两种情况：<!-- -->
<ul>
<li>1）如果当前帧还未被显示，该帧加入 render list 链表尾部，从 Decoding 状态变为 wait render 状态；</li>
<li>2）该帧不再用做参考帧且已显示完成，此时该帧加入 empty list 链表尾部，由 Decoding 状态进  入 IDLE 状态；</li>
</ul>
</li>
<li>显示模块从 render list 链表头部取一帧图像，此时当前帧由 wait render 状态进入 Rendering 状态；</li>
<li>显示模块还图像 buffer，分两种情况：<!-- -->
<ul>
<li>1）如果当前帧不用于参考，此时由 Rendering 状态回到IDLE状态，该帧加入 empty list 链表尾部；</li>
<li>2）如果当前帧用于参考，此时由 Rendering 状态进入Decoding状态，该图像 buffer 不进入任何队列，等待解码器还参考帧；</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/frame_status1-17066995677329.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/frame_status1.png" class="img_ev3q"></p>
<p>图 6.47 <em>frame状态迁移</em></p>
<ol>
<li>frame manager 调用流程</li>
</ol>
<p>对于 JPEG、PNG 这类没有参考帧概念的编码格式，每一帧的状态是唯一的，解码后的数据帧可直接送 render list</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_jpeg1-170669957657011.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_jpeg1.png" class="img_ev3q"></p>
<p>图 6.48 <em>frame manager 调用流程（JPEG/PNG）</em>)</p>
<p>但对于 H264 这类有参考帧的编码格式，解码后的视频帧可能既被显示占用也会被解码器用作参考帧，并且由于双向参考帧的存在， 视频帧需要重排序后才能送显示。 不同于JPG，H264 解码库内部存在一个 delay list 用于为显示帧重排序。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_2641-170669959339213.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/frame_manager_2641.png" class="img_ev3q"></p>
<p>图 6.49 <em>frame manager 调用流程（H264）</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="533-物理连续内存使用情况">5.3.3. 物理连续内存使用 情况<a href="#533-物理连续内存使用情况" class="hash-link" aria-label="5.3.3. 物理连续内存使用情况的直接链接" title="5.3.3. 物理连续内存使用情况的直接链接">​</a></h3>
<p>H264 解码所需的物理连续内存如下所示：</p>
<table><thead><tr><th>内存占用模块</th><th>计算方式</th><th>说明</th></tr></thead><tbody><tr><td>输入码流</td><td></td><td>大小由应用层配置</td></tr><tr><td>输出帧</td><td>width<em>height</em>3/2*frame_num</td><td>frame_num至少需要（参考帧个数+1）个显示占用个数可由应用层通过struct decode_config结构体中的extra_frame_num 配置</td></tr><tr><td>帧内预测(需要上一行数据)</td><td>帧格式：width<em>2MBAFF：width</em>4</td><td></td></tr><tr><td>宏块信息</td><td>固定12K</td><td></td></tr><tr><td>dblk模块(上一个宏块行最后4行数据)</td><td>帧格式：width<em>8MBAFF：width</em>16</td><td></td></tr><tr><td>co-located信息</td><td>固定68K</td><td></td></tr><tr><td>每一帧co-located数据缓存</td><td>(width/16)*(height/16)<em>32</em>frame_num</td><td></td></tr></tbody></table>
<p>注解</p>
<p>co-located 两个buffer，I、P帧解码时会往buffer里写数据，B 帧解码时从buffer读数据。 如果当前码流中没有 B 帧，这两块内存也需要申请。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="534-mpp_decoder-调用流程">5.3.4. mpp_decoder 调用流程<a href="#534-mpp_decoder-调用流程" class="hash-link" aria-label="5.3.4. mpp_decoder 调用流程的直接链接" title="5.3.4. mpp_decoder 调用流程的直接链接">​</a></h3>
<p>在调用 mpp_decoder 的解码函数时，解码模块从 Packet manager 取一笔码流，同时从 Frame maneger 取一个空闲图像 buffer，对码流进行解码 并输出图像到图像 buffer。</p>
<p>解码后，解码模块将码流 buffer 归还 Packet manager，将解码图像 buffer 归还 Frame maneger。</p>
<p>为保证解码效率，建议调用者创建3个线程实现解码功能  ：</p>
<ul>
<li>
<ul>
<li>
<p>send data thread</p>
<p>通过 mpp_decoder_get_packet 和 mpp_decoder_put_packet 这两个接口把码流数据送到 packet 管理模块</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>decode thread</p>
<p>通过调用 mpp_decoder_decode 控制解码，解码库从 packet 管理模块取一笔码流数据，解码完成后，将视频帧送入 frame 管理模块</p>
</li>
</ul>
</li>
<li>
<ul>
<li>
<p>render thread</p>
<p>通过 mpp_decoder_get_frame 和 mpp_decoder_put_frame 两个接口从 frame 管理模块获取视频帧，并控制该帧显示时机</p>
</li>
</ul>
</li>
</ul>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_decoder_flow1-170669962555915.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_decoder_flow1.png" class="img_ev3q"></p>
<p>图 6.50 <em>mpp_decoder 调用流程</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="535-mpp_decoder-数据结构">5.3.5. mpp_decoder 数据结构<a href="#535-mpp_decoder-数据结构" class="hash-link" aria-label="5.3.5. mpp_decoder 数据结构的直接链接" title="5.3.5. mpp_decoder 数据结构的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5351-struct-decode_config">5.3.5.1. struct decode_config<a href="#5351-struct-decode_config" class="hash-link" aria-label="5.3.5.1. struct decode_config的直接链接" title="5.3.5.1. struct decode_config的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct decode_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enum mpp_pixel_format pix_fmt;  // output pixel format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int bitstream_buffer_size;      // bitstream buffer size in pm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int packet_count;               // packet number in pm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int extra_frame_num;            // extra frame number in fm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>decode_config 结构体用于配置解码器初始化使用的参数。</p>
<ul>
<li>pix_fmt 表示解码输出的颜色格式</li>
<li>bitstream_buffer_size 表示存放输入码流缓存的总长度</li>
<li>packet_count 表示 packet manager 中 packet 的最大个数</li>
<li>extra_frame_num 表示解码器额外分配的帧个数，主要用于缓存显示帧以保证显示平滑。</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5352-struct-mpp_packet">5.3.5.2. struct mpp_packet<a href="#5352-struct-mpp_packet" class="hash-link" aria-label="5.3.5.2. struct mpp_packet的直接链接" title="5.3.5.2. struct mpp_packet的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_packet {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *data;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long long pts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>mpp_packet 结构体用于表示输入码流信息。</p>
<ul>
<li>data 表示码流数据存放的起始地址</li>
<li>size 表示该笔码流数据长度</li>
<li>pts 表示该笔码流的时间戳</li>
<li>flag 表示该笔码流的标记位，目前仅用于确定该码流是否为最后一笔码流（PACKET_FLAG_EOS）</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5353-struct-mpp_frame">5.3.5.3. struct mpp_frame<a href="#5353-struct-mpp_frame" class="hash-link" aria-label="5.3.5.3. struct mpp_frame的直接链接" title="5.3.5.3. struct mpp_frame的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_size {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int width;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_rect {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int width;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum mpp_buf_type {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_DMA_BUF_FD,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_PHY_ADDR,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_buf {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enum mpp_buf_type       buf_type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    union {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            int             fd[3];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            unsigned int    phy_addr[3];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            stride[3];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct mpp_size         size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            crop_en;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct mpp_rect         crop;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enum mpp_pixel_format   format;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            flags;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>buf_type：表示 mpp_buf 类型，以 fd 方式 MPP_DMA_BUF_FD 或 以物理地址方式 MPP_PHY_ADDR；</li>
<li>fd[3] ：表示 buffer 三个分量的 fd</li>
<li>phy_addr[3]：表示 buffer 三个分量的物理地址</li>
<li>stride[3]：表示 buffer 三个分量的 stride</li>
<li>size：表示 buffer 的宽、高</li>
<li>crop_en： 表示该 buffer 是否需要 crop</li>
<li>crop：表示该 buffer 的 crop 信息</li>
<li>format： 表示该 buffer 的颜色格式类型</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_frame {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct mpp_buf          buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    long long               pts;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            flags;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>buf：表示 mpp_frame 的 buffer 信息</li>
<li>pts：表示 mpp_frame 的时间戳</li>
<li>id：表示 mpp_frame 的唯一标识</li>
<li>flags：表示 mpp_frame 的标志位</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5354-enum-mpp_dec_errno">5.3.5.4. enum mpp_dec_errno<a href="#5354-enum-mpp_dec_errno" class="hash-link" aria-label="5.3.5.4. enum mpp_dec_errno的直接链接" title="5.3.5.4. enum mpp_dec_errno的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum mpp_dec_errno {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_NOT_SUPPORT         = 0x90000001,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_NO_EMPTY_PACKET     = 0x90000002, // no packet in empty list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_NO_READY_PACKET     = 0x90000003, //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_NO_EMPTY_FRAME      = 0x90000004, //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_NO_RENDER_FRAME     = 0x90000005, //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_NULL_PTR            = 0x90000006,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DEC_ERR_FM_NOT_CREATE       = 0x90000006,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="  复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>DEC_ERR_NOT_SUPPORT：该码流不支持</li>
<li>DEC_ERR_NO_EMPTY_PACKET：packet manager 中缺少空闲的 packet，可能是解码速度小于送 packet 速度，此时需要等待一段时间；</li>
<li>DEC_ERR_NO_READY_PACKET：packet manager 中缺少填好码流数据的 packet，可能是送 packet 速度小于解码速度，此时需要等待一段时间；</li>
<li>DEC_ERR_NO_EMPTY_FRAME：frame manager 中缺少空闲的 frame，表示所有帧都处于使用状态，通常是解码速度大于显示速度导致，此时需要等待一段时间；</li>
<li>DEC_ERR_NO_RENDER_FRAME：frame manager 中缺少待显示的 frame，表示所有帧都处于空闲状态，通常是解码速度小于显示速度导致，此时需要等待一段时间；</li>
<li>DEC_ERR_NULL_PTR：表示接口函数输入参数存在空指针</li>
<li>DEC_ERR_FM_NOT_CREATE：表示在获取待显示 frame 时 frame manager 还未创建</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5355-enum-mpp_codec_type">5.3.5.5. enum mpp_codec_type<a href="#5355-enum-mpp_codec_type" class="hash-link" aria-label="5.3.5.5. enum mpp_codec_type的直接链接" title="5.3.5.5. enum mpp_codec_type的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum mpp_codec_type {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_CODEC_VIDEO_DECODER_H264 = 0x1000,         // decoder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_CODEC_VIDEO_DECODER_MJPEG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_CODEC_VIDEO_DECODER_PNG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_CODEC_VIDEO_ENCODER_H264 = 0x2000,         // encoder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>mpp_codec_type 枚举类型表示支持的编解码格式。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5356-enum-mpp_dec_cmd">5.3.5.6. enum mpp_dec_cmd<a href="#5356-enum-mpp_dec_cmd" class="hash-link" aria-label="5.3.5.6. enum mpp_dec_cmd的直接链接" title="5.3.5.6. enum mpp_dec_cmd的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum mpp_dec_cmd {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_DEC_INIT_CMD_SET_EXT_FRAME_ALLOCATOR,            // frame buffer allocator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_DEC_INIT_CMD_SET_ROT_FLIP_FLAG,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_DEC_INIT_CMD_SET_SCALE,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_DEC_INIT_CMD_SET_CROP_INFO,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MPP_DEC_INIT_CMD_SET_OUTPUT_POS,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>MPP_DEC_INIT_CMD_SET_EXT_FRAME_ALLOCATOR：表示由外部设置帧 buffer 分配器</li>
<li>MPP_DEC_INIT_CMD_SET_ROT_FLIP_FLAG: 表示设置旋转、镜像后处理，只用于JPEG</li>
<li>MPP_DEC_INIT_CMD_SET_SCALE： 表示设置缩放系数，只用于JPEG</li>
<li>MPP_DEC_INIT_CMD_SET_CROP_INFO：表示设置输出 crop 信息</li>
<li>MPP_DEC_INIT_CMD_SET_OUTPUT_POS：表示设置解码图像在输出缓存的位置</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="536-mpp_decoder-接口设计">5.3.6. mpp_decoder 接口设计<a href="#536-mpp_decoder-接口设计" class="hash-link" aria-label="5.3.6. mpp_decoder 接口设计的直接链接" title="5.3.6. mpp_decoder 接口设计的直接链接">​</a></h3>
<p>接口如下 :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct decode_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enum mpp_pixel_format pix_fmt;  // output pixel format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int bitstream_buffer_size;      // bitstream buffer size in pm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int packet_count;               // packet number in pm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int extra_frame_num;            // extra frame number in fm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_decoder* create_mpp_decoder(enum mpp_codec_type type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void destory_mpp_decoder(struct mpp_decoder* decoder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_init(struct mpp_decoder *decoder, struct decode_config *config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_decode(struct mpp_decoder* decoder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_control(struct mpp_decoder* decoder, int cmd, void *param);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_reset(struct mpp_decoder* decoder);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_get_packet(struct mpp_decoder* decoder, struct mpp_packet* packet, int size);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_put_packet(struct mpp_decoder* decoder, struct mpp_packet* packet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_get_frame(struct mpp_decoder* decoder, struct mpp_frame* frame);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int mpp_decoder_put_frame(struct mpp_decoder* decoder, struct mpp_frame* frame);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5361-mpp_decoder_create">5.3.6.1. mpp_decoder_create<a href="#5361-mpp_decoder_create" class="hash-link" aria-label="5.3.6.1. mpp_decoder_create的直接链接" title="5.3.6.1. mpp_decoder_create的直接链接">​</a></h4>
<table><thead><tr><th>函数原型</th><th>struct mpp_decoder* mpp_decoder_create(enum mpp_codec_type type)</th></tr></thead><tbody><tr><td>功能说明</td><td>创建mpp_decoder对象</td></tr><tr><td>参数定义</td><td>type: 解码器类型</td></tr><tr><td>返回值</td><td>mpp_decoder对象</td></tr><tr><td>注意事项</td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5362-mpp_decoder_destory">5.3.6.2. mpp_decoder_destory<a href="#5362-mpp_decoder_destory" class="hash-link" aria-label="5.3.6.2. mpp_decoder_destory的直接链接" title="5.3.6.2. mpp_decoder_destory的直接链接">​</a></h4>
<table><thead><tr><th>函数原型</th><th>void mpp_decoder_destory(struct mpp_decoder* decoder)</th></tr></thead><tbody><tr><td>功能说明</td><td>销毁mpp_decoder对象</td></tr><tr><td>参数定义</td><td>decoder: mpp_decoder对象</td></tr><tr><td>返回值</td><td>无</td></tr><tr><td>注意事项</td><td></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5363-mpp_decoder_init">5.3.6.3. mpp_decoder_init<a href="#5363-mpp_decoder_init" class="hash-link" aria-label="5.3.6.3. mpp_decoder_init的直接链接" title="5.3.6.3. mpp_decoder_init的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_init(struct mpp_decoder *decoder, struct decode_config *config) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 初始化解码器                                                 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象config：解码器的配置参数             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5364-mpp_decoder_decode">5.3.6.4. mpp_decoder_decode<a href="#5364-mpp_decoder_decode" class="hash-link" aria-label="5.3.6.4. mpp_decoder_decode的直接链接" title="5.3.6.4. mpp_decoder_decode的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_decode(struct mpp_decoder* decoder) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | --------------------------------------------------- |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 解码一笔数据                                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象                            |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                     |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="53-mpp_decoder_control">5.3. mpp_decoder_control<a href="#53-mpp_decoder_control" class="hash-link" aria-label="5.3. mpp_decoder_control的直接链接" title="5.3. mpp_decoder_control的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_control(struct mpp_decoder* decoder, int cmd, void* param) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 向mpp_decoder对象发送控制命令                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象cmd: 控制命令类型param: 控制参数     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5366-mpp_decoder_reset">5.3.6.6. mpp_decoder_reset<a href="#5366-mpp_decoder_reset" class="hash-link" aria-label="5.3.6.6. mpp_decoder_reset的直接链接" title="5.3.6.6. mpp_decoder_reset的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_reset(struct mpp_decoder* decoder) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | -------------------------------------------------- |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 重置mpp_decoder对象                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                    |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5367-mpp_decoder_get_packet">5.3.6.7. mpp_decoder_get_packet<a href="#5367-mpp_decoder_get_packet" class="hash-link" aria-label="5.3.6.7. mpp_decoder_get_packet的直接链接" title="5.3.6.7. mpp_decoder_get_packet的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_get_packet(struct mpp_decoder* decoder, struct mpp_packet* packet, int size) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 获取一个写码流数据的packet                                   |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象packet:码流数据结构指针size:上层应用申请packet的buffer大小 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5368-mpp_decoder_put_packet">5.3.6.8. mpp_decoder_put_packet<a href="#5368-mpp_decoder_put_packet" class="hash-link" aria-label="5.3.6.8. mpp_decoder_put_packet的直接链接" title="5.3.6.8. mpp_decoder_put_packet的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_put_packet(struct mpp_decoder* decoder, struct mpp_packet* packet) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 归还码流数据的packet对象                                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象packet:码流数据结构指针              |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5369-mpp_decoder_get_frame">5.3.6.9. mpp_decoder_get_frame<a href="#5369-mpp_decoder_get_frame" class="hash-link" aria-label="5.3.6.9. mpp_decoder_get_frame的直接链接" title="5.3.6.9. mpp_decoder_get_frame的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_get_frame(struct mpp_decoder* decoder, struct mpp_frame* frame) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 获取一个视频帧对象                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象frame:视频帧数据结构指针             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="53610-mpp_decoder_put_frame">5.3.6.10. mpp_decoder_put_frame<a href="#53610-mpp_decoder_put_frame" class="hash-link" aria-label="5.3.6.10. mpp_decoder_put_frame的直接链接" title="5.3.6.10. mpp_decoder_put_frame的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_decoder_put_frame(struct mpp_decoder* decoder, struct mpp_frame* frame) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 归还视频帧对象                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | decoder: mpp_decoder对象frame:视频帧数据结构指针             |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0:成功&lt;0:失败                                                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="537-mpp_decoder-参考demo">5.3.7. mpp_decoder 参考demo<a href="#537-mpp_decoder-参考demo" class="hash-link" aria-label="5.3.7. mpp_decoder 参考demo的直接链接" title="5.3.7. mpp_decoder 参考demo的直接链接">​</a></h3>
<p>以下 demo 为基本流程调用，具体实现可以参考代码 mpp/mpp_test/picture_decoder_test.c</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//* 1.创建 mpp_decoder 对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_decoder* dec = mpp_decoder_create(type);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct decode_config config;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.bitstream_buffer_size = (file_len + 1023) &amp; (~1023);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.extra_frame_num = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.packet_count = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">config.pix_fmt = MPP_FMT_ARGB_8888;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 2. 初始化 mpp_decoder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_init(dec, &amp;config);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 3. 获取一个空的packet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_packet packet;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">memset(&amp;packet, 0, sizeof(struct mpp_packet));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_get_packet(dec, &amp;packet, file_len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 4. 把视频码流数据拷贝到 packet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fread(packet.data, 1, file_len, fp);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packet.size = file_len;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">packet.flag = PACKET_FLAG_EOS;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 5. 归还 packet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_put_packet(dec, &amp;packet);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 6. 解码该笔码流数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_decode(dec);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 7. 获取解码后视频帧数据</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_frame frame;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">memset(&amp;frame, 0, sizeof(struct mpp_frame));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_get_frame(dec, &amp;frame);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 8. 显示该视频帧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// render_frame...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 9. 归还该视频帧</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_put_frame(dec, &amp;frame);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 10. 销毁 mpp_decoder</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_decoder_destory(dec);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="54-mpp_encoder-设计及接口说明">5.4. mpp_encoder 设计及接口说明<a href="#54-mpp_encoder-设计及接口说明" class="hash-link" aria-label="5.4. mpp_encoder 设计及接口说明的直接链接" title="5.4. mpp_encoder 设计及接口说明的直接链接">​</a></h2>
<p>mpp_encoder 目前只支持 JPEG 图片编码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="541-接口设计">5.4.1. 接口设计<a href="#541-接口设计" class="hash-link" aria-label="5.4.1. 接口设计的直接链接" title="5.4.1. 接口设计的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="5411-mpp_encode_jpeg">5.4.1.1. mpp_encode_jpeg<a href="#5411-mpp_encode_jpeg" class="hash-link" aria-label="5.4.1.1. mpp_encode_jpeg的直接链接" title="5.4.1.1. mpp_encode_jpeg的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int mpp_encode_jpeg(struct mpp_frame* frame, int quality, int dma_buf_fd, int buf_len, int* len) |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------------------------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 编码一帧 JPEG 图片                                           |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | frame: 待编码的原始 YUV 数据quality: 编码质量，取值范围1~100，1表示编码图片质量最差，100表示最好dma_buf_fd：输出 JPEG 图片存放的 dma-buf fdbuf_len：输出 JPEG 图片 dma-buf 的长度len: 输出 JPEG 图片的真实大小 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | 0: 成功&lt;0:失败                                               |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                                              |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>小技巧</p>
<p>输出 JPEG 图片的缓存 buffer 由调用者申请，但调用者并不知道编码后图片的实际大小， 为避免 VE 写输出数据时越界，该 buffer 需要预先申请较大的内存。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="542-mpp_encoder-参考demo">5.4.2. mpp_encoder 参考demo<a href="#542-mpp_encoder-参考demo" class="hash-link" aria-label="5.4.2. mpp_encoder 参考demo的直接链接" title="5.4.2. mpp_encoder 参考demo的直接链接">​</a></h3>
<p>以下 demo 为基本流程调用，具体实现可以参考代码 mpp/mpp_test/jpeg_encoder_test.c</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">//* 1. 获取 dma-buf device 句柄</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int dma_fd = dmabuf_device_open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 2. 设置输入 YUV 数据结构体</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct mpp_frame frame;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// ....</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 3. 申请编码输出 buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int len = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int buf_len = width * height * 4/5 * quality / 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int jpeg_data_fd = dmabuf_alloc(dma_fd, buf_len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 4. 编码 JPEG 图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mpp_encode_jpeg(&amp;frame, quality, jpeg_data_fd, buf_len, &amp;len)；</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 5. 保存编码后 JPEG 图片</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">unsigned char* jpeg_vir_addr = dmabuf_mmap(jpeg_data_fd, buf_len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FILE* fp_save = fopen(&quot;/save.jpg&quot;, &quot;wb&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fwrite(jpeg_vir_addr, 1, len, fp_save);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fclose(fp_save);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">//* 6. 释放资源</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dmabuf_munmap(jpeg_vir_addr, buf_len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dmabuf_free(jpeg_data_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dmabuf_device_close(dma_fd);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="55-mpp_ge-接口说明">5.5. mpp_ge 接口说明<a href="#55-mpp_ge-接口说明" class="hash-link" aria-label="5.5. mpp_ge 接口说明的直接链接" title="5.5. mpp_ge 接口说明的直接链接">​</a></h2>
<p>mpp_ge 接口说明请参考 <a href="/docs/Luban-SDK/ge/5_design_guide.html#ref-luban-mpp-ge">MPP对GE接口的封装</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="56-mpp-heap-设计及说明">5.6. mpp heap 设计及说明<a href="#56-mpp-heap-设计及说明" class="hash-link" aria-label="5.6. mpp heap 设计及说明的直接链接" title="5.6. mpp heap 设计及说明的直接链接">​</a></h2>
<p>Mpp Heap 负责管理 mpp 中间件独占的 CMA 内存，并在 mpp 中间件需要物理内存时，将内存页面导出为 DMA-BUF。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="561-mpp-heap-特点">5.6.1. mpp heap 特点<a href="#561-mpp-heap-特点" class="hash-link" aria-label="5.6.1. mpp heap 特点的直接链接" title="5.6.1. mpp heap 特点的直接链接">​</a></h3>
<p><strong>解决内存碎片化</strong></p>
<p>CMA 内存允许多媒体模块和系统复用，在这种情况下，内存碎片化的情况不可避免（部分内存页面可能会被系统 pin 住，无法迁移）。而 mpp heap 管理的内存能确保只被 mpp 中间件使用，避免了内存页面被 pin 住而导致碎片化的问题。</p>
<ul>
<li>mpp heap 的内存需要在用户态通过 <code>/dev/dmabuf/mpp</code> 节点来申请，这个节点是 ArtInChip 平台扩展的私有节点，只有 mpp 中间件会访问。</li>
<li>对于系统来说，该块内存已被 alloc，系统不会再去访问，因此能达到 mpp 中间件独占的效果。</li>
</ul>
<p>小技巧</p>
<p>只要在调用 mpp 中间件的过程中，只要做到资源的申请与释放一一对应，就能解决内存碎片化问题。</p>
<p><strong>允许系统回收 mpp heap 内存</strong></p>
<p>mpp heap 管理的内存通过 <code>cma_alloc</code> 申请，在系统内存资源紧张，而又不需要 mpp 中间件的情况下 （例如 OTA 升级），允许通过销毁 mpp heap 释放 CMA 内存给系统使用。</p>
<p>注解</p>
<p>mpp heap 一旦销毁，无法再次初始化，只能 reboot 系统。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="562-mpp-heap-init">5.6.2. mpp heap init<a href="#562-mpp-heap-init" class="hash-link" aria-label="5.6.2. mpp heap init的直接链接" title="5.6.2. mpp heap init的直接链接">​</a></h3>
<p>初始化时，MPP Heap 从 CMA 内存中申请一大块物理连续内存，并创建一个 genpool 内存池进行管理。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_init-170669984075717.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_init.png" class="img_ev3q"></p>
<p>图 6.51 <em>mpp_heap 初始化</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="563-mpp-heap-export">5.6.3. mpp heap export<a href="#mpp-heap-export">¶</a><a href="#563-mpp-heap-export" class="hash-link" aria-label="563-mpp-heap-export的直接链接" title="563-mpp-heap-export的直接链接">​</a></h3>
<p>mpp heap 通过 <code>/dev/dmabuf/mpp</code> 节点，以 <code>ioctl</code> 的方式将管理的 CMA 内存导出为标准的 DMA-BUF 文件句柄。</p>
<p>genpool 内存池是一个基于 bitmap 的管理算法，其最小分配单位为 4K，分配的内存无论 <strong>首地址</strong> 还是 <strong>大小</strong> ，都遵循 <code>4K</code> 对齐。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_export-170669984741119.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_export.png" class="img_ev3q"></p>
<p>图 6.52 <em>mpp_heap 导出 DMA-BUF</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="564-mpp-heap-close">5.6.4. mpp heap close<a href="#mpp-heap-close">¶</a><a href="#564-mpp-heap-close" class="hash-link" aria-label="564-mpp-heap-close的直接链接" title="564-mpp-heap-close的直接链接">​</a></h3>
<p>只需要 <code>close</code> DMA-BUF 的文件句柄，即触发 mpp heap 的回收 DMA-BUF。</p>
<p>注解</p>
<p>当一块 DMA-BUF 还被多媒体模块占用时，close 操作无法触发 mpp heap 回收</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_close-170669986798021.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_close.png" class="img_ev3q"></p>
<p>图 6.53 <em>mpp_heap 回收 DMA-BUF</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="5-mpp-heap-destroy">5. mpp heap destroy<a href="#5-mpp-heap-destroy" class="hash-link" aria-label="5. mpp heap destroy的直接链接" title="5. mpp heap destroy的直接链接">​</a></h3>
<p>通过 <code>/dev/dmabuf/mpp</code> 节点，下发扩展的 <code>ioctl</code> 接口即可销毁 MPP Heap, 将其中的 CMA 内存归还改系统。</p>
<p>mpp heap 一旦被销毁，无法再次初始化，只能 reboot。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_destroy-170669988289623.png" alt="../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/mpp_heap_destroy.png" class="img_ev3q"></p>
<p>图 6.54 <em>mpp heap 销毁</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="566-mpp-heap-接口">5.6.6. mpp heap 接口<a href="#566-mpp-heap-接口" class="hash-link" aria-label="5.6.6. mpp heap 接口的直接链接" title="5.6.6. mpp heap 接口的直接链接">​</a></h3>
<p>接口如下 :</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int dmabuf_device_open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void dmabuf_device_close(int dma_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void dmabuf_device_destroy(int dma_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int dmabuf_alloc(int dma_fd, int size);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int dmabuf_device_open() |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | ------------------------ |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 获取 mpp heap 的文件句柄 |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | void                     |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | dma_fd:成功&lt;0:失败       |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                          |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>函数原型</th><th>void dmabuf_device_close(int dma_fd)</th></tr></thead><tbody><tr><td>功能说明</td><td>释放 mpp heap 的文件句柄</td></tr><tr><td>参数定义</td><td>dma_fd: mpp heap 的文件句柄</td></tr><tr><td>返回值</td><td>void</td></tr><tr><td>注意事项</td><td></td></tr></tbody></table>
<table><thead><tr><th>函数原型</th><th>void dmabuf_device_destroy(int dma_fd)</th></tr></thead><tbody><tr><td>功能说明</td><td>销毁 mpp heap</td></tr><tr><td>参数定义</td><td>dma_fd: mpp heap 的文件句柄</td></tr><tr><td>返回值</td><td>void</td></tr><tr><td>注意事项</td><td>mpp heap 一旦被销毁，无法再次初始化，只能 reboot</td></tr></tbody></table>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 函数原型 | int dmabuf_alloc(int dma_fd, int size)        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| -------- | --------------------------------------------- |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 功能说明 | 通过 mpp heap 申请一块 DMA-BUF                |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 参数定义 | dma_fd: mpp heap 的文件句柄size: DMA-BUF size |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 返回值   | DMA-BUF fd:成功&lt;0:失败                        |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| 注意事项 |                                               |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="567-mpp-heap-设置">5.6.7. mpp heap 设置<a href="#567-mpp-heap-设置" class="hash-link" aria-label="5.6.7. mpp heap 设置的直接链接" title="5.6.7. mpp heap 设置的直接链接">​</a></h3>
<p>mpp heap 管理的内存必须满足视频播放的最大需求。</p>
<p>视频播放内存可由 <a href="/_downloads/8db0ff5ddffd480ed46bdfb4ca60868d/video_memory.xlsx"><code>视频播放内存统计表格</code></a> 得到结果。</p>
<p>mpp heap 中的内存从 CMA 预留内存中申请，但 CMA 内存不能只为 mpp heap 预留，还需要为 其他需要物理连续内存的模块预留，主要是显示，音频和通讯模块。</p>
<p>注解</p>
<p>如果 mpp heap 的 size 或 CMA 预留内存的 size 设置不合理，不仅影响 mpp heap 初始化，还可能影响其他模块运行。</p>
<p><strong>显示模块</strong></p>
<p>以 fb0 为 32 位 argb8888 格式，外接分辨率为 1024x600 的 LCD 为例：</p>
<p>单 buffer 场景下需要 1024 * 600 * (32 / 8) = 2457600 byte, 约 <code>2.4M</code> CMA 内存</p>
<p>双 buffer 场景下则需要 <code>4.8M</code></p>
<p><strong>音频模块</strong></p>
<p>启用 ALSL 的场景下需要为音频模块预留 <code>1.5M</code> CMA 内存</p>
<p>在 ALSL 加 I2S 的场景下则需要 <code>2.5M</code> CMA 内存</p>
<p><strong>通讯模块</strong></p>
<p>WIFI, Bluetooth, USB 等通讯模块也会占用部分 CMA 内存，这个要根据实际场景进行推算。</p>
<p>小技巧</p>
<p>CMA 预留内存的大小 &gt;= mpp heap + 其他模块，同时 CMA 预留内存大小遵循 <code>4M</code> 对齐。 为确保系统正常运行，在设置 CMA 预留内存时要保有一定的余量。</p>
<h1>6. 常见问题</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="61-ve驱动未加载">6.1. VE驱动未加载<a href="#61-ve驱动未加载" class="hash-link" aria-label="6.1. VE驱动未加载的直接链接" title="6.1. VE驱动未加载的直接链接">​</a></h2>
<p>请查看VE使用指南 <a href="/docs/Luban-SDK/ve/6_faq.html#ref-ve-insmod">VE驱动未加载</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="62-解码图像花屏">6.2. 解码图像花屏<a href="#62-解码图像花屏" class="hash-link" aria-label="6.2. 解码图像花屏的直接链接" title="6.2. 解码图像花屏的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="621-现象">6.2.1. 现象<a href="#621-现象" class="hash-link" aria-label="6.2.1. 现象的直接链接" title="6.2.1. 现象的直接链接">​</a></h3>
<p>解码后的图像出现花屏现象。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="622-原因分析">6.2.2. 原因分析<a href="#622-原因分析" class="hash-link" aria-label="6.2.2. 原因分析的直接链接" title="6.2.2. 原因分析的直接链接">​</a></h3>
<p>逐步排除以下原因：</p>
<ol>
<li>是否源文件本身有数据错误，可使用 PC 端视频播放软件或图像浏览器查看，是否有花屏现象;</li>
<li>通过保存解码帧数据，在 PC 端查看图像是否有花屏现象，如果 PC 端查看图像正常，则需要排查是否设置图像格式错误，或排查 Display 模块相关原因。</li>
<li>码流解析是否正确，相关 VE 寄存器信息是否配置正确，具体请查看 VE Spec 说明。</li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="63-图像解码出错">6.3. 图像解码出错<a href="#63-图像解码出错" class="hash-link" aria-label="6.3. 图像解码出错的直接链接" title="6.3. 图像解码出错的直接链接">​</a></h2>
<p>请查看VE使用指南 <a href="/docs/Luban-SDK/ve/6_faq.html#ref-ve-error">解码报错</a></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="64-申请-dmabuf-失败">6.4. 申请 dmabuf 失败<a href="#64-申请-dmabuf-失败" class="hash-link" aria-label="6.4. 申请 dmabuf 失败的直接链接" title="6.4. 申请 dmabuf 失败的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="641-现象">6.4.1. 现象<a href="#641-现象" class="hash-link" aria-label="6.4.1. 现象的直接链接" title="6.4.1. 现象的直接链接">​</a></h3>
<p>log 显示 dmabuf 申请失败，或者解码程序跑飞</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="642-原因分析">6.4.2. 原因分析<a href="#642-原因分析" class="hash-link" aria-label="6.4.2. 原因分析的直接链接" title="6.4.2. 原因分析的直接链接">​</a></h3>
<ol>
<li>
<p>mpp heap 的是否成功初始化，生成 <code>/dev/dmabuf/mpp</code> 文件节点</p>
<p>如果没有生成 <code>/dev/dmabuf/mpp</code> 文件节点，则需要增加 CMA 预留内存的大小，或者减小 mpp heap 申请的内存大小。请查看配置指南 <a href="/docs/Luban-SDK/part2/2_config_guide.html#ref-mpp-heap-cfg">MPP Heap</a></p>
</li>
<li>
<p>mpp heap 是否设置得太小，无法满足满足解码的需求</p>
</li>
</ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/Luban-SDK/part2/06-5_MPP-Useguide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/category/mpp开发"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">MPP开发</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Luban-SDK/part2/06-6_MPPPlayer-Useguide"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">MPP 播放器使用指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-模块介绍" class="table-of-contents__link toc-highlight">1. 模块介绍</a></li><li><a href="#11-术语定义" class="table-of-contents__link toc-highlight">1.1. 术语定义</a></li><li><a href="#12-模块简介" class="table-of-contents__link toc-highlight">1.2. 模块简介</a></li><li><a href="#21-内核配置" class="table-of-contents__link toc-highlight">2.1. 内核配置</a><ul><li><a href="#211-mpp-heap" class="table-of-contents__link toc-highlight">2.1.1. MPP Heap</a></li><li><a href="#212-ve-驱动" class="table-of-contents__link toc-highlight">2.1.2. VE 驱动</a></li></ul></li><li><a href="#22-dts-参数配置" class="table-of-contents__link toc-highlight">2.2. DTS 参数配置</a></li><li><a href="#31-调试开关" class="table-of-contents__link toc-highlight">3.1. 调试开关</a><ul><li><a href="#311-mpp调试" class="table-of-contents__link toc-highlight">3.1.1. MPP调试</a></li><li><a href="#312-子模块调试" class="table-of-contents__link toc-highlight">3.1.2. 子模块调试</a></li><li><a href="#313-mpp-heap-调试" class="table-of-contents__link toc-highlight">3.1.3. MPP Heap 调试</a></li></ul></li><li><a href="#41-运行测试用例" class="table-of-contents__link toc-highlight">4.1. 运行测试用例</a><ul><li><a href="#411-mpp_test" class="table-of-contents__link toc-highlight">4.1.1. mpp_test</a></li><li><a href="#412-pic_test" class="table-of-contents__link toc-highlight">4.1.2. pic_test</a></li></ul></li><li><a href="#51-源码说明" class="table-of-contents__link toc-highlight">5.1. 源码说明</a></li><li><a href="#52-模块架构" class="table-of-contents__link toc-highlight">5.2. 模块架构</a><ul><li><a href="#521-mpp-软件框架" class="table-of-contents__link toc-highlight">5.2.1. MPP 软件框架</a></li></ul></li><li><a href="#53-mpp_decoder-设计以及接口说明" class="table-of-contents__link toc-highlight">5.3. mpp_decoder 设计以及接口说明</a><ul><li><a href="#531-packet-管理机制" class="table-of-contents__link toc-highlight">5.3.1. packet 管理机制</a></li><li><a href="#532-frame-管理机制" class="table-of-contents__link toc-highlight">5.3.2. frame 管理机制</a></li><li><a href="#533-物理连续内存使用情况" class="table-of-contents__link toc-highlight">5.3.3. 物理连续内存使用情况</a></li><li><a href="#534-mpp_decoder-调用流程" class="table-of-contents__link toc-highlight">5.3.4. mpp_decoder 调用流程</a></li><li><a href="#535-mpp_decoder-数据结构" class="table-of-contents__link toc-highlight">5.3.5. mpp_decoder 数据结构</a></li><li><a href="#536-mpp_decoder-接口设计" class="table-of-contents__link toc-highlight">5.3.6. mpp_decoder 接口设计</a></li><li><a href="#537-mpp_decoder-参考demo" class="table-of-contents__link toc-highlight">5.3.7. mpp_decoder 参考demo</a></li></ul></li><li><a href="#54-mpp_encoder-设计及接口说明" class="table-of-contents__link toc-highlight">5.4. mpp_encoder 设计及接口说明</a><ul><li><a href="#541-接口设计" class="table-of-contents__link toc-highlight">5.4.1. 接口设计</a></li><li><a href="#542-mpp_encoder-参考demo" class="table-of-contents__link toc-highlight">5.4.2. mpp_encoder 参考demo</a></li></ul></li><li><a href="#55-mpp_ge-接口说明" class="table-of-contents__link toc-highlight">5.5. mpp_ge 接口说明</a></li><li><a href="#56-mpp-heap-设计及说明" class="table-of-contents__link toc-highlight">5.6. mpp heap 设计及说明</a><ul><li><a href="#561-mpp-heap-特点" class="table-of-contents__link toc-highlight">5.6.1. mpp heap 特点</a></li><li><a href="#562-mpp-heap-init" class="table-of-contents__link toc-highlight">5.6.2. mpp heap init</a></li><li><a href="#563-mpp-heap-export" class="table-of-contents__link toc-highlight">5.6.3. mpp heap export¶</a></li><li><a href="#564-mpp-heap-close" class="table-of-contents__link toc-highlight">5.6.4. mpp heap close¶</a></li><li><a href="#5-mpp-heap-destroy" class="table-of-contents__link toc-highlight">5. mpp heap destroy</a></li><li><a href="#566-mpp-heap-接口" class="table-of-contents__link toc-highlight">5.6.6. mpp heap 接口</a></li><li><a href="#567-mpp-heap-设置" class="table-of-contents__link toc-highlight">5.6.7. mpp heap 设置</a></li></ul></li><li><a href="#61-ve驱动未加载" class="table-of-contents__link toc-highlight">6.1. VE驱动未加载</a></li><li><a href="#62-解码图像花屏" class="table-of-contents__link toc-highlight">6.2. 解码图像花屏</a><ul><li><a href="#621-现象" class="table-of-contents__link toc-highlight">6.2.1. 现象</a></li><li><a href="#622-原因分析" class="table-of-contents__link toc-highlight">6.2.2. 原因分析</a></li></ul></li><li><a href="#63-图像解码出错" class="table-of-contents__link toc-highlight">6.3. 图像解码出错</a></li><li><a href="#64-申请-dmabuf-失败" class="table-of-contents__link toc-highlight">6.4. 申请 dmabuf 失败</a><ul><li><a href="#641-现象" class="table-of-contents__link toc-highlight">6.4.1. 现象</a></li><li><a href="#642-原因分析" class="table-of-contents__link toc-highlight">6.4.2. 原因分析</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>