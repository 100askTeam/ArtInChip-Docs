<!doctype html>
<html lang="zh-Hans" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-D213-DevKit/part3/06-3_Display-Useguide" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Display 使用指南 | 东山Π</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://artinchip.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://artinchip.100ask.net/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://artinchip.100ask.net/docs/D213-DevKit/part3/06-3_Display-Useguide"><meta data-rh="true" property="og:locale" content="zh_Hans"><meta data-rh="true" property="og:locale:alternate" content="en"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Display 使用指南 | 东山Π"><meta data-rh="true" name="description" content="1. 模块介绍"><meta data-rh="true" property="og:description" content="1. 模块介绍"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/06-3_Display-Useguide"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/06-3_Display-Useguide" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/en/docs/D213-DevKit/part3/06-3_Display-Useguide" hreflang="en"><link data-rh="true" rel="alternate" href="https://artinchip.100ask.net/docs/D213-DevKit/part3/06-3_Display-Useguide" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d875fe7e.css">
<script src="/assets/js/runtime~main.981e9d4c.js" defer="defer"></script>
<script src="/assets/js/main.abeb38c7.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="东山PI" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">东山Π</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/D213-DevKit/BoardIntroduction">D213-DevKit</a><a class="navbar__item navbar__link" href="/docs/category/luban-sdk使用指南">Luban-SDK</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/D213-DevKit/part3/06-3_Display-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-Hans">简体中文</a></li><li><a href="/en/docs/D213-DevKit/part3/06-3_Display-Useguide" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/100askTeam/ArtInChip-Docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/D213-DevKit/BoardIntroduction">匠心创D213-DevKit开发板</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/D213-DevKit/SupportingResources">源码工具文档手册</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/快速启动">快速启动</a><button aria-label="展开侧边栏分类 &#x27;快速启动&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/D213-DevKit/ConfigHostEnv">安装并配置开发环境</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/luban-sdk开发">Luban-SDK开发</a><button aria-label="展开侧边栏分类 &#x27;Luban-SDK开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/luban-linux系统开发">Luban-Linux系统开发</a><button aria-label="折叠侧边栏分类 &#x27;Luban-Linux系统开发&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-1_BWMUserGuide">BWM 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-2_CMUUserGuide">CMU 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-3_DMABook">DMA 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-4_RTCUserGuide">RTC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-5_TSensorUserGuide">TSensor 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-6_WatchdogUserGuide">Watchdog 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/04-7_WRIUserGuide">WRI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/05-1_SDMCUserGuide">SDMC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/05-2_SPI_NANDUserGuide">SPI NAND 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/05-3_SPI_NORUserGuide">SPI NOR 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/05-4_FileSystemUserGuide">文件系统使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/06-1_GE-Useguide">GE 开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/06-2_VE-Useguide">VE 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/D213-DevKit/part3/06-3_Display-Useguide">Display 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/06-4_DVP-Useguide">DVP开 发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/06-8_I2S-Useguide">I2S 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/06-9_AudioCodec-Useguide">AudioCodec 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-1_CAN-Useguide">CAN 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-2_ CIR-Useguide">CIR 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-3_ GPAI-Useguide">GPAI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-4_I2C-Useguide">I2C 开发指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-5_MAC-Useguide">MAC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-6_PBus-Useguide">PBus 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-7_PINCTRL-Useguide">PINCTRL 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-8_PWM-Useguide">PWM 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-9_RTP-Useguide">RTP 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-10_SPI-Useguide">SPI 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-11_UART-Useguide">UART 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-12_USB-Useguide">USB 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/07-13_PSADC-Useguide">PSADC 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/08-1_SPI-ENC">SPI ENC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/08-2_CE-Useguide">CE 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/08-3_eFuse-Useguide">eFuse 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/08-4_HardwareAuthorizationCertification">硬件授权认证</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/10-1_TouchscreenDebuggingGuide">触摸屏调试指  南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/10-2_DisplayDebuggingGuide">显示屏调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/10-3_WiFiDebuggingGuide">WiFi调试指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/D213-DevKit/part3/10-4_GuideToUsingTheKeyMatrix">按键矩阵使用指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux-bringup参考">Linux-Bringup参考</a><button aria-label="展开侧边栏分类 &#x27;Linux-Bringup参考&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/linux-uboot开发">Linux-Uboot开发</a><button aria-label="展开侧边栏分类 &#x27;Linux-Uboot开发&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/luban-linux系统开发"><span itemprop="name">Luban-Linux系统开发</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Display 使用指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><h1>Display 使用指南</h1>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-模块介绍">1. 模块介绍<a href="#1-模块介绍" class="hash-link" aria-label="1. 模块介绍的直接链接" title="1. 模块介绍的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-术语定义">1.1. 术语定义<a href="#11-术语定义" class="hash-link" aria-label="1.1. 术语定义的直接链接" title="1.1. 术语定义的直接链接">​</a></h3>
<table><thead><tr><th>术语</th><th>定义</th><th>注释说明</th></tr></thead><tbody><tr><td>DE</td><td>Display Engine</td><td>显示引擎</td></tr><tr><td>DI</td><td>Display Interface</td><td>显示接口，包括RGB/LVDS/DSI等</td></tr><tr><td>PANEL</td><td>panel</td><td>外接屏幕驱动</td></tr><tr><td>RGB</td><td>Red Green Blue</td><td>按红绿蓝三原色编码的显示接口标准</td></tr><tr><td>LVDS</td><td>Low Voltage Differential Signaling</td><td>低压差分信号的显示接口标准</td></tr><tr><td>MIPI-DSI</td><td>Mipi Display Serial Interface</td><td>Mipi组织定义的一个显示接口标准</td></tr><tr><td>I8080</td><td>/</td><td>Inter提出的8080总线标准</td></tr><tr><td>SPI</td><td>Serial Peripheral Interface</td><td>串行外设接口，由spi协议传输数据</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-系统简介">1.2. 系统简介<a href="#12-系统简介" class="hash-link" aria-label="1.2. 系统简介的直接链接" title="1.2. 系统简介的直接链接">​</a></h3>
<p>显示模块包含了显示引擎 (DE)，显示接口 (DI)。其中显示接口支持 RGB/LVDS/DSI/I8080/SPI 等接口标准。</p>
<p>显示模块的主要功能是将内存中的数据转换成显示接口需要的信号，并且支持多图层的叠加输出。从硬件角度看，显示模块的框架如下所示：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/display_system1-17066864576981.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/display_system1.png" class="img_ev3q"></p>
<p>图 6.21 <em>显示模块</em></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="13-特性说明">1.3. 特性说明<a href="#13-特性说明" class="hash-link" aria-label="1.3. 特性说明的直接链接" title="1.3. 特性说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="131-显示引擎">1.3.1. 显示引擎<a href="#131-显示引擎" class="hash-link" aria-label="1.3.1. 显示引擎的直接链接" title="1.3.1. 显示引擎的直接链接">​</a></h4>
<p><strong>Display Engine</strong></p>
<ul>
<li>
<p>最大输入/输出图像大小 2048x2048</p>
</li>
<li>
<p>最高性能 1920*1080@60fps</p>
</li>
<li>
<p>支持两个显示图层，一个 Video 图层，一个 UI 图层，UI 图层内支持4个矩形窗口</p>
</li>
<li>
<p>UI 图层支持图像格式：ARGB8888/XRGB8888/RGB888/ARGB4444/ARGB1555/RGB565</p>
</li>
<li>
<p>Video 图层支持图像格式：</p>
<blockquote>
<ul>
<li>ARGB8888/XRGB8888/RGB888/ARGB4444/ARGB1555/RGB565</li>
<li>YUV420P/NV12/NV21/YUV420_TILE_64x32/YUV420_TILE_128x16</li>
<li>YUV422P/NV16/NV61/YUYV/YVYU/UYVY/VYUY/YUV422_TILE_64x32/YUV422_TILE_128x16</li>
<li>YUV400</li>
</ul>
</blockquote>
</li>
<li>
<p>Video图层的 YUV 格式支持 1/31.999x ~ 32x 缩放（RGB格式不支持）</p>
</li>
<li>
<p>支持误差扩散 Dither</p>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="132-显示接口">1.3.2. 显示接口<a href="#132-显示接口" class="hash-link" aria-label="1.3.2. 显示接口的直接链接" title="1.3.2. 显示接口的直接链接">​</a></h4>
<p><strong>RGB接口</strong></p>
<ul>
<li>支持 PRGB/SRGB/I8080/SPI 四种接口<!-- -->
<ul>
<li>PRGB 并行 RGB 接口<!-- -->
<ul>
<li>支持 PRGB 24/18/16 bit 模式，最高性能 1080P60</li>
</ul>
</li>
<li>SRGB 串行 RGB 接口<!-- -->
<ul>
<li>支持 SRGB 8/6 bit 模式，最高性能 480x320@60fps</li>
</ul>
</li>
<li>I8080 接口<!-- -->
<ul>
<li>支持 I8080 24/18/16/9/8 bit 模式，最高性能 960x540@60fps</li>
</ul>
</li>
<li>SPI 接口<!-- -->
<ul>
<li>支持 SPI 3wire/4wire/4-sda 模式，最高性能 480x320@60fps</li>
<li>支持 SPI 8/24/32 read模式</li>
</ul>
</li>
</ul>
</li>
<li>支持 8 位色深，R/G/B 三组信号可任意交叉，空白区域数据可配置</li>
<li>支持 R/G/B 组内数据输出顺序切换</li>
<li>PRGB/SRGB 时钟提供 4 个相位选择</li>
</ul>
<p><strong>LVDS接口</strong></p>
<ul>
<li>支持 Single Link 和 Dual Link，最高速率 700M bps</li>
<li>支持 VESA 和 JEIDA 模式</li>
<li>支持 18bit 和 24bit 数据传输</li>
<li>支持 LVDS 信号极性选择模式</li>
<li>支持 LVDS Link0 和 Link1 整组互换</li>
<li>支持 LVDS 五组差分对信号任意互换</li>
</ul>
<p><strong>MIPI-DSI接口</strong></p>
<ul>
<li>最大支持 1080P60 及衍生分辨率，支持 Video 和 Command 模式</li>
<li>Video 模式支持 Non-burst 和 Burst 两种方式</li>
<li>可配置为 1/2/3/4 对数据通道，每通道最大支持 1Gbps 速率</li>
<li>支持 RGB888，RGB666，RGB666 packed，RGB565</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-参数配置">2. 参数配置<a href="#2-参数配置" class="hash-link" aria-label="2. 参数配置的直接链接" title="2. 参数配置的直接链接">​</a></h2>
<p>本章节介绍显示模块的参数配置，包括 menuconfig 配置 和 dts 配置。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-menuconfig配置">2.1. menuconfig配置<a href="#21-menuconfig配置" class="hash-link" aria-label="2.1. menuconfig配置的直接链接" title="2.1. menuconfig配置的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="211-使能显示模块驱动">2.1.1. 使能显示模块驱动<a href="#211-使能显示模块驱动" class="hash-link" aria-label="2.1.1. 使能显示模块驱动的直接链接" title="2.1.1. 使能显示模块驱动的直接链接">​</a></h4>
<p>在 luban 根目录下执行 make linux-menuconfig，进入 kernel 的功能配置，使能显示模块驱动：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Device Drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Graphics support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ArtInChip Graphics  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;*&gt; ArtInChip Framebuffer support</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪 贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="212-编译显示接口">2.1.2. 编译显示接口<a href="#212-编译显示接口" class="hash-link" aria-label="2.1.2. 编译显示接口的直接链接" title="2.1.2. 编译显示接口的直接链接">​</a></h4>
<p>使能显示模块的驱动后，需要将显示接口编译进内核。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;*&gt; ArtInChip Framebuffer support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*]   ArtInChip display rgb support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*]   ArtInChip display lvds support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*]   ArtInChip display mipi-dsi support</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以将三个显示接口都编译进内核，但系统运行时，只有 panel 驱动所对应的显示接口能生效。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="213-选择panel">2.1.3. 选择panel<a href="#213-选择panel" class="hash-link" aria-label="2.1.3. 选择panel的直接链接" title="2.1.3. 选择panel的直接链接">​</a></h4>
<p>Luban sdk 不仅为 RGB/LVDS 等显示接口提供了通用的 panel 驱动，也为部分屏驱 IC 提供专用 panel 驱动。</p>
<p>选择特定的 panel 驱动，要先使能 panel 对应的显示接口和 pwm-backlight，否则 panel 在 menuconfig 中不可见。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;*&gt; ArtInChip Framebuffer support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;*&gt;   ArtInChip Panel Drivers (ArtInChip general RGB panel)  ---&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="214-使能背光">2.1.4. 使能背光<a href="#214-使能背光" class="hash-link" aria-label="2.1.4. 使能背光的直接链接" title="2.1.4. 使能背光的直接链接">​</a></h4>
<p>显示模块驱动使用 pwm-backlight 框架进行背光控制</p>
<p>使能 PWM</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*] Pulse-Width Modulation (PWM) Support  ---&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         &lt;*&gt;   ArtInChip PWM support</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使能 pwm-backlight</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Device Drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Graphics support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Backlight &amp; LCD device support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &lt;*&gt; Lowlevel Backlight controls</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;*&gt; Generic PWM based Backlight Driver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="215-驱动依赖项">2.1.5. 驱动依赖项<a href="#215-驱动依赖项" class="hash-link" aria-label="2.1.5. 驱动依赖项的直接链接" title="2.1.5. 驱动依赖项的直接链接">​</a></h4>
<p>显示模块驱动依赖 CMA 和 DMA-BUF 功能。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2151-配置cma">2.1.5.1. 配置CMA<a href="#2151-配置cma" class="hash-link" aria-label="2.1.5.1. 配置CMA的直接链接" title="2.1.5.1. 配置CMA的直接链接">​</a></h5>
<p>在 luban 根目录下执行 make kernel-menuconfig，使能 CMA：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Memory Management options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*] Contiguous Memory Allocator</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>配置 CMA 内存区域的大小，在内核配置的另一个地方，以下配置为 12MB：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Library routines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [*] DMA Contiguous Memory Allocator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    (12)  Size in Mega Bytes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>小技巧</p>
<p>CMA 内存区域无法随意设置大小, Size 需要 4M 对齐。</p>
<p>Linux 启动时会对 CMA size 进行 4M 对齐，对齐操作与 CONFIG_FORCE_MAX_ZONEORDER 设置相关。 ArtInChip 平台上，该配置为 11，意思为一次最大分配内存为 2^10 pages，即 4M。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2152-使能-dma-buf">2.1.5.2. 使能 DMA-BUF<a href="#2152-使能-dma-buf" class="hash-link" aria-label="2.1.5.2. 使能 DMA-BUF的直接链接" title="2.1.5.2. 使能 DMA-BUF的直接链接">​</a></h5>
<p>在 luban 根目录下执行 make kernel-menuconfig，进入 kernel 的功能配置，按如下选择：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Device Drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DMABUF options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] Explicit Synchronization Framework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*]   Sync File Validation Framework</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] userspace dmabuf misc driver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] DMA-BUF Userland Memory Heaps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                [*]   DMA-BUF CMA Heap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-dts参数配置">2.2. DTS参数配置<a href="#22-dts参数配置" class="hash-link" aria-label="2.2. DTS参数配置的直接链接" title="2.2. DTS参数配置的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="221-系统参数配置">2.2.1. 系统参数配置<a href="#221-系统参数配置" class="hash-link" aria-label="2.2.1. 系统参数配置的直接链接" title="2.2.1. 系统参数配置的直接链接">​</a></h4>
<p>系统参数主要在文件 <code>target/d211/common/d211.dtsi</code> 中。模块的系统参数随 IC 的设定而定，不建议用户修改模块系统参数。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2211-fb0">2.2.1.1. fb0<a href="#2211-fb0" class="hash-link" aria-label="2.2.1.1. fb0的直接链接" title="2.2.1.1. fb0的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">display-fb {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-framebuffer&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #address-cells = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #size-cells = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fb0: fb@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0x0 0x0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2212-display-engine">2.2.1.2. display engine<a href="#2212-display-engine" class="hash-link" aria-label="2.2.1.2. display engine的直接链接" title="2.2.1.2. display engine的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">de0: de@18a00000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #address-cells = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #size-cells = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-de-v1.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg = &lt;0x0 0x18a00000 0x0 0x1000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupts-extended = &lt;&amp;plic0 59 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clocks = &lt;&amp;cmu CLK_DE&gt;, &lt;&amp;cmu CLK_PIX&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock-names = &quot;de0&quot;, &quot;pix&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resets = &lt;&amp;rst RESET_DE&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reset-names = &quot;de0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mclk-rate = &lt;200000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2213-rgb-display-interface">2.2.1.3. rgb display interface<a href="#2213-rgb-display-interface" class="hash-link" aria-label="2.2.1.3. rgb display interface的直接链接" title="2.2.1.3. rgb display interface的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rgb0: rgb@18800000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #address-cells = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #size-cells = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-rgb-v1.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg = &lt;0x0 0x18800000 0x0 0x1000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clocks = &lt;&amp;cmu CLK_RGB&gt;, &lt;&amp;cmu CLK_SCLK&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock-names = &quot;rgb0&quot;, &quot;sclk&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resets = &lt;&amp;rst RESET_RGB&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reset-names = &quot;rgb0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2214-lvds-display-interface">2.2.1.4. lvds display interface<a href="#2214-lvds-display-interface" class="hash-link" aria-label="2.2.1.4. lvds display interface的直接链接" title="2.2.1.4. lvds display interface的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">lvds0: lvds@18810000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #address-cells = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #size-cells = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-lvds-v1.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg = &lt;0x0 0x18810000 0x0 0x1000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clocks = &lt;&amp;cmu CLK_LVDS&gt;, &lt;&amp;cmu CLK_SCLK&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock-names = &quot;lvds0&quot;, &quot;sclk&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resets = &lt;&amp;rst RESET_LVDS&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reset-names = &quot;lvds0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2215-mipi-dsi-display-interface">2.2.1.5. mipi-dsi display interface<a href="#2215-mipi-dsi-display-interface" class="hash-link" aria-label="2.2.1.5. mipi-dsi display interface的直接链接" title="2.2.1.5. mipi-dsi display interface的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">dsi0: dsi@18820000 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #address-cells = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    #size-cells = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-mipi-dsi-v1.0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reg = &lt;0x0 0x18820000 0x0 0x1000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clocks = &lt;&amp;cmu CLK_MIPIDSI&gt;, &lt;&amp;cmu CLK_SCLK&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock-names = &quot;dsi0&quot;, &quot;sclk&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    resets = &lt;&amp;rst RESET_MIPIDSI&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    reset-names = &quot;dsi0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interrupts-extended = &lt;&amp;plic0 56 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-lanes = &lt;0 1 2 3&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lane-polarities = &lt;0 0 0 0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="222-功能参数配置">2.2.2. 功能参数配置<a href="#222-功能参数配置" class="hash-link" aria-label="2.2.2. 功能参数配置的直接链接" title="2.2.2. 功能参数配置的直接链接">​</a></h4>
<p>功能参数主要针对某一个使用方案，随着方案的改变，参数很可能不同。</p>
<p>这些参数主要在文件 target/d211/方案x/board.dts 中，功能参数的设置必须和硬件原理图相匹配。</p>
<p>功能参数的设置亦可参看以下路径的内核文档：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">linux-5.10/Documentation/devicetree/bindings/display/artinchip/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artinchip-de.txt  artinchip-dsi.txt  artinchip-fb.txt  artinchip-lvds.txt  artinchip-panel.txt  artinchip-rgb.txt</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">linux-5.10/Documentation/devicetree/bindings/display/panel/artinchip/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    panel-dsi.txt  panel-lvds.txt  panel-rgb.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>功能参数之间会构成一条完整的数据链路，如何设置可查看 <a href="/docs/06_panel_port/index.html#ref-to-panel-port">屏配置指南</a> 相关章节。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* The data flow:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">* fb ---&gt; de ----&gt; di ----&gt; panel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*              {-&gt; lvds -&gt;}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*              |-&gt; rgb  -&gt;|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*              &#x27;-&gt; dsi  -&gt;&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2221-panel">2.2.2.1. Panel<a href="#2221-panel" class="hash-link" aria-label="2.2.2.1. Panel的直接链接" title="2.2.2.1. Panel的直接链接">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22211-panel-rgb">2.2.2.1.1. panel rgb<a href="#22211-panel-rgb" class="hash-link" aria-label="2.2.2.1.1. panel rgb的直接链接" title="2.2.2.1.1. panel rgb的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">panel_rgb {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-general-rgb-panel&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rgb-mode = &lt;PRGB&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    interface-format = &lt;PRGB_24BIT&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock-phase = &lt;DEGREE_0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-order = &lt;RGB&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backlight = &lt;&amp;backlight&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // enable-gpios = &lt;&amp;gpio_a 4 GPIO_ACTIVE_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        panel_rgb_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;rgb0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display-timings {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        native-mode = &lt;&amp;timing0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timing0: 1024x600 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clock-frequency = &lt;45000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hactive = &lt;1024&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vactive = &lt;600&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hback-porch = &lt;140&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hfront-porch = &lt;160&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hsync-len = &lt;20&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vback-porch = &lt;12&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vfront-porch = &lt;20&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vsync-len = &lt;3&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            de-active = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pixelclk-active = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注解</p>
<p>相关宏定义取值在文件 include/dt-bindings/display/artinchip,aic-disp.h 中</p>
<p><strong>Required properties:</strong></p>
<ul>
<li>
<p>port</p>
<blockquote>
<p>连接到 RGB 显示接口的输入端口，将 panel_rgb 结点与 rgb 结点关联起来。</p>
</blockquote>
</li>
</ul>
<p><strong>Optional properties:</strong></p>
<ul>
<li>
<p>rgb-mode</p>
<blockquote>
<p>设置 RGB 显示接口的输出模式，可以设置为并行 RGB、串行 RGB、I8080、SPI。默认为并行 RGB 模式</p>
<table><thead><tr><th>rgb-mode</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>并行RGB</td><td>PRGB</td><td>0</td></tr><tr><td>串行RGB</td><td>SRGB</td><td>1</td></tr><tr><td>I8080</td><td>I8080</td><td>2</td></tr><tr><td>SPI</td><td>SPI</td><td>3</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>interface-format</p>
<blockquote>
<p>设置 RGB 显示接口的输出格式，默认输出并行 RGB 24-bit。</p>
<p>PRGB 的 18bit/16bit 兼容 2 种输出模式，可根据不同的封装或走线需求进行选择。</p>
<ul>
<li>PRGB_18BIT_LD 表示将 24 个 pin 中最低位的 6 个 pin 丢弃</li>
<li>PRGB_18BIT_HD 表示将 24 个 pin 中最高位的 6 个 pin 丢弃</li>
</ul>
<p>16 bit 模式同理，丢弃 24 个 pin 中的 8 个，详情可参考芯片数据手册中 LCD 章节中的功能描述。</p>
<table><thead><tr><th>mode</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>PRGB</td><td>PRGB_24BIT</td><td>0</td></tr><tr><td></td><td>PRGB_18BIT_LD</td><td>1</td></tr><tr><td></td><td>PRGB_18BIT_HD</td><td>2</td></tr><tr><td></td><td>PRGB_16BIT_LD</td><td>3</td></tr><tr><td></td><td>PRGB_16BIT_HD</td><td>4</td></tr><tr><td>SRGB</td><td>SRGB_8BIT</td><td>0</td></tr><tr><td></td><td>SRGB_6BIT</td><td>1</td></tr><tr><td>I8080</td><td>I8080_RGB565_8BIT</td><td>0</td></tr><tr><td></td><td>I8080_RGB666_8BIT</td><td>1</td></tr><tr><td></td><td>I8080_RGB666_9BIT</td><td>2</td></tr><tr><td></td><td>I8080_RGB666_16BIT_3CYCLE</td><td>3</td></tr><tr><td></td><td>I8080_RGB666_16BIT_2CYCLE</td><td>4</td></tr><tr><td></td><td>I8080_RGB565_16BIT</td><td>5</td></tr><tr><td></td><td>I8080_RGB666_18BIT</td><td>6</td></tr><tr><td></td><td>I8080_RGB888_24BIT</td><td>7</td></tr><tr><td>SPI</td><td>SPI_3LINE_RGB565</td><td>0</td></tr><tr><td></td><td>SPI_3LINE_RGB666</td><td>1</td></tr><tr><td></td><td>SPI_3LINE_RGB888</td><td>2</td></tr><tr><td></td><td>SPI_4LINE_RGB565</td><td>3</td></tr><tr><td></td><td>SPI_4LINE_RGB666</td><td>4</td></tr><tr><td></td><td>SPI_4LINE_RGB888</td><td>5</td></tr><tr><td></td><td>SPI_4SDA_RGB565</td><td>6</td></tr><tr><td></td><td>SPI_4SDA_RGB666</td><td>7</td></tr><tr><td></td><td>SPI_4SDA_RGB888</td><td>8</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>clock-phase</p>
<blockquote>
<p>pixel时钟输出相位选择, 允许设置时钟上升沿延后数据 0°/90°/180°/270° 相位。 默认为 0°</p>
<table><thead><tr><th>degress</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>0°</td><td>DEGREE_0</td><td>0</td></tr><tr><td>90°</td><td>DEGREE_90</td><td>1</td></tr><tr><td>180°</td><td>DEGREE_180</td><td>2</td></tr><tr><td>270°</td><td>DEGREE_270</td><td>3</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>data-order</p>
<blockquote>
<p>RGB 数据的输出顺序，R/G/B 三组信号可按任意顺序输出。默认为 RGB 顺序输出。</p>
<table><thead><tr><th>数据输出顺序</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>RGB</td><td>RGB</td><td>0x02100210</td></tr><tr><td>RBG</td><td>RBG</td><td>0x02010201</td></tr><tr><td>BGR</td><td>BGR</td><td>0x00120012</td></tr><tr><td>BRG</td><td>BRG</td><td>0x00210021</td></tr><tr><td>GRB</td><td>GRB</td><td>0x01200120</td></tr><tr><td>GBR</td><td>GBR</td><td>0x01020102</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>data-mirror</p>
<blockquote>
<p>布尔型参数，控制 RGB 数据组内大小端输出。默认输出低位到高位 0 - 7。如果设置则输出变为 7 - 0</p>
</blockquote>
</li>
<li>
<p>disp-dither</p>
<blockquote>
<p>颜色输出深度控制，使图像过度更平滑。当内存数据为 8bit ，但输出为 6bit 或者 5bit 时，使能 dither 能让图像过度更平滑，否则直接丢弃低位 bit。</p>
<p>配置 dither 时默认使能随机 dither ，获取更好的显示效果。</p>
<table><thead><tr><th>颜色输出深度</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>R 分量输出 5bitG 分量输出 6bitB 分量输出 5bit</td><td>DITHER_RGB565</td><td>0x1</td></tr><tr><td>R  分量输出 6bitG 分量输出 6bitB 分量输出 6bit</td><td>DITHER_RGB666</td><td>0x2</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>tearing-effect</p>
<blockquote>
<p>TE 信号响应模式，配合屏幕 TE 信号使用，控制 DE 模块的输出，避免 LCD 屏幕出现撕裂现象。</p>
<blockquote>
<ul>
<li>连续刷新 (default) ：忽略 TE 信号, 连续刷新</li>
<li>手动刷新：DE timging enable 后在下一个 TE 信号更新画面</li>
<li>自动刷新： 每收到一个 TE 信号，自动更新画面，更新期间忽略 TE 信号</li>
</ul>
</blockquote>
<p>手动刷新和自动刷新模式下，需要设定 TE 脉冲宽度，用于检测屏幕 TE 信号。</p>
<table><thead><tr><th>TE mode</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>连续刷新</td><td>TE_BYPASS</td><td>0x0</td></tr><tr><td>手动刷新</td><td>TE_HOLD</td><td>0x1</td></tr><tr><td>自动刷新</td><td>TE_AUTO</td><td>0x2</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>te-pulse-width</p>
<blockquote>
<p>TE 脉冲宽度，用于检测 TE 同步信号的有效状态，建议设为5。</p>
</blockquote>
</li>
<li>
<p>enable-gpios</p>
<blockquote>
<p>预留的屏幕使能引脚，可用于控制屏幕供电，不使用 pwm-backlight 的情况下亦可控制屏幕背光。</p>
</blockquote>
</li>
<li>
<p>backlight</p>
<blockquote>
<p>屏幕的 pwm-backlight 配置节点。</p>
</blockquote>
</li>
<li>
<p>display-timings</p>
<blockquote>
<p>屏的时序信号。由屏厂提供。</p>
</blockquote>
</li>
</ul>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22212-panel-lvds">2.2.2.1.2. panel lvds<a href="#22212-panel-lvds" class="hash-link" aria-label="2.2.2.1.2. panel lvds的直接链接" title="2.2.2.1.2. panel lvds的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">panel_lvds {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-general-lvds-panel&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-mapping = &quot;vesa-24&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-channel = &quot;single-link1&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backlight = &lt;&amp;backlight&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // enable-gpios = &lt;&amp;gpio_a 4 GPIO_ACTIVE_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        panel_lvds_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;lvds0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display-timings {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        native-mode = &lt;&amp;timing1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timing1: 1024x600 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clock-frequency = &lt;60000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hactive = &lt;1024&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vactive = &lt;600&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hback-porch = &lt;140&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hfront-porch = &lt;160&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hsync-len = &lt;20&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vback-porch = &lt;20&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vfront-porch = &lt;12&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vsync-len = &lt;3&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            de-active = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pixelclk-active = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Required properties:</strong></p>
<ul>
<li>
<p>port</p>
<blockquote>
<p>连接到LVDS显示接口的输入端口，将panel_lvds结点与lvds结点关联起来。</p>
</blockquote>
</li>
<li>
<p>data-mapping</p>
<blockquote>
<p>lvds 模式设置，字符串参数，默认输出为”vesa-24”</p>
<table><thead><tr><th>lvds mode</th><th>strings</th></tr></thead><tbody><tr><td>NS</td><td>“vesa-24”</td></tr><tr><td>JEIDA 8 bit</td><td>“jeida-24”</td></tr><tr><td>JEIDA 6 bit</td><td>“jeida-18”</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>data-channel</p>
<blockquote>
<p>lvds link 设置，字符串参数，默认输出”lvds-link0”，单link输出，link0通道。</p>
<table><thead><tr><th>lvds link mode</th><th>strings</th><th>备注</th></tr></thead><tbody><tr><td>单Link模式0</td><td>“single-link0”</td><td>单link输出，输出选择link0通道</td></tr><tr><td>单Link模式1</td><td>“single-link1”</td><td>单link输出，输出选择link1通道</td></tr><tr><td>单Link模式2</td><td>“double-screen”</td><td>单link输出，link0 和 link1 同时输出，可驱动双屏同显</td></tr><tr><td>双Link模式</td><td>“dual-link”</td><td>dual link输出，奇偶像素同时输出</td></tr></tbody></table>
</blockquote>
</li>
</ul>
<p><strong>Optional properties:</strong></p>
<ul>
<li>
<p>disp-dither</p>
<blockquote>
<p>颜色输出深度控制，使图像过度更平滑。当内存数据为 8bit ，但输出为 6bit 或者 5bit 时，使能 dither 能让图像过度更平滑，否则直接丢弃低位 bit。</p>
<p>配置 dither 时默认使能随机 dither ，获取更好的 显示效果。</p>
<table><thead><tr><th>颜色输出深度</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>R 分量输出 5bitG 分量输出 6bitB 分量输出 5bit</td><td>DITHER_RGB565</td><td>0x1</td></tr><tr><td>R 分量输出 6bitG 分量输出 6bitB 分量输出 6bit</td><td>DITHER_RGB666</td><td>0x2</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>tearing-effect</p>
<blockquote>
<p>TE 信号响应模式，配合屏幕 TE 信号使用，控制 DE 模块的输出，避免 LCD 屏幕出现撕裂现象。</p>
<blockquote>
<ul>
<li>连续刷新 (default) ：忽略 TE 信号, 连续刷新</li>
<li>手动刷新：DE timging enable 后在下一个 TE 信号更新画面</li>
<li>自动刷新： 每收到一个 TE 信号，自动更新画面，更新期间忽略 TE 信号</li>
</ul>
</blockquote>
<p>手动刷新和自动刷新模式下，需要设定 TE 脉冲宽度，用于检测屏幕 TE 信号。</p>
<table><thead><tr><th>TE mode</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>连续刷新</td><td>TE_BYPASS</td><td>0x0</td></tr><tr><td>手动刷新</td><td>TE_HOLD</td><td>0x1</td></tr><tr><td>自动刷新</td><td>TE_AUTO</td><td>0x2</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>te-pulse-width</p>
<blockquote>
<p>TE 脉冲宽度，用于检测 TE 同步信号的有效状态，建议设为5。</p>
</blockquote>
</li>
<li>
<p>enable-gpios</p>
<blockquote>
<p>预留的屏幕使能引脚，可用于控制屏幕供电，不使用 pwm-backlight 的情况下亦可控制屏幕背光。</p>
</blockquote>
</li>
<li>
<p>backlight</p>
<blockquote>
<p>屏幕的 pwm-backlight 配置节点。</p>
</blockquote>
</li>
<li>
<p>display-timings</p>
<blockquote>
<p>屏的时序信号。由屏厂提供。</p>
</blockquote>
</li>
</ul>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22213-panel-dsi">2.2.2.1.3. panel dsi<a href="#22213-panel-dsi" class="hash-link" aria-label="2.2.2.1.3. panel dsi的直接链接" title="2.2.2.1.3. panel dsi的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">panel_dsi {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-dsi-panel-simple&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backlight = &lt;&amp;backlight&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // enable-gpios = &lt;&amp;gpio_a 4 GPIO_ACTIVE_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        panel_dsi_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;dsi0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Required properties:</strong></p>
<ul>
<li>
<p>port</p>
<blockquote>
<p>连接到MIPI-DSI显示接口的输入端口，将panel_dsi结点与dsi结点关联起来。</p>
</blockquote>
</li>
</ul>
<p><strong>Optional properties:</strong></p>
<ul>
<li>
<p>dsi,mode</p>
<blockquote>
<p>dsi模式设置，字符串参数，支持video 与 command 两种模式。Video模式支持Non-burst和Burst两种方式。</p>
<table><thead><tr><th>dsi mode</th><th>strings</th></tr></thead><tbody><tr><td>video pulse mode</td><td>“video-pulse”</td></tr><tr><td>video event mode</td><td>“video-event”</td></tr><tr><td>video burst mode</td><td>“video-burst”</td></tr><tr><td>command mode</td><td>“command-mode”</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>dsi,format</p>
<blockquote>
<p>dsi 显示接口输出格式。字符串参数，支持RGB888，RGB666，RGB666 packed，RGB565</p>
<table><thead><tr><th>dsi outout format</th><th>strings</th></tr></thead><tbody><tr><td>RGB888</td><td>“rgb888”</td></tr><tr><td>RGB666</td><td>“rgb666”</td></tr><tr><td>RGB666 packed</td><td>“rgb666l”</td></tr><tr><td>RGB565</td><td>“rgb565”</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>dsi,lane_num</p>
<blockquote>
<p>数据通路数量，整型，取值 1 ~ 4</p>
</blockquote>
</li>
<li>
<p>disp-dither</p>
<blockquote>
<p>颜色输出深度控制，使图像过度更平滑。当内存数据为 8bit ，但输出为 6bit 或者 5bit 时，使能 dither 能让图像过度更平滑，否则直接丢弃低位 bit。</p>
<p>配置 dither 时默认使能随机 dither ，获取更好的显示效果。</p>
<table><thead><tr><th>颜色输出深度</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>R 分量输出 5bitG 分量输出 6bitB 分量输出 5bit</td><td>DITHER_RGB565</td><td>0x1</td></tr><tr><td>R 分量输出 6bitG 分量输出 6bitB 分量输出 6bit</td><td>DITHER_RGB666</td><td>0x2</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>tearing-effect</p>
<blockquote>
<p>TE 信号响应模式，配合屏幕 TE 信号使用，控制 DE 模块的输出，避免 LCD 屏幕出现撕裂现象。</p>
<blockquote>
<ul>
<li>连续刷新 (default) ：忽略 TE 信号, 连续刷新</li>
<li>手动刷新：DE timging enable 后在下一个 TE 信号更新画面</li>
<li>自动刷新：每收到一个 TE 信号，自动更新画面，更新期间忽略 TE 信号</li>
</ul>
</blockquote>
<p>手动刷新和自动刷新模式下，需要设定 TE 脉冲宽度，用于检测屏幕 TE 信号。</p>
<table><thead><tr><th>TE mode</th><th>macro</th><th>value</th></tr></thead><tbody><tr><td>连续刷新</td><td>TE_BYPASS</td><td>0x0</td></tr><tr><td>手动刷新</td><td>TE_HOLD</td><td>0x1</td></tr><tr><td>自动刷新</td><td>TE_AUTO</td><td>0x2</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>te-pulse-width</p>
<blockquote>
<p>TE 脉冲宽度，用于检测 TE 同步信号的有效状态，建议设为5。</p>
</blockquote>
</li>
<li>
<p>enable-gpios</p>
<blockquote>
<p>预留的屏幕使能引脚，可用于控制屏幕供电，不使用 pwm-backlight 的情况下亦可控制屏幕背光。</p>
</blockquote>
</li>
<li>
<p>backlight</p>
<blockquote>
<p>屏幕的 pwm-backlight 配置节点。</p>
</blockquote>
</li>
<li>
<p>display-timings</p>
<blockquote>
<p>屏的时序信号。由屏厂提供。</p>
</blockquote>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2222-backlight">2.2.2.2. backlight<a href="#2222-backlight" class="hash-link" aria-label="2.2.2.2. backlight的直接链接" title="2.2.2.2. backlight的直接链接">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22221-pwm-backlight">2.2.2.2.1. pwm-backlight<a href="#22221-pwm-backlight" class="hash-link" aria-label="2.2.2.2.1. pwm-backlight的直接链接" title="2.2.2.2.1. pwm-backlight的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">panel_rgb {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    backlight = &lt;&amp;backlight&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">backlight: backlight {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;pwm-backlight&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* pwm node name; pwm device No.; period_ns; pwm_polarity */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwms = &lt;&amp;pwm 2 1000000 0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    brightness-levels = &lt;0 10 20 30 40 50 60 70 80 90 100&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    default-brightness-level = &lt;8&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&amp;pwm {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;pwm2_pins_b&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* mode: up-count, down-count, up-down-count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       action: none, low, high, inverse */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pwm2 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,mode = &quot;up-count&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,tb-clk-rate = &lt;24000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        /*            CBD,    CBU,    CAD,    CAU,    PRD,   ZRO */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,action0 = &quot;none&quot;, &quot;none&quot;, &quot;none&quot;, &quot;high&quot;, &quot;low&quot;, &quot;none&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,action1 = &quot;none&quot;, &quot;none&quot;, &quot;none&quot;, &quot;low&quot;, &quot;high&quot;, &quot;none&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,default-level = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,rise-edge-delay = &lt;10&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        aic,fall-edge-delay = &lt;10&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>背光控制依赖 PWM 模块，详细配置可参考 PWM 使用指南。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2223-display-interface">2.2.2.3. Display Interface<a href="#2223-display-interface" class="hash-link" aria-label="2.2.2.3. Display Interface的直接链接" title="2.2.2.3. Display Interface的直接链接">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22231-rgb-display-interface">2.2.2.3.1. RGB Display Interface<a href="#22231-rgb-display-interface" class="hash-link" aria-label="2.2.2.3.1. RGB Display Interface的直接链接" title="2.2.2.3.1. RGB Display Interface的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;rgb0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;lcd_pins&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rgb0_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;de0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        rgb0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;panel_rgb_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>pinctrl-names</p>
<blockquote>
<p>SDK一般会把要使用的某一功能的端口组预先定义，后期直接使用即可，定义一般放在target/aicxxx/common/aicxxx-pinctrl.dtsi文件中，目前“pinctrl-names” 均设置为“default” 即可</p>
</blockquote>
</li>
<li>
<p>pinctrl-0</p>
<blockquote>
<p>即指示rgb显示接口预先定义的端口组</p>
</blockquote>
</li>
<li>
<p>port@0</p>
<blockquote>
<p>数据输入端口，连接 display engine 结点</p>
</blockquote>
</li>
<li>
<p>port@1</p>
<blockquote>
<p>数据输出端口，连接 panel rgb 结点</p>
</blockquote>
</li>
</ul>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22232-lvds-display-interface">2.2.2.3.2. LVDS Display Interface<a href="#22232-lvds-display-interface" class="hash-link" aria-label="2.2.2.3.2. LVDS Display Interface的直接链接" title="2.2.2.3.2. LVDS Display Interface的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;lvds0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;lvds0_pins&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lines = &lt;0x43210&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link-swap = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lvds0_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;de0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lvds0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;panel_lvds_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>pinctrl-names</p>
<blockquote>
<p>SDK一般会把要使用的某一功能的端口组预先定义，后期直接使用即可，定义一般放在target/aicxxx/common/aicxxx-pinctrl.dtsi文件中，目前“pinctrl-names” 均设置为“default” 即可</p>
</blockquote>
</li>
<li>
<p>pinctrl-0</p>
<blockquote>
<p>即指示lvds显示接口预先定义的端口组</p>
</blockquote>
</li>
<li>
<p>port@0</p>
<blockquote>
<p>数据输入端口，连接 display engine 结点</p>
</blockquote>
</li>
<li>
<p>port@1</p>
<blockquote>
<p>数据输出端口，连接 panel lvds 结点</p>
</blockquote>
</li>
</ul>
<p><strong>Optional:</strong></p>
<ul>
<li>
<p>link-swap</p>
<blockquote>
<p>整型，link0 与 link1 整组交换</p>
</blockquote>
</li>
<li>
<p>lines</p>
<blockquote>
<p>整型，控制 lvds link 内部 5 个通道的差分信号输出，允许 5 对差分信号任意互换</p>
<p>5 个通道分别为 D3 CK D2 D1 D0，缺省值为：0x43210</p>
<p>0x43210 表示 D3 通道输出 D3，CK 通道输出 CK，D2 通道输出 D2，D1 通道输出 D1，D0 通道输出 D0</p>
<p>0x01234 表示 D3 通道输出 D0，CK 通道输出 D1，D2 通道输出 D2，D1 通道输出 CK，D0 通道输出 D3</p>
</blockquote>
</li>
<li>
<p>pols</p>
<blockquote>
<p>整型，LVDS差分信号极性控制。低 5 bit 分别控制 LVDS 五个通道差分信号的极性。通道顺序为 D3 CK D2 D1 D0</p>
<p>0x3 表示 D1 D0 通道极性反相，0x8 表示 CK 通道反相</p>
<p>pols 属性受 lines 属性影响，如果 CK 通道选择输出 D0，则该 bit 控制 D0 相位，0x8 表示 D0 反相</p>
</blockquote>
</li>
<li>
<p>sync-ctrl</p>
<blockquote>
<p>布尔型，同步前端信号模式，默认开启。防止前端输出半帧数据时打开 LVDS 模块，出现显示异常</p>
</blockquote>
</li>
<li>
<p>phys</p>
<blockquote>
<p>整型，LVDS参考电压控制。数值直接写入 LVDS_0_PHY_CTL 和 LVDS_1_PHY_CTL 寄存器，参考芯片用户手册进行配置。</p>
</blockquote>
</li>
</ul>
<p>注解</p>
<p>lines、pols 和 phys 属性会同时作用于 link0 和 link1</p>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22233-mipi-dsi-display-interface">2.2.2.3.3. MIPI-DSI Display Interface<a href="#22233-mipi-dsi-display-interface" class="hash-link" aria-label="2.2.2.3.3. MIPI-DSI Display Interface的直接链接" title="2.2.2.3.3. MIPI-DSI Display Interface的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;dsi0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;dsi_pins&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-lanes = &lt;3 0 1 2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    lane-polarities = &lt;1 0 1 0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-clk-inverse;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        dsi0_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;de0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            dsi0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;panel_dsi_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>pinctrl-names</p>
<blockquote>
<p>SDK一般会把要使用的某一功能的端口组预先定义，后期直接使用即可，定义一般放在target/aicxxx/common/aicxxx-pinctrl.dtsi文件中，目前“pinctrl-names” 均设置为“default” 即可</p>
</blockquote>
</li>
<li>
<p>pinctrl-0</p>
<blockquote>
<p>即指示mipi-dsi显示接口预先定义的端口组</p>
</blockquote>
</li>
<li>
<p>port@0</p>
<blockquote>
<p>数据输入端口，连接 display engine 结点</p>
</blockquote>
</li>
<li>
<p>port@1</p>
<blockquote>
<p>数据输出端口，连接 panel dsi 结点</p>
</blockquote>
</li>
</ul>
<p><strong>Optional:</strong></p>
<ul>
<li>
<p>data-clk-inverse</p>
<blockquote>
<p>布尔型，CLK Lane 正负极取反</p>
</blockquote>
</li>
<li>
<p>data-lanes</p>
</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; 数组，数据通道输出选择，默认为 &lt;0 1 2 3&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; &lt;0 1 2 3&gt; 表示数据通道0 输出 DATA0，数据通道1 输出 DATA1，以此类推</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; &lt;3 0 1 2&gt; 表示数据通道0 输出 DATA3，数据通道1 输出 DATA0，数据通道2 输出 DATA1，数据通道3 输出 DATA2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; 如果是两个 lane，可配置成 &lt;0 1&gt;，数据通道0 输出 DATA0, 数据通道1 输出 DATA1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>lane-polarities</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; 数组，表示数据通道极性，是否正负极取反，默认为 &lt;0 0 0 0&gt;，与 data-lanes 配置的通道顺序保持一致。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &gt; data-lanes = &lt;3 0 1 2&gt;; lane-polarities = &lt;1 0 1 0&gt;; 表示 DATA3 和 DATA1 正负极取反</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2224-display-engine">2.2.2.4. Display Engine<a href="#2224-display-engine" class="hash-link" aria-label="2.2.2.4. Display Engine的直接链接" title="2.2.2.4. Display Engine的直接链接">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22241-display-engine">2.2.2.4.1. Display Engine<a href="#22241-display-engine" class="hash-link" aria-label="2.2.2.4.1. Display Engine的直接链接" title="2.2.2.4.1. Display Engine的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;de0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                de0_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        remote-endpoint = &lt;&amp;fb0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port@1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                reg = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                de0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        remote-endpoint = &lt;&amp;lvds0_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p>port@0</p>
<blockquote>
<p>数据输入端口，连接 display engine 结点</p>
</blockquote>
</li>
<li>
<p>port@1</p>
<blockquote>
<p>数据输出端口，连接到display interface 结点，此处例子为连接 lvds 结点</p>
</blockquote>
</li>
<li>
<p>tearing-effect</p>
<blockquote>
<p>tearing effetc 模式，支持 bypass / hold / auto 三种模式</p>
<table><thead><tr><th>tearing effect mode</th><th>macro</th><th>value</th><th>备注</th></tr></thead><tbody><tr><td>bypass</td><td>TE_BYPASS</td><td>0</td><td>连续模式，持续刷新，不启用te</td></tr><tr><td>hold</td><td>TE_HOLD</td><td>1</td><td>单帧模式，需要手动刷新</td></tr><tr><td>auto</td><td>TE_AUTO</td><td>2</td><td>自动单帧模式， 接受到te信号后刷新一帧数据</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>te-pulse-width</p>
<blockquote>
<p>TE 信号的脉冲宽度，设置其脉冲宽度等于多少个pixel clock cycle</p>
</blockquote>
</li>
</ul>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="2225-display-fb0">2.2.2.5. Display FB0<a href="#2225-display-fb0" class="hash-link" aria-label="2.2.2.5. Display FB0的直接链接" title="2.2.2.5. Display FB0的直接链接">​</a></h5>
<h6 class="anchor anchorWithStickyNavbar_LWe7" id="22251-display-fb0">2.2.2.5.1. Display FB0<a href="#22251-display-fb0" class="hash-link" aria-label="2.2.2.5.1. Display FB0的直接链接" title="2.2.2.5.1. Display FB0的直接链接">​</a></h6>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;fb0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    artinchip,uboot-logo-on=&lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rotation-degress = &lt;270&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    rotation-buf-num = &lt;2&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    height-virtual = &lt;2160&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disp-bright = &lt;45&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disp-contrast = &lt;50&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disp-saturation = &lt;60&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    disp-hue = &lt;50&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        fb0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;de0_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Required properties:</strong></p>
<ul>
<li>
<p>port</p>
<blockquote>
<p>数据输出端口，连接 display engine 结点</p>
</blockquote>
</li>
<li>
<p>artinchip,uboot-logo-on</p>
<blockquote>
<p>是否保持 uboot 阶段的 logo</p>
</blockquote>
</li>
</ul>
<p><strong>Optional properties:</strong></p>
<ul>
<li>
<p>format</p>
<blockquote>
<p>framebuffer 内存数据格式，string 型参数，缺省为 <code>a8r8g8b8</code> ，表示 32 位 ARGB8888 格式。显示驱动目前适配了以下几种常见格式：</p>
<table><thead><tr><th>format</th><th>strings</th></tr></thead><tbody><tr><td>ARGB8888</td><td>“a8r8g8b8”</td></tr><tr><td>ABGR8888</td><td>“a8b8g8r8”</td></tr><tr><td>XRGB8888</td><td>“x8r8g8b8”</td></tr><tr><td>RGB888</td><td>“r8g8b8”</td></tr><tr><td>RGB565</td><td>“r5g6b5”</td></tr><tr><td>ARGB1555</td><td>“a1r5g5b5”</td></tr></tbody></table>
</blockquote>
</li>
<li>
<p>disp-bright</p>
<blockquote>
<p>显示亮度，[0, 100], 缺省等于 50，50 表示不调节亮度。</p>
</blockquote>
</li>
<li>
<p>disp-contrast</p>
<blockquote>
<p>显示对比度，[0, 100], 缺省等于 50，50 表示不调节对比度。</p>
</blockquote>
</li>
<li>
<p>disp-saturation</p>
<blockquote>
<p>显示饱和度，[0, 100], 缺省等于 50，50 表示不调节饱和度。</p>
</blockquote>
</li>
<li>
<p>disp-hue</p>
<blockquote>
<p>显示色调，[0, 100], 缺省等于 50，50 表示不调节色调。</p>
</blockquote>
</li>
<li>
<p>rotation-degress</p>
<blockquote>
<p>framebuffer 旋转角度，在竖屏横用或横屏竖用时配置，支持 0°/90°/180°/270° 旋转。</p>
</blockquote>
</li>
<li>
<p>rotation-buf-num</p>
<blockquote>
<p>framebuffer 中需要旋转的 buffer 个数。部分应用程序会使用双 buffer 来避免撕裂。</p>
</blockquote>
</li>
<li>
<p>width-virtual</p>
<blockquote>
<p>framebuffer 的内存宽度，缺省等于 width。用于配置双 buffer。</p>
</blockquote>
</li>
<li>
<p>height-virtual</p>
<blockquote>
<p>framebuffer 的内存高度，缺省等于 height。用于配置双 buffer。</p>
</blockquote>
</li>
<li>
<p>width</p>
<blockquote>
<p>display engine 图像输出宽度，缺省等于 panel 子节点 display-timings 中的 hactive 属性。</p>
<p>预留节点，为 display engine 的缩放功能预留，一般不需要配置。</p>
</blockquote>
</li>
<li>
<p>height</p>
<blockquote>
<p>display engine 图像输出高度，缺省等于 panel 子节点 display-timings 中的 vactive 属性。</p>
<p>预留节点，为 display engine 的缩放功能预留，一般不需要配置。</p>
</blockquote>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-调试指南">3. 调试指南<a href="#3-调试指南" class="hash-link" aria-label="3. 调试指南的直接链接" title="3. 调试指南的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-调试开关">3.1. 调试开关<a href="#31-调试开关" class="hash-link" aria-label="3.1. 调试开关的直接链接" title="3.1. 调试开关的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="311-de-调试开关">3.1.1. DE 调试开关<a href="#311-de-调试开关" class="hash-link" aria-label="3.1.1. DE 调试开关的直接链接" title="3.1.1. DE 调试开关的直接  链接">​</a></h4>
<p>在 luban 根目录下执行 make kernel-menuconfig，进入 kernel 的功能配置，打开 DE 模块的 DEBUG 选项：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Kernel hacking</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Artinchip Debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            [*] DE driver debug</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此 DEBUG 选项打开的影响：</p>
<ol>
<li>DE 驱动以-O0编译</li>
<li>DE 驱动的 pr_dbg()和 dev_dbg()调试信息会被编译</li>
</ol>
<p>在系统运行时，如果要打印 pr_dbg() 和 dev_dbg() 信息，还需要调整 loglevel 为8，两个方法：</p>
<ol>
<li>在 board.dts 中修改 bootargs，增加 “loglevel=8”</li>
<li>在板子启动到 Linux shell 后，执行命令：</li>
</ol>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo 8 &gt; /proc/sys/kernel/printk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>小技巧</p>
<p>如无特殊说明，本文档中的 DE 驱动表示显示模块的驱动，包含显示引擎模块，显示接口模块，LCD 的 panel 驱动。并非仅仅指示显示引擎。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="312-cma-调试开关">3.1.2. CMA 调试开关<a href="#312-cma-调试开关" class="hash-link" aria-label="3.1.2. CMA 调试开关的直接链接" title="3.1.2. CMA 调试开关的直接链接">​</a></h4>
<p>在 luban 根目录下执行 make kernel-menuconfig，进入 kernel 的功能配置，打开 CMA 框架的 DEBUG 选项：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Memory Management options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         [*]   CMA debug messages (DEVELOPMENT)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         [*]   CMA debugfs interface</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这两个 DEBUG 选项打开的影响：</p>
<ol>
<li>CMA 框架中 pr_debug() 调试信息会被编译</li>
<li>debugfs 中添加 cma 结点</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-component">3.2. Component<a href="#32-component" class="hash-link" aria-label="3.2. Component的直接链接" title="3.2. Component的直接链接">​</a></h3>
<p>查看Component的注册信息，</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># mount -t debugfs none /sys/kernel/debug/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/device_component/soc\:display-fb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master name                                            status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soc:display-fb                                          bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">device name                                            status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">98a00000.de                                             bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">98800000.rgb                                            bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">panel0                                                  bound</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果 bound 失败，控制台输出如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/device_component/soc\:display-fb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">master name                                            status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">soc:display-fb                                      not bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">device name                                            status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18a00000.de                                         not bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18800000.rgb                                        not bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(unknown)                                      not registered</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-cma">3.3. CMA<a href="#33-cma" class="hash-link" aria-label="3.3. CMA的直接链接" title="3.3. CMA的直接链接">​</a></h3>
<p>在 menuconfig 配置中使能 CMA debug 开关后，可通过 debugfs 调试 CMA。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># mount -t debugfs none /sys/kernel/debug/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ls /sys/kernel/debug/cma/cma-reserved/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">alloc          bitmap         free           order_per_bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">base_pfn       count          maxchunk       used</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>CMA 调试接口：</p>
<ul>
<li>
<p><strong>alloc</strong></p>
<blockquote>
<p>申请 cma 内存，以 page 为单位</p>
</blockquote>
</li>
<li>
<p><strong>free</strong></p>
<blockquote>
<p>释放 cma 内存，以 page 为单位</p>
</blockquote>
</li>
<li>
<p><strong>base_pfn</strong></p>
<blockquote>
<p>cma 内存起始页框号</p>
</blockquote>
</li>
<li>
<p><strong>count</strong></p>
<blockquote>
<p>cma 总 page 数</p>
</blockquote>
</li>
<li>
<p><strong>maxchunk</strong></p>
<blockquote>
<p>cma 最大连续 page 数</p>
</blockquote>
</li>
<li>
<p><strong>order_per_bit</strong></p>
<blockquote>
<p>每个 bit 代表 2 ^ order_per_bit 个 page</p>
</blockquote>
</li>
<li>
<p><strong>bitmap</strong></p>
<blockquote>
<p>记录 cma page 使用情况的位图。1 表示占用，0 表示空闲</p>
</blockquote>
</li>
</ul>
<p>查看 cma 使用情况：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/cma/cma-reserved/bitmap</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295 4294967295</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">4294967295 4294967295 2097151 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/cma/cma-reserved/count</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">8192</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/cma/cma-reserved/used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">1525</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/cma/cma-reserved/base_pfn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">548864</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/kernel/debug/cma/cma-reserved/order_per_bit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>手动申请 100 个 page</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># echo 100 &gt;  /sys/kernel/debug/cma/cma-reserved/alloc</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>手动释放 100 个 page</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># echo 100 &gt;  /sys/kernel/debug/cma/cma-reserved/free</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>sysfs 的 meminfo 结点亦可查看 CMA 的使用情况（为节省篇幅，已省略无关信息）：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat /proc/meminfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CmaTotal:          32768 kB</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    CmaFree:           29068 kB</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>小技巧</p>
<p>CmaFree 中记录的信息并不准确，推荐使用 debugfs 中 cma 节点的 bitmap 来查看 cma page 的使用情况。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-dma-buf">3.4. DMA-BUF<a href="#34-dma-buf" class="hash-link" aria-label="3.4. DMA-BUF的直接链接" title="3.4. DMA-BUF的直接链接">​</a></h3>
<p>在 debugfs 中查看当前 DMA-BUF 的使用情况：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mount -t debugfs none /sys/kernel/debug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cat /sys/kernel/debug/dma_buf/bufinfo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf-17066878792223.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf.png" class="img_ev3q"></p>
<p>小技巧</p>
<p>Component, CMA，DMA-BUF 相关概念在后续设计说明章节会有补充介绍。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-devfb">3.5. /dev/fb<a href="#35-devfb" class="hash-link" aria-label="3.5. /dev/fb的直接链接" title="3.5. /dev/fb的直接链接">​</a></h3>
<p>在 sysfs 中查看 /dev/fb 的一些信息：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># ls /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/ -l</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 bits_per_pixel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 blank</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 cursor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-r--r--r--    1 root     root          4096 Jan  1 00:01 dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx    1 root     root             0 Jan  1 00:01 device -&gt; ../../../soc:display-fb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 modes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-r--r--r--    1 root     root          4096 Jan  1 00:01 name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 pan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 rotate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-r--r--r--    1 root     root          4096 Jan  1 00:01 stride</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lrwxrwxrwx    1 root     root             0 Jan  1 00:01 subsystem -&gt; ../../../../../../class/graphics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 uevent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-rw-r--r--    1 root     root          4096 Jan  1 00:01 virtual_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/bits_per_pixel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/blank</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/console</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">29:0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/pan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">0,0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aicfb0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/stride</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3200</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/soc\:display-fb/graphics/fb0/virtual_size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">800,480</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="36-display-engine">3.6. Display Engine<a href="#36-display-engine" class="hash-link" aria-label="3.6. Display Engine的直接链接" title="3.6. Display Engine的直接链接">​</a></h3>
<p>在 sysfs 中查看当前 display engine 的一些信息：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cat /sys/devices/platform/soc/18a00000.de/debug/display</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Video Layer Enable       : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Video Layer Format       : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Video Layer Input Size   : 0 x 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Video Layer Stride       : 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Scaler Output Size       : 0 x 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Layer Control         : format: 0, color key: 0, alpha: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Layer Input Size      : 1024 x 600</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Layer Color Key       : 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Layer Alpha           : mode: 0, g_alpha: 255</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Rectangle Control     : 1 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Rectangle Size        : (1024, 600) (0, 0) (0, 0) (0, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Rectangle Offset      : (0, 0) (0, 0) (0, 0) (0, 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">UI Rectangle Stride      : 4096 0 0 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tearing-effect           : TE mode: 0, TE pulse width: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Display Dither           : dither_en: 0, red depth: 0, green depth: 0, blue depth: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Display Timing           : hactive: 1024, vactive: 600 hfp: 160 hbp: 140 vfp: 20 vbp: 12 hsync: 20 vsync: 3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Display Pixelclock       : 60000000 HZ</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>小技巧</p>
<p>UI Layer Control 中的 color key 和 alpha 表示 enable / disable 状态。 UI Layer Color Key 才表示 color value。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="37-color-bar">3.7. Color bar<a href="#37-color-bar" class="hash-link" aria-label="3.7. Color bar的直接链接" title="3.7. Color bar的直接链接">​</a></h3>
<p>在 sysfs 中使用 display engine 的 color bar 模式进行调试</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// 开启 color bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># echo 1 &gt;  /sys/devices/platform/soc/18a00000.de/debug/color_bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 关闭 color bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># echo 0 &gt;  /sys/devices/platform/soc/18a00000.de/debug/color_bar</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="38-framebuffer-截图">3.8. Framebuffer 截图<a href="#38-framebuffer-截图" class="hash-link" aria-label="3.8. Framebuffer 截图的直接链接" title="3.8. Framebuffer 截图的直接链接">​</a></h3>
<p>拷贝 /dev/fb0 裸数据，使用 RawViewer 查看</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># cp /dev/fb0 fb0.bgra</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>使用ADB pull <code>fb0.bgra</code> 文件，在PC 上使用 RawViewer 软件查看。</p>
<p>RawViewer 软件可在其官网免费下载：<a href="http://www.filefriend.net/#RawViewer" target="_blank" rel="noopener noreferrer">http://www.filefriend.net/#RawViewer</a></p>
<p>小技巧</p>
<p>使用 RawViewer 查看 fb0.bgra 文件，需要手工设置数据源的宽高，在开启双 buffer 的场景下，要将高度 * 2。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="4-测试指南">4. 测试指南<a href="#4-测试指南" class="hash-link" aria-label="4. 测试指南的直接链接" title="4. 测试指南的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-测试环境">4.1. 测试环境<a href="#41-测试环境" class="hash-link" aria-label="4.1. 测试环境的直接链接" title="4.1. 测试环境的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="411-硬件">4.1.1. 硬件<a href="#411-硬件" class="hash-link" aria-label="4.1.1. 硬件的直接链接" title="4.1.1. 硬件的直接链接">​</a></h4>
<ul>
<li>开发板，或者D211的FPGA板</li>
<li>可转接LVDS的子板</li>
<li>LVDS屏幕，7寸TFT屏幕，驱动芯片EK79001+EK73215</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="412-软件">4.1.2. 软件<a href="#412-软件" class="hash-link" aria-label="4.1.2. 软件的直接链接" title="4.1.2. 软件的直接链接">​</a></h4>
<ul>
<li>PC端的串口终端软件，用于PC和开发板进行串口通信</li>
<li>显示模块的测试demo：test_dmabuf</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="413-软件配置">4.1.3. 软件配置<a href="#413-软件配置" class="hash-link" aria-label="4.1.3. 软件配置的直接链接" title="4.1.3. 软件配置的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4131-配置-lvds屏幕">4.1.3.1. 配置 LVDS屏幕<a href="#4131-配置-lvds屏幕" class="hash-link" aria-label="4.1.3.1. 配置 LVDS屏幕的直接链接" title="4.1.3.1. 配置 LVDS屏幕的直接链接">​</a></h5>
<p>测试中需要用到LVDS屏幕，以驱动芯片EK79001+EK73215为例，在 luban 的根目录下通过make kernel-menuconfig，按如下选择：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Linux</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Device Drivers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Graphics support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Frame buffer Devices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &lt;*&gt; Artinchip Framebuffer support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    [*]   Artinchip display lvds support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        &lt;*&gt; Artinchip Framebuffer support</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            Artinchip Panel Drivers (Artinchip general LVDS panel)  ---&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在board.dts中，修改 LVDS 相关配置。</p>
<ul>
<li>panel</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">panel_lvds {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    compatible = &quot;artinchip,aic-general-lvds-panel&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enable-gpios = &lt;&amp;gpio_a 4 GPIO_ACTIVE_HIGH&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-mapping = &quot;vesa-24&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data-channel = &quot;single-link0&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        panel_lvds_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;lvds0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    display-timings {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        native-mode = &lt;&amp;timing1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        timing1: 1024x600 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            clock-frequency = &lt;60000000&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hactive = &lt;1024&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vactive = &lt;600&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hback-porch = &lt;140&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hfront-porch = &lt;160&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hsync-len = &lt;20&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vback-porch = &lt;20&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vfront-porch = &lt;12&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vsync-len = &lt;3&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            de-active = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            pixelclk-active = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4132-display-engine">4.1.3.2. display engine<a href="#4132-display-engine" class="hash-link" aria-label="4.1.3.2. display engine的直接链接" title="4.1.3.2. display engine的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;de0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        de0_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;fb0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        de0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;lvds0_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4133-lvds-display-interface">4.1.3.3. lvds display interface<a href="#4133-lvds-display-interface" class="hash-link" aria-label="4.1.3.3. lvds display interface的直接链接" title="4.1.3.3. lvds display interface的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&amp;lvds0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-names = &quot;default&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pinctrl-0 = &lt;&amp;lvds0_pins&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@0 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;0&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lvds0_in: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;de0_out&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    port@1 {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reg = &lt;1&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lvds0_out: endpoint {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            remote-endpoint = &lt;&amp;panel_lvds_in&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="4134-test_dmabuf-配置">4.1.3.4. test_dmabuf 配置<a href="#4134-test_dmabuf-配置" class="hash-link" aria-label="4.1.3.4. test_dmabuf 配置的直接链接" title="4.1.3.4. test_dmabuf 配置的直接链接">​</a></h5>
<p>在luban 根目录，运行<code>make menuconfig</code>，按如下选择：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Artinchip packages</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Sample code</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [*] test-dma-buf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-test_dmabuf-测试">4.2. test_dmabuf 测试<a href="#42-test_dmabuf-测试" class="hash-link" aria-label="4.2. test_dmabuf 测试的直接链接" title="4.2. test_dmabuf 测试的直接链接">​</a></h3>
<p>test_dmabuf的主要功能是测试显示引擎UI图层和Videv图层blend，在Video图层播放一个视频帧文件</p>
<p>在打开test_dmabuf的编译后，板子上的test_dmabuf位于 <code>/usr/local/bin/</code>，无需进入该目录，直接运行test_dmabuf即可：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # test_dmabuf -u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Usage: test_dmabuf [options]:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -w, --width    need an integer argument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -h, --height   need an integer argument</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -f, --format   video format, yuv420p etc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -i, --input    need a file name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     -u, --usage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example: test_dmabuf -w 480 -h 320 -f yuv420p -i my.yuv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[aic@] # test_dmabuf -w 480 -h 320 -f yuv420p -i my.yuv  - 播放一个yuv420格式的文件</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="5-设计说明">5. 设计说明<a href="#5-设计说明" class="hash-link" aria-label="5. 设计说明的直接链接" title="5. 设计说明的直接链接">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-源码和文档说明">5.1. 源码和文档说明<a href="#51-源码和文档说明" class="hash-link" aria-label="5.1. 源码和文档说明的直接链接" title="5.1. 源码和文档说明的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="511-源码说明">5.1.1. 源码说明<a href="#511-源码说明" class="hash-link" aria-label="5.1.1. 源码说明的直接链接" title="5.1.1. 源码说明的直接链接">​</a></h4>
<p>本模块源代码在内核目录 linux-5.10/drivers/video/artinchip/disp 下，目录结构如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">├── aic_com.h       // 显示驱动共用的头文件，其中定义了寄存器、共用数据结构、全局函数等</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── aic_fb.c    // 对接 fbdev 框架，并进行扩展</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── aic_de.c    // 显示引擎驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── aic_dsi.c   // mipi-dsi 显示接口驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── aic_lvds.c  // lvds 显示接口驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── aic_rgb.c   // rgb 显示接口驱动</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── hw/         // 显示引擎和显示接口的寄存器封装</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── panel/      // 屏驱动</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="512-文档说明">5.1.2. 文档说明<a href="#512-文档说明" class="hash-link" aria-label="5.1.2. 文档说明的直接链接" title="5.1.2. 文档说明的直接链接">​</a></h4>
<p>关于本模块的device tree bindings文档，可查看</p>
<p>/Documentation/devicetree/bindings/display/</p>
<p>/Documentation/devicetree/bindings/display/panel/</p>
<p>目录下的txt文件。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-模块架构">5.2. 模块架构<a href="#52-模块架构" class="hash-link" aria-label="5.2. 模块架构的直接链接" title="5.2. 模块架构的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="521-fbdev框架">5.2.1. fbdev框架<a href="#521-fbdev框架" class="hash-link" aria-label="5.2.1. fbdev框架的直接链接" title="5.2.1. fbdev框架的直接链接">​</a></h4>
<p>ArtInChip 平台的显示模块驱动基于 fbdev 框架。</p>
<p>关于 fbdev 架构的文档：</p>
<p>可查看Documentation/fb/framebuffer.txt 或在线阅读 <a href="https:/www.kernel.org/doc/Documentation/fb/framebuffer.txt/" target="_blank" rel="noopener noreferrer">https:/www.kernel.org/doc/Documentation/fb/framebuffer.txt</a></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="522-componet框架">5.2.2. Componet框架<a href="#522-componet框架" class="hash-link" aria-label="5.2.2. Componet框架的直接链接" title="5.2.2. Componet框架的直接链接">​</a></h4>
<p>框架代码：linux-5.10/drivers/base/component.c</p>
<p>Linux 引入 Componet 框架是为了 Subsystems 能按照一定的顺序初始化设备。Subsystems，例如：ALSA, DRM，整个框架包含较多子设备模块，但内核加载每个子模块的时间不定，因此需要 Componet 框架进行约束。</p>
<p>Component 框架通过 dts 将所有子设备关联到一个主设备上，主设备会管理子设备的加载顺序，保证所有设备正常使用。</p>
<p>在 dts 文件中，显示引擎、显示接口、panel、fb0 通过 port 结点进行关联，其中 fb0 为主设备。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-关键流程设计">5.3. 关键流程设计<a href="#53-关键流程设计" class="hash-link" aria-label="5.3. 关键流程设计的直接链接" title="5.3. 关键流程设计的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="531-初始化流程">5.3.1. 初始化流程<a href="#531-初始化流程" class="hash-link" aria-label="5.3.1. 初始化流程的直接链接" title="5.3.1. 初始化流程的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5311-probe和bind过程">5.3.1.1. probe和bind过程<a href="#5311-probe和bind过程" class="hash-link" aria-label="5.3.1.1. probe和bind过程的直接链接" title="5.3.1.1. probe和bind过程的直接链接">​</a></h5>
<p>为了约束初始化顺序，AICFB 为 component 的 master 设备，DE、DI 和 panel 为 slave 设备，component  框架保证 master 的初始化顺序在所有 slave 之后。各模块的初始化顺序如下：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/driver_bind-17066881502075.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/driver_bind.png" class="img_ev3q"></p>
<p>图 6.22 <em>显示模块的初始化顺序</em></p>
<p>其中：</p>
<ol>
<li>master 调用 component_match_add() 接口声明一个 match 队列。</li>
<li>master 调用 component_master_add_with_match() 将自己注册进 component 框架。</li>
<li>slave 调用 component_add()完成 slave 注册。</li>
<li>各模块的 probe 顺序没有约束，设备的注册和声明在 probe 函数中进行。</li>
<li>每个子设备都要实现自己的 bind() 和 unbind() 接口（struct component_ops），当 match 队列中的模块都完成 probe 后，component 框架会调用模块的 bind() 接口。</li>
<li>各 slave 按 match 队列顺序执行 bind()，Component 框架保证 master 最后执行。</li>
<li>aicfb-&gt;bind() 主要完成 framebuffer 申请、fb 设备注册、使能 UI 图层、使能 panel 等动作。</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5312-硬件时序要求">5.3.1.2. 硬件时序要求<a href="#id2">¶</a><a href="#5312-硬件时序要求" class="hash-link" aria-label="5312-硬件时序要求的直接链接" title="5312-硬件时序要求的直接链接">​</a></h5>
<p>DE、DI、panel 三个硬件模块在初始化时有一些时序要求，包含先后顺序、延迟大小，主要约束来自于 panel 侧。 为了应对这样的硬件特性，驱动设计中使用 callback 方式来实现多个模块间的互相调用。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/callbacks1-17066882134577.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/callbacks1.png" class="img_ev3q"></p>
<p>在fb的bind()中，会调用这些回调来完成初始化，如下图（其中关系  比较绕的是 panel 初始化逻辑）：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/fb_bind1-17066882208049.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/fb_bind1.png" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="532-预留内存管理流程">5.3.2. 预留内存管理流程<a href="#532-预留内存管理流程" class="hash-link" aria-label="5.3.2. 预留内存管理流程的直接链接" title="5.3.2. 预留内存管理流程的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5321-cma">5.3.2.1. CMA<a href="#5321-cma" class="hash-link" aria-label="5.3.2.1. CMA的直接链接" title="5.3.2.1. CMA的直接链接">​</a></h5>
<p>Linux-3.5 引入了一套 Contiguous Memory Allocator，简称 CMA，基于 DMA 映射框架为内核提供连续大块内存的申请和释放。CMA 主要思路是将预留内存纳入 DMA 映射管理，可以给系统内所有设备共享使用，这样就既解决了为 GPU、Camera、显示等图像处理类模块预留大块的连续内存，又解决了预留内存被空置的问题，提升内存使用率。</p>
<p>CMA 本身不是一套分配内存的算法，它的底层仍然要依赖伙伴算法系统来支持，可以理解为 CMA 是介于 DMA mapping 和内存管理之间的中间层。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/cma-170668824010611.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/cma.png" class="img_ev3q"></p>
<p>CMA的具体功能有：</p>
<ol>
<li>在系统的启动过程中，根据内核编译配置、或者 DTS 配置将内存中某块区域用于 CMA，然后内核中其他模块可以通过 DMA 的接口 API 申请连续内存，这块区域我们称之为 CMA area。</li>
<li>提供 cma_alloc()和 cma_release()两个接口函数用于分配和释放 CMA pages。</li>
<li>记录和跟踪 CMA area 中各个 pages 的状态。</li>
<li>调用伙伴系  统接口，进行真正的内存分配。</li>
</ol>
<p><strong>CMA 主要接口</strong></p>
<ol>
<li>
<p>CNA area 的声明</p>
<blockquote>
<p>setup_bootmem() -&gt; dma_contiguous_reserve()，定义在 kernel/dma/contiguous.c，其中有确定 CMA area size 的代码如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#ifdef CONFIG_CMA_SIZE_SEL_MBYTES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       selected_size = size_bytes;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#elif defined(CONFIG_CMA_SIZE_SEL_PERCENTAGE)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       selected_size = cma_early_percent_memory();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#elif defined(CONFIG_CMA_SIZE_SEL_MIN)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       selected_size = min(size_bytes, cma_early_percent_memory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#elif defined(CONFIG_CMA_SIZE_SEL_MAX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       selected_size = max(size_bytes, cma_early_percent_memory());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#endif</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>然后会调用 dma_contiguous_reserve_area() -&gt; cma_declare_contiguous() 去初始化 CMA 的配置参数。</p>
</blockquote>
</li>
</ol>
<p>小技巧</p>
<p>计算 CMA 内存大小的过程中，size_bytes 来源于内核编译配置中 CONFIG_CMA_SIZE_MBYTES，通过计算将 size 限定在 4MB 对齐。 参考 <a href="/docs/D213-DevKit/02_config_guide/menuconfig/index.html#ref-to-cma-config">CMA配置</a> 进行设置。</p>
<ol>
<li>
<p>CMA 初始化</p>
<blockquote>
<p>见 mm/cma.c 中的 cma_init_reserved_areas() -&gt; init_cma_reserved_pageblock()，其中会设置 page 属性为 MIGRATE_CMA。</p>
</blockquote>
</li>
<li>
<p>申请 CMA</p>
<blockquote>
<p>使用 DMA 标准接口 dma_alloc_coherent() 和 dma_alloc_wc()，会间接调用 dma_alloc_from_contiguous()。</p>
</blockquote>
</li>
<li>
<p>释放 CMA</p>
<blockquote>
<p>使用 DMA 标准接口 dma_free_coherent()。</p>
</blockquote>
</li>
</ol>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5322-dma-buf">5.3.2.2. DMA-BUF<a href="#5322-dma-buf" class="hash-link" aria-label="5.3.2.2. DMA-BUF的直接链接" title="5.3.2.2. DMA-BUF的直接链接">​</a></h5>
<p>CMA 解决的是预留内存空闲期间如何给其他设备共享的问题，DMA-BUF 解决的是使用期间多个设备共享的问题、以及内核态和用户态如何共享内存的问题。DMA-BUF 可减少多余的拷贝，提升系统运行效率。</p>
<p>DMA-BUF 最初原型是s hrbuf，于 2011 年首次提出，实现了 “Buffer Sharing” 的概念验证。shrbuf 被社区重构变身为 DMA-BUF，2012年合入 Linux-3.3 主线版本。</p>
<p>DMA-BUF 被广泛用在多媒体驱动中，尤其在 V4L2、DRM 子系统中经常用到。</p>
<p><strong>DMA-BUF vs ION</strong></p>
<p>从 Linux-5.6 开始，DMA-BUF 正式合入了原来 ION 的 heap 管理功能，社区的主分支是打算抛弃 ION 了。在Linux-5.11，主分支已经删除了 drivers/staging/android/ion 代码，原因是“原厂对ION的支持在社区中不太活跃，很难持续更新ION”，而且ION还带来了几个ABI break。</p>
<ol>
<li>ION 有大量的 heap 逻辑管理，而 DMA-BUF 的 heap 更多是分配接口上的管理（社区更容易接受）；</li>
<li>ION 是生产一个字符设备 /dev/ion，而 DMA-BUF 为每个 heap 生成一个字符设备，便于用户态的heap区分和权限管理；</li>
<li>ION 限制最多32个 heap，DMA-BUF 没有这个限制；</li>
<li>DMA-BUF中实现了两个初始的 heap：system heap 和 cma heap，与原 ION 中的功能类似，但做了很大简化（为了方便社区 review），删掉原来 ION 中针对 system、cma 做过的一些优化，涉及 uncached buffers、large page allocation、page pooling和deferred freeing。 DMA-BUF 中的 CMA，只添加了default CMA 区域。原 ION 中的 CMA 是添加了所有 DMA 区域。</li>
</ol>
<p><strong>工作机制</strong></p>
<p>为了解决各个驱动之间的 buffer 共享问题，DMA-BUF 将 buffer 与 file 结合使用，让 DMA-BUF 既是一块物理 buffer，同时也是个 Linux 标准 file。典型的应用框图如下：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf1-170668827127813.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf1.png" class="img_ev3q"></p>
<p>分配 buffer 的模块为 exporter，使用该 buffer 的模块为 importer。</p>
<p>DMA-BUF 支持连续物理内存、散列物理内存的 buffer 管理。ArtInChip 平台目前只支持连续物理内存的 DMA-BUF。</p>
<p><strong>主要接口</strong></p>
<p>内核空间</p>
<blockquote>
<ul>
<li>
<p>作为 exporter</p>
<p>注册接口 <code>dma_buf_export()</code></p>
</li>
<li>
<p>作为 importer</p>
<p>获取buf的接口：<code>dma_buf_get</code>,<code>dma_buf_attach()</code>,<code>dma_buf_map_attachment</code>。</p>
</li>
</ul>
</blockquote>
<p>用户空间</p>
<blockquote>
<p>通过 ioctl 来管理 DMA-BUF。</p>
</blockquote>
<p><strong>基于 DMA-BUF 的 Video Layer buffer 管理</strong></p>
<p>UI Layer的 buffer，由 driver 申请，通过 /dev/fb0 透传到用户态，用户态使用 mmap() 实现 buffer 共享。</p>
<p>但对于 Video Layer 的 buffer，情况有所不同，申请多大 buffer、多少个 buffer 都是由应用场景确定，所以应该是用户态发起申请。同时这个 buffer 还要满足物理连续的特性，DE 硬件才能用来做图层叠加处理。</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_heap-170668828133515.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_heap.png" class="img_ev3q"></p>
<p>左图，是 ION 时代的使用方法，新版 Linux（Linux-5.6以后）的 DMA-BUF 已经支持了 heap 功能，从功能上完全可以替代 ION。对用户态来说，看到的差别不再是单一的 /dev/ion 设备节点，而是有多个 /dev/* 设备节点，比如 CMA heap 会生成 /dev/dma_heap/reserved，System heap 会生成 /dev/dma_heap/system。</p>
<p>使用 DMA-BUF 的情况下，APP 和 fb 驱动共享 buffer 的初始化流程如下图所示：</p>
<p><img loading="lazy" src="https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_app-170668828975517.png" alt="../../../../_https://photos.100ask.net/artinchip-docs/d213-devkit/dma_buf_app.png" class="img_ev3q"></p>
<p>其中第3步的操作比较啰嗦，fb 驱动根据 APP 传来的一组fd[]，逐个去向 DMA-BUF 模块申请以下资源：dma_buf -&gt; attatch -&gt; sg_table -&gt; dma_addr_t，并将这组资源保存在本地（struct aic_de_dmabuf），用于释放 DMA-BUF。</p>
<p>这里面有一个假设：sg_table 中只有一个 sg。也就是说单个 DMA-BUF 必须是物 理连续的，不能是多块 buf 拼起来的，否则物理地址 dma_addr_t 就不能代表多块 buf 的起始地址。</p>
<p>对于释放过程，APP需要先通知FB驱动要释放的fb[]，然后再使用用户态文件接口close()逐个关闭fb[]。</p>
<p>小技巧</p>
<p>之所以申请“一组fd[]”，是因为video播放过程中为了边显示边解码，至少需要两套 Buffer 来实现乒乓效果（实际应用中为了更流畅，可能还需要申请多套 Buffer 构成循环 Buffer）。这里说的“一套Buffer”对应视频的一帧数据，而一帧视频数据往往分成YUV三个分量，每个分量在解码过程中是需要分别处理（对应DE寄存器中addr0、addr1、addr2），所以“一套Buffer”应该是 Y、U、V 共3个Buffer。对于乒乓结构的 Buffer，就需要申请 3*2=6 个DMA-BUF的fd。</p>
<p>UI Layer 的 buffer 申请，是直接调用通用 DMA 接口 <code>dma_alloc_coherent()</code>，最终在 CMA 内存中分配。这样并不影响 Video Layer的 buffer 走 DMA-BUF 申请，CMA 模块内部会处理好来自各种接口的 Buffer 申请。</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="533-backlight">5.3.3. Backlight<a href="#533-backlight" class="hash-link" aria-label="5.3.3. Backlight的直接链接" title="5.3.3. Backlight的直接链接">​</a></h5>
<p>Backlight 使用内核中 pwm-backlight 背光驱动，代码见 linux-5.10driversvideobacklightpwm_bl.c。</p>
<p>panel 驱动可以通过 DTS 获取背光驱动的 device node , 然后 backlight API 控制背光。</p>
<ul>
<li>backlight_enable() 使能背光</li>
<li>backlight_update_status() 对背光状态进行更新</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">backlight {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   compatible = &quot;pwm-backlight&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   /* pwm node name; pwm device No.; period_ns; pwm_polarity */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   pwms = &lt;&amp;pwm 0 1000000 PWM_POLARITY_INVERTED&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   brightness-levels = &lt;0 10 20 30 40 50 60 70 80 90 100&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   default-brightness-level = &lt;8&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   status = &quot;okay&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">panel_rgb {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   compatible = &quot;artinchip,aic-general-rgb-panel&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   backlight = &lt;&amp;backlight&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};  // 为节省篇幅，已省略无关配置</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>应用程序对背光进行操作：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo 2 &gt; /sys/class/backlight/backlight/brightness</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-数据结构设计">5.4. 数据结构设计<a href="#54-数据结构设计" class="hash-link" aria-label="5.4. 数据结构设计的直接链接" title="5.4. 数据结构设计的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="541-uapivideoartinchip_videoh">5.4.1. uapi/video/artinchip_video.h<a href="#541-uapivideoartinchip_videoh" class="hash-link" aria-label="5.4.1. uapi/video/artinchip_video.h的直接链接" title="5.4.1. uapi/video/artinchip_video.h的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5411-struct-aic_rect">5.4.1.1. struct aic_rect<a href="#5411-struct-aic_rect" class="hash-link" aria-label="5.4.1.1. struct aic_rect的直接链接" title="5.4.1.1. struct aic_rect的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_rect {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int width;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5412-struct-aic_point">5.4.1.2. struct aic_point<a href="#5412-struct-aic_point" class="hash-link" aria-label="5.4.1.2. struct aic_point的直接链接" title="5.4.1.2. struct aic_point的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_point {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5413-struct-aic_size">5.4.1.3. struct aic_size<a href="#5413-struct-aic_size" class="hash-link" aria-label="5.4.1.3. struct aic_size的直接链接" title="5.4.1.3. struct aic_size的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">struct aic_size {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int width;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5414-enum-aic_pixel_format">5.4.1.4. enum aic_pixel_format<a href="#5414-enum-aic_pixel_format" class="hash-link" aria-label="5.4.1.4. enum aic_pixel_format的直接链接" title="5.4.1.4. enum aic_pixel_format的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum aic_pixel_format {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_ARGB_8888            = 0x00,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_ABGR_8888            = 0x01,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_RGBA_8888            = 0x02,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_BGRA_8888            = 0x03,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_XRGB_8888            = 0x04,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_XBGR_8888            = 0x05,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_RGBX_8888            = 0x06,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_BGRX_8888            = 0x07,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_RGB_888              = 0x08,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_BGR_888              = 0x09,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_ARGB_1555            = 0x0a,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_ABGR_1555            = 0x0b,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_RGBA_5551            = 0x0c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_BGRA_5551            = 0x0d,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_RGB_565              = 0x0e,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_BGR_565              = 0x0f,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_ARGB_4444            = 0x10,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_ABGR_4444            = 0x11,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_RGBA_4444            = 0x12,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_BGRA_4444            = 0x13,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV420P              = 0x20,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_NV12                 = 0x21,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_NV21                 = 0x22,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV422P              = 0x23,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_NV16                 = 0x24,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_NV61                 = 0x25,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUYV                 = 0x26,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YVYU                 = 0x27,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_UYVY                 = 0x28,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_VYUY                 = 0x29,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV400               = 0x2a,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV444P              = 0x2b,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV420_64x32_TILE    = 0x30,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV420_128x16_TILE   = 0x31,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV422_64x32_TILE    = 0x32,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_YUV422_128x16_TILE   = 0x33,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    AIC_FMT_MAX,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="542-uapivideoartinchip_fbh">5.4.2. uapi/video/artinchip_fb.h<a href="#542-uapivideoartinchip_fbh" class="hash-link" aria-label="5.4.2. uapi/video/artinchip_fb.h的直接链接" title="5.4.2. uapi/video/artinchip_fb.h的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5421-struct-aicfb_layer_num">5.4.2.1. struct aicfb_layer_num<a href="#5421-struct-aicfb_layer_num" class="hash-link" aria-label="5.4.2.1. struct aicfb_layer_num的直接链接" title="5.4.2.1. struct aicfb_layer_num的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_layer_num - aicfb layer number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @vi_num: number of video layers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @ui_num: number of UI layers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  total_layer_num = vi_num + ui_num</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  layer id range: [0, total_layer_num - 1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_layer_num {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int vi_num;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int ui_num;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5422-struct-aicfb_layer_capability">5.4.2.2. struct aicfb_layer_capability<a href="#5422-struct-aicfb_layer_capability" class="hash-link" aria-label="5.4.2.2. struct aicfb_layer_capability的直接链接" title="5.4.2.2. struct aicfb_layer_capability的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_layer_capability - aicfb layer capability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @layer_id: the layer id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @layer_type: the layer type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  0: UI layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  1: Video layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @max_width:  the max pixels per line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @max_height: the max lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @cap_flags:  flags of layer capability</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_layer_capability {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int layer_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int layer_type;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int max_width;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int max_height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int cap_flags;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5423-struct-aicfb_buffer">5.4.2.3. struct aicfb_buffer<a href="#5423-struct-aicfb_buffer" class="hash-link" aria-label="5.4.2.3. struct aicfb_buffer的直接链接" title="5.4.2.3. struct aicfb_buffer的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_buffer - aicfb frame buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @phy_addr[3]: address of frame buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  single addr for interleaved fomart with 1 plane,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  double addr for semi-planar fomart with 2 planes,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  triple addr for planar format with 3 planes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @size: width and height of aicfb_buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @stride[3]: stride for all planes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @crop_en: corp disable/enable ctrl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  0: disable crop the buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  1: enable crop the buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @crop: crop info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @format: color format</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @buf_flags: aicfb buffer flags</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_buffer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            phy_addr[AICFB_PLANE_NUM];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            dmabuf_fd[AICFB_PLANE_NUM];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            stride[AICFB_PLANE_NUM];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_size         size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            crop_en;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_rect         crop;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enum aic_pixel_format   format;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int            buf_flags;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5424-struct-aicfb_layer_data">5.4.2.4. struct aicfb_layer_data<a href="#5424-struct-aicfb_layer_data" class="hash-link" aria-label="5.4.2.4. struct aicfb_layer_data的直接链接" title="5.4.2.4. struct aicfb_layer_data的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_layer_data - aicfb layer data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  0: disable the layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  1: enable the layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @layer_id: the layer id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @rect_id: the rectanglular window id of the layer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  only used by layers with multi-rectangular windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  for example: if the layer has 4 rectangular windows,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  rect_id can be 0,1,2 or 3 for different windows</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @scale_size:  scaling size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  if the layer can be scaled. the scaling size can be different</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  from the input buffer. the input buffer can be original aicfb_buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  or crop aicfb_buffer, otherwise, the scaling size will be ignore</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @pos: left-top x/y coordinate of the screen in pixels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @buf: frame buffer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_layer_data {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int enable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int layer_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int rect_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_size scale_size;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_point pos;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_buffer buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5425-struct-aicfb_config_lists">5.4.2.5. struct aicfb_config_lists<a href="#5425-struct-aicfb_config_lists" class="hash-link" aria-label="5.4.2.5. struct aicfb_config_lists的直接链接" title="5.4.2.5. struct aicfb_config_lists的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_config_lists - aicfb config lists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @num: the total number of layer data config lists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @layers[]: the array of aicfb_layer_data lists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_config_lists {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int num;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_layer_data layers[];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5426-struct-aicfb_alpha_config">5.4.2.6. struct aicfb_alpha_config<a href="#5426-struct-aicfb_alpha_config" class="hash-link" aria-label="5.4.2.6. struct aicfb_alpha_config的直接链接" title="5.4.2.6. struct aicfb_alpha_config的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_alpha_config - aicfb layer alpha blending config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @layer_id: the layer id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  0: disable alpha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  1: enable alpha</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @mode: alpha mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  0: pixel alpha mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  1: global alpha mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  2: mixder alpha mode(alpha = pixel alpha * global alpha / 255)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @value: global alpha value (0~255)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  used by global alpha mode and mixer alpha mode</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_alpha_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int layer_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int enable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int mode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5427-struct-aicfb_ck_config">5.4.2.7. struct aicfb_ck_config<a href="#5427-struct-aicfb_ck_config" class="hash-link" aria-label="5.4.2.7. struct aicfb_ck_config的直接链接" title="5.4.2.7. struct aicfb_ck_config的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * struct aicfb_ck_config - aicfb layer color key blending config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @layer_id: the layer id</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @ck_enable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  0: disable color key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  1: enable color key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @ck_value: color key rgb value to match the layer pixels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  bit[31:24]: reserved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  bit[23:16]: R value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  bit[15:8]: G value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *  bit[7:0]: B value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_ck_config {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int layer_id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int enable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int value;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5428-struct-aicfb_dmabuf_fd">5.4.2.8. struct aicfb_dmabuf_fd<a href="#5428-struct-aicfb_dmabuf_fd" class="hash-link" aria-label="5.4.2.8. struct aicfb_dmabuf_fd的直接链接" title="5.4.2.8. struct aicfb_dmabuf_fd的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Transfer dma-buf fd from userspace to the importers in kernel.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @fd: the actual fd, requested by mmap() in userspace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @phy_addr: the physical address of the actual fd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_dmabuf_fd {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    unsigned int phy_addr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5429-ioctl命令">5.4.2.9. ioctl命令<a href="#5429-ioctl命令" class="hash-link" aria-label="5.4.2.9. ioctl命令的直接链接" title="5.4.2.9. ioctl命令的直接链接">​</a></h5>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#define IOC_TYPE_FB       &#x27;F&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_WAIT_FOR_VSYNC  _IOW(IOC_TYPE_FB, 0x20, unsigned int)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get layer number */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_LAYER_NUM  _IOR(IOC_TYPE_FB, 0x21, struct aicfb_layer_num)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get layer capability */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_LAYER_CAPABILITY  _IOWR(IOC_TYPE_FB, 0x22,\</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    struct aicfb_layer_capability)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get layer config data */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_LAYER_CONFIG  _IOWR(IOC_TYPE_FB, 0x23, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    struct aicfb_layer_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** update layer config data */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_UPDATE_LAYER_CONFIG  _IOW(IOC_TYPE_FB, 0x24, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    struct aicfb_layer_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** update layer config data lists */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_UPDATE_LAYER_CONFIG_LISTS  _IOW(IOC_TYPE_FB, 0x25, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        struct aicfb_config_lists)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get layer alpha blendig config */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_ALPHA_CONFIG  _IOWR(IOC_TYPE_FB, 0x26, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    struct aicfb_alpha_config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** update layer alpha blendig config */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_UPDATE_ALPHA_CONFIG  _IOW(IOC_TYPE_FB, 0x27, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    struct aicfb_alpha_config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get layer color key config */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_CK_CONFIG  _IOWR(IOC_TYPE_FB, 0x26, struct aicfb_ck_config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** update layer color key config */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_UPDATE_CK_CONFIG  _IOW(IOC_TYPE_FB, 0x27, struct aicfb_ck_config)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get screen size */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_SCREEN_SIZE  _IOR(IOC_TYPE_FB, 0x40, struct aic_size)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** get layer config data which the standard framebuffer is used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * call this API to get which layer the standard framebuffer is used.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_FB_LAYER_CONFIG  _IOR(IOC_TYPE_FB, 0x41, \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    struct aicfb_layer_data)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_GET_DMABUF _IOW(IOC_TYPE_FB, 0x50, struct aicfb_dmabuf_fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_PUT_DMABUF _IOW(IOC_TYPE_FB, 0x51, struct aicfb_dmabuf_fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/** export a dma_buf fd, associates /dev/fb0 */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_TO_DMABUF_FD _IOW(IOC_TYPE_FB, 0x52, struct aicfb_dmabuf_fd)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="55-接口设计">5.5. 接口设计<a href="#55-接口设计" class="hash-link" aria-label="5.5. 接口设计的直接链接" title="5.5. 接口设计的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="551-概述">5.5.1. 概述<a href="#551-概述" class="hash-link" aria-label="5.5.1. 概述的直接链接" title="5.5.1. 概述的直接链接">​</a></h4>
<p>AICFB 显示驱动接口分可为标准功能和扩展功能。</p>
<ul>
<li>标准功能：</li>
</ul>
<ol>
<li>将物理显存映射到用户空间</li>
<li>获取显示屏的分辨率和获取 Framebuffer 的像素格式</li>
<li>支持单缓冲 Framebuffer 和双缓冲 Framebuffer 可配置</li>
</ol>
<ul>
<li>扩展功能：</li>
</ul>
<ol>
<li>获取图层个数</li>
<li>获取图层能力</li>
<li>获取图层配置数据</li>
<li>更新图层配置数据</li>
<li>支持同时更新多图层配置数据</li>
<li>支持图层 scaler 设置</li>
<li>支持 alpha blending 设置</li>
<li>支持 color key</li>
<li>获取显示屏大小</li>
<li>绑定 DMA-BUF</li>
<li>解绑 DMA-BUF</li>
<li>将 /dev/fb0 导出为 dmabuf fd</li>
</ol>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="552-framebuffer标准接口">5.5.2. Framebuffer标准接口<a href="#552-framebuffer标准接口" class="hash-link" aria-label="5.5.2. Framebuffer标准接口的直接链接" title="5.5.2. Framebuffer标准接口的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int ioctl(int fd, unsigned long cmd, CMD_DATA_TYPE *cmddata);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>参数</th><th>描述</th><th>输入/输出</th></tr></thead><tbody><tr><td>Fd</td><td>打开FB设备后设备描述符</td><td>输入</td></tr><tr><td>cmd</td><td>主要的cmd命令如下：FBIOGET_VSCREENINFO：获取屏幕可变信息FBIOPUT_VSCREENINFO：设置屏幕可变信息FBIOGET_FSCREENINFO：获取屏幕固定信息FBIOPAN_DISPLAY：设置PAN 显示FBIO_WAITFORVSYNC: 等待vsync信号</td><td>输入</td></tr><tr><td>cmddata</td><td>各cmd 对应的数据类型分别是：屏幕可变信息：struct fb_var_screeninfo *类型屏幕固定信息：struct fb_fix_screeninfo *类型PAN显示：struct fb_var_screeninfo *类型</td><td>输入/输出</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="553-扩展接口">5.5.3. 扩展接口<a href="#553-扩展接口" class="hash-link" aria-label="5.5.3. 扩展接口的直接链接" title="5.5.3. 扩展接口的直接链接">​</a></h4>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5531-aicfb_wait_for_vsync">5.5.3.1. AICFB_WAIT_FOR_VSYNC<a href="#5531-aicfb_wait_for_vsync" class="hash-link" aria-label="5.5.3.1. AICFB_WAIT_FOR_VSYNC的直接链接" title="5.5.3.1. AICFB_WAIT_FOR_VSYNC的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, unsigned int *pvalue);</th></tr></thead><tbody><tr><td>功能说明</td><td>等待Vsync信号</td></tr><tr><td>参数定义</td><td>CMD: AICFB_WAIT_FOR_VSYNCpvalue:该值无意义，固定为NULL</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5532-aicfb_get_layer_num">5.5.3.2. AICFB_GET_LAYER_NUM<a href="#5532-aicfb_get_layer_num" class="hash-link" aria-label="5.5.3.2. AICFB_GET_LAYER_NUM的直接链接" title="5.5.3.2. AICFB_GET_LAYER_NUM的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_layer_num *pvalue);</th></tr></thead><tbody><tr><td>功能说明</td><td>获取显示图层的个数, 包括UI 图层个数和Video 图层</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_LAYER_NUMplayer_num: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-layer-num">struct aicfb_layer_num</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5533-aicfb_get_layer_capability">5.5.3.3. AICFB_GET_LAYER_CAPABILITY<a href="#5533-aicfb_get_layer_capability" class="hash-link" aria-label="5.5.3.3. AICFB_GET_LAYER_CAPABILITY的直接链接" title="5.5.3.3. AICFB_GET_LAYER_CAPABILITY的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_layer_capability *player_cap);</th></tr></thead><tbody><tr><td>功能说明</td><td>获取当前图层的能力</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_LAYER_CAPABILITYplayer_cap: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-layer-capability">struct aicfb_layer_capability</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>调用接口前要先填写结构体中的 layer_id</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5534-aicfb_get_layer_config">5.5.3.4. AICFB_GET_LAYER_CONFIG<a href="#5534-aicfb_get_layer_config" class="hash-link" aria-label="5.5.3.4. AICFB_GET_LAYER_CONFIG的直接链接" title="5.5.3.4. AICFB_GET_LAYER_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_layer_data *player_conf);</th></tr></thead><tbody><tr><td>功能说明</td><td>获取图层配置信息</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_LAYER_CONFIGplayer_conf: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-layer-data">struct aicfb_layer_data</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>调用接口前要先填写结构体中的layer_id，如果是多矩形窗口要同时填写rect_win_id</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5535-aicfb_update_layer_config">5.5.3.5. AICFB_UPDATE_LAYER_CONFIG<a href="#5535-aicfb_update_layer_config" class="hash-link" aria-label="5.5.3.5. AICFB_UPDATE_LAYER_CONFIG的直接链接" title="5.5.3.5. AICFB_UPDATE_LAYER_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_layer_data *player_conf)</th></tr></thead><tbody><tr><td>功能说明</td><td>更新图层配置信息</td></tr><tr><td>参数定义</td><td>CMD: AICFB_UPDATE_LAYER_CONFIGplayer_ocnf:参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-layer-data">struct aicfb_layer_data</a> 定义</td></tr><tr><td>返回值</td><td>0: 成功-1：失败</td></tr><tr><td>注意事项</td><td>如果是仅更新图层的部分config data 信息，可以先调用接口AICFB_GET_LAYER_CONFIG，获取当前图层信息，然后再修改要更新的图像信息，最后再调用此接口更新图层信息</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5536-aicfb_update_layer_config_lists">5.5.3.6. AICFB_UPDATE_LAYER_CONFIG_LISTS<a href="#5536-aicfb_update_layer_config_lists" class="hash-link" aria-label="5.5.3.6. AICFB_UPDATE_LAYER_CONFIG_LISTS的直接链接" title="5.5.3.6. AICFB_UPDATE_LAYER_CONFIG_LISTS的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_config_lists *player_lists);</th></tr></thead><tbody><tr><td>功能说明</td><td>更新图层配置数据列表</td></tr><tr><td>参数定义</td><td>CMD: AICFB_UPDATE_LAYER_CONFIG_LISTS aicfb_config_listsplayer_lists: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-config-lists">struct aicfb_config_lists</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>通过此接口可以同时更新多个图层或者多个窗口的配置信息通过此接口调用的好处是相关图层配置的更新可以同时生效</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5537-aicfb_get_alpha_config">5.5.3.7. AICFB_GET_ALPHA_CONFIG<a href="#5537-aicfb_get_alpha_config" class="hash-link" aria-label="5.5.3.7. AICFB_GET_ALPHA_CONFIG的直接链接" title="5.5.3.7. AICFB_GET_ALPHA_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_alpha_config *alpha);</th></tr></thead><tbody><tr><td>功能说明</td><td>获取当前图层的Alpha配置</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_ALPHA_CONFIGalpha: 参结考构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-alpha-config">struct aicfb_alpha_config</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5538-aicfb_update_alpha_config">5.5.3.8. AICFB_UPDATE_ALPHA_CONFIG<a href="#5538-aicfb_update_alpha_config" class="hash-link" aria-label="5.5.3.8. AICFB_UPDATE_ALPHA_CONFIG的直接链接" title="5.5.3.8. AICFB_UPDATE_ALPHA_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_alpha_config *alpha);</th></tr></thead><tbody><tr><td>功能说明</td><td>更新当前图层的Alpha配置</td></tr><tr><td>参数定义</td><td>CMD: AICFB_UPDATE_ALPHA_CONFIGalpha: 参结考构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-alpha-config">struct aicfb_alpha_config</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="5539-aicfb_get_ck_config">5.5.3.9. AICFB_GET_CK_CONFIG<a href="#5539-aicfb_get_ck_config" class="hash-link" aria-label="5.5.3.9. AICFB_GET_CK_CONFIG的直接链接" title="5.5.3.9. AICFB_GET_CK_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_ck_config *player_ck);</th></tr></thead><tbody><tr><td>功能说明</td><td>获取当前图层的CK配置</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_CK_CONFIGplayer_ck: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-ck-config">struct aicfb_ck_config</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：当前图层不支持 color key</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="55310-aicfb_update_ck_config">5.5.3.10. AICFB_UPDATE_CK_CONFIG<a href="#55310-aicfb_update_ck_config" class="hash-link" aria-label="5.5.3.10. AICFB_UPDATE_CK_CONFIG的直接链接" title="5.5.3.10. AICFB_UPDATE_CK_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_ck_config *player_ck);</th></tr></thead><tbody><tr><td>功能说明</td><td>更新当前图层的CK配置</td></tr><tr><td>参数定义</td><td>CMD: AICFB_SET_CK_CONFIGplayer_ck: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-ck-config">struct aicfb_ck_config</a> 定义</td></tr><tr><td>返回值</td><td>0： 成功-1：当前图层不支持 color key</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="55311-aicfb_get_screen_size">5.5.3.11. AICFB_GET_SCREEN_SIZE<a href="#55311-aicfb_get_screen_size" class="hash-link" aria-label="5.5.3.11. AICFB_GET_SCREEN_SIZE的直接链接" title="5.5.3.11. AICFB_GET_SCREEN_SIZE的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aic_size *pscreen_size);</th></tr></thead><tbody><tr><td>功能说明</td><td>更新当前图层的CK配置</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_SCREEN_SIZEpscreen_size: 结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aic-size">struct aic_size</a> 定义了屏幕的宽，高信息</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="55312-aicfb_get_fb_layer_config">5.5.3.12. AICFB_GET_FB_LAYER_CONFIG<a href="#55312-aicfb_get_fb_layer_config" class="hash-link" aria-label="5.5.3.12. AICFB_GET_FB_LAYER_CONFIG的直接链接" title="5.5.3.12. AICFB_GET_FB_LAYER_CONFIG的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_layer_data *player_conf);</th></tr></thead><tbody><tr><td>功能说明</td><td>获取标准framebuffer占用的图层信息</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_FB_LAYER_CONFIGplayer_conf: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-layer-data">struct aicfb_layer_data</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="55313-aicfb_get_dmabuf">5.5.3.13. AICFB_GET_DMABUF<a href="#55313-aicfb_get_dmabuf" class="hash-link" aria-label="5.5.3.13. AICFB_GET_DMABUF的直接链接" title="5.5.3.13. AICFB_GET_DMABUF的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_dmabuf_fd *fds);</th></tr></thead><tbody><tr><td>功能说明</td><td>通知 fb 驱动绑定 DMA-BUF</td></tr><tr><td>参数定义</td><td>CMD: AICFB_GET_DMABUFfds: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-dmabuf-fd">struct aicfb_dmabuf_fd</a> 定义</td></tr><tr><td>返回值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>APP 在将 dmabuf 送给 DE 显示之前必须进行绑定，否则无法显示 buf 中的内容</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="55314-aicfb_put_dmabuf">5.5.3.14. AICFB_PUT_DMABUF<a href="#55314-aicfb_put_dmabuf" class="hash-link" aria-label="5.5.3.14. AICFB_PUT_DMABUF的直接链接" title="5.5.3.14. AICFB_PUT_DMABUF的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_dmabuf_fd *fds);</th></tr></thead><tbody><tr><td>功能说明</td><td>通知 fb 驱动解绑 DMA-BUF</td></tr><tr><td>参数定义</td><td>CMD: AICFB_PUT_DMABUFfds: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-dmabuf-fd">struct aicfb_dmabuf_fd</a> 定义</td></tr><tr><td>返回 值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>无</td></tr></tbody></table>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="55315-aicfb_to_dmabuf_fd">5.5.3.15. AICFB_TO_DMABUF_FD<a href="#55315-aicfb_to_dmabuf_fd" class="hash-link" aria-label="5.5.3.15. AICFB_TO_DMABUF_FD的直接链接" title="5.5.3.15. AICFB_TO_DMABUF_FD的直接链接">​</a></h5>
<table><thead><tr><th>接口定义</th><th>int ioctl(int fd, unsigned long cmd, struct aicfb_dmabuf_fd *fds);</th></tr></thead><tbody><tr><td>功能说明</td><td>将 /dev/fb0 导出为一个 dmabuf fd</td></tr><tr><td>参数定义</td><td>CMD: AICFB_TO_DMABUF_FDfds: 参考结构体 <a href="/docs/D213-DevKit/part3/data_structure.html#ref-to-aicfb-dmabuf-fd">struct aicfb_dmabuf_fd</a> 定义</td></tr><tr><td>返回 值</td><td>0：成功-1：失败</td></tr><tr><td>注意事项</td><td>导出的 dmabuf fd 不支持 mmap 操作，无法得到一个有效的虚拟地址</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="56-app-demo">5.6. APP Demo<a href="#56-app-demo" class="hash-link" aria-label="5.6. APP Demo的直接链接" title="5.6. APP Demo的直接链接">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="561-framebuffer标准接口的使用">5.6.1. Framebuffer标准接口的使用<a href="#561-framebuffer标准接口的使用" class="hash-link" aria-label="5.6.1. Framebuffer标准接口的使用的直接链接" title="5.6.1. Framebuffer标准接口的使用的直接链接">​</a></h4>
<p>标准framebuffer接口操作示例:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int main()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int fd = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct fb_var_screeninfo vi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct fb_fix_screeninfo fi;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void *fb_ptr = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fd = open(&quot;/dev/fb0&quot;, O_RDWR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (fd &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;failed to open fb0\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取可变屏幕参数，如分辨率，像素格式</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ioctl(fd, FBIOGET_VSCREENINFO, &amp;vi) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;failed to get fb0 info\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close(fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 获取屏幕固定参数，包括显存起始物理地址、显存大小和行间距</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ioctl(fd, FBIOGET_FSCREENINFO, &amp;fi) &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;failed to get fb0 info\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close(fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // framebuffer 缓冲区映射到用户空间：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fb_ptr = mmap(0, fi.smem_len, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (fb_ptr == MAP_FAILED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;failed to mmap framebuffer\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close(fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 用户可以直接把要显示到屏幕的图像数据写入fb_ptr即可</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ........</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    munmap(fb_ptr, fi.smem_len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close(fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="562-aicfb扩展接口的使用">5.6.2. AICFB扩展接口的使用<a href="#562-aicfb扩展接口的使用" class="hash-link" aria-label="5.6.2. AICFB扩展接口的使用的直接链接" title="5.6.2. AICFB扩展接口的使用的直接链接">​</a></h4>
<p>代码详见 source/artinchip/test-fb/test_fb.c</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SPDX-License-Identifier: GPL-2.0-only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Copyright (C) 2020-2021 Artinchip Technology Co., Ltd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Authors:  Matteo &lt;duanmt@artinchip.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;base.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &quot;artinchip_fb.h&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Global macro and variables */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_LAYER_MAX_NUM 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define FB_DEV &quot;/dev/fb0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char sopts[] = &quot;nscflLaAkKedw:h:m:v:u&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const struct option lopts[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_layer_num&quot;,   no_argument, NULL, &#x27;n&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_screen_size&quot;, no_argument, NULL, &#x27;s&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_layer_cap&quot;,   no_argument, NULL, &#x27;c&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_fb_layer&quot;,    no_argument, NULL, &#x27;f&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_layer&quot;,       no_argument, NULL, &#x27;l&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;set_layer&quot;,       no_argument, NULL, &#x27;L&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_alpha&quot;,       no_argument, NULL, &#x27;a&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;set_alpha&quot;,     required_argument, NULL, &#x27;A&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;get_ck_cfg&quot;,      no_argument, NULL, &#x27;k&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;set_ck_cfg&quot;,      no_argument, NULL, &#x27;K&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;enable&quot;,      no_argument, NULL, &#x27;e&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;disable&quot;,     no_argument, NULL, &#x27;d&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;id&quot;,        required_argument, NULL, &#x27;i&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;width&quot;,     required_argument, NULL, &#x27;w&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;height&quot;,    required_argument, NULL, &#x27;h&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;mode&quot;,      required_argument, NULL, &#x27;m&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;value&quot;,     required_argument, NULL, &#x27;v&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;usage&quot;,       no_argument, NULL, &#x27;u&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {0, 0, 0, 0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Functions */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void usage(char *program)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Usage: %s [options]: \n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -n, --get_layer_num \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -s, --get_screen_size \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -c, --get_layer_cap \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -f, --get_fb_layer \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -l, --get_layer \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -L, --set_layer\tneed other options: -i x -e/d -w y -h z\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -a, --get_alpha \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -A, --set_alpha\tneed other options: -e/d -m x -v y \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -k, --get_ck_cfg \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -K, --set_ck_cfg\tneed other options: -e/d -v x \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -e, --enable \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -d, --disable \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -i, --id\t\tneed an integer argument of Layer ID\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -w, --width\t\tneed an integer argument\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -h, --height\t\tneed an integer argument\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -m, --mode\t\tneed an integer argument\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -v, --value\t\tneed an integer argument\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -u, --usage \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Example: %s -l\n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Example: %s -L -i 1 -e -w 800 -h 480\n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Example: %s -A -e -w 800 -h 480\n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Example: %s -K -e -v 0x3F\n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Open a device file to be needed. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int device_open(char *_fname, int _flag)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s32 fd = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fd = open(_fname, _flag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (fd &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Failed to open %s&quot;, _fname);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exit(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_layer_num(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_layer_num n = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, AICFB_GET_LAYER_NUM, &amp;n);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;The number of video layer: %d\n&quot;, n.vi_num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;The number of UI layer: %d\n&quot;, n.ui_num);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_layer_cap(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_layer_capability cap = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_LAYER_MAX_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        memset(&amp;cap, 0, sizeof(struct aicfb_layer_capability));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        cap.layer_id = i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret = ioctl(fd, AICFB_GET_LAYER_CAPABILITY, &amp;cap);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;\n--------------- Layer %d ---------------\n&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Type: %s\n&quot;, cap.layer_type == AICFB_LAYER_TYPE_VIDEO ?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            &quot;Video&quot; : &quot;UI&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Max Width: %d (%#x)\n&quot;, cap.max_width, cap.max_width);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Max height: %d (%#x)\n&quot;, cap.max_height, cap.max_height);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Flag: %#x\n&quot;, cap.cap_flags);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;---------------------------------------\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_one_layer_cfg(int fd, int cmd, int id)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_layer_data layer = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.layer_id = id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, cmd, &amp;layer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\n--------------- Layer %d ---------------\n&quot;, layer.layer_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Enable: %d\n&quot;, layer.enable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Layer ID: %d\n&quot;, layer.layer_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Rect ID: %d\n&quot;, layer.rect_id);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Scale Size: w %d, h %d\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.scale_size.width, layer.scale_size.height);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Position: x %d, y %d\n&quot;, layer.pos.x, layer.pos.y);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Buffer: \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tPixel format: %#x\n&quot;, layer.buf.format);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tPhysical addr: %#x %#x %#x\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.buf.phy_addr[0], layer.buf.phy_addr[1],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.buf.phy_addr[2]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tStride: %d %d %d\n&quot;, layer.buf.stride[0],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.buf.stride[1], layer.buf.stride[2]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tSize: w %d, h %d\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.buf.size.width, layer.buf.size.height);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tCrop enable: %d\n&quot;, layer.buf.crop_en);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tCrop: x %d, y %d, w %d, h %d\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.buf.crop.x, layer.buf.crop.y,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        layer.buf.crop.width, layer.buf.crop.height);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\tFlag: %#x\n&quot;, layer.buf.buf_flags);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;---------------------------------------\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_fb_layer_cfg(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return get_one_layer_cfg(fd, AICFB_GET_FB_LAYER_CONFIG, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_layer_cfg(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_LAYER_MAX_NUM; i++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        get_one_layer_cfg(fd, AICFB_GET_LAYER_CONFIG, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int set_layer_cfg(int fd, int id, int enable, int width, int height)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_layer_data layer = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((id &lt; 0) || (enable &lt; 0) || (width &lt; 0) || (height &lt; 0)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Invalid argument.\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.layer_id = id;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.enable = enable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.scale_size.width = layer.buf.size.width;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.scale_size.height = layer.buf.size.height;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, AICFB_UPDATE_LAYER_CONFIG, &amp;layer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_layer_alpha(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_alpha_config alpha = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 1; i &lt; AICFB_LAYER_MAX_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        alpha.layer_id = i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret = ioctl(fd, AICFB_GET_ALPHA_CONFIG, &amp;alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;\n--------------- Layer %d ---------------\n&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Alpha enable: %d\n&quot;, alpha.enable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Alpla mode: %d (0, pixel; 1, global; 2, mix)\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            alpha.mode);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Alpha value: %d (%#x)\n&quot;, alpha.value, alpha.value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;---------------------------------------\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int set_layer_alpha(int fd, int enable, int mode, int val)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_alpha_config alpha = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((enable &lt; 0) || (mode &lt; 0) || (val &lt; 0)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Invalid argument.\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.layer_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.enable = enable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.mode = mode;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.value = val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, AICFB_UPDATE_ALPHA_CONFIG, &amp;alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_ck_cfg(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_ck_config ck = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 1; i &lt; AICFB_LAYER_MAX_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ck.layer_id = i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret = ioctl(fd, AICFB_GET_CK_CONFIG, &amp;ck);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;\n--------------- Layer %d ---------------\n&quot;, i);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Color key enable: %d\n&quot;, ck.enable);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;Color key value: R %#x, G %#x, B %#x\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            (ck.value &gt;&gt; 16) &amp; 0xFF, (ck.value &gt;&gt; 8) &amp; 0xFF,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ck.value &amp; 0xFF);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        printf(&quot;---------------------------------------\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int set_ck_cfg(int fd, int enable, int val)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_ck_config ck = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((enable &lt; 0) || (val &lt; 0)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Invalid argument.\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ck.layer_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ck.enable = enable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ck.value = val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, AICFB_UPDATE_CK_CONFIG, &amp;ck);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int get_screen_size(int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aic_size s = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, AICFB_GET_SCREEN_SIZE, &amp;s);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() return %d\n&quot;, ret);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Screen width: %d (%#x)\n&quot;, s.width, s.width);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Screen height: %d (%#x)\n&quot;, s.height, s.height);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char **argv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int dev_fd = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int c = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int layer_id = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int enable = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int mode = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int width = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int height = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int value = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    dev_fd = device_open(FB_DEV, O_RDWR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (dev_fd &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Failed to open %s, return %d\n&quot;, FB_DEV, dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while ((c = getopt_long(argc, argv, sopts, lopts, NULL)) != -1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;n&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_layer_num(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;s&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_screen_size(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;c&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_layer_cap(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;f&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_fb_layer_cfg(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;l&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_layer_cfg(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;a&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_layer_alpha(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;k&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = get_ck_cfg(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;e&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enable = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;d&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            enable = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;i&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            layer_id = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;w&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            width = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;h&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            height = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;m&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            mode = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;v&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            value = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;u&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            usage(argv[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    optind = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while ((c = getopt_long(argc, argv, sopts, lopts, NULL)) != -1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;L&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = set_layer_cfg(dev_fd, layer_id, enable, width, height);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;A&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = set_layer_alpha(dev_fd, enable, mode, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;K&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ret = set_ck_cfg(dev_fd, enable, value);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            goto end;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (dev_fd &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close(dev_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="563-dma-buf的使用">5.6.3. DMA-BUF的使用<a href="#563-dma-buf的使用" class="hash-link" aria-label="5.6.3. DMA-BUF的使用的直接链接" title="5.6.3. DMA-BUF的使用的直接链接">​</a></h4>
<p>代码详见 source/artinchip/test-dma-buf/</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// SPDX-License-Identifier: GPL-2.0-only</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Copyright (C) 2020-2021 Artinchip Technology Co., Ltd.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Authors:  Matteo &lt;duanmt@artinchip.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;artinchip/sample_base.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;linux/dma-buf.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;linux/dma-heap.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;video/artinchip_fb.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Global macro and variables */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AICFB_VID_BUF_NUM   2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define AIC_CMA_BUF_MAX     (8 * 1024 * 1024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define DMA_HEAP_DEV        &quot;/dev/dma_heap/reserved&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#define FB_DEV          &quot;/dev/fb0&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const char sopts[] = &quot;m:w:h:f:i:u&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static const struct option lopts[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;width&quot;,     required_argument, NULL, &#x27;w&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;height&quot;,    required_argument, NULL, &#x27;h&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;format&quot;,    required_argument, NULL, &#x27;f&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;input&quot;,     required_argument, NULL, &#x27;i&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {&quot;usage&quot;,       no_argument, NULL, &#x27;u&#x27;},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {0, 0, 0, 0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct video_data_format {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    enum aic_pixel_format format;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    char f_str[12];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y_shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int u_shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int v_shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct video_data_format g_vformat[] = {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {AIC_FMT_YUV420P, &quot;yuv420p&quot;, 0, 2, 2},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {AIC_FMT_YUV422P, &quot;yuv422p&quot;, 0, 1, 1},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {AIC_FMT_YUV444P, &quot;yuv444p&quot;, 0, 0, 0},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {AIC_FMT_MAX, &quot;&quot;, 0, 0, 0}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct video_plane {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    char *buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int len;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct video_buf {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_plane y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_plane u;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_plane v;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">struct aicfb_video_layer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_data_format *f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_buf vbuf[AICFB_VID_BUF_NUM];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static int g_fb_fd = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static struct aicfb_video_layer g_vlayer = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Functions */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void usage(char *program)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Usage: %s [options]: \n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -w, --width\t\tneed an integer argument\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -h, --height\t\tneed an integer argument\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -f, --format\t\tvideo format, yuv420p etc\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -i, --input\t\tneed a file name \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\t -u, --usage \n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;\n&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    printf(&quot;Example: %s -w 480 -h 320 -f yuv420p -i my.yuv\n&quot;, program);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Open a device file to be needed. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int device_open(char *_fname, int _flag)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s32 fd = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fd = open(_fname, _flag);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (fd &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Failed to open %s&quot;, _fname);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        exit(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int vidbuf_request_one(struct video_plane *plane, int len, int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    char *buf = NULL;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct dma_heap_allocation_data data = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ((len &lt; 0) || (len &gt; AIC_CMA_BUF_MAX)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Invalid len %d\n&quot;, len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data.fd = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data.len = len;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data.fd_flags = O_RDWR;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data.heap_flags = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(fd, DMA_HEAP_IOCTL_ALLOC, &amp;data);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() failed! errno: %d[%s]\n&quot;, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DBG(&quot;Get dma_heap fd: %d\n&quot;, data.fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plane-&gt;fd = data.fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    buf = mmap(NULL, len, PROT_READ|PROT_WRITE, MAP_SHARED, data.fd, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (buf == MAP_FAILED) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;mmap() failed! errno: %d[%s]\n&quot;, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DBG(&quot;Get virtual address: %p\n&quot;, buf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plane-&gt;buf = buf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    plane-&gt;len = len;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void aic_fb_open(void)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (g_fb_fd &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    g_fb_fd = device_open(FB_DEV, O_RDWR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (g_fb_fd &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Failed to open %s. errno: %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            FB_DEV, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int set_ui_layer_alpha(int val)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_alpha_config alpha = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.layer_id = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.enable = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.mode = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    alpha.value = val;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret = ioctl(g_fb_fd, AICFB_UPDATE_ALPHA_CONFIG, &amp;alpha);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() failed! errno: %d[%s]\n&quot;, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int vidbuf_request(struct aicfb_video_layer *vlayer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i, j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int heap_fd = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int y_frame = vlayer-&gt;w * vlayer-&gt;h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    heap_fd = device_open(DMA_HEAP_DEV, O_RDWR);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (heap_fd &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;Failed to open %s, errno: %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DMA_HEAP_DEV, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /* Prepare two group buffer for video player,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       and each group has three planes: y, u, v. */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_VID_BUF_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct video_plane *p = (struct video_plane *)&amp;vlayer-&gt;vbuf[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        int *shift = &amp;vlayer-&gt;f-&gt;y_shift;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (j = 0; j &lt; AICFB_PLANE_NUM; j++, p++)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vidbuf_request_one(p, y_frame &gt;&gt; shift[j], heap_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    close(heap_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void vidbuf_release(struct aicfb_video_layer *vlayer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i, j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_VID_BUF_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct video_plane *p = (struct video_plane *)&amp;vlayer-&gt;vbuf[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (j = 0; j &lt; AICFB_PLANE_NUM; j++, p++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (munmap(p-&gt;buf, p-&gt;len) &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ERR(&quot;munmap() failed! errno: %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void vidbuf_dmabuf_begin(struct aicfb_video_layer *vlayer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i, j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_dmabuf_fd fds = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_VID_BUF_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct video_plane *plane = (struct video_plane *)&amp;vlayer-&gt;vbuf[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (j = 0; j &lt; AICFB_PLANE_NUM; j++, plane++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fds.fd = plane-&gt;fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (ioctl(g_fb_fd, AICFB_GET_DMABUF, &amp;fds) &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ERR(&quot;ioctl() failed! err %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void vidbuf_dmabuf_end(struct aicfb_video_layer *vlayer)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i, j;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_dmabuf_fd fds = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_VID_BUF_NUM; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct video_plane *plane = (struct video_plane *)&amp;vlayer-&gt;vbuf[i];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (j = 0; j &lt; AICFB_PLANE_NUM; j++, plane++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fds.fd = plane-&gt;fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (ioctl(g_fb_fd, AICFB_PUT_DMABUF, &amp;fds) &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ERR(&quot;ioctl() failed! err %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void video_layer_set(struct aicfb_video_layer *vlayer, int index)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct aicfb_layer_data layer = {0};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_buf *vbuf = &amp;vlayer-&gt;vbuf[index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.layer_id = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.enable = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.scale_size.width = vlayer-&gt;w * 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.scale_size.height = vlayer-&gt;h * 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.pos.x = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.pos.y = 10;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.size.width = vlayer-&gt;w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.size.height = vlayer-&gt;h;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.format = vlayer-&gt;f-&gt;format;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.dmabuf_fd[0] = vbuf-&gt;y.fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.dmabuf_fd[1] = vbuf-&gt;u.fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.dmabuf_fd[2] = vbuf-&gt;v.fd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.stride[0] = vlayer-&gt;w;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.stride[1] = vlayer-&gt;w &gt;&gt; 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    layer.buf.stride[2] = vlayer-&gt;w &gt;&gt; 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (ioctl(g_fb_fd, AICFB_UPDATE_LAYER_CONFIG, &amp;layer) &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ERR(&quot;ioctl() failed! err %d[%s]\n&quot;, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void vidbuf_cpu_begin(struct video_buf *vbuf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct dma_buf_sync flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_plane *p = (struct video_plane *)vbuf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_PLANE_NUM; i++, p++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        flag.flags = DMA_BUF_SYNC_WRITE | DMA_BUF_SYNC_START;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ioctl(p-&gt;fd, DMA_BUF_IOCTL_SYNC, &amp;flag) &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ERR(&quot;ioctl() failed! err %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void vidbuf_cpu_end(struct video_buf *vbuf)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct dma_buf_sync flag;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_plane *p = (struct video_plane *)vbuf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_PLANE_NUM; i++, p++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        flag.flags = DMA_BUF_SYNC_WRITE | DMA_BUF_SYNC_END;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ioctl(p-&gt;fd, DMA_BUF_IOCTL_SYNC, &amp;flag) &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ERR(&quot;ioctl() failed! err %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int vidbuf_read(struct aicfb_video_layer *vlayer, int index, int fd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i, ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    static int frame_cnt = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    struct video_plane *p = (struct video_plane *)&amp;vlayer-&gt;vbuf[index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (frame_cnt == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lseek(fd, 0, SEEK_SET);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; i &lt; AICFB_PLANE_NUM; i++, p++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        DBG(&quot;Frame %d - %d, offset %ld, len %d\n&quot;, frame_cnt, i,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             lseek(fd, 0, SEEK_CUR), p-&gt;len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret = read(fd, p-&gt;buf, p-&gt;len);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ret != p-&gt;len) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ERR(&quot;read(%d) return %d. errno: %d[%s]\n&quot;, p-&gt;len,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ret, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    frame_cnt++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int format_parse(char *str)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for (i = 0; g_vformat[i].format != AIC_FMT_MAX; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (strncasecmp(g_vformat[i].f_str, str, strlen(str)) == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ERR(&quot;Invalid format: %s\n&quot;, str);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char **argv)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int vid_fd = -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int ret = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int c = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int fsize = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int index = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    DBG(&quot;Compile time: %s\n&quot;, __TIME__);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    while ((c = getopt_long(argc, argv, sopts, lopts, NULL)) != -1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        switch (c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;w&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g_vlayer.w = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;h&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g_vlayer.h = str2int(optarg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            continue;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;f&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            g_vlayer.f = &amp;g_vformat[format_parse(optarg)];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;i&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            vid_fd = device_open(optarg, O_RDONLY);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (vid_fd &lt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ERR(&quot;Failed to open %s. errno: %d[%s]\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    optarg, errno, strerror(errno));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return -1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fsize = lseek(vid_fd, 0, SEEK_END);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            DBG(&quot;open(%s) %d, size %d\n&quot;, optarg, vid_fd, fsize);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        case &#x27;u&#x27;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            usage(argv[0]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    aic_fb_open();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    set_ui_layer_alpha(128);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vidbuf_request(&amp;g_vlayer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vidbuf_dmabuf_begin(&amp;g_vlayer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    do {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        struct video_buf *vbuf = &amp;g_vlayer.vbuf[index];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vidbuf_cpu_begin(vbuf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ret = vidbuf_read(&amp;g_vlayer, index, vid_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vidbuf_cpu_end(vbuf);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (ret &lt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        video_layer_set(&amp;g_vlayer, index);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        index = !index;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        usleep(40000);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (lseek(vid_fd, 0, SEEK_CUR) == fsize)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } while (1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vidbuf_dmabuf_end(&amp;g_vlayer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    vidbuf_release(&amp;g_vlayer);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (vid_fd &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close(vid_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (g_fb_fd &gt; 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        close (g_fb_fd);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return ret;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/100askTeam/ArtInChip-Docs/tree/master/docs/D213-DevKit/part3/06-3_Display-Useguide.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/D213-DevKit/part3/06-2_VE-Useguide"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">VE 使用指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/D213-DevKit/part3/06-4_DVP-Useguide"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">DVP开发指南</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-模块介绍" class="table-of-contents__link toc-highlight">1. 模块介绍</a><ul><li><a href="#11-术语定义" class="table-of-contents__link toc-highlight">1.1. 术语定义</a></li><li><a href="#12-系统简介" class="table-of-contents__link toc-highlight">1.2. 系统简介</a></li><li><a href="#13-特性说明" class="table-of-contents__link toc-highlight">1.3. 特性说明</a></li></ul></li><li><a href="#2-参数配置" class="table-of-contents__link toc-highlight">2. 参数配置</a><ul><li><a href="#21-menuconfig配置" class="table-of-contents__link toc-highlight">2.1. menuconfig配置</a></li><li><a href="#22-dts参数配置" class="table-of-contents__link toc-highlight">2.2. DTS参数配置</a></li></ul></li><li><a href="#3-调试指南" class="table-of-contents__link toc-highlight">3. 调试指南</a><ul><li><a href="#31-调试开关" class="table-of-contents__link toc-highlight">3.1. 调试开关</a></li><li><a href="#32-component" class="table-of-contents__link toc-highlight">3.2. Component</a></li><li><a href="#33-cma" class="table-of-contents__link toc-highlight">3.3. CMA</a></li><li><a href="#34-dma-buf" class="table-of-contents__link toc-highlight">3.4. DMA-BUF</a></li><li><a href="#35-devfb" class="table-of-contents__link toc-highlight">3.5. /dev/fb</a></li><li><a href="#36-display-engine" class="table-of-contents__link toc-highlight">3.6. Display Engine</a></li><li><a href="#37-color-bar" class="table-of-contents__link toc-highlight">3.7. Color bar</a></li><li><a href="#38-framebuffer-截图" class="table-of-contents__link toc-highlight">3.8. Framebuffer 截图</a></li></ul></li><li><a href="#4-测试指南" class="table-of-contents__link toc-highlight">4. 测试指南</a><ul><li><a href="#41-测试环境" class="table-of-contents__link toc-highlight">4.1. 测试环境</a></li><li><a href="#42-test_dmabuf-测试" class="table-of-contents__link toc-highlight">4.2. test_dmabuf 测试</a></li></ul></li><li><a href="#5-设计说明" class="table-of-contents__link toc-highlight">5. 设计说明</a><ul><li><a href="#51-源码和文档说明" class="table-of-contents__link toc-highlight">5.1. 源码和文档说明</a></li><li><a href="#52-模块架构" class="table-of-contents__link toc-highlight">5.2. 模块架构</a></li><li><a href="#53-关键流程设计" class="table-of-contents__link toc-highlight">5.3. 关键流程设计</a></li><li><a href="#54-数据结构设计" class="table-of-contents__link toc-highlight">5.4. 数据结构设计</a></li><li><a href="#55-接口设计" class="table-of-contents__link toc-highlight">5.5. 接口设计</a></li><li><a href="#56-app-demo" class="table-of-contents__link toc-highlight">5.6. APP Demo</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://dongshanpi.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">DongshanPI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://canaan-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Canaan-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://renesas-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Renesas-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://rtos.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">RTOS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://tina.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">TinaSDK-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://allwinner-docs.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Allwinner-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://aw-r128.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">R128-Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://space.bilibili.com/275908810" target="_blank" rel="noopener noreferrer" class="footer__link-item">BiliBili<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.100ask.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://video.100ask.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">VideoCenter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/dongshanpi" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://weidongshan.coding.net/public/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Coding<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/100askTeam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/weidongshan" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 100askTeam, Inc. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>